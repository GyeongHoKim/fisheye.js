(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var pr="0.9.0",l=Symbol(`typegpu:${pr}:$internal`),F=Symbol(`typegpu:${pr}:$gpuValueOf`),ue=Symbol(`typegpu:${pr}:$getNameForward`),ur=Symbol(`typegpu:${pr}:$providing`),ke=Symbol(`typegpu:${pr}:$ownSnippet`),z=Symbol(`typegpu:${pr}:$resolve`),Xr=Symbol(`typegpu:${pr}:$repr`);function C(e){return!!e?.[l]}var se={[l]:!0,type:"void",toString(){return"void"}},Dl=["bool","f32","f16","i32","u32","u16","vec2f","vec2h","vec2i","vec2u","vec2<bool>","vec3f","vec3h","vec3i","vec3u","vec3<bool>","vec4f","vec4h","vec4i","vec4u","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","struct","array","ptr","atomic","decorated","abstractInt","abstractFloat","void","texture_1d","texture_storage_1d","texture_2d","texture_storage_2d","texture_multisampled_2d","texture_depth_2d","texture_depth_multisampled_2d","texture_2d_array","texture_storage_2d_array","texture_depth_2d_array","texture_cube","texture_depth_cube","texture_cube_array","texture_depth_cube_array","texture_3d","texture_storage_3d","texture_external","sampler","sampler_comparison"];function te(e){let t=e;return C(t)&&typeof t.kind=="string"&&t.kind.startsWith("vec")}function ps(e){let t=e;return C(t)&&typeof t.type=="string"&&t.type.startsWith("vec2")}function ds(e){let t=e;return C(t)&&typeof t.type=="string"&&t.type.startsWith("vec3")}function Ho(e){let t=e;return C(t)&&typeof t.type=="string"&&t.type.startsWith("vec4")}function ft(e){return ps(e)||ds(e)||Ho(e)}function pt(e){let t=e;return C(t)&&typeof t.kind?.startsWith=="function"&&t.kind.startsWith("mat")}function Yo(e){return C(e)&&e?.type==="mat2x2f"}function Xo(e){return C(e)&&e?.type==="mat3x3f"}function Nl(e){return C(e)&&e?.type==="mat4x4f"}function fi(e){return Yo(e)||Xo(e)||Nl(e)}function Wa(e){return te(e)&&["vec2f","vec3f","vec4f"].includes(e.kind)}function Zt(e){return C(e)&&Dl.includes(e?.type)}function Ie(e){return C(e)&&e?.type==="array"}function ye(e){return C(e)&&e?.type==="struct"}function Xe(e){return C(e)&&e?.type==="ptr"}function mi(e){return C(e)&&e?.type==="atomic"}function Gs(e){return C(e)&&e?.type==="@align"}function Ls(e){return C(e)&&e?.type==="@size"}function Zo(e){return C(e)&&e?.type==="@location"}function Wl(e){return C(e)&&e?.type==="@interpolate"}function Ds(e){return C(e)&&e?.type==="@builtin"}function Ze(e){return C(e)&&e?.type==="decorated"}function Ko(e){return C(e)&&e.type==="void"}function Wt(e){let t=e?.type;return C(e)&&(t==="abstractInt"||t==="abstractFloat"||t==="f32"||t==="f16"||t==="i32"||t==="u32")}function Ns(e){let t=e?.type;return C(e)&&(t==="f16"||t==="vec2h"||t==="vec3h"||t==="vec4h")}var ql=["abstractInt","abstractFloat","f32","f16","i32","u32","bool"];function _e(e){return!C(e)||ql.includes(e?.type)}function Hl(e){return e.schema}Object.assign(globalThis,{__TYPEGPU_AUTONAME__:(e,t)=>(Pi(e)&&C(e)&&!b(e)&&e.$name(t),e)});var fs=globalThis;function Qo(e){return!!e?.[ue]}function b(e){return Qo(e)?b(e[ue]):Ui(e)?.name}function G(e,t){Qo(e)&&G(e[ue],t),Yl(e,{name:t})}function Pi(e){return!!e?.$name}function yn(e){return!!Ui(e)?.ast}function Ui(e){return fs.__TYPEGPU_META__.get(e)}function Yl(e,t){fs.__TYPEGPU_META__??=new WeakMap;let r=fs.__TYPEGPU_META__;r.set(e,{...r.get(e),...t})}var Jo=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],Xl={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"};function St(e){return e.type==="decorated"||e.type==="loose-decorated"?e.inner:e}function Zn(e){return e.type==="ptr"?e.inner:e}var Zl=["unstruct","disarray","loose-decorated",...Jo];function Zr(e){return C(e)&&Zl.includes(e?.type)}function Et(e){return C(e)&&e?.type==="disarray"}function Ke(e){return C(e)&&e?.type==="unstruct"}function Qe(e){return C(e)&&e?.type==="loose-decorated"}function gn(e){return e.attribs?.find(Gs)?.params[0]}function Kl(e){return e.attribs?.find(Ls)?.params[0]}function qt(e){return e.attribs?.find(Zo)?.params[0]}function Kr(e){return Zt(e)||Zr(e)}var Ye={type:"unknown",toString(){return"unknown"}},eu=class{constructor(t,r,n){this.name=t,this.lhs=r,this.operator=n}},tu=class{constructor(t){this.matrix=t}},qa=class{constructor(t){this.op=t,G(this,"consoleLog")}[l]=!0},Ql="Invariant failed";function dt(e,t){if(!e)throw new Error(Ql)}var Fr=class ms extends Error{constructor(t,r){let n=r.map(i=>`- ${yn(i)?`fn*:${b(i)}`:i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Resolution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,ms.prototype)}appendToTrace(t){let r=[t,...this.trace];return new ms(this.cause,r)}},Ha=class ys extends Error{constructor(t,r){let n=r.map(i=>`- ${i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Execution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,ys.prototype)}appendToTrace(t){let r=[t,...this.trace];return new ys(this.cause,r)}},Jl=class ru extends Error{constructor(t){super(`Missing value for '${t}'`),this.slot=t,Object.setPrototypeOf(this,ru.prototype)}},ec=class nu extends Error{constructor(t){super(`Buffer '${b(t)??"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,nu.prototype)}},tc=class iu extends Error{constructor(t,r){super(`The function '${t??"<unnamed>"}' is missing links to the following external values: ${r}.`),Object.setPrototypeOf(this,iu.prototype)}},Ws=class su extends Error{constructor(t){super(`Missing bind groups for layouts: '${[...t].map(r=>b(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(bindGroup).(...)`),Object.setPrototypeOf(this,su.prototype)}},au=class ou extends Error{constructor(t){super(`Missing vertex buffers for layouts: '${[...t].map(r=>b(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(layout, buffer).(...)`),Object.setPrototypeOf(this,ou.prototype)}},Ya=class uu extends Error{constructor(t){super(t),Object.setPrototypeOf(this,uu.prototype)}},Xa=class hu extends Error{constructor(t){super(t),Object.setPrototypeOf(this,hu.prototype)}},j=class lu extends Error{constructor(t){super(t),Object.setPrototypeOf(this,lu.prototype)}};function gs(e){return e?.resourceType==="slot"}function ws(e){return e?.resourceType==="derived"}function xs(e){return e?.[ur]!==void 0}function Vi(e){return e?.resourceType==="accessor"}function cu(e){return e==="runtime"||e==="constant"||e==="argument"}function jr(e){return cu(e.origin)}var rc={uniform:{space:"uniform",access:"read"},readonly:{space:"storage",access:"read"},mutable:{space:"storage",access:"read-write"},workgroup:{space:"workgroup",access:"read-write"},private:{space:"private",access:"read-write"},function:{space:"function",access:"read-write"},"this-function":{space:"function",access:"read-write"}},pu=class{constructor(t,r,n){this.value=t,this.dataType=r,this.origin=n}};function qs(e){return e instanceof pu}function Kn(e){return Wt(e.dataType)}function y(e,t,r){return new pu(e,St(t),r)}function Hs(e){return Pt("function",e,"read-write")}function nc(e){return Pt("private",e,"read-write")}function ic(e){return Pt("workgroup",e,"read-write")}function sc(e,t="read"){return Pt("storage",e,t)}function ac(e){return Pt("uniform",e,"read")}function oc(e){return Pt("handle",e,"read")}function Pt(e,t,r,n=!1){return{[l]:!0,type:"ptr",addressSpace:e,inner:t,access:r,implicit:n,toString:()=>`ptr<${e}, ${t}, ${r}>`}}function du(e,t){let r=rc[e];if(r)return Pt(r.space,t,r.access)}function uc(e){return Pt(e.addressSpace,e.inner,e.access,!0)}function hc(e){return Pt(e.addressSpace,e.inner,e.access,!1)}var Pn=class{type="normal"},lc=class{type="codegen"},cc=class{constructor(t,r){this.buffers=t,this.vars=r}type="simulate"};function fu(e){return!!e?.[z]}function Ai(e){return e?.[ke]}function Ve(e){return(typeof e.value!="string"||e.dataType.type==="unknown")&&Ai(e.value)===void 0}function pc(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||fu(e)||Zt(e)||gs(e)||ws(e)||xs(e)}function vs(e){return!!e&&typeof e=="object"&&"getMappedRange"in e&&"mapAsync"in e}var si=!1;function dc(e){if(si)return e();try{return si=!0,e()}finally{si=!1}}function yi(){return si}var Rt;function mu(e,t){if(dt(Rt===void 0||Rt===e),Rt===e)return t();Rt=e;try{return t()}finally{Rt=void 0}}function Ce(){return Rt}var yu=new Pn;function gi(){return Rt?.mode??yu}function et(){return Rt?.mode.type==="codegen"}function c(e,...t){let r=Ce();function n(s){return qs(s)?r.resolve(s.value,s.dataType).value:s}let i="";for(let s=0;s<e.length;++s){i+=e[s];let a=t[s];Array.isArray(a)?i+=a.filter(o=>o!==void 0).map(n).join(", "):a&&(i+=n(a))}return i}var fc=(()=>{let e=n=>{if(n.origin==="argument")throw new j(c`d.ref(${n}) is illegal, cannot take a reference of an argument. Copy the value locally first, and take a reference of the copy.`);if(n.dataType.type==="ptr")return y(n.value,hc(n.dataType),n.origin);let i=du(n.origin,n.dataType);return y(new zt(n,i),i??Ye,"runtime")},t=n=>new wu(n),r=n=>et()?e(n):t(n);return G(r,"ref"),r.toString=()=>"ref",Object.defineProperty(r,l,{value:{jsImpl:t,gpuImpl:e,strictSignature:void 0,argConversionHint:"keep"}}),r})();function gu(e){return e instanceof wu}var wu=class{[l];type;#e;constructor(t){this[l]=!0,this.type="ref",this.#e=t}get $(){return this.#e}set $(t){if(t&&typeof t=="object")for(let r of Object.keys(t))this.#e[r]=t[r];else this.#e=t}},zt=class{[l];snippet;#e;constructor(t,r){this[l]=!0,this.snippet=t,this.#e=r}get[ke](){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return y(this,this.#e,this.snippet.origin)}[z](t){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return y(c`(&${this.snippet})`,this.#e,this.snippet.origin)}};function Ys(e){if(!Xe(e.dataType))return e;let t=e.dataType.inner,r=_e(t)?"runtime":e.origin;return e.value instanceof zt?y(c`${e.value.snippet}`,t,r):y(c`(*${e})`,t,r)}function qr(e,t){throw new Error(`Failed to handle ${e} at ${t}`)}var Xs={rank:Number.POSITIVE_INFINITY,action:"none"};function wi(e,t){let r=St(e),n=St(t);if(r.type===n.type)return{rank:0,action:"none"};if(r.type==="abstractFloat"){if(n.type==="f32")return{rank:1,action:"none"};if(n.type==="f16")return{rank:2,action:"none"}}if(r.type==="abstractInt"){if(n.type==="i32")return{rank:3,action:"none"};if(n.type==="u32")return{rank:4,action:"none"};if(n.type==="abstractFloat")return{rank:5,action:"none"};if(n.type==="f32")return{rank:6,action:"none"};if(n.type==="f16")return{rank:7,action:"none"}}return ft(r)&&ft(n)?wi(r.primitive,n.primitive):fi(r)&&fi(n)?{rank:0,action:"none"}:Xs}function mc(e,t){let r=St(e),n=St(t);if(r.type==="ptr"&&r.implicit&&wi(r.inner,n).rank<Number.POSITIVE_INFINITY)return{rank:0,action:"deref"};if(n.type==="ptr"&&wi(r,n.inner).rank<Number.POSITIVE_INFINITY)return{rank:1,action:"ref"};let i={f32:0,f16:1,i32:2,u32:3,bool:4};if(r.type in i&&n.type in i){let s=r.type,a=n.type;if(s!==a){let o=i[s];return{rank:i[a]<o?10:20,action:"cast",targetType:n}}}if(r.type==="abstractFloat"){if(n.type==="u32")return{rank:2,action:"cast",targetType:n};if(n.type==="i32")return{rank:1,action:"cast",targetType:n}}return Xs}function yc(e,t,r){let n=wi(e,t);return n.rank<Number.POSITIVE_INFINITY?n:r?mc(e,t):Xs}function Za(e,t,r){let n;for(let s of t){let a=[],o=0;for(let u of e){let h=yc(u,s,r);if(o+=h.rank,h.rank===Number.POSITIVE_INFINITY)break;a.push(h)}o<(n?.sum??Number.POSITIVE_INFINITY)&&(n={type:s,details:a,sum:o})}if(!n)return;let i=n.details.map((s,a)=>({sourceIndex:a,action:s.action,...s.action==="cast"&&{targetType:s.targetType}}));return{targetType:n.type,actions:i,hasImplicitConversions:i.some(s=>s.action==="cast")}}function Zs(e,t){if(e.length===0)return;let r=[...new Set((t||e).map(St))],n=Za(e,r,!1);if(n)return n;let i=Za(e,r,!0);if(i)return i}function gc(e,t,r){if(t.action==="none")return y(e.value,r,e.origin);switch(t.action){case"ref":return y(new zt(e,r),r,e.origin);case"deref":return Ys(e);case"cast":return r(e);default:qr(t.action,"applyActionToSnippet")}}function ge(e,t){if(e.some(n=>n.type==="unknown"))return;let r=Zs(e,t);if(r)return e.map(()=>r.targetType)}function Rr(e,t,r=!0){let n=e.map(s=>s.dataType);if(n.some(s=>s.type==="unknown"))return;let i=Zs(n,t);if(i)return e.map((s,a)=>{let o=i.actions[a];return dt(o),gc(s,o,i.targetType)})}function nr(e,t,r=!0){if(t===e.dataType)return y(e.value,t,e.origin);if(e.dataType.type==="unknown")return y(c`${y(e.value,t,e.origin)}`,t,e.origin);let n=Rr([e],[t],r);if(!n)throw new j(`Cannot convert value of type '${String(e.dataType)}' to type '${t.type}'`);return n[0]}function wc(e,t){return Object.keys(e.propTypes).map(r=>{let n=t[r];if(!n)throw new Error(`Missing property ${r}`);let i=e.propTypes[r];return Rr([n],[i])?.[0]??n})}var Je=class extends Error{constructor(t){super(t),this.name=this.constructor.name}};function d(e){let t=(...n)=>{let i=Ce(),{argTypes:s,returnType:a}=typeof e.signature=="function"?e.signature(...n.map(u=>u.dataType.type==="ptr"&&u.dataType.implicit?u.dataType.inner:u.dataType)):e.signature,o=n.map((u,h)=>{let p=s[h];if(!p)throw new Error("Function called with invalid arguments");return nr(u,p,!e.ignoreImplicitCastWarning)});if(!e.noComptime&&o.every(u=>Ve(u))&&typeof e.normalImpl=="function"){i.pushMode(new Pn);try{return y(e.normalImpl(...o.map(u=>u.value)),a,"constant")}catch(u){if(!(u instanceof Je))throw u}finally{i.popMode("normal")}}return y(e.codegenImpl(...o),a,"runtime")},r=((...n)=>{if(et())return t(...n);if(typeof e.normalImpl=="string")throw new Je(e.normalImpl);return e.normalImpl(...n)});return G(r,e.name),r.toString=()=>e.name,Object.defineProperty(r,l,{value:{jsImpl:e.normalImpl,gpuImpl:t,get strictSignature(){return typeof e.signature!="function"?e.signature:void 0},argConversionHint:"keep"}}),r}var Un={[l]:!0,type:"abstractInt",toString(){return"abstractInt"}},mt={[l]:!0,type:"abstractFloat",toString(){return"abstractFloat"}},xc=d({name:"bool",signature:e=>({argTypes:e?[e]:[],returnType:R}),normalImpl(e){return e===void 0?!1:typeof e=="boolean"?e:!!e},codegenImpl:e=>e.dataType.type==="bool"?c`${e}`:c`bool(${e})`}),R=Object.assign(xc,{type:"bool"}),vc=d({name:"u32",signature:e=>({argTypes:e?[e]:[],returnType:$}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:(e&4294967295)>>>0},codegenImpl:e=>e.dataType.type==="u32"?c`${e}`:c`u32(${e})`}),$=Object.assign(vc,{type:"u32"}),bc=d({name:"i32",signature:e=>({argTypes:e?[e]:[],returnType:B}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:e|0},codegenImpl:e=>e.dataType.type==="i32"?c`${e}`:c`i32(${e})`}),$c={[l]:!0,type:"u16"},B=Object.assign(bc,{type:"i32"}),Tc=d({name:"f32",signature:e=>({argTypes:e?[e]:[],returnType:g}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Math.fround(e)},codegenImpl:e=>e.dataType.type==="f32"?c`${e}`:c`f32(${e})`}),g=Object.assign(Tc,{type:"f32"}),xu=new ArrayBuffer(4),_c=new Float32Array(xu),zc=new Uint32Array(xu);function Ic(e){_c[0]=e;let t=zc[0],r=t>>>31&1,n=t>>>23&255,i=t&8388607;return n===255?r<<15|31744|(i?512:0):(n=n-127+15,n<=0?n<-10?r<<15:(i=(i|8388608)>>1-n,i=i+4096>>13,r<<15|i):n>=31||(i=i+4096,i&8388608&&(i=0,++n,n>=31))?r<<15|31744:r<<15|n<<10|i>>13)}function Sc(e){let t=e&32768?-1:1,r=e>>10&31,n=e&1023;return r===0?n?t*n*2**-24:t*0:r===31?n?Number.NaN:t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t*(1+n/1024)*2**(r-15)}function Ec(e){return Sc(Ic(e))}var Mc=d({name:"f16",signature:e=>({argTypes:e?[e]:[],returnType:he}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Ec(e)},codegenImpl:e=>e.dataType.type==="f16"?c`${e}`:c`f16(${e})`}),he=Object.assign(Mc,{type:"f16"}),dr=class extends Array{castElement(){return this[l].elementSchema[l].jsImpl}[z](){let t=this[l].elementSchema;return this.every(r=>!r)?y(`${this.kind}()`,t,"constant"):this.every(r=>this[0]===r)?y(`${this.kind}(${this[0]})`,t,"runtime"):y(`${this.kind}(${this.join(", ")})`,t,"runtime")}toString(){return this[z]().value}get xx(){return new this._Vec2(this[0],this[0])}get xy(){return new this._Vec2(this[0],this[1])}get xz(){return new this._Vec2(this[0],this[2])}get xw(){return new this._Vec2(this[0],this[3])}get yx(){return new this._Vec2(this[1],this[0])}get yy(){return new this._Vec2(this[1],this[1])}get yz(){return new this._Vec2(this[1],this[2])}get yw(){return new this._Vec2(this[1],this[3])}get zx(){return new this._Vec2(this[2],this[0])}get zy(){return new this._Vec2(this[2],this[1])}get zz(){return new this._Vec2(this[2],this[2])}get zw(){return new this._Vec2(this[2],this[3])}get wx(){return new this._Vec2(this[3],this[0])}get wy(){return new this._Vec2(this[3],this[1])}get wz(){return new this._Vec2(this[3],this[2])}get ww(){return new this._Vec2(this[3],this[3])}get xxx(){return new this._Vec3(this[0],this[0],this[0])}get xxy(){return new this._Vec3(this[0],this[0],this[1])}get xxz(){return new this._Vec3(this[0],this[0],this[2])}get xxw(){return new this._Vec3(this[0],this[0],this[3])}get xyx(){return new this._Vec3(this[0],this[1],this[0])}get xyy(){return new this._Vec3(this[0],this[1],this[1])}get xyz(){return new this._Vec3(this[0],this[1],this[2])}get xyw(){return new this._Vec3(this[0],this[1],this[3])}get xzx(){return new this._Vec3(this[0],this[2],this[0])}get xzy(){return new this._Vec3(this[0],this[2],this[1])}get xzz(){return new this._Vec3(this[0],this[2],this[2])}get xzw(){return new this._Vec3(this[0],this[2],this[3])}get xwx(){return new this._Vec3(this[0],this[3],this[0])}get xwy(){return new this._Vec3(this[0],this[3],this[1])}get xwz(){return new this._Vec3(this[0],this[3],this[2])}get xww(){return new this._Vec3(this[0],this[3],this[3])}get yxx(){return new this._Vec3(this[1],this[0],this[0])}get yxy(){return new this._Vec3(this[1],this[0],this[1])}get yxz(){return new this._Vec3(this[1],this[0],this[2])}get yxw(){return new this._Vec3(this[1],this[0],this[3])}get yyx(){return new this._Vec3(this[1],this[1],this[0])}get yyy(){return new this._Vec3(this[1],this[1],this[1])}get yyz(){return new this._Vec3(this[1],this[1],this[2])}get yyw(){return new this._Vec3(this[1],this[1],this[3])}get yzx(){return new this._Vec3(this[1],this[2],this[0])}get yzy(){return new this._Vec3(this[1],this[2],this[1])}get yzz(){return new this._Vec3(this[1],this[2],this[2])}get yzw(){return new this._Vec3(this[1],this[2],this[3])}get ywx(){return new this._Vec3(this[1],this[3],this[0])}get ywy(){return new this._Vec3(this[1],this[3],this[1])}get ywz(){return new this._Vec3(this[1],this[3],this[2])}get yww(){return new this._Vec3(this[1],this[3],this[3])}get zxx(){return new this._Vec3(this[2],this[0],this[0])}get zxy(){return new this._Vec3(this[2],this[0],this[1])}get zxz(){return new this._Vec3(this[2],this[0],this[2])}get zxw(){return new this._Vec3(this[2],this[0],this[3])}get zyx(){return new this._Vec3(this[2],this[1],this[0])}get zyy(){return new this._Vec3(this[2],this[1],this[1])}get zyz(){return new this._Vec3(this[2],this[1],this[2])}get zyw(){return new this._Vec3(this[2],this[1],this[3])}get zzx(){return new this._Vec3(this[2],this[2],this[0])}get zzy(){return new this._Vec3(this[2],this[2],this[1])}get zzz(){return new this._Vec3(this[2],this[2],this[2])}get zzw(){return new this._Vec3(this[2],this[2],this[3])}get zwx(){return new this._Vec3(this[2],this[3],this[0])}get zwy(){return new this._Vec3(this[2],this[3],this[1])}get zwz(){return new this._Vec3(this[2],this[3],this[2])}get zww(){return new this._Vec3(this[2],this[3],this[3])}get wxx(){return new this._Vec3(this[3],this[0],this[0])}get wxy(){return new this._Vec3(this[3],this[0],this[1])}get wxz(){return new this._Vec3(this[3],this[0],this[2])}get wxw(){return new this._Vec3(this[3],this[0],this[3])}get wyx(){return new this._Vec3(this[3],this[1],this[0])}get wyy(){return new this._Vec3(this[3],this[1],this[1])}get wyz(){return new this._Vec3(this[3],this[1],this[2])}get wyw(){return new this._Vec3(this[3],this[1],this[3])}get wzx(){return new this._Vec3(this[3],this[2],this[0])}get wzy(){return new this._Vec3(this[3],this[2],this[1])}get wzz(){return new this._Vec3(this[3],this[2],this[2])}get wzw(){return new this._Vec3(this[3],this[2],this[3])}get wwx(){return new this._Vec3(this[3],this[3],this[0])}get wwy(){return new this._Vec3(this[3],this[3],this[1])}get wwz(){return new this._Vec3(this[3],this[3],this[2])}get www(){return new this._Vec3(this[3],this[3],this[3])}get xxxx(){return new this._Vec4(this[0],this[0],this[0],this[0])}get xxxy(){return new this._Vec4(this[0],this[0],this[0],this[1])}get xxxz(){return new this._Vec4(this[0],this[0],this[0],this[2])}get xxxw(){return new this._Vec4(this[0],this[0],this[0],this[3])}get xxyx(){return new this._Vec4(this[0],this[0],this[1],this[0])}get xxyy(){return new this._Vec4(this[0],this[0],this[1],this[1])}get xxyz(){return new this._Vec4(this[0],this[0],this[1],this[2])}get xxyw(){return new this._Vec4(this[0],this[0],this[1],this[3])}get xxzx(){return new this._Vec4(this[0],this[0],this[2],this[0])}get xxzy(){return new this._Vec4(this[0],this[0],this[2],this[1])}get xxzz(){return new this._Vec4(this[0],this[0],this[2],this[2])}get xxzw(){return new this._Vec4(this[0],this[0],this[2],this[3])}get xxwx(){return new this._Vec4(this[0],this[0],this[3],this[0])}get xxwy(){return new this._Vec4(this[0],this[0],this[3],this[1])}get xxwz(){return new this._Vec4(this[0],this[0],this[3],this[2])}get xxww(){return new this._Vec4(this[0],this[0],this[3],this[3])}get xyxx(){return new this._Vec4(this[0],this[1],this[0],this[0])}get xyxy(){return new this._Vec4(this[0],this[1],this[0],this[1])}get xyxz(){return new this._Vec4(this[0],this[1],this[0],this[2])}get xyxw(){return new this._Vec4(this[0],this[1],this[0],this[3])}get xyyx(){return new this._Vec4(this[0],this[1],this[1],this[0])}get xyyy(){return new this._Vec4(this[0],this[1],this[1],this[1])}get xyyz(){return new this._Vec4(this[0],this[1],this[1],this[2])}get xyyw(){return new this._Vec4(this[0],this[1],this[1],this[3])}get xyzx(){return new this._Vec4(this[0],this[1],this[2],this[0])}get xyzy(){return new this._Vec4(this[0],this[1],this[2],this[1])}get xyzz(){return new this._Vec4(this[0],this[1],this[2],this[2])}get xyzw(){return new this._Vec4(this[0],this[1],this[2],this[3])}get xywx(){return new this._Vec4(this[0],this[1],this[3],this[0])}get xywy(){return new this._Vec4(this[0],this[1],this[3],this[1])}get xywz(){return new this._Vec4(this[0],this[1],this[3],this[2])}get xyww(){return new this._Vec4(this[0],this[1],this[3],this[3])}get xzxx(){return new this._Vec4(this[0],this[2],this[0],this[0])}get xzxy(){return new this._Vec4(this[0],this[2],this[0],this[1])}get xzxz(){return new this._Vec4(this[0],this[2],this[0],this[2])}get xzxw(){return new this._Vec4(this[0],this[2],this[0],this[3])}get xzyx(){return new this._Vec4(this[0],this[2],this[1],this[0])}get xzyy(){return new this._Vec4(this[0],this[2],this[1],this[1])}get xzyz(){return new this._Vec4(this[0],this[2],this[1],this[2])}get xzyw(){return new this._Vec4(this[0],this[2],this[1],this[3])}get xzzx(){return new this._Vec4(this[0],this[2],this[2],this[0])}get xzzy(){return new this._Vec4(this[0],this[2],this[2],this[1])}get xzzz(){return new this._Vec4(this[0],this[2],this[2],this[2])}get xzzw(){return new this._Vec4(this[0],this[2],this[2],this[3])}get xzwx(){return new this._Vec4(this[0],this[2],this[3],this[0])}get xzwy(){return new this._Vec4(this[0],this[2],this[3],this[1])}get xzwz(){return new this._Vec4(this[0],this[2],this[3],this[2])}get xzww(){return new this._Vec4(this[0],this[2],this[3],this[3])}get xwxx(){return new this._Vec4(this[0],this[3],this[0],this[0])}get xwxy(){return new this._Vec4(this[0],this[3],this[0],this[1])}get xwxz(){return new this._Vec4(this[0],this[3],this[0],this[2])}get xwxw(){return new this._Vec4(this[0],this[3],this[0],this[3])}get xwyx(){return new this._Vec4(this[0],this[3],this[1],this[0])}get xwyy(){return new this._Vec4(this[0],this[3],this[1],this[1])}get xwyz(){return new this._Vec4(this[0],this[3],this[1],this[2])}get xwyw(){return new this._Vec4(this[0],this[3],this[1],this[3])}get xwzx(){return new this._Vec4(this[0],this[3],this[2],this[0])}get xwzy(){return new this._Vec4(this[0],this[3],this[2],this[1])}get xwzz(){return new this._Vec4(this[0],this[3],this[2],this[2])}get xwzw(){return new this._Vec4(this[0],this[3],this[2],this[3])}get xwwx(){return new this._Vec4(this[0],this[3],this[3],this[0])}get xwwy(){return new this._Vec4(this[0],this[3],this[3],this[1])}get xwwz(){return new this._Vec4(this[0],this[3],this[3],this[2])}get xwww(){return new this._Vec4(this[0],this[3],this[3],this[3])}get yxxx(){return new this._Vec4(this[1],this[0],this[0],this[0])}get yxxy(){return new this._Vec4(this[1],this[0],this[0],this[1])}get yxxz(){return new this._Vec4(this[1],this[0],this[0],this[2])}get yxxw(){return new this._Vec4(this[1],this[0],this[0],this[3])}get yxyx(){return new this._Vec4(this[1],this[0],this[1],this[0])}get yxyy(){return new this._Vec4(this[1],this[0],this[1],this[1])}get yxyz(){return new this._Vec4(this[1],this[0],this[1],this[2])}get yxyw(){return new this._Vec4(this[1],this[0],this[1],this[3])}get yxzx(){return new this._Vec4(this[1],this[0],this[2],this[0])}get yxzy(){return new this._Vec4(this[1],this[0],this[2],this[1])}get yxzz(){return new this._Vec4(this[1],this[0],this[2],this[2])}get yxzw(){return new this._Vec4(this[1],this[0],this[2],this[3])}get yxwx(){return new this._Vec4(this[1],this[0],this[3],this[0])}get yxwy(){return new this._Vec4(this[1],this[0],this[3],this[1])}get yxwz(){return new this._Vec4(this[1],this[0],this[3],this[2])}get yxww(){return new this._Vec4(this[1],this[0],this[3],this[3])}get yyxx(){return new this._Vec4(this[1],this[1],this[0],this[0])}get yyxy(){return new this._Vec4(this[1],this[1],this[0],this[1])}get yyxz(){return new this._Vec4(this[1],this[1],this[0],this[2])}get yyxw(){return new this._Vec4(this[1],this[1],this[0],this[3])}get yyyx(){return new this._Vec4(this[1],this[1],this[1],this[0])}get yyyy(){return new this._Vec4(this[1],this[1],this[1],this[1])}get yyyz(){return new this._Vec4(this[1],this[1],this[1],this[2])}get yyyw(){return new this._Vec4(this[1],this[1],this[1],this[3])}get yyzx(){return new this._Vec4(this[1],this[1],this[2],this[0])}get yyzy(){return new this._Vec4(this[1],this[1],this[2],this[1])}get yyzz(){return new this._Vec4(this[1],this[1],this[2],this[2])}get yyzw(){return new this._Vec4(this[1],this[1],this[2],this[3])}get yywx(){return new this._Vec4(this[1],this[1],this[3],this[0])}get yywy(){return new this._Vec4(this[1],this[1],this[3],this[1])}get yywz(){return new this._Vec4(this[1],this[1],this[3],this[2])}get yyww(){return new this._Vec4(this[1],this[1],this[3],this[3])}get yzxx(){return new this._Vec4(this[1],this[2],this[0],this[0])}get yzxy(){return new this._Vec4(this[1],this[2],this[0],this[1])}get yzxz(){return new this._Vec4(this[1],this[2],this[0],this[2])}get yzxw(){return new this._Vec4(this[1],this[2],this[0],this[3])}get yzyx(){return new this._Vec4(this[1],this[2],this[1],this[0])}get yzyy(){return new this._Vec4(this[1],this[2],this[1],this[1])}get yzyz(){return new this._Vec4(this[1],this[2],this[1],this[2])}get yzyw(){return new this._Vec4(this[1],this[2],this[1],this[3])}get yzzx(){return new this._Vec4(this[1],this[2],this[2],this[0])}get yzzy(){return new this._Vec4(this[1],this[2],this[2],this[1])}get yzzz(){return new this._Vec4(this[1],this[2],this[2],this[2])}get yzzw(){return new this._Vec4(this[1],this[2],this[2],this[3])}get yzwx(){return new this._Vec4(this[1],this[2],this[3],this[0])}get yzwy(){return new this._Vec4(this[1],this[2],this[3],this[1])}get yzwz(){return new this._Vec4(this[1],this[2],this[3],this[2])}get yzww(){return new this._Vec4(this[1],this[2],this[3],this[3])}get ywxx(){return new this._Vec4(this[1],this[3],this[0],this[0])}get ywxy(){return new this._Vec4(this[1],this[3],this[0],this[1])}get ywxz(){return new this._Vec4(this[1],this[3],this[0],this[2])}get ywxw(){return new this._Vec4(this[1],this[3],this[0],this[3])}get ywyx(){return new this._Vec4(this[1],this[3],this[1],this[0])}get ywyy(){return new this._Vec4(this[1],this[3],this[1],this[1])}get ywyz(){return new this._Vec4(this[1],this[3],this[1],this[2])}get ywyw(){return new this._Vec4(this[1],this[3],this[1],this[3])}get ywzx(){return new this._Vec4(this[1],this[3],this[2],this[0])}get ywzy(){return new this._Vec4(this[1],this[3],this[2],this[1])}get ywzz(){return new this._Vec4(this[1],this[3],this[2],this[2])}get ywzw(){return new this._Vec4(this[1],this[3],this[2],this[3])}get ywwx(){return new this._Vec4(this[1],this[3],this[3],this[0])}get ywwy(){return new this._Vec4(this[1],this[3],this[3],this[1])}get ywwz(){return new this._Vec4(this[1],this[3],this[3],this[2])}get ywww(){return new this._Vec4(this[1],this[3],this[3],this[3])}get zxxx(){return new this._Vec4(this[2],this[0],this[0],this[0])}get zxxy(){return new this._Vec4(this[2],this[0],this[0],this[1])}get zxxz(){return new this._Vec4(this[2],this[0],this[0],this[2])}get zxxw(){return new this._Vec4(this[2],this[0],this[0],this[3])}get zxyx(){return new this._Vec4(this[2],this[0],this[1],this[0])}get zxyy(){return new this._Vec4(this[2],this[0],this[1],this[1])}get zxyz(){return new this._Vec4(this[2],this[0],this[1],this[2])}get zxyw(){return new this._Vec4(this[2],this[0],this[1],this[3])}get zxzx(){return new this._Vec4(this[2],this[0],this[2],this[0])}get zxzy(){return new this._Vec4(this[2],this[0],this[2],this[1])}get zxzz(){return new this._Vec4(this[2],this[0],this[2],this[2])}get zxzw(){return new this._Vec4(this[2],this[0],this[2],this[3])}get zxwx(){return new this._Vec4(this[2],this[0],this[3],this[0])}get zxwy(){return new this._Vec4(this[2],this[0],this[3],this[1])}get zxwz(){return new this._Vec4(this[2],this[0],this[3],this[2])}get zxww(){return new this._Vec4(this[2],this[0],this[3],this[3])}get zyxx(){return new this._Vec4(this[2],this[1],this[0],this[0])}get zyxy(){return new this._Vec4(this[2],this[1],this[0],this[1])}get zyxz(){return new this._Vec4(this[2],this[1],this[0],this[2])}get zyxw(){return new this._Vec4(this[2],this[1],this[0],this[3])}get zyyx(){return new this._Vec4(this[2],this[1],this[1],this[0])}get zyyy(){return new this._Vec4(this[2],this[1],this[1],this[1])}get zyyz(){return new this._Vec4(this[2],this[1],this[1],this[2])}get zyyw(){return new this._Vec4(this[2],this[1],this[1],this[3])}get zyzx(){return new this._Vec4(this[2],this[1],this[2],this[0])}get zyzy(){return new this._Vec4(this[2],this[1],this[2],this[1])}get zyzz(){return new this._Vec4(this[2],this[1],this[2],this[2])}get zyzw(){return new this._Vec4(this[2],this[1],this[2],this[3])}get zywx(){return new this._Vec4(this[2],this[1],this[3],this[0])}get zywy(){return new this._Vec4(this[2],this[1],this[3],this[1])}get zywz(){return new this._Vec4(this[2],this[1],this[3],this[2])}get zyww(){return new this._Vec4(this[2],this[1],this[3],this[3])}get zzxx(){return new this._Vec4(this[2],this[2],this[0],this[0])}get zzxy(){return new this._Vec4(this[2],this[2],this[0],this[1])}get zzxz(){return new this._Vec4(this[2],this[2],this[0],this[2])}get zzxw(){return new this._Vec4(this[2],this[2],this[0],this[3])}get zzyx(){return new this._Vec4(this[2],this[2],this[1],this[0])}get zzyy(){return new this._Vec4(this[2],this[2],this[1],this[1])}get zzyz(){return new this._Vec4(this[2],this[2],this[1],this[2])}get zzyw(){return new this._Vec4(this[2],this[2],this[1],this[3])}get zzzx(){return new this._Vec4(this[2],this[2],this[2],this[0])}get zzzy(){return new this._Vec4(this[2],this[2],this[2],this[1])}get zzzz(){return new this._Vec4(this[2],this[2],this[2],this[2])}get zzzw(){return new this._Vec4(this[2],this[2],this[2],this[3])}get zzwx(){return new this._Vec4(this[2],this[2],this[3],this[0])}get zzwy(){return new this._Vec4(this[2],this[2],this[3],this[1])}get zzwz(){return new this._Vec4(this[2],this[2],this[3],this[2])}get zzww(){return new this._Vec4(this[2],this[2],this[3],this[3])}get zwxx(){return new this._Vec4(this[2],this[3],this[0],this[0])}get zwxy(){return new this._Vec4(this[2],this[3],this[0],this[1])}get zwxz(){return new this._Vec4(this[2],this[3],this[0],this[2])}get zwxw(){return new this._Vec4(this[2],this[3],this[0],this[3])}get zwyx(){return new this._Vec4(this[2],this[3],this[1],this[0])}get zwyy(){return new this._Vec4(this[2],this[3],this[1],this[1])}get zwyz(){return new this._Vec4(this[2],this[3],this[1],this[2])}get zwyw(){return new this._Vec4(this[2],this[3],this[1],this[3])}get zwzx(){return new this._Vec4(this[2],this[3],this[2],this[0])}get zwzy(){return new this._Vec4(this[2],this[3],this[2],this[1])}get zwzz(){return new this._Vec4(this[2],this[3],this[2],this[2])}get zwzw(){return new this._Vec4(this[2],this[3],this[2],this[3])}get zwwx(){return new this._Vec4(this[2],this[3],this[3],this[0])}get zwwy(){return new this._Vec4(this[2],this[3],this[3],this[1])}get zwwz(){return new this._Vec4(this[2],this[3],this[3],this[2])}get zwww(){return new this._Vec4(this[2],this[3],this[3],this[3])}get wxxx(){return new this._Vec4(this[3],this[0],this[0],this[0])}get wxxy(){return new this._Vec4(this[3],this[0],this[0],this[1])}get wxxz(){return new this._Vec4(this[3],this[0],this[0],this[2])}get wxxw(){return new this._Vec4(this[3],this[0],this[0],this[3])}get wxyx(){return new this._Vec4(this[3],this[0],this[1],this[0])}get wxyy(){return new this._Vec4(this[3],this[0],this[1],this[1])}get wxyz(){return new this._Vec4(this[3],this[0],this[1],this[2])}get wxyw(){return new this._Vec4(this[3],this[0],this[1],this[3])}get wxzx(){return new this._Vec4(this[3],this[0],this[2],this[0])}get wxzy(){return new this._Vec4(this[3],this[0],this[2],this[1])}get wxzz(){return new this._Vec4(this[3],this[0],this[2],this[2])}get wxzw(){return new this._Vec4(this[3],this[0],this[2],this[3])}get wxwx(){return new this._Vec4(this[3],this[0],this[3],this[0])}get wxwy(){return new this._Vec4(this[3],this[0],this[3],this[1])}get wxwz(){return new this._Vec4(this[3],this[0],this[3],this[2])}get wxww(){return new this._Vec4(this[3],this[0],this[3],this[3])}get wyxx(){return new this._Vec4(this[3],this[1],this[0],this[0])}get wyxy(){return new this._Vec4(this[3],this[1],this[0],this[1])}get wyxz(){return new this._Vec4(this[3],this[1],this[0],this[2])}get wyxw(){return new this._Vec4(this[3],this[1],this[0],this[3])}get wyyx(){return new this._Vec4(this[3],this[1],this[1],this[0])}get wyyy(){return new this._Vec4(this[3],this[1],this[1],this[1])}get wyyz(){return new this._Vec4(this[3],this[1],this[1],this[2])}get wyyw(){return new this._Vec4(this[3],this[1],this[1],this[3])}get wyzx(){return new this._Vec4(this[3],this[1],this[2],this[0])}get wyzy(){return new this._Vec4(this[3],this[1],this[2],this[1])}get wyzz(){return new this._Vec4(this[3],this[1],this[2],this[2])}get wyzw(){return new this._Vec4(this[3],this[1],this[2],this[3])}get wywx(){return new this._Vec4(this[3],this[1],this[3],this[0])}get wywy(){return new this._Vec4(this[3],this[1],this[3],this[1])}get wywz(){return new this._Vec4(this[3],this[1],this[3],this[2])}get wyww(){return new this._Vec4(this[3],this[1],this[3],this[3])}get wzxx(){return new this._Vec4(this[3],this[2],this[0],this[0])}get wzxy(){return new this._Vec4(this[3],this[2],this[0],this[1])}get wzxz(){return new this._Vec4(this[3],this[2],this[0],this[2])}get wzxw(){return new this._Vec4(this[3],this[2],this[0],this[3])}get wzyx(){return new this._Vec4(this[3],this[2],this[1],this[0])}get wzyy(){return new this._Vec4(this[3],this[2],this[1],this[1])}get wzyz(){return new this._Vec4(this[3],this[2],this[1],this[2])}get wzyw(){return new this._Vec4(this[3],this[2],this[1],this[3])}get wzzx(){return new this._Vec4(this[3],this[2],this[2],this[0])}get wzzy(){return new this._Vec4(this[3],this[2],this[2],this[1])}get wzzz(){return new this._Vec4(this[3],this[2],this[2],this[2])}get wzzw(){return new this._Vec4(this[3],this[2],this[2],this[3])}get wzwx(){return new this._Vec4(this[3],this[2],this[3],this[0])}get wzwy(){return new this._Vec4(this[3],this[2],this[3],this[1])}get wzwz(){return new this._Vec4(this[3],this[2],this[3],this[2])}get wzww(){return new this._Vec4(this[3],this[2],this[3],this[3])}get wwxx(){return new this._Vec4(this[3],this[3],this[0],this[0])}get wwxy(){return new this._Vec4(this[3],this[3],this[0],this[1])}get wwxz(){return new this._Vec4(this[3],this[3],this[0],this[2])}get wwxw(){return new this._Vec4(this[3],this[3],this[0],this[3])}get wwyx(){return new this._Vec4(this[3],this[3],this[1],this[0])}get wwyy(){return new this._Vec4(this[3],this[3],this[1],this[1])}get wwyz(){return new this._Vec4(this[3],this[3],this[1],this[2])}get wwyw(){return new this._Vec4(this[3],this[3],this[1],this[3])}get wwzx(){return new this._Vec4(this[3],this[3],this[2],this[0])}get wwzy(){return new this._Vec4(this[3],this[3],this[2],this[1])}get wwzz(){return new this._Vec4(this[3],this[3],this[2],this[2])}get wwzw(){return new this._Vec4(this[3],this[3],this[2],this[3])}get wwwx(){return new this._Vec4(this[3],this[3],this[3],this[0])}get wwwy(){return new this._Vec4(this[3],this[3],this[3],this[1])}get wwwz(){return new this._Vec4(this[3],this[3],this[3],this[2])}get wwww(){return new this._Vec4(this[3],this[3],this[3],this[3])}},Vn=class extends dr{e0;e1;constructor(t,r){super(2),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t)}get 0(){return this.e0}get 1(){return this.e1}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}},An=class extends dr{e0;e1;e2;constructor(t,r,n){super(3),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}set z(t){this[2]=this.castElement()(t)}},Cn=class extends dr{e0;e1;e2;e3;constructor(t,r,n,i){super(4),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t),this.e3=this.castElement()(i??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}get 3(){return this.e3}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}set 3(t){this.e3=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set w(t){this[3]=t}},Ks=class vu extends Vn{get[l](){return{elementSchema:g}}get kind(){return"vec2f"}get _Vec2(){return vu}get _Vec3(){return ra}get _Vec4(){return oa}},Qs=class bu extends Vn{get[l](){return{elementSchema:he}}get kind(){return"vec2h"}get _Vec2(){return bu}get _Vec3(){return na}get _Vec4(){return ua}},Js=class $u extends Vn{get[l](){return{elementSchema:B}}get kind(){return"vec2i"}get _Vec2(){return $u}get _Vec3(){return ia}get _Vec4(){return ha}},ea=class Tu extends Vn{get[l](){return{elementSchema:$}}get kind(){return"vec2u"}get _Vec2(){return Tu}get _Vec3(){return sa}get _Vec4(){return la}},ta=class _u extends Vn{get[l](){return{elementSchema:R}}get kind(){return"vec2<bool>"}get _Vec2(){return _u}get _Vec3(){return aa}get _Vec4(){return ca}},ra=class zu extends An{get[l](){return{elementSchema:g}}get kind(){return"vec3f"}get _Vec2(){return Ks}get _Vec3(){return zu}get _Vec4(){return oa}},na=class Iu extends An{get[l](){return{elementSchema:he}}get kind(){return"vec3h"}get _Vec2(){return Qs}get _Vec3(){return Iu}get _Vec4(){return ua}},ia=class Su extends An{get[l](){return{elementSchema:B}}get kind(){return"vec3i"}get _Vec2(){return Js}get _Vec3(){return Su}get _Vec4(){return ha}},sa=class Eu extends An{get[l](){return{elementSchema:$}}get kind(){return"vec3u"}get _Vec2(){return ea}get _Vec3(){return Eu}get _Vec4(){return la}},aa=class Mu extends An{get[l](){return{elementSchema:R}}get kind(){return"vec3<bool>"}get _Vec2(){return ta}get _Vec3(){return Mu}get _Vec4(){return ca}},oa=class ku extends Cn{get[l](){return{elementSchema:g}}get kind(){return"vec4f"}get _Vec2(){return Ks}get _Vec3(){return ra}get _Vec4(){return ku}},ua=class Pu extends Cn{get[l](){return{elementSchema:he}}get kind(){return"vec4h"}get _Vec2(){return Qs}get _Vec3(){return na}get _Vec4(){return Pu}},ha=class Uu extends Cn{get[l](){return{elementSchema:B}}get kind(){return"vec4i"}get _Vec2(){return Js}get _Vec3(){return ia}get _Vec4(){return Uu}},la=class Vu extends Cn{get[l](){return{elementSchema:$}}get kind(){return"vec4u"}get _Vec2(){return ea}get _Vec3(){return sa}get _Vec4(){return Vu}},ca=class Au extends Cn{get[l](){return{elementSchema:R}}get kind(){return"vec4<bool>"}get _Vec2(){return ta}get _Vec3(){return aa}get _Vec4(){return Au}},N=Se(Ks,g),yt=Se(Qs,he),ie=Se(Js,B),Me=Se(ea,$),fr=Se(ta,R),le=Se(ra,g),gt=Se(na,he),Oe=Se(ia,B),ae=Se(sa,$),mr=Se(aa,R),I=Se(oa,g),wt=Se(ua,he),de=Se(ha,B),ve=Se(la,$),yr=Se(ca,R),xi={vec2f:N,vec2h:yt,vec2i:ie,vec2u:Me,"vec2<bool>":fr,vec3f:le,vec3h:gt,vec3i:Oe,vec3u:ae,"vec3<bool>":mr,vec4f:I,vec4h:wt,vec4i:de,vec4u:ve,"vec4<bool>":yr};function Se(e,t){let{kind:r,length:n}=new e,i=d({name:r,signature:(...a)=>({argTypes:a.map(o=>ft(o)?o:t),returnType:s}),normalImpl:(...a)=>{let o=new Array(a.length),u=0;for(let h of a)if(typeof h=="number"||typeof h=="boolean")o[u++]=h;else for(let p=0;p<h.length;++p)o[u++]=h[p];if(o.length<=1||o.length===n)return new e(...o);throw new Error(`'${r}' constructor called with invalid number of arguments.`)},ignoreImplicitCastWarning:!0,codegenImpl:(...a)=>a.length===1&&a[0]?.dataType===s?c`${a[0]}`:c`${r}(${a})`}),s=Object.assign(i,{type:r,primitive:t,[Xr]:void 0});return e.prototype.schema=s,s}function vi(e){return e>=2**63||e<-9223372036854776e3?y(e,mt,"constant"):Number.isInteger(e)?(Number.isSafeInteger(e)||console.warn(`The integer ${e} exceeds the safe integer range and may have lost precision.`),y(e,Un,"constant")):y(e,mt,"constant")}function Gt(e){return e.type==="abstractFloat"?g:e.type==="abstractInt"?B:e}function kc(e){return e.map(t=>y(t.value,Gt(t.dataType),t.origin))}function Ci(e){if(qs(e))return e;if(gu(e))throw new Error("Cannot use refs (d.ref(...)) from the outer scope.");return Ai(e)||(te(e)||pt(e)?y(e,Hl(e),"constant"):typeof e=="string"||typeof e=="function"||typeof e=="object"||typeof e=="symbol"||typeof e>"u"||e===null?y(e,Ye,"constant"):typeof e=="number"?vi(e):typeof e=="boolean"?y(e,R,"constant"):y(e,Ye,"constant"))}function Ht(e){let t=(...n)=>{let i=n;if(!i.every(s=>Ve(s)))throw new j(`Called comptime function with runtime-known values: ${i.filter(s=>!Ve(s)).map(s=>`'${s.value}'`).join(", ")}`);return Ci(e(...i.map(s=>s.value)))},r=((...n)=>{let i=Ce();if(i?.mode.type==="codegen"){i.pushMode(new Pn);try{return t(...n)}finally{i.popMode("normal")}}return e(...n)});return r.toString=()=>"comptime",r[ue]=e,r.$name=n=>(G(e,n),r),Object.defineProperty(r,l,{value:{jsImpl:e,gpuImpl:t,argConversionHint:"keep"}}),r}var E=class{constructor(t){this.type=t}[l]=!0},Mt={uint8:$,uint8x2:Me,uint8x4:ve,sint8:B,sint8x2:ie,sint8x4:de,unorm8:g,unorm8x2:N,unorm8x4:I,snorm8:g,snorm8x2:N,snorm8x4:I,uint16:$,uint16x2:Me,uint16x4:ve,sint16:B,sint16x2:ie,sint16x4:de,unorm16:g,unorm16x2:N,unorm16x4:I,snorm16:g,snorm16x2:N,snorm16x4:I,float16:g,float16x2:N,float16x4:I,float32:g,float32x2:N,float32x3:le,float32x4:I,uint32:$,uint32x2:Me,uint32x3:ae,uint32x4:ve,sint32:B,sint32x2:ie,sint32x3:Oe,sint32x4:de,"unorm10-10-10-2":I,"unorm8x4-bgra":I},pa=new Set(Object.keys(Mt)),Pc=new E("uint8"),Uc=new E("uint8x2"),Vc=new E("uint8x4"),Ac=new E("sint8"),Cc=new E("sint8x2"),Oc=new E("sint8x4"),Bc=new E("unorm8"),Fc=new E("unorm8x2"),jc=new E("unorm8x4"),Rc=new E("snorm8"),Gc=new E("snorm8x2"),Lc=new E("snorm8x4"),Dc=new E("uint16"),Nc=new E("uint16x2"),Wc=new E("uint16x4"),qc=new E("sint16"),Hc=new E("sint16x2"),Yc=new E("sint16x4"),Xc=new E("unorm16"),Zc=new E("unorm16x2"),Kc=new E("unorm16x4"),Qc=new E("snorm16"),Jc=new E("snorm16x2"),ep=new E("snorm16x4"),tp=new E("float16"),rp=new E("float16x2"),np=new E("float16x4"),ip=new E("float32"),sp=new E("float32x2"),ap=new E("float32x3"),op=new E("float32x4"),up=new E("uint32"),hp=new E("uint32x2"),lp=new E("uint32x3"),cp=new E("uint32x4"),pp=new E("sint32"),dp=new E("sint32x2"),fp=new E("sint32x3"),mp=new E("sint32x4"),yp=new E("unorm10-10-10-2"),gp=new E("unorm8x4-bgra");function Cu(e){return C(e)&&pa.has(e?.type)}function Yt(e,t){let r=e?.type,n=r in Mt?Mt[r]:e;return typeof n!="function"?t:t===void 0?n():n(t)}function Oi(e){return Ou(e,!1)}function fe(e){return Ou(e,!0)}function Ou(e,t){let r=n=>Object.fromEntries(Object.entries(e).map(([i,s])=>[i,Yt(s,n?.[i])]));return Object.setPrototypeOf(r,wp),r.propTypes=e,Object.defineProperty(r,l,{value:{isAbstruct:t}}),r}var wp={type:"struct",$name(e){return G(this,e),this},toString(){return`struct:${b(this)??"<unnamed>"}`}};function Xt(e){let t=String(e);if(t!=="[object Object]")return t;try{return JSON.stringify(e)}catch(r){return console.error("Error parsing JSON:",r),"<invalid json>"}}function bs(e){return te(e)||pt(e)?e.toString():Array.isArray(e)?`[${e.map(bs).join(", ")}]`:e&&typeof e=="object"?`{ ${Object.entries(e).map(([t,r])=>`${t}: ${bs(r)}`).join(", ")} }`:String(e)}var xp={f32:4,f16:2,i32:4,u32:4,bool:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec2b:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec3b:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,vec4b:16,mat2x2f:8,mat3x3f:16,mat4x4f:16,atomic:4};function vp(e){let t=e?.type,r=xp[t];if(r!==void 0)return r;if(ye(e))return Object.values(e.propTypes).map(re).reduce((n,i)=>n>i?n:i);if(Ie(e))return re(e.elementType);if(Ke(e)){let n=Object.values(e.propTypes)[0];return n?gn(n)??1:1}if(Et(e))return gn(e.elementType)??1;if(Ze(e)||Qe(e))return gn(e)??re(e.inner);if(pa.has(t))return 1;throw new Error(`Cannot determine alignment of data: ${Xt(e)}`)}function bp(e){if(Ke(e)){let t=Object.values(e.propTypes)[0];return t?De(t):1}return Et(e)?De(e.elementType):Qe(e)?gn(e)??De(e.inner):gn(e)??1}var Ka=new WeakMap,Qa=new WeakMap;function re(e){let t=Ka.get(e);return t===void 0&&(t=vp(e),Ka.set(e,t)),t}function De(e){let t=Qa.get(e);return t===void 0&&(t=bp(e),Qa.set(e,t)),t}function $p(e){return re(e)}var Ae=(e,t)=>{let r=t-1,n=~r;return(e&r)===0?e:(e&n)+t},Tp={bool:4,f32:4,f16:2,i32:4,u32:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,"vec2<bool>":8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,"vec3<bool>":12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,"vec4<bool>":16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4,atomic:4};function _p(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){if(Number.isNaN(t))throw new Error("Only the last property of a struct can be unbounded");if(t=Ae(t,re(n)),t+=A(n),Number.isNaN(t)&&n.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return Ae(t,re(e))}function zp(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){let i=De(n);t=Ae(t,i),t+=A(n)}return t}function Ip(e){let t=Tp[e?.type];if(t!==void 0)return t;if(ye(e))return _p(e);if(Ke(e))return zp(e);if(Ie(e)){if(e.elementCount===0)return Number.NaN;let r=re(e.elementType);return Ae(A(e.elementType),r)*e.elementCount}if(Et(e)){let r=De(e.elementType);return Ae(A(e.elementType),r)*e.elementCount}if(Ze(e)||Qe(e))return Kl(e)??A(e.inner);throw new Error(`Cannot determine size of data: ${e}`)}var Ja=new WeakMap;function A(e){let t=Ja.get(e);return t===void 0&&(t=Ip(e),Ja.set(e,t)),t}function Sp(e){return A(e)}function Qr(e,t){return Ze(e)?new eo(e.inner,[t,...e.attribs]):Qe(e)?new to(e.inner,[t,...e.attribs]):Zr(e)?new to(e,[t]):new eo(e,[t])}function Ep(e,t){return Qr(t,{[l]:!0,type:"@align",params:[e]})}function Mp(e,t){return Qr(t,{[l]:!0,type:"@size",params:[e]})}function bi(e,t){return Qr(t,{[l]:!0,type:"@location",params:[e]})}function kp(e,t){return Qr(t,{[l]:!0,type:"@interpolate",params:[e]})}function Pp(e){if(!kt(e))throw new Error("The @invariant attribute must only be applied to the position built-in value.");let t=Ze(e)||Qe(e)?e.attribs.find(Ds):void 0;if(!t||t.params[0]!=="position")throw new Error("The @invariant attribute must only be applied to the position built-in value.");return Qr(e,{[l]:!0,type:"@invariant",params:[]})}function kt(e){return(Ze(e)||Qe(e))&&e.attribs.find(Ds)!==void 0}function da(e){return!Ze(e)&&!Qe(e)?"":e.attribs.map(t=>t.params.length===0?`${t.type} `:`${t.type}(${t.params.join(", ")}) `).join("")}var Bu=class{constructor(t,r){this.inner=t,this.attribs=r;let n=r.find(Gs)?.params[0],i=r.find(Ls)?.params[0];if(n!==void 0){if(n<=0)throw new Error(`Custom data alignment must be a positive number, got: ${n}.`);if(Math.log2(n)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${n}.`);if(Zt(this.inner)&&n%re(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${n}, expected multiple of: ${re(this.inner)}.`)}if(i!==void 0){if(i<A(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${i}, expected at least: ${A(this.inner)}.`);if(i<=0)throw new Error(`Custom data size must be a positive number. Got: ${i}.`)}}[l]=!0},eo=class extends Bu{[l]=!0;type="decorated"},to=class extends Bu{[l]=!0;type="loose-decorated"},_n=Ht(((e,t)=>t===void 0?Ht(r=>ro(e,r)):ro(e,t))).$name("arrayOf");function ro(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Array schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>Yt(e,n?.[s]))};if(Object.setPrototypeOf(r,Up),Number.isNaN(A(e)))throw new Error("Cannot nest runtime sized arrays.");if(r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create array schema with invalid element count: ${t}.`);return r.elementCount=t,r}var Up={[l]:!0,type:"array",toString(){return`arrayOf(${this.elementType}, ${this.elementCount})`}};function ze(e,t){return Qr(e,{[l]:!0,type:"@builtin",params:[t]})}var Fu={vertexIndex:ze($,"vertex_index"),instanceIndex:ze($,"instance_index"),position:ze(I,"position"),clipDistances:ze(_n($,8),"clip_distances"),frontFacing:ze(R,"front_facing"),fragDepth:ze(g,"frag_depth"),sampleIndex:ze($,"sample_index"),sampleMask:ze($,"sample_mask"),localInvocationId:ze(ae,"local_invocation_id"),localInvocationIndex:ze($,"local_invocation_index"),globalInvocationId:ze(ae,"global_invocation_id"),workgroupId:ze(ae,"workgroup_id"),numWorkgroups:ze(ae,"num_workgroups"),subgroupInvocationId:ze($,"subgroup_invocation_id"),subgroupSize:ze($,"subgroup_size")};function Wr(e,t){for(let[r,n]of Object.entries(t))e[r]=n,n&&(typeof n=="object"||typeof n=="function")&&b(n)===void 0&&G(n,r)}function Vp(e,t,r){let n=[...e.matchAll(/:\s*(?<arg>.*?)\s*[,)]/g)].map(i=>i?i[1]:void 0);r(Object.fromEntries(t.flatMap((i,s)=>{let a=n?n[s]:void 0;return ye(i)&&a!==void 0?[[a,i]]:[]})))}function ju(e,t,r){let n=e.match(/->\s(?<output>[\w\d_]+)\s{/),i=n?n[1]?.trim():void 0;ye(t)&&i&&!/\s/g.test(i)&&r({[i]:t})}function Ap(e){return new RegExp(`(?<![\\w\\$_.])${e.replaceAll(".","\\.").replaceAll("$","\\$")}(?![\\w\\$_])`,"g")}function On(e,t,r){return Object.entries(t).reduce((n,[i,s])=>{let a=Ap(i);if(r&&i!=="Out"&&i!=="In"&&!a.test(r)&&console.warn(`The external '${i}' wasn't used in the resolved template.`),pc(s)||Zr(s)||yn(s))return n.replaceAll(a,e.resolve(s).value);if(s!==null&&typeof s=="object"){let o=[...r.matchAll(new RegExp(`${i.replaceAll(".","\\.").replaceAll("$","\\$")}\\.(?<prop>.*?)(?![\\w\\$_])`,"g"))].map(u=>u[1]);return[...new Set(o)].reduce((u,h)=>h&&h in s?On(e,{[`${i}.${h}`]:s[h]},u):u,n)}return console.warn(`During resolution, the external '${i}' has been omitted. Only TGPU resources, 'use gpu' functions, primitives, and plain JS objects can be used as externals.`),n},r)}function Cp(e){let{strippedCode:t,argRange:r}=Op(e),n=new Ru(t);n.consume("(");let i=[];for(;!n.isAt(")");){let a=[];for(;n.isAt("@");)n.parseUntil(no,io),n.consume(")"),a.push(n.lastParsed);n.parseUntil(Fp);let o=n.lastParsed,u;n.isAt(":")&&(n.consume(":"),n.parseUntil(jp,Gp),u=n.lastParsed),i.push({identifier:o,attributes:a,type:u}),n.isAt(",")&&n.consume(",")}n.consume(")");let s;if(n.isAt("->")){n.consume("->");let a=[];for(;n.isAt("@");)n.parseUntil(no,io),n.consume(")"),a.push(n.lastParsed);s={type:n.str.slice(n.pos),attributes:a}}return{args:i,ret:s,range:{begin:r[0],end:r[1]}}}function Op(e){let t=new Ru(e),r="",n;for(;!t.isFinished();){if(t.isAt(Bp)){t.advanceBy(1);continue}if(t.isAt("//")){t.consume("//"),t.parseUntil(Gu),t.advanceBy(1);continue}if(t.isAt("/*")){t.parseUntil(Rp,Lp),t.consume("*/");continue}if(t.isAt("{"))return{strippedCode:r,argRange:[n,t.pos]};t.isAt("(")&&n===void 0&&(n=t.pos),n!==void 0&&(r+=t.str[t.pos]),t.advanceBy(1)}throw new Error("Invalid wgsl code!")}var Ru=class{constructor(t){this.str=t,this.#t=0}#e;#t;get pos(){return this.#t}get lastParsed(){if(this.#e===void 0)throw new Error("Parse was not called yet!");return this.str.slice(this.#e,this.pos)}isFinished(){return this.#t>=this.str.length}isAt(t){if(typeof t=="string"){for(let r=0;r<t.length;r++)if(this.str[this.#t+r]!==t[r])return!1;return!0}for(let r of t)if(this.isAt(r))return!0;return!1}parseUntil(t,r){this.#e=this.#t;let n=0;for(;this.#t<this.str.length;){if(r&&this.isAt(r[0])&&(n+=1),r&&this.isAt(r[1])&&(n-=1),n===0&&this.isAt(t))return this.#t;this.#t+=1}throw new Error("Reached the end of the string without finding a match!")}advanceBy(t){this.#t+=t}consume(t){if(!this.isAt(t))throw new Error(`Expected '${t}' at position ${this.#t}, but found '${this.str.slice(this.#t,this.#t+t.length)}'`);this.advanceBy(t.length)}},Gu=new Set([`
`,"\v","\f","\r","","\u2028","\u2029"]),Bp=new Set([...Gu," ","	","",""]),no=new Set([")"]),Fp=new Set([":",",",")"]),jp=new Set([",",")"]),Rp=new Set(["*/"]),io=["(",")"],Gp=["<",">"],Lp=["/*","*/"];function Bn(e,t=""){let r=[],n={applyExternals(s){r.push(s)},resolve(s,a,o){let u={};for(let Z of r)Wr(u,Z);let h=s.getUniqueName(this);if(typeof e=="string"){if(!o)throw new Error("Explicit return type is required for string implementation");let Z=On(s,u,e),K="",Be="";if(t!==""){let $e=ye(a[0])?`(in: ${s.resolve(a[0]).value})`:"()",tt=Zt(o)?da(o):"",xt=o!==se?ye(o)?`-> ${s.resolve(o).value}`:`-> ${tt!==""?tt:"@location(0)"} ${s.resolve(o).value}`:"";K=`${$e} ${xt} `,Be=Z}else{let $e=Cp(Z);if($e.args.length!==a.length)throw new Error(`WGSL implementation has ${$e.args.length} arguments, while the shell has ${a.length} arguments.`);let tt=$e.args.map((vt,Kt)=>`${vt.identifier}: ${so(s,`parameter ${vt.identifier}`,vt.type,a[Kt])}`).join(", "),xt=o===se?"":`-> ${so(s,"return type",$e.ret?.type,o)}`;K=`(${tt}) ${xt}`,Be=Z.slice($e.range.end)}return s.addDeclaration(`${t}fn ${h}${K}${Be}`),y(h,o,"runtime")}let p=Ui(e),f=typeof p?.externals=="function"?p.externals():p?.externals;if(f){let Z=Object.fromEntries(Object.entries(f).filter(([K])=>!(K in u)));Wr(u,Z)}let m=p?.ast;if(!m)throw new Error("Missing metadata for tgpu.fn function body (either missing 'use gpu' directive, or misconfigured `unplugin-typegpu`)");let w=m.externalNames.filter(Z=>!(Z in u));if(w.length>0)throw new tc(b(this),w);let v=m.params[1];v&&v.type==="i"&&t!==""&&Wr(u,{[v.name]:St(o)});let{head:_,body:S,returnType:V}=s.fnToWgsl({functionType:t.includes("@compute")?"compute":t.includes("@vertex")?"vertex":t.includes("@fragment")?"fragment":"normal",argTypes:a,params:m.params,returnType:o,body:m.body,externalMap:u});return s.addDeclaration(`${t}fn ${h}${s.resolve(_).value}${s.resolve(S).value}`),y(h,V,"runtime")}},i=b(e);return i!==void 0&&G(n,i),n}function so(e,t,r,n){let i=e.resolve(n).value.replace(/\s/g,"");if(!r)return i;let s=r.replace(/\s/g,"");if(s!==i)throw new Error(`Type mismatch between TGPU shell and WGSL code string: ${t}, JS type "${i}", WGSL type "${s}".`);return r}function Dp(e,t={}){let r=0,n=new Set;return Object.fromEntries(Object.entries(e??{}).map(([i,s])=>{let a=qt(s);if(a!==void 0){if(n.has(a))throw new Error("Duplicate custom location attributes found");n.add(a)}return[i,s]}).map(([i,s])=>{if(kt(s))return[i,s];if(qt(s)!==void 0)return[i,s];if(t[i])return[i,bi(t[i],s)];for(;n.has(r);)r++;return[i,bi(r++,s)]}))}function Fn(e,t={}){return Kr(e)?Ko(e)||kt(e)||qt(e)!==void 0?e:bi(0,e):Oi(Dp(e,t))}function Bi(e,...t){return Np(e)?Wp(e,...t):e}function Np(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)&&e.raw.every(t=>typeof t=="string")}function Wp(e,...t){return e.slice(1).reduce((r,n,i)=>`${r}${t[i]}${n}`,e[0])}function qp(e){if(Object.keys(e.out).length===0)throw new Error("A vertexFn output cannot be empty since it must include the 'position' builtin.");let t={in:e.in,out:e.out,argTypes:e.in&&Object.keys(e.in).length!==0?[Fn(e.in)]:[],isEntry:!0};return Object.assign((r,...n)=>Hp(t,Bi(r,...n)),t)}function Hp(e,t){let r=Bn(t,"@vertex "),n=e.argTypes[0];return{shell:e,$uses(i){return r.applyExternals(i),this},[l]:!0,[ue]:r,$name(i){return G(r,i),Pi(n)&&n.$name(`${i}_Input`),this},[z](i){let s=Fn(e.out,i.varyingLocations).$name(`${b(this)??""}_Output`);return typeof t=="string"&&(n&&r.applyExternals({In:n}),r.applyExternals({Out:s})),r.resolve(i,e.argTypes,s)},toString(){return`vertexFn:${b(r)??"<unnamed>"}`}}}var Jr=class{};function fa(e){let t=d({name:e.type,normalImpl:(...n)=>{let i=[];for(let s of n)if(typeof s=="number")i.push(s);else for(let a=0;a<s.length;++a)i.push(s[a]);if(i.length!==0&&i.length!==e.columns*e.rows)throw new Error(`'${e.type}' constructor called with invalid number of arguments.`);for(let s=i.length;s<e.columns*e.rows;++s)i.push(0);return new e.MatImpl(...i)},ignoreImplicitCastWarning:!0,signature:(...n)=>({argTypes:n.map(i=>ft(i)?i:g),returnType:r}),codegenImpl:(...n)=>c`${e.type}(${n})`}),r=Object.assign(t,{type:e.type,identity:ed[e.columns],translation:e.columns===4?Fi:void 0,scaling:e.columns===4?ji:void 0,rotationX:e.columns===4?Ri:void 0,rotationY:e.columns===4?Gi:void 0,rotationZ:e.columns===4?Li:void 0});return e.MatImpl.prototype.schema=r,r}var Yp=class extends Jr{[l]=!0;columns;length=4;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1]),this.makeColumn(t[2],t[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[1].x=t}set 3(t){this.columns[1].y=t}*[Symbol.iterator](){yield this[0],yield this[1],yield this[2],yield this[3]}[z](){return y(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,Ut,"runtime")}toString(){return this[z]().value}},Xp=class extends Yp{kind="mat2x2f";makeColumn(t,r){return N(t,r)}},Zp=class extends Jr{[l]=!0;columns;length=12;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2]),this.makeColumn(t[3],t[4],t[5]),this.makeColumn(t[6],t[7],t[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){}*[Symbol.iterator](){for(let t=0;t<12;t++)yield this[t]}[z](){return y(`${this.kind}(${this[0]}, ${this[1]}, ${this[2]}, ${this[4]}, ${this[5]}, ${this[6]}, ${this[8]}, ${this[9]}, ${this[10]})`,Vt,"runtime")}toString(){return this[z]().value}},Kp=class extends Zp{kind="mat3x3f";makeColumn(t,r,n){return le(t,r,n)}},Qp=class extends Jr{[l]=!0;columns;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2],t[3]),this.makeColumn(t[4],t[5],t[6],t[7]),this.makeColumn(t[8],t[9],t[10],t[11]),this.makeColumn(t[12],t[13],t[14],t[15])]}length=16;get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){this.columns[0].w=t}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){this.columns[1].w=t}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){this.columns[2].w=t}set 12(t){this.columns[3].x=t}set 13(t){this.columns[3].y=t}set 14(t){this.columns[3].z=t}set 15(t){this.columns[3].w=t}*[Symbol.iterator](){for(let t=0;t<16;t++)yield this[t]}[z](){return y(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,Y,"runtime")}toString(){return this[z]().value}},Jp=class extends Qp{kind="mat4x4f";makeColumn(t,r,n,i){return I(t,r,n,i)}},Lu=Ht(()=>Ut(1,0,0,1)).$name("identity2"),Du=Ht(()=>Vt(1,0,0,0,1,0,0,0,1)).$name("identity3"),Nu=Ht(()=>Y(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)).$name("identity4"),ed={2:Lu,3:Du,4:Nu},Fi=d({name:"translation4",normalImpl:e=>Y(1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1),get signature(){return{argTypes:[le],returnType:Y}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, ${e}.x, ${e}.y, ${e}.z, 1)`}),ji=d({name:"scaling4",normalImpl:e=>Y(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),get signature(){return{argTypes:[le],returnType:Y}},codegenImpl:e=>c`mat4x4f(${e}.x, 0, 0, 0, 0, ${e}.y, 0, 0, 0, 0, ${e}.z, 0, 0, 0, 0, 1)`}),Ri=d({name:"rotationX4",normalImpl:e=>Y(1,0,0,0,0,Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[g],returnType:Y}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1)`}),Gi=d({name:"rotationY4",normalImpl:e=>Y(Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[g],returnType:Y}},codegenImpl:e=>c`mat4x4f(cos(${e}), 0, -sin(${e}), 0, 0, 1, 0, 0, sin(${e}), 0, cos(${e}), 0, 0, 0, 0, 1)`}),Li=d({name:"rotationZ4",normalImpl:e=>Y(Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1),get signature(){return{argTypes:[g],returnType:Y}},codegenImpl:e=>c`mat4x4f(cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)`}),Ut=fa({type:"mat2x2f",rows:2,columns:2,MatImpl:Xp}),Vt=fa({type:"mat3x3f",rows:3,columns:3,MatImpl:Kp}),Y=fa({type:"mat4x4f",rows:4,columns:4,MatImpl:Jp});function td(e){return e.kind==="mat3x3f"?[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]:Array.from({length:e.length}).map((t,r)=>e[r])}var ir=(e,t,r)=>{if(e===t)return 0;let n=k((r-e)/(t-e),0,1);return n*n*(3-2*n)},k=(e,t,r)=>Math.min(Math.max(t,e),r),br=(e,t)=>t===0?e:Math.trunc(e/t);function ot(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getFloat32(0,!0)}function ut(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getInt32(0,!0)}var Fe=fr[l].jsImpl,Ge=N[l].jsImpl,Tt=yt[l].jsImpl,Gr=ie[l].jsImpl,wn=Me[l].jsImpl,je=mr[l].jsImpl,Ue=le[l].jsImpl,ht=gt[l].jsImpl,Lr=Oe[l].jsImpl,xn=ae[l].jsImpl,Re=yr[l].jsImpl,Le=I[l].jsImpl,_t=wt[l].jsImpl,Dr=de[l].jsImpl,vn=ve[l].jsImpl,$r=e=>Math.sqrt(e.x**2+e.y**2),Tr=e=>Math.sqrt(e.x**2+e.y**2+e.z**2),_r=e=>Math.sqrt(e.x**2+e.y**2+e.z**2+e.w**2),Qn=(e,t)=>e.x*t.x+e.y*t.y,Jn=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z,ei=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,H=e=>t=>Ge(e(t.x),e(t.y)),Q=e=>t=>Tt(e(t.x),e(t.y)),zr=e=>t=>Gr(e(t.x),e(t.y)),on=e=>t=>wn(e(t.x),e(t.y)),q=e=>t=>Ue(e(t.x),e(t.y),e(t.z)),J=e=>t=>ht(e(t.x),e(t.y),e(t.z)),Ir=e=>t=>Lr(e(t.x),e(t.y),e(t.z)),un=e=>t=>xn(e(t.x),e(t.y),e(t.z)),W=e=>t=>Le(e(t.x),e(t.y),e(t.z),e(t.w)),ee=e=>t=>_t(e(t.x),e(t.y),e(t.z),e(t.w)),Sr=e=>t=>Dr(e(t.x),e(t.y),e(t.z),e(t.w)),hn=e=>t=>vn(e(t.x),e(t.y),e(t.z),e(t.w)),ao=e=>t=>{let r=t.columns;return Ut(H(e)(r[0]),H(e)(r[1]))},oo=e=>t=>{let r=t.columns;return Vt(q(e)(r[0]),q(e)(r[1]),q(e)(r[2]))},uo=e=>t=>{let r=t.columns;return Y(W(e)(r[0]),W(e)(r[1]),W(e)(r[2]),W(e)(r[3]))},$t=e=>(t,r)=>Ge(e(t.x,r.x),e(t.y,r.y)),Jt=e=>(t,r)=>Tt(e(t.x,r.x),e(t.y,r.y)),Er=e=>(t,r)=>Gr(e(t.x,r.x),e(t.y,r.y)),Mr=e=>(t,r)=>wn(e(t.x,r.x),e(t.y,r.y)),lt=e=>(t,r)=>Ue(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),er=e=>(t,r)=>ht(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),kr=e=>(t,r)=>Lr(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Pr=e=>(t,r)=>xn(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),He=e=>(t,r)=>Le(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),tr=e=>(t,r)=>_t(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),Ur=e=>(t,r)=>Dr(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),Vr=e=>(t,r)=>vn(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),rd=e=>(t,r)=>{let n=t.columns,i=r.columns;return Ut($t(e)(n[0],i[0]),$t(e)(n[1],i[1]))},nd=e=>(t,r)=>{let n=t.columns,i=r.columns;return Vt(lt(e)(n[0],i[0]),lt(e)(n[1],i[1]),lt(e)(n[2],i[2]))},id=e=>(t,r)=>{let n=t.columns,i=r.columns;return Y(He(e)(n[0],i[0]),He(e)(n[1],i[1]),He(e)(n[2],i[2]),He(e)(n[3],i[3]))},sd=e=>(t,r,n)=>Ge(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),ad=e=>(t,r,n)=>Tt(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),od=e=>(t,r,n)=>Ue(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),ud=e=>(t,r,n)=>ht(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),hd=e=>(t,r,n)=>Le(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),ld=e=>(t,r,n)=>_t(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),T={eq:{vec2f:(e,t)=>Fe(e.x===t.x,e.y===t.y),vec2h:(e,t)=>Fe(e.x===t.x,e.y===t.y),vec2i:(e,t)=>Fe(e.x===t.x,e.y===t.y),vec2u:(e,t)=>Fe(e.x===t.x,e.y===t.y),"vec2<bool>":(e,t)=>Fe(e.x===t.x,e.y===t.y),vec3f:(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),vec3h:(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),vec3i:(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),vec3u:(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),"vec3<bool>":(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),vec4f:(e,t)=>Re(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4h:(e,t)=>Re(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4i:(e,t)=>Re(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4u:(e,t)=>Re(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),"vec4<bool>":(e,t)=>Re(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w)},lt:{vec2f:(e,t)=>Fe(e.x<t.x,e.y<t.y),vec2h:(e,t)=>Fe(e.x<t.x,e.y<t.y),vec2i:(e,t)=>Fe(e.x<t.x,e.y<t.y),vec2u:(e,t)=>Fe(e.x<t.x,e.y<t.y),vec3f:(e,t)=>je(e.x<t.x,e.y<t.y,e.z<t.z),vec3h:(e,t)=>je(e.x<t.x,e.y<t.y,e.z<t.z),vec3i:(e,t)=>je(e.x<t.x,e.y<t.y,e.z<t.z),vec3u:(e,t)=>je(e.x<t.x,e.y<t.y,e.z<t.z),vec4f:(e,t)=>Re(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4h:(e,t)=>Re(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4i:(e,t)=>Re(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4u:(e,t)=>Re(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w)},or:{"vec2<bool>":(e,t)=>Fe(e.x||t.x,e.y||t.y),"vec3<bool>":(e,t)=>je(e.x||t.x,e.y||t.y,e.z||t.z),"vec4<bool>":(e,t)=>Re(e.x||t.x,e.y||t.y,e.z||t.z,e.w||t.w)},all:{"vec2<bool>":e=>e.x&&e.y,"vec3<bool>":e=>e.x&&e.y&&e.z,"vec4<bool>":e=>e.x&&e.y&&e.z&&e.w},abs:{vec2f:H(Math.abs),vec2h:Q(Math.abs),vec2i:zr(Math.abs),vec2u:on(Math.abs),vec3f:q(Math.abs),vec3h:J(Math.abs),vec3i:Ir(Math.abs),vec3u:un(Math.abs),vec4f:W(Math.abs),vec4h:ee(Math.abs),vec4i:Sr(Math.abs),vec4u:hn(Math.abs)},atan2:{vec2f:$t(Math.atan2),vec2h:Jt(Math.atan2),vec3f:lt(Math.atan2),vec3h:er(Math.atan2),vec4f:He(Math.atan2),vec4h:tr(Math.atan2)},acos:{vec2f:H(Math.acos),vec2h:Q(Math.acos),vec2i:zr(Math.acos),vec2u:on(Math.acos),vec3f:q(Math.acos),vec3h:J(Math.acos),vec3i:Ir(Math.acos),vec3u:un(Math.acos),vec4f:W(Math.acos),vec4h:ee(Math.acos),vec4i:Sr(Math.acos),vec4u:hn(Math.acos)},acosh:{vec2f:H(Math.acosh),vec2h:Q(Math.acosh),vec3f:q(Math.acosh),vec3h:J(Math.acosh),vec4f:W(Math.acosh),vec4h:ee(Math.acosh)},asin:{vec2f:H(Math.asin),vec2h:Q(Math.asin),vec3f:q(Math.asin),vec3h:J(Math.asin),vec4f:W(Math.asin),vec4h:ee(Math.asin)},asinh:{vec2f:H(Math.asinh),vec2h:Q(Math.asinh),vec3f:q(Math.asinh),vec3h:J(Math.asinh),vec4f:W(Math.asinh),vec4h:ee(Math.asinh)},atan:{vec2f:H(Math.atan),vec2h:Q(Math.atan),vec3f:q(Math.atan),vec3h:J(Math.atan),vec4f:W(Math.atan),vec4h:ee(Math.atan)},atanh:{vec2f:H(Math.atanh),vec2h:Q(Math.atanh),vec3f:q(Math.atanh),vec3h:J(Math.atanh),vec4f:W(Math.atanh),vec4h:ee(Math.atanh)},ceil:{vec2f:H(Math.ceil),vec2h:Q(Math.ceil),vec3f:q(Math.ceil),vec3h:J(Math.ceil),vec4f:W(Math.ceil),vec4h:ee(Math.ceil)},clamp:{vec2f:(e,t,r)=>Ge(k(e.x,t.x,r.x),k(e.y,t.y,r.y)),vec2h:(e,t,r)=>Tt(k(e.x,t.x,r.x),k(e.y,t.y,r.y)),vec2i:(e,t,r)=>Gr(k(e.x,t.x,r.x),k(e.y,t.y,r.y)),vec2u:(e,t,r)=>wn(k(e.x,t.x,r.x),k(e.y,t.y,r.y)),vec3f:(e,t,r)=>Ue(k(e.x,t.x,r.x),k(e.y,t.y,r.y),k(e.z,t.z,r.z)),vec3h:(e,t,r)=>ht(k(e.x,t.x,r.x),k(e.y,t.y,r.y),k(e.z,t.z,r.z)),vec3i:(e,t,r)=>Lr(k(e.x,t.x,r.x),k(e.y,t.y,r.y),k(e.z,t.z,r.z)),vec3u:(e,t,r)=>xn(k(e.x,t.x,r.x),k(e.y,t.y,r.y),k(e.z,t.z,r.z)),vec4f:(e,t,r)=>Le(k(e.x,t.x,r.x),k(e.y,t.y,r.y),k(e.z,t.z,r.z),k(e.w,t.w,r.w)),vec4h:(e,t,r)=>_t(k(e.x,t.x,r.x),k(e.y,t.y,r.y),k(e.z,t.z,r.z),k(e.w,t.w,r.w)),vec4i:(e,t,r)=>Dr(k(e.x,t.x,r.x),k(e.y,t.y,r.y),k(e.z,t.z,r.z),k(e.w,t.w,r.w)),vec4u:(e,t,r)=>vn(k(e.x,t.x,r.x),k(e.y,t.y,r.y),k(e.z,t.z,r.z),k(e.w,t.w,r.w))},length:{vec2f:$r,vec2h:$r,vec3f:Tr,vec3h:Tr,vec4f:_r,vec4h:_r},add:{vec2f:$t((e,t)=>e+t),vec2h:Jt((e,t)=>e+t),vec2i:Er((e,t)=>e+t),vec2u:Mr((e,t)=>e+t),vec3f:lt((e,t)=>e+t),vec3h:er((e,t)=>e+t),vec3i:kr((e,t)=>e+t),vec3u:Pr((e,t)=>e+t),vec4f:He((e,t)=>e+t),vec4h:tr((e,t)=>e+t),vec4i:Ur((e,t)=>e+t),vec4u:Vr((e,t)=>e+t),mat2x2f:rd((e,t)=>e+t),mat3x3f:nd((e,t)=>e+t),mat4x4f:id((e,t)=>e+t)},smoothstep:{vec2f:sd(ir),vec2h:ad(ir),vec3f:od(ir),vec3h:ud(ir),vec4f:hd(ir),vec4h:ld(ir)},addMixed:{vec2f:(e,t)=>H(r=>r+t)(e),vec2h:(e,t)=>Q(r=>r+t)(e),vec2i:(e,t)=>zr(r=>r+t)(e),vec2u:(e,t)=>on(r=>r+t)(e),vec3f:(e,t)=>q(r=>r+t)(e),vec3h:(e,t)=>J(r=>r+t)(e),vec3i:(e,t)=>Ir(r=>r+t)(e),vec3u:(e,t)=>un(r=>r+t)(e),vec4f:(e,t)=>W(r=>r+t)(e),vec4h:(e,t)=>ee(r=>r+t)(e),vec4i:(e,t)=>Sr(r=>r+t)(e),vec4u:(e,t)=>hn(r=>r+t)(e),mat2x2f:(e,t)=>ao(r=>r+t)(e),mat3x3f:(e,t)=>oo(r=>r+t)(e),mat4x4f:(e,t)=>uo(r=>r+t)(e)},mulSxV:{vec2f:(e,t)=>H(r=>e*r)(t),vec2h:(e,t)=>Q(r=>e*r)(t),vec2i:(e,t)=>zr(r=>e*r)(t),vec2u:(e,t)=>on(r=>e*r)(t),vec3f:(e,t)=>q(r=>e*r)(t),vec3h:(e,t)=>J(r=>e*r)(t),vec3i:(e,t)=>Ir(r=>e*r)(t),vec3u:(e,t)=>un(r=>e*r)(t),vec4f:(e,t)=>W(r=>e*r)(t),vec4h:(e,t)=>ee(r=>e*r)(t),vec4i:(e,t)=>Sr(r=>e*r)(t),vec4u:(e,t)=>hn(r=>e*r)(t),mat2x2f:(e,t)=>ao(r=>e*r)(t),mat3x3f:(e,t)=>oo(r=>e*r)(t),mat4x4f:(e,t)=>uo(r=>e*r)(t)},mulVxV:{vec2f:$t((e,t)=>e*t),vec2h:Jt((e,t)=>e*t),vec2i:Er((e,t)=>e*t),vec2u:Mr((e,t)=>e*t),vec3f:lt((e,t)=>e*t),vec3h:er((e,t)=>e*t),vec3i:kr((e,t)=>e*t),vec3u:Pr((e,t)=>e*t),vec4f:He((e,t)=>e*t),vec4h:tr((e,t)=>e*t),vec4i:Ur((e,t)=>e*t),vec4u:Vr((e,t)=>e*t),mat2x2f:(e,t)=>{let r=e.columns,n=t.columns;return Ut(r[0].x*n[0].x+r[1].x*n[0].y,r[0].y*n[0].x+r[1].y*n[0].y,r[0].x*n[1].x+r[1].x*n[1].y,r[0].y*n[1].x+r[1].y*n[1].y)},mat3x3f:(e,t)=>{let r=e.columns,n=t.columns;return Vt(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z)},mat4x4f:(e,t)=>{let r=e.columns,n=t.columns;return Y(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z+r[3].x*n[0].w,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z+r[3].y*n[0].w,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z+r[3].z*n[0].w,r[0].w*n[0].x+r[1].w*n[0].y+r[2].w*n[0].z+r[3].w*n[0].w,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z+r[3].x*n[1].w,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z+r[3].y*n[1].w,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z+r[3].z*n[1].w,r[0].w*n[1].x+r[1].w*n[1].y+r[2].w*n[1].z+r[3].w*n[1].w,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z+r[3].x*n[2].w,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z+r[3].y*n[2].w,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z+r[3].z*n[2].w,r[0].w*n[2].x+r[1].w*n[2].y+r[2].w*n[2].z+r[3].w*n[2].w,r[0].x*n[3].x+r[1].x*n[3].y+r[2].x*n[3].z+r[3].x*n[3].w,r[0].y*n[3].x+r[1].y*n[3].y+r[2].y*n[3].z+r[3].y*n[3].w,r[0].z*n[3].x+r[1].z*n[3].y+r[2].z*n[3].z+r[3].z*n[3].w,r[0].w*n[3].x+r[1].w*n[3].y+r[2].w*n[3].z+r[3].w*n[3].w)}},mulMxV:{mat2x2f:(e,t)=>{let r=e.columns;return Ge(r[0].x*t.x+r[1].x*t.y,r[0].y*t.x+r[1].y*t.y)},mat3x3f:(e,t)=>{let r=e.columns;return Ue(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z)},mat4x4f:(e,t)=>{let r=e.columns;return Le(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z+r[3].x*t.w,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z+r[3].y*t.w,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z+r[3].z*t.w,r[0].w*t.x+r[1].w*t.y+r[2].w*t.z+r[3].w*t.w)}},mulVxM:{mat2x2f:(e,t)=>{let r=t.columns;return Ge(e.x*r[0].x+e.y*r[0].y,e.x*r[1].x+e.y*r[1].y)},mat3x3f:(e,t)=>{let r=t.columns;return Ue(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z)},mat4x4f:(e,t)=>{let r=t.columns;return Le(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z+e.w*r[0].w,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z+e.w*r[1].w,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z+e.w*r[2].w,e.x*r[3].x+e.y*r[3].y+e.z*r[3].z+e.w*r[3].w)}},div:{vec2f:$t((e,t)=>e/t),vec2h:Jt((e,t)=>e/t),vec2i:Er(br),vec2u:Mr(br),vec3f:lt((e,t)=>e/t),vec3h:er((e,t)=>e/t),vec3i:kr(br),vec3u:Pr(br),vec4f:He((e,t)=>e/t),vec4h:tr((e,t)=>e/t),vec4i:Ur(br),vec4u:Vr(br)},dot:{vec2f:Qn,vec2h:Qn,vec2i:Qn,vec2u:Qn,vec3f:Jn,vec3h:Jn,vec3i:Jn,vec3u:Jn,vec4f:ei,vec4h:ei,vec4i:ei,vec4u:ei},normalize:{vec2f:e=>{let t=$r(e);return Ge(e.x/t,e.y/t)},vec2h:e=>{let t=$r(e);return Tt(e.x/t,e.y/t)},vec2i:e=>{let t=$r(e);return Gr(e.x/t,e.y/t)},vec2u:e=>{let t=$r(e);return wn(e.x/t,e.y/t)},vec3f:e=>{let t=Tr(e);return Ue(e.x/t,e.y/t,e.z/t)},vec3h:e=>{let t=Tr(e);return ht(e.x/t,e.y/t,e.z/t)},vec3i:e=>{let t=Tr(e);return Lr(e.x/t,e.y/t,e.z/t)},vec3u:e=>{let t=Tr(e);return xn(e.x/t,e.y/t,e.z/t)},vec4f:e=>{let t=_r(e);return Le(e.x/t,e.y/t,e.z/t,e.w/t)},vec4h:e=>{let t=_r(e);return _t(e.x/t,e.y/t,e.z/t,e.w/t)},vec4i:e=>{let t=_r(e);return Dr(e.x/t,e.y/t,e.z/t,e.w/t)},vec4u:e=>{let t=_r(e);return vn(e.x/t,e.y/t,e.z/t,e.w/t)}},cross:{vec3f:(e,t)=>Ue(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x),vec3h:(e,t)=>ht(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},mod:{vec2f:$t((e,t)=>e%t),vec2h:Jt((e,t)=>e%t),vec2i:Er((e,t)=>e%t),vec2u:Mr((e,t)=>e%t),vec3f:lt((e,t)=>e%t),vec3h:er((e,t)=>e%t),vec3i:kr((e,t)=>e%t),vec3u:Pr((e,t)=>e%t),vec4f:He((e,t)=>e%t),vec4h:tr((e,t)=>e%t),vec4i:Ur((e,t)=>e%t),vec4u:Vr((e,t)=>e%t)},floor:{vec2f:H(Math.floor),vec2h:Q(Math.floor),vec3f:q(Math.floor),vec3h:J(Math.floor),vec4f:W(Math.floor),vec4h:ee(Math.floor)},max:{vec2f:$t(Math.max),vec2h:Jt(Math.max),vec2i:Er(Math.max),vec2u:Mr(Math.max),vec3f:lt(Math.max),vec3h:er(Math.max),vec3i:kr(Math.max),vec3u:Pr(Math.max),vec4f:He(Math.max),vec4h:tr(Math.max),vec4i:Ur(Math.max),vec4u:Vr(Math.max)},min:{vec2f:$t(Math.min),vec2h:Jt(Math.min),vec2i:Er(Math.min),vec2u:Mr(Math.min),vec3f:lt(Math.min),vec3h:er(Math.min),vec3i:kr(Math.min),vec3u:Pr(Math.min),vec4f:He(Math.min),vec4h:tr(Math.min),vec4i:Ur(Math.min),vec4u:Vr(Math.min)},pow:{vec2f:(e,t)=>Ge(e.x**t.x,e.y**t.y),vec2h:(e,t)=>Tt(e.x**t.x,e.y**t.y),vec3f:(e,t)=>Ue(e.x**t.x,e.y**t.y,e.z**t.z),vec3h:(e,t)=>ht(e.x**t.x,e.y**t.y,e.z**t.z),vec4f:(e,t)=>Le(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w),vec4h:(e,t)=>_t(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w)},sign:{vec2f:H(Math.sign),vec2h:Q(Math.sign),vec2i:zr(Math.sign),vec3f:q(Math.sign),vec3h:J(Math.sign),vec3i:Ir(Math.sign),vec4f:W(Math.sign),vec4h:ee(Math.sign),vec4i:Sr(Math.sign)},sqrt:{vec2f:H(Math.sqrt),vec2h:Q(Math.sqrt),vec3f:q(Math.sqrt),vec3h:J(Math.sqrt),vec4f:W(Math.sqrt),vec4h:ee(Math.sqrt)},mix:{vec2f:(e,t,r)=>typeof r=="number"?Ge(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):Ge(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec2h:(e,t,r)=>typeof r=="number"?Tt(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):Tt(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec3f:(e,t,r)=>typeof r=="number"?Ue(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):Ue(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec3h:(e,t,r)=>typeof r=="number"?ht(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):ht(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec4f:(e,t,r)=>typeof r=="number"?Le(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):Le(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w),vec4h:(e,t,r)=>typeof r=="number"?_t(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):_t(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w)},sin:{vec2f:H(Math.sin),vec2h:Q(Math.sin),vec3f:q(Math.sin),vec3h:J(Math.sin),vec4f:W(Math.sin),vec4h:ee(Math.sin)},cos:{vec2f:H(Math.cos),vec2h:Q(Math.cos),vec3f:q(Math.cos),vec3h:J(Math.cos),vec4f:W(Math.cos),vec4h:ee(Math.cos)},cosh:{vec2f:H(Math.cosh),vec2h:Q(Math.cosh),vec3f:q(Math.cosh),vec3h:J(Math.cosh),vec4f:W(Math.cosh),vec4h:ee(Math.cosh)},exp:{vec2f:H(Math.exp),vec2h:Q(Math.exp),vec3f:q(Math.exp),vec3h:J(Math.exp),vec4f:W(Math.exp),vec4h:ee(Math.exp)},exp2:{vec2f:H(e=>2**e),vec2h:Q(e=>2**e),vec3f:q(e=>2**e),vec3h:J(e=>2**e),vec4f:W(e=>2**e),vec4h:ee(e=>2**e)},log:{vec2f:H(Math.log),vec2h:Q(Math.log),vec3f:q(Math.log),vec3h:J(Math.log),vec4f:W(Math.log),vec4h:ee(Math.log)},log2:{vec2f:H(Math.log2),vec2h:Q(Math.log2),vec3f:q(Math.log2),vec3h:J(Math.log2),vec4f:W(Math.log2),vec4h:ee(Math.log2)},fract:{vec2f:H(e=>e-Math.floor(e)),vec2h:Q(e=>e-Math.floor(e)),vec3f:q(e=>e-Math.floor(e)),vec3h:J(e=>e-Math.floor(e)),vec4f:W(e=>e-Math.floor(e)),vec4h:ee(e=>e-Math.floor(e))},isCloseToZero:{vec2f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec2h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec3f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec3h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec4f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t,vec4h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t},neg:{vec2f:H(e=>-e),vec2h:Q(e=>-e),vec2i:zr(e=>-e),vec2u:on(e=>-e),"vec2<bool>":e=>Fe(!e.x,!e.y),vec3f:q(e=>-e),vec3h:J(e=>-e),vec3i:Ir(e=>-e),vec3u:un(e=>-e),"vec3<bool>":e=>je(!e.x,!e.y,!e.z),vec4f:W(e=>-e),vec4h:ee(e=>-e),vec4i:Sr(e=>-e),vec4u:hn(e=>-e),"vec4<bool>":e=>Re(!e.x,!e.y,!e.z,!e.w)},select:{vec2f:(e,t,r)=>Ge(r.x?t.x:e.x,r.y?t.y:e.y),vec2h:(e,t,r)=>Tt(r.x?t.x:e.x,r.y?t.y:e.y),vec2i:(e,t,r)=>Gr(r.x?t.x:e.x,r.y?t.y:e.y),vec2u:(e,t,r)=>wn(r.x?t.x:e.x,r.y?t.y:e.y),"vec2<bool>":(e,t,r)=>Fe(r.x?t.x:e.x,r.y?t.y:e.y),vec3f:(e,t,r)=>Ue(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3h:(e,t,r)=>ht(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3i:(e,t,r)=>Lr(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3u:(e,t,r)=>xn(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),"vec3<bool>":(e,t,r)=>je(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec4f:(e,t,r)=>Le(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4h:(e,t,r)=>_t(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4i:(e,t,r)=>Dr(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4u:(e,t,r)=>vn(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),"vec4<bool>":(e,t,r)=>Re(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w)},tanh:{vec2f:H(Math.tanh),vec2h:Q(Math.tanh),vec3f:q(Math.tanh),vec3h:J(Math.tanh),vec4f:W(Math.tanh),vec4h:ee(Math.tanh)},bitcastU32toF32:{vec2u:e=>Ge(ot(e.x),ot(e.y)),vec3u:e=>Ue(ot(e.x),ot(e.y),ot(e.z)),vec4u:e=>Le(ot(e.x),ot(e.y),ot(e.z),ot(e.w))},bitcastU32toI32:{vec2u:e=>Gr(ut(e.x),ut(e.y)),vec3u:e=>Lr(ut(e.x),ut(e.y),ut(e.z)),vec4u:e=>Dr(ut(e.x),ut(e.y),ut(e.z),ut(e.w))}};function Wu(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="number"&&te(t))return T.addMixed[t.kind](t,e);if(te(e)&&typeof t=="number")return T.addMixed[e.kind](e,t);if(te(e)&&te(t)||pt(e)&&pt(t))return T.add[e.kind](e,t);throw new Error("Add/Sub called with invalid arguments.")}var ma=d({name:"add",signature:(...e)=>{let t=ge(e)??e;return{argTypes:t,returnType:Wt(t[0])?t[1]:t[0]}},normalImpl:Wu,codegenImpl:(e,t)=>c`(${e} + ${t})`});function cd(e,t){return Wu(e,qu(-1,t))}var en=d({name:"sub",signature:(...e)=>{let t=ge(e)??e;return{argTypes:t,returnType:Wt(t[0])?t[1]:t[0]}},normalImpl:cd,codegenImpl:(e,t)=>c`(${e} - ${t})`});function qu(e,t){if(typeof e=="number"&&typeof t=="number")return e*t;if(typeof e=="number"&&(te(t)||pt(t)))return T.mulSxV[t.kind](e,t);if((te(e)||pt(e))&&typeof t=="number")return T.mulSxV[e.kind](t,e);if(te(e)&&te(t))return T.mulVxV[e.kind](e,t);if(Wa(e)&&pt(t))return T.mulVxM[t.kind](e,t);if(pt(e)&&Wa(t))return T.mulMxV[e.kind](e,t);if(pt(e)&&pt(t))return T.mulVxV[e.kind](e,t);throw new Error("Mul called with invalid arguments.")}var jn=d({name:"mul",signature:(...e)=>{let t=ge(e)??e,r=Wt(t[0])?t[1]:Wt(t[1])||t[0].type.startsWith("vec")?t[0]:t[1].type.startsWith("vec")?t[1]:t[0];return{argTypes:t,returnType:r}},normalImpl:qu,codegenImpl:(e,t)=>c`(${e} * ${t})`});function pd(e,t){if(typeof e=="number"&&typeof t=="number")return e/t;if(typeof e=="number"&&te(t)){let r=xi[t.kind][l].jsImpl;return T.div[t.kind](r(e),t)}if(te(e)&&typeof t=="number"){let r=xi[e.kind][l].jsImpl;return T.div[e.kind](e,r(t))}if(te(e)&&te(t))return T.div[e.kind](e,t);throw new Error("Div called with invalid arguments.")}var ya=d({name:"div",signature:(...e)=>{let t=ge(e,[g,he,mt])??e;return{argTypes:t,returnType:Wt(t[0])?t[1]:t[0]}},normalImpl:pd,codegenImpl:(e,t)=>c`(${e} / ${t})`,ignoreImplicitCastWarning:!0}),dd=d({name:"mod",signature:(...e)=>{let t=ge(e)??e;return{argTypes:t,returnType:Wt(t[0])?t[1]:t[0]}},normalImpl(e,t){if(typeof e=="number"&&typeof t=="number")return e%t;if(typeof e=="number"&&te(t)){let r=xi[t.kind];return T.mod[t.kind](r(e),t)}if(te(e)&&typeof t=="number"){let r=xi[e.kind];return T.mod[e.kind](e,r(t))}if(te(e)&&te(t))return T.mod[e.kind](e,t);throw new Error("Mod called with invalid arguments, expected types: number or vector.")},codegenImpl:(e,t)=>c`(${e} % ${t})`});function fd(e){return typeof e=="number"?-e:T.neg[e.kind](e)}var Hu=d({name:"neg",signature:e=>({argTypes:[e],returnType:e}),normalImpl:fd,codegenImpl:e=>c`-(${e})`});function $s(e){if("multisampled"in e){if(e.multisampled){if(e.dimension==="2d")return Xu(e.sampleType);throw new Error(`Multisampled textures only support '2d' dimension, got '${e.dimension}'`)}switch(e.dimension){case"1d":return Yu(e.sampleType);case"2d":return ga(e.sampleType);case"2d-array":return Zu(e.sampleType);case"3d":return Ju(e.sampleType);case"cube":return Ku(e.sampleType);case"cube-array":return Qu(e.sampleType);default:throw new Error(`Unsupported texture dimension: '${e.dimension}'`)}}if(!("access"in e))throw new Error("Descriptor is neither a sampled nor a storage texture");switch(e.dimension){case"1d":return eh(e.format,e.access);case"2d":return wa(e.format,e.access);case"2d-array":return th(e.format,e.access);case"3d":return rh(e.format,e.access);default:throw new Error(`Unsupported storage texture dimension: '${e.dimension}'`)}}function Ne(e,t){let r=e.startsWith("texture_depth")?["depth","float","unfilterable-float"]:t.sampleType.type==="i32"?["sint"]:t.sampleType.type==="u32"?["uint"]:["float","unfilterable-float"];return{[l]:!0,[Xr]:void 0,type:e,bindingSampleType:r,...t}}function Di(e,t){return{[l]:!0,[Xr]:void 0,type:e,...t}}var ho=new Map,Rn={"write-only":"write","read-only":"read","read-write":"read_write"};function be(e,t){let r=ho.get(e);return r||(r=t(),ho.set(e,r)),r}function Yu(e){let t=e||g,r=`texture_1d<${t.type}>`;return be(r,()=>Ne("texture_1d",{dimension:"1d",sampleType:t,multisampled:!1}))}function ga(e){let t=e||g,r=`texture_2d<${t.type}>`;return be(r,()=>Ne("texture_2d",{dimension:"2d",sampleType:t,multisampled:!1}))}function Xu(e){let t=e||g,r=`texture_multisampled_2d<${t.type}>`;return be(r,()=>Ne("texture_multisampled_2d",{dimension:"2d",sampleType:t,multisampled:!0}))}function Zu(e){let t=e||g,r=`texture_2d_array<${t.type}>`;return be(r,()=>Ne("texture_2d_array",{dimension:"2d-array",sampleType:t,multisampled:!1}))}function Ku(e){let t=e||g,r=`texture_cube<${t.type}>`;return be(r,()=>Ne("texture_cube",{dimension:"cube",sampleType:t,multisampled:!1}))}function Qu(e){let t=e||g,r=`texture_cube_array<${t.type}>`;return be(r,()=>Ne("texture_cube_array",{dimension:"cube-array",sampleType:t,multisampled:!1}))}function Ju(e){let t=e||g,r=`texture_3d<${t.type}>`;return be(r,()=>Ne("texture_3d",{dimension:"3d",sampleType:t,multisampled:!1}))}function eh(e,t){let r=t||"write-only",n=`texture_storage_1d<${e}, ${Rn[r]}>`;return be(n,()=>Di("texture_storage_1d",{dimension:"1d",format:e,access:r}))}function wa(e,t){let r=t||"write-only",n=`texture_storage_2d<${e}, ${Rn[r]}>`;return be(n,()=>Di("texture_storage_2d",{dimension:"2d",format:e,access:r}))}function th(e,t){let r=t||"write-only",n=`texture_storage_2d_array<${e}, ${Rn[r]}>`;return be(n,()=>Di("texture_storage_2d_array",{dimension:"2d-array",format:e,access:r}))}function rh(e,t){let r=t||"write-only",n=`texture_storage_3d<${e}, ${Rn[r]}>`;return be(n,()=>Di("texture_storage_3d",{dimension:"3d",format:e,access:r}))}function md(){return be("texture_depth_2d",()=>Ne("texture_depth_2d",{dimension:"2d",sampleType:g,multisampled:!1}))}function yd(){return be("texture_depth_multisampled_2d",()=>Ne("texture_depth_multisampled_2d",{dimension:"2d",sampleType:g,multisampled:!0}))}function gd(){return be("texture_depth_2d_array",()=>Ne("texture_depth_2d_array",{dimension:"2d-array",sampleType:g,multisampled:!1}))}function wd(){return be("texture_depth_cube",()=>Ne("texture_depth_cube",{dimension:"cube",sampleType:g,multisampled:!1}))}function xd(){return be("texture_depth_cube_array",()=>Ne("texture_depth_cube_array",{dimension:"cube-array",sampleType:g,multisampled:!1}))}function nh(){return be("texture_external",()=>({[l]:!0,[Xr]:void 0,type:"texture_external",dimension:"2d"}))}function ih(e){return!!e[l]&&typeof e.multisampled=="boolean"}function Ts(e){return!!e[l]&&typeof e.format=="string"&&typeof e.access=="string"}var vd=["vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"],_s={add:ma,sub:en,mul:jn,div:ya},bd={f:{1:g,2:N,3:le,4:I},h:{1:he,2:yt,3:gt,4:wt},i:{1:B,2:ie,3:Oe,4:de},u:{1:$,2:Me,3:ae,4:ve},b:{1:R,2:fr,3:mr,4:yr}};function xa(e,t){if(vd.includes(e.dataType.type)&&t in _s)return y(new eu(t,e,_s[t][l].gpuImpl),Ye,e.origin);if(Ie(e.dataType)&&t==="length")return e.dataType.elementCount===0?y(c`arrayLength(&${e})`,$,"runtime"):y(e.dataType.elementCount,Un,"constant");if(fi(e.dataType)&&t==="columns")return y(new tu(e),Ye,e.origin);if(ye(e.dataType)||Ke(e.dataType)){let n=e.dataType.propTypes[t];return n?(n=St(n),y(c`${e}.${t}`,n,e.origin==="argument"?"argument":!jr(e)&&!_e(n)?e.origin:e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime")):void 0}if(Xe(e.dataType)){let n=Ys(e);return t==="$"?n:xa(n,t)}if(ft(e.dataType)&&t==="kind")return y(e.dataType.type,Ye,"constant");let r=t.length;if(ft(e.dataType)&&r>=1&&r<=4){let n=e.dataType.type.includes("bool")?"b":e.dataType.type[4],i=bd[n][r];return i?y(Ve(e)?e.value[t]:c`${e}.${t}`,i,e.origin==="argument"&&r===1?"argument":e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime"):void 0}if(Ve(e)||e.dataType.type==="unknown")return Ci(e.value[t])}function va(){return{[l]:!0,type:"sampler",[Xr]:void 0}}function ba(){return{[l]:!0,type:"sampler_comparison",[Xr]:void 0}}function $d(e){return!!e[l]&&e.type==="sampler"}function Td(e){return!!e[l]&&e.type==="sampler_comparison"}function sh(e){return new _d(e)}var _d=class{constructor(t){this.inner=t}[l]=!0;type="atomic"},ah=Object.defineProperty,zd=(e,t,r)=>t in e?ah(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Id=(e,t)=>{for(var r in t)ah(e,r,{get:t[r],enumerable:!0})},P=(e,t,r)=>zd(e,typeof t!="symbol"?t+"":t,r),Sd={};Id(Sd,{BufferReader:()=>Nt,BufferWriter:()=>gr,MaxValue:()=>oe,Measurer:()=>ne,UnresolvedReferenceError:()=>or,ValidationError:()=>Ni,arrayOf:()=>Ud,bool:()=>Ad,byte:()=>Rd,chars:()=>ef,concat:()=>sf,dynamicArrayOf:()=>of,f16:()=>Zd,f32:()=>Qd,f32Array:()=>Tf,f64Array:()=>_f,generic:()=>rf,genericEnum:()=>nf,i16:()=>Ld,i16Array:()=>bf,i32:()=>qd,i32Array:()=>$f,i8:()=>Fd,i8Array:()=>vf,keyed:()=>lf,object:()=>tf,optional:()=>pf,string:()=>Od,tupleOf:()=>mf,u16:()=>Nd,u16Array:()=>wf,u32:()=>Yd,u32Array:()=>xf,u8:()=>ch,u8Array:()=>yf,u8ClampedArray:()=>gf});var or=class oh extends Error{constructor(t){super(t),Object.setPrototypeOf(this,oh.prototype)}},Ni=class uh extends Error{constructor(t){super(t),Object.setPrototypeOf(this,uh.prototype)}},Ed=class{constructor(){P(this,"size",Number.NaN),P(this,"unbounded",this),P(this,"isUnbounded",!0)}add(){return this}fork(){return this}},Md=new Ed,ne=class hh{constructor(){P(this,"size",0),P(this,"unbounded",Md),P(this,"isUnbounded",!1)}add(t){return this.size+=t,this}fork(){const t=new hh;return t.size=this.size,t}},oe=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),we=class{constructor(){P(this,"__unwrapped")}resolveReferences(e){}seekProperty(e,t){return null}},kd=class{constructor(e){this.key=e}},bn={STRING:"string",ENUM:"enum"},Pd=class extends we{constructor(e,t){super(),this._unstableElementSchema=e,this.length=t,P(this,"elementSchema"),this.elementSchema=e}resolveReferences(e){this.elementSchema=e.resolve(this._unstableElementSchema)}write(e,t){if(t.length!==this.length)throw new Ni(`Expected array of length ${this.length}, got ${t.length}`);for(const r of t)this.elementSchema.write(e,r)}read(e){const t=[];for(let r=0;r<this.length;++r)t.push(this.elementSchema.read(e));return t}get maxSize(){return this.elementSchema.measure(oe).size*this.length}measure(e,t=new ne){for(let r=0;r<this.length;++r)this.elementSchema.measure(e===oe?oe:e[r],t);return t}};function Ud(e,t){return new Pd(e,t)}var Vd=class extends we{constructor(){super(...arguments),P(this,"maxSize",1)}read(e){return e.readBool()}write(e,t){e.writeBool(t)}measure(e,t=new ne){return t.add(1)}},Ad=new Vd,lh=class pn extends we{static get _encoder(){return pn._cachedEncoder||(pn._cachedEncoder=new TextEncoder),pn._cachedEncoder}read(t){return t.readString()}write(t,r){t.writeString(r)}measure(t,r=new ne){if(t===oe)return r.unbounded;const n=pn._encoder.encode(t);return r.add(n.byteLength+1)}};P(lh,"_cachedEncoder");var Cd=lh,Od=new Cd,Bd=class extends we{constructor(){super(...arguments),P(this,"maxSize",1)}read(e){return e.readInt8()}write(e,t){e.writeInt8(t)}measure(e,t=new ne){return t.add(1)}},Fd=new Bd,jd=class extends we{constructor(){super(...arguments),P(this,"maxSize",1)}read(e){return e.readUint8()}write(e,t){e.writeUint8(t)}measure(e,t=new ne){return t.add(1)}},ch=new jd,Rd=ch,Gd=class extends we{constructor(){super(...arguments),P(this,"maxSize",2)}read(e){return e.readInt16()}write(e,t){e.writeInt16(t)}measure(e,t=new ne){return t.add(2)}},Ld=new Gd,Dd=class extends we{constructor(){super(...arguments),P(this,"maxSize",2)}read(e){return e.readUint16()}write(e,t){e.writeUint16(t)}measure(e,t=new ne){return t.add(2)}},Nd=new Dd,Wd=class extends we{constructor(){super(...arguments),P(this,"maxSize",4)}read(e){return e.readInt32()}write(e,t){e.writeInt32(t)}measure(e,t=new ne){return t.add(4)}},qd=new Wd,Hd=class extends we{constructor(){super(...arguments),P(this,"maxSize",4)}read(e){return e.readUint32()}write(e,t){e.writeUint32(t)}measure(e,t=new ne){return t.add(4)}},Yd=new Hd,Xd=class extends we{constructor(){super(...arguments),P(this,"maxSize",2)}read(e){return e.readFloat16()}write(e,t){e.writeFloat16(t)}measure(e,t=new ne){return t.add(2)}},Zd=new Xd,Kd=class extends we{constructor(){super(...arguments),P(this,"maxSize",4)}read(e){return e.readFloat32()}write(e,t){e.writeFloat32(t)}measure(e,t=new ne){return t.add(4)}},Qd=new Kd,Jd=class extends we{constructor(e){super(),this.length=e}write(e,t){if(t.length!==this.length)throw new Ni(`Expected char-string of length ${this.length}, got ${t.length}`);for(let r=0;r<t.length;++r)e.writeUint8(t.charCodeAt(r))}read(e){let t="";for(let r=0;r<this.length;++r)t+=String.fromCharCode(e.readByte());return t}measure(e,t=new ne){return t.add(this.length)}};function ef(e){return new Jd(e)}function Dt(e){return Object.entries(e)}function ph(e,t){const r={};for(const[n,i]of Dt(t))r[n]=e.resolve(i);return r}var $a=class extends we{constructor(e){super(),this._properties=e,P(this,"properties"),this.properties=e}resolveReferences(e){this.properties=ph(e,this._properties)}write(e,t){for(const[r,n]of Dt(this.properties))n.write(e,t[r])}read(e){const t={};for(const[r,n]of Dt(this.properties))t[r]=n.read(e);return t}get maxSize(){const e=new ne;for(const t of Object.values(this.properties))t.measure(oe,e);return e.size}measure(e,t=new ne){for(const[r,n]of Dt(this.properties))n.measure(e===oe?oe:e[r],t);return t}seekProperty(e,t){let r=0;for(const[n,i]of Dt(this.properties)){if(n===t)return{bufferOffset:r,schema:i};r+=i.measure(e).size}return null}};function tf(e){return new $a(e)}var dh=class extends we{constructor(e,t,r){super(),this.keyedBy=e,this._subTypeMap=r,P(this,"_baseObject"),P(this,"subTypeMap"),this._baseObject=new $a(t),this.subTypeMap=r}resolveReferences(e){this._baseObject.resolveReferences(e),this.subTypeMap=ph(e,this._subTypeMap)}write(e,t){const r=t.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===bn.ENUM?e.writeUint8(t.type):e.writeString(t.type),this._baseObject.write(e,t);for(const[i,s]of Dt(n.properties))s.write(e,t[i])}read(e){const t=this.keyedBy===bn.ENUM?e.readByte():e.readString(),r=this.subTypeMap[t]||null;if(r===null)throw new Error(`Unknown sub-type '${t}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const n=this._baseObject.read(e);if(n.type=t,r!==null)for(const[i,s]of Dt(r.properties))n[i]=s.read(e);return n}measure(e,t=new ne){if(this._baseObject.measure(e,t),this.keyedBy===bn.ENUM)t.add(1);else if(e!==oe)t.add(e.type.length+1);else return t.unbounded;if(e===oe){const r=Object.values(this.subTypeMap).map(n=>{const i=t.fork();for(const s of Object.values(n.properties))s.measure(oe,i);return[n,i.size]}).reduce((n,i)=>n[1]>i[1]?n:i)[0];for(const n of Object.values(r.properties))n.measure(oe,t)}else{const r=e.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[i,s]of Dt(n.properties))s.measure(e[i],t)}return t}};function rf(e,t){return new dh(bn.STRING,e,t)}function nf(e,t){return new dh(bn.ENUM,e,t)}function sf(e){return new $a(Object.fromEntries(e.flatMap(({properties:t})=>Object.entries(t))))}var af=class extends we{constructor(e){super(),this._unstableElementType=e,P(this,"elementType"),this.elementType=e}resolveReferences(e){this.elementType=e.resolve(this._unstableElementType)}write(e,t){e.writeUint32(t.length);for(const r of t)this.elementType.write(e,r)}read(e){const t=[],r=e.readUint32();for(let n=0;n<r;++n)t.push(this.elementType.read(e));return t}get maxSize(){return this.measure(oe).size}measure(e,t=new ne){if(e===oe)return t.unbounded;t.add(4);for(const r of e)this.elementType.measure(r,t);return t}seekProperty(e,t){if(typeof t=="symbol")return null;const r=Number.parseInt(String(t),10);if(Number.isNaN(r))return null;if(e===oe)return{bufferOffset:this.elementType.measure(oe).size*r,schema:this.elementType};if(r>=e.length)return null;const n=new ne;for(let i=0;i<r;++i)this.elementType.measure(e[i],n);return{bufferOffset:n.size,schema:this.elementType}}};function of(e){return new af(e)}var fh=class{constructor(e){P(this,"__unwrapped"),P(this,"ref"),this.ref=new kd(e)}resolveReferences(){throw new or("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new or("Tried to read a reference directly. Resolve it instead.")}write(){throw new or("Tried to write a reference directly. Resolve it instead.")}measure(){throw new or("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new or("Tried to seek property of a reference directly. Resolve it instead.")}},uf=class{constructor(){P(this,"registry",{})}hasKey(e){return this.registry[e]!==void 0}register(e,t){this.registry[e]=t}resolve(e){if(e instanceof fh){const r=e.ref.key;if(this.registry[r]!==void 0)return this.registry[r];throw new or(`Couldn't resolve reference to ${r}. Unknown key.`)}return e.resolveReferences(this),e}},hf=class{constructor(e,t){this.key=e,P(this,"__unwrapped"),P(this,"__keyDefinition"),P(this,"innerType"),this.innerType=t(new fh(e)),this.resolveReferences(new uf)}resolveReferences(e){e.hasKey(this.key)||(e.register(this.key,this.innerType),this.innerType.resolveReferences(e))}read(e){return this.innerType.read(e)}write(e,t){this.innerType.write(e,t)}get maxSize(){return this.measure(oe).size}measure(e,t=new ne){return this.innerType.measure(e,t)}seekProperty(e,t){return this.innerType.seekProperty(e,t)}};function lf(e,t){return new hf(e,t)}var cf=class extends we{constructor(e){super(),this._innerUnstableSchema=e,P(this,"innerSchema"),this.innerSchema=e}resolveReferences(e){this.innerSchema=e.resolve(this._innerUnstableSchema)}write(e,t){t!=null?(e.writeBool(!0),this.innerSchema.write(e,t)):e.writeBool(!1)}read(e){if(e.readBool())return this.innerSchema.read(e)}get maxSize(){return this.measure(oe).size}measure(e,t=new ne){return e!==void 0&&this.innerSchema.measure(e,t),t.add(1)}};function pf(e){return new cf(e)}function df(e,t){return t.map(r=>e.resolve(r))}var ff=class extends we{constructor(e){super(),this._unstableSchemas=e,P(this,"schemas"),this.schemas=e}resolveReferences(e){this.schemas=df(e,this._unstableSchemas)}write(e,t){if(t.length!==this.schemas.length)throw new Ni(`Expected tuple of length ${this.schemas.length}, got ${t.length}`);for(let r=0;r<this.schemas.length;++r)this.schemas[r].write(e,t[r])}read(e){const t=[];for(let r=0;r<this.schemas.length;++r)t.push(this.schemas[r].read(e));return t}get maxSize(){return this.measure(oe).size}measure(e,t=new ne){for(let r=0;r<this.schemas.length;++r)this.schemas[r].measure(e===oe?oe:e[r],t);return t}};function mf(e){return new ff(e)}var At=class extends we{constructor(e,t){super(),this.length=e,this._arrayConstructor=t,P(this,"byteLength"),this.byteLength=e*t.BYTES_PER_ELEMENT}write(e,t){e.writeSlice(t)}read(e){const t=new ArrayBuffer(this.byteLength),r=new this._arrayConstructor(t,0,this.length);return e.readSlice(r,0,this.byteLength),r}measure(e,t=new ne){return t.add(this.byteLength)}},yf=e=>new At(e,Uint8Array),gf=e=>new At(e,Uint8ClampedArray),wf=e=>new At(e,Uint16Array),xf=e=>new At(e,Uint32Array),vf=e=>new At(e,Int8Array),bf=e=>new At(e,Int16Array),$f=e=>new At(e,Int32Array),Tf=e=>new At(e,Float32Array),_f=e=>new At(e,Float64Array);function zf(){const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return t[0]=1,e[0]===0}function mh(){return zf()?"big":"little"}function Ta(e){let t=0,r=e;return r&&"buffer"in r&&"byteOffset"in r&&(t+=r.byteOffset,r=r.buffer),{buffer:r,byteOffset:t,byteLength:e.byteLength}}var yh=class{constructor(e,t){P(this,"dataView"),P(this,"littleEndian"),P(this,"byteOffset",0),P(this,"endianness");const{byteOffset:r=0,endianness:n="system"}=t??{};this.byteOffset=r;const i=mh();this.endianness=n==="system"?i:n,this.littleEndian=this.endianness==="little";const s=Ta(e);this.byteOffset+=s.byteOffset,this.dataView=new DataView(s.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(e){this.byteOffset=e}skipBytes(e){this.byteOffset+=e}};function If(e){if(e===0)return 0;if(Number.isNaN(e))return 32256;if(!Number.isFinite(e))return e>0?31744:64512;const t=e<0?1:0,r=Math.abs(e),n=Math.floor(Math.log2(r)),i=r/2**n-1,s=n+15,a=Math.floor(i*1024);return t<<15|s<<10|a}function Sf(e){const t=(e&32768)>>15,r=(e&31744)>>10,n=e&1023;return r===0?t===0?n/1024:-n/1024:r===31?n===0?t===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(t===0?1:-1)*(1+n/1024)*2**(r-15)}var Nt=class extends yh{constructor(){super(...arguments),P(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const e=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readUint16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readInt32(){const e=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readUint32(){const e=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readFloat16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,Sf(e)}readFloat32(){const e=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readString(){let e=0;for(;this.byteOffset+e<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+e++)!==0;);const t=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,e-1));return this.byteOffset+=e,t}readSlice(e,t,r){const n=Ta(e),i=new Uint8Array(n.buffer,n.byteOffset+t);for(let s=0;s<r;++s)i[s]=this.dataView.getUint8(this.byteOffset++)}},gr=class extends yh{constructor(){super(...arguments),P(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(e){this.dataView.setUint8(this.byteOffset++,e?1:0)}writeByte(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt8(e){this.dataView.setInt8(this.byteOffset++,e)}writeUint8(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt16(e){this.dataView.setInt16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeUint16(e){this.dataView.setUint16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeInt32(e){this.dataView.setInt32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeUint32(e){this.dataView.setUint32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeFloat16(e){this.dataView.setUint16(this.byteOffset,If(e),this.littleEndian),this.byteOffset+=2}writeFloat32(e){this.dataView.setFloat32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeString(e){const t=this._textEncoder.encodeInto(e,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=t.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(e){const t=Ta(e),r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(const n of r)this.dataView.setUint8(this.byteOffset++,n)}},U=e=>({argTypes:[e],returnType:e}),Wi=(...e)=>{let t=ge(e)??e;return{argTypes:t,returnType:t[0]}};function gh(e){return(t,...r)=>{let n=t;for(let i of r)n=e(n,i);return n}}function wh(e){return(t,...r)=>{let n=c`${t}`;for(let i of r)n=c`${e}(${n}, ${i})`;return n}}function Ef(e){return typeof e=="number"?Math.abs(e):T.abs[e.kind](e)}var Mf=d({name:"abs",signature:U,normalImpl:Ef,codegenImpl:e=>c`abs(${e})`});function kf(e){return typeof e=="number"?Math.acos(e):T.acos[e.kind](e)}var Pf=d({name:"acos",signature:U,normalImpl:kf,codegenImpl:e=>c`acos(${e})`});function Uf(e){return typeof e=="number"?Math.acosh(e):T.acosh[e.kind](e)}var Vf=d({name:"acosh",signature:U,normalImpl:Uf,codegenImpl:e=>c`acosh(${e})`});function Af(e){return typeof e=="number"?Math.asin(e):T.asin[e.kind](e)}var Cf=d({name:"asin",signature:U,normalImpl:Af,codegenImpl:e=>c`asin(${e})`});function Of(e){return typeof e=="number"?Math.asinh(e):T.asinh[e.kind](e)}var Bf=d({name:"asinh",signature:U,normalImpl:Of,codegenImpl:e=>c`asinh(${e})`});function Ff(e){return typeof e=="number"?Math.atan(e):T.atan[e.kind](e)}var zs=d({name:"atan",signature:U,normalImpl:Ff,codegenImpl:e=>c`atan(${e})`});function jf(e){return typeof e=="number"?Math.atanh(e):T.atanh[e.kind](e)}var Rf=d({name:"atanh",signature:U,normalImpl:jf,codegenImpl:e=>c`atanh(${e})`});function Gf(e,t){return typeof e=="number"&&typeof t=="number"?Math.atan2(e,t):T.atan2[e.kind](e,t)}var Lf=d({name:"atan2",signature:(...e)=>{let t=ge(e,[g,he,mt])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Gf,codegenImpl:(e,t)=>c`atan2(${e}, ${t})`});function Df(e){return typeof e=="number"?Math.ceil(e):T.ceil[e.kind](e)}var xh=d({name:"ceil",signature:U,normalImpl:Df,codegenImpl:e=>c`ceil(${e})`});function Nf(e,t,r){return typeof e=="number"?Math.min(Math.max(t,e),r):T.clamp[e.kind](e,t,r)}var dn=d({name:"clamp",signature:Wi,normalImpl:Nf,codegenImpl:(e,t,r)=>c`clamp(${e}, ${t}, ${r})`});function Wf(e){return typeof e=="number"?Math.cos(e):T.cos[e.kind](e)}var sr=d({name:"cos",signature:U,normalImpl:Wf,codegenImpl:e=>c`cos(${e})`});function qf(e){return typeof e=="number"?Math.cosh(e):T.cosh[e.kind](e)}var Hf=d({name:"cosh",signature:U,normalImpl:qf,codegenImpl:e=>c`cosh(${e})`}),Yf=d({name:"countLeadingZeros",signature:U,normalImpl:"CPU implementation for countLeadingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countLeadingZeros(${e})`}),Xf=d({name:"countOneBits",signature:U,normalImpl:"CPU implementation for countOneBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countOneBits(${e})`}),Zf=d({name:"countTrailingZeros",signature:U,normalImpl:"CPU implementation for countTrailingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countTrailingZeros(${e})`}),Kf=d({name:"cross",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>T.cross[e.kind](e,t),codegenImpl:(e,t)=>c`cross(${e}, ${t})`});function Qf(e){if(typeof e=="number")return e*180/Math.PI;throw new Je("CPU implementation for degrees on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Jf=d({name:"degrees",signature:U,normalImpl:Qf,codegenImpl:e=>c`degrees(${e})`}),em=d({name:"determinant",signature:U,normalImpl:"CPU implementation for determinant not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`determinant(${e})`});function tm(e,t){return typeof e=="number"&&typeof t=="number"?Math.abs(e-t):bh(en(e,t))}var rm=d({name:"distance",signature:(...e)=>({argTypes:e,returnType:Ns(e[0])?he:g}),normalImpl:tm,codegenImpl:(e,t)=>c`distance(${e}, ${t})`}),vh=d({name:"dot",signature:(...e)=>({argTypes:e,returnType:e[0].primitive}),normalImpl:(e,t)=>T.dot[e.kind](e,t),codegenImpl:(e,t)=>c`dot(${e}, ${t})`}),nm=d({name:"dot4U8Packed",signature:{argTypes:[$,$],returnType:$},normalImpl:"CPU implementation for dot4U8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4U8Packed(${e}, ${t})`}),im=d({name:"dot4I8Packed",signature:{argTypes:[$,$],returnType:B},normalImpl:"CPU implementation for dot4I8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4I8Packed(${e}, ${t})`});function sm(e){return typeof e=="number"?Math.exp(e):T.exp[e.kind](e)}var am=d({name:"exp",signature:U,normalImpl:sm,codegenImpl:e=>c`exp(${e})`});function om(e){return typeof e=="number"?2**e:T.exp2[e.kind](e)}var um=d({name:"exp2",signature:U,normalImpl:om,codegenImpl:e=>c`exp2(${e})`}),hm=d({name:"extractBits",signature:(e,t,r)=>({argTypes:[e,$,$],returnType:e}),normalImpl:"CPU implementation for extractBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`extractBits(${e}, ${t}, ${r})`}),lm=d({name:"faceForward",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:"CPU implementation for faceForward not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`faceForward(${e}, ${t}, ${r})`}),cm=d({name:"firstLeadingBit",signature:U,normalImpl:"CPU implementation for firstLeadingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstLeadingBit(${e})`}),pm=d({name:"firstTrailingBit",signature:U,normalImpl:"CPU implementation for firstTrailingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstTrailingBit(${e})`});function dm(e){return typeof e=="number"?Math.floor(e):T.floor[e.kind](e)}var Is=d({name:"floor",signature:U,normalImpl:dm,codegenImpl:e=>c`floor(${e})`});function fm(e,t,r){if(typeof e=="number")return e*t+r;throw new Je("CPU implementation for fma on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var mm=d({name:"fma",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:fm,codegenImpl:(e,t,r)=>c`fma(${e}, ${t}, ${r})`});function ym(e){return typeof e=="number"?e-Math.floor(e):T.fract[e.kind](e)}var gm=d({name:"fract",signature:U,normalImpl:ym,codegenImpl:e=>c`fract(${e})`}),wm={f32:fe({fract:g,exp:B}),f16:fe({fract:he,exp:B}),abstractFloat:fe({fract:mt,exp:Un}),vec2f:fe({fract:N,exp:ie}),vec3f:fe({fract:le,exp:Oe}),vec4f:fe({fract:I,exp:de}),vec2h:fe({fract:yt,exp:ie}),vec3h:fe({fract:gt,exp:Oe}),vec4h:fe({fract:wt,exp:de})},xm=d({name:"frexp",normalImpl:"CPU implementation for frexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",signature:e=>{let t=wm[e.type];if(!t)throw new Error(`Unsupported data type for frexp: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},codegenImpl:e=>c`frexp(${e})`}),vm=d({name:"insertBits",signature:(e,t,r,n)=>({argTypes:[e,t,$,$],returnType:e}),normalImpl:"CPU implementation for insertBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r,n)=>c`insertBits(${e}, ${t}, ${r}, ${n})`});function bm(e){if(typeof e=="number")return 1/Math.sqrt(e);throw new Je("CPU implementation for inverseSqrt on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var $m=d({name:"inverseSqrt",signature:U,normalImpl:bm,codegenImpl:e=>c`inverseSqrt(${e})`}),Tm=d({name:"ldexp",signature:(e,t)=>{switch(e.type){case"abstractFloat":return{argTypes:[e,Un],returnType:e};case"f32":case"f16":return{argTypes:[e,B],returnType:e};case"vec2f":case"vec2h":return{argTypes:[e,ie],returnType:e};case"vec3f":case"vec3h":return{argTypes:[e,Oe],returnType:e};case"vec4f":case"vec4h":return{argTypes:[e,de],returnType:e};default:throw new Error(`Unsupported data type for ldexp: ${e.type}. Supported types are abstractFloat, f32, f16, vec2f, vec2h, vec3f, vec3h, vec4f, vec4h.`)}},normalImpl:"CPU implementation for ldexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`ldexp(${e}, ${t})`});function _m(e){return typeof e=="number"?Math.abs(e):T.length[e.kind](e)}var bh=d({name:"length",signature:e=>({argTypes:[e],returnType:Ns(e)?he:g}),normalImpl:_m,codegenImpl:e=>c`length(${e})`});function zm(e){return typeof e=="number"?Math.log(e):T.log[e.kind](e)}var Im=d({name:"log",signature:U,normalImpl:zm,codegenImpl:e=>c`log(${e})`});function Sm(e){return typeof e=="number"?Math.log2(e):T.log2[e.kind](e)}var Em=d({name:"log2",signature:U,normalImpl:Sm,codegenImpl:e=>c`log2(${e})`});function Mm(e,t){return typeof e=="number"?Math.max(e,t):T.max[e.kind](e,t)}var $h=d({name:"max",signature:Wi,normalImpl:gh(Mm),codegenImpl:wh("max")});function km(e,t){return typeof e=="number"?Math.min(e,t):T.min[e.kind](e,t)}var Pm=d({name:"min",signature:Wi,normalImpl:gh(km),codegenImpl:wh("min")});function Um(e,t,r){if(typeof e=="number"){if(typeof r!="number"||typeof t!="number")throw new Error("When e1 and e2 are numbers, the blend factor must be a number.");return e*(1-r)+t*r}if(typeof e=="number"||typeof t=="number")throw new Error("e1 and e2 need to both be vectors of the same kind.");return T.mix[e.kind](e,t,r)}var ai=d({name:"mix",signature:Wi,normalImpl:Um,codegenImpl:(e,t,r)=>c`mix(${e}, ${t}, ${r})`}),Vm={f32:fe({fract:g,whole:g}),f16:fe({fract:he,whole:he}),abstractFloat:fe({fract:mt,whole:mt}),vec2f:fe({fract:N,whole:N}),vec3f:fe({fract:le,whole:le}),vec4f:fe({fract:I,whole:I}),vec2h:fe({fract:yt,whole:yt}),vec3h:fe({fract:gt,whole:gt}),vec4h:fe({fract:wt,whole:wt})},Am=d({name:"modf",signature:e=>{let t=Vm[e.type];if(!t)throw new Error(`Unsupported data type for modf: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},normalImpl:"CPU implementation for modf not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`modf(${e})`}),Cm=d({name:"normalize",signature:U,normalImpl:e=>T.normalize[e.kind](e),codegenImpl:e=>c`normalize(${e})`});function Om(e,t){if(typeof e=="number"&&typeof t=="number")return e**t;if(te(e)&&te(t))return T.pow[e.kind](e,t);throw new Error("Invalid arguments to pow()")}var Th=d({name:"pow",signature:(...e)=>{let t=ge(e,[g,he,mt])??e;return{argTypes:t,returnType:Wt(t[0])?t[1]:t[0]}},normalImpl:Om,codegenImpl:(e,t)=>c`pow(${e}, ${t})`}),Bm=d({name:"quantizeToF16",signature:U,normalImpl:"CPU implementation for quantizeToF16 not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`quantizeToF16(${e})`});function Fm(e){if(typeof e=="number")return e*Math.PI/180;throw new Je("CPU implementation for radians on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var jm=d({name:"radians",signature:(...e)=>{let t=ge(e,[g,he,mt])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Fm,codegenImpl:e=>c`radians(${e})`}),Rm=d({name:"reflect",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>en(e,jn(2*vh(t,e),t)),codegenImpl:(e,t)=>c`reflect(${e}, ${t})`}),Gm=d({name:"refract",normalImpl:"CPU implementation for refract not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`refract(${e}, ${t}, ${r})`,signature:(e,t,r)=>({argTypes:[e,t,Ns(e)?he:g],returnType:e})}),Lm=d({name:"reverseBits",signature:U,normalImpl:"CPU implementation for reverseBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`reverseBits(${e})`});function Dm(e){if(typeof e=="number")return Math.round(e);throw new Je("CPU implementation for round on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Nm=d({name:"round",signature:U,normalImpl:Dm,codegenImpl:e=>c`round(${e})`});function Wm(e){if(typeof e=="number")return Math.max(0,Math.min(1,e));throw new Je("CPU implementation for saturate on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var qm=d({name:"saturate",signature:U,normalImpl:Wm,codegenImpl:e=>c`saturate(${e})`});function Hm(e){return typeof e=="number"?Math.sign(e):T.sign[e.kind](e)}var Ym=d({name:"sign",signature:U,normalImpl:Hm,codegenImpl:e=>c`sign(${e})`});function Xm(e){return typeof e=="number"?Math.sin(e):T.sin[e.kind](e)}var ar=d({name:"sin",signature:U,normalImpl:Xm,codegenImpl:e=>c`sin(${e})`});function Zm(e){if(typeof e=="number")return Math.sinh(e);throw new Je("CPU implementation for sinh on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Km=d({name:"sinh",signature:U,normalImpl:Zm,codegenImpl:e=>c`sinh(${e})`});function Qm(e,t,r){return typeof r=="number"?ir(e,t,r):T.smoothstep[r.kind](e,t,r)}var Jm=d({name:"smoothstep",signature:(...e)=>({argTypes:e,returnType:e[2]}),normalImpl:Qm,codegenImpl:(e,t,r)=>c`smoothstep(${e}, ${t}, ${r})`});function ey(e){return typeof e=="number"?Math.sqrt(e):T.sqrt[e.kind](e)}var Ss=d({name:"sqrt",signature:U,normalImpl:ey,codegenImpl:e=>c`sqrt(${e})`});function ty(e,t){if(typeof e=="number")return e<=t?1:0;throw new Je("CPU implementation for step on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var ry=d({name:"step",signature:(...e)=>{let t=ge(e,[g,he,mt])??e;return{argTypes:t,returnType:t[0]}},normalImpl:ty,codegenImpl:(e,t)=>c`step(${e}, ${t})`});function ny(e){if(typeof e=="number")return Math.tan(e);throw new Je("CPU implementation for tan on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var iy=d({name:"tan",signature:U,normalImpl:ny,codegenImpl:e=>c`tan(${e})`});function sy(e){return typeof e=="number"?Math.tanh(e):T.tanh[e.kind](e)}var ay=d({name:"tanh",signature:U,normalImpl:sy,codegenImpl:e=>c`tanh(${e})`}),oy=d({name:"transpose",signature:U,normalImpl:"CPU implementation for transpose not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`transpose(${e})`}),uy=d({name:"trunc",signature:U,normalImpl:"CPU implementation for trunc not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`trunc(${e})`}),_h=d({name:"bitcastU32toF32",normalImpl:(e=>typeof e=="number"?ot(e):T.bitcastU32toF32[e.kind](e)),codegenImpl:e=>c`bitcast<f32>(${e})`,signature:(...e)=>{let t=ge(e,[$])??e;return{argTypes:t,returnType:ft(t[0])?t[0].type==="vec2u"?N:t[0].type==="vec3u"?le:I:g}}}),zh=d({name:"bitcastU32toI32",normalImpl:(e=>typeof e=="number"?ut(e):T.bitcastU32toI32[e.kind](e)),codegenImpl:e=>c`bitcast<i32>(${e})`,signature:(...e)=>{let t=ge(e,[$])??e;return{argTypes:t,returnType:ft(t[0])?t[0].type==="vec2u"?ie:t[0].type==="vec3u"?Oe:de:B}}}),Ih=d({name:"unpack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4);new gr(t).writeUint32(e);let r=new Nt(t);return N(r.readFloat16(),r.readFloat16())},signature:{argTypes:[$],returnType:N},codegenImpl:e=>c`unpack2x16float(${e})`}),hy=d({name:"pack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4),r=new gr(t);r.writeFloat16(e.x),r.writeFloat16(e.y);let n=new Nt(t);return $(n.readUint32())},signature:{argTypes:[N],returnType:$},codegenImpl:e=>c`pack2x16float(${e})`}),ly=d({name:"unpack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4);new gr(t).writeUint32(e);let r=new Nt(t);return I(r.readUint8()/255,r.readUint8()/255,r.readUint8()/255,r.readUint8()/255)},signature:{argTypes:[$],returnType:I},codegenImpl:e=>c`unpack4x8unorm(${e})`}),cy=d({name:"pack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4),r=new gr(t);r.writeUint8(e.x*255),r.writeUint8(e.y*255),r.writeUint8(e.z*255),r.writeUint8(e.w*255);let n=new Nt(t);return $(n.readUint32())},signature:{argTypes:[I],returnType:$},codegenImpl:e=>c`pack4x8unorm(${e})`});function tn(e){return e.type.includes("2")?fr:e.type.includes("3")?mr:yr}var Sh=d({name:"allEq",signature:(...e)=>({argTypes:e,returnType:R}),normalImpl:(e,t)=>za(Gn(e,t)),codegenImpl:(e,t)=>c`all(${e} == ${t})`}),Gn=(e,t)=>T.eq[e.kind](e,t),py=d({name:"eq",signature:(...e)=>({argTypes:e,returnType:tn(e[0])}),normalImpl:Gn,codegenImpl:(e,t)=>c`(${e} == ${t})`}),dy=d({name:"ne",signature:(...e)=>({argTypes:e,returnType:tn(e[0])}),normalImpl:(e,t)=>It(Gn(e,t)),codegenImpl:(e,t)=>c`(${e} != ${t})`}),qi=(e,t)=>T.lt[e.kind](e,t),fy=d({name:"lt",signature:(...e)=>({argTypes:e,returnType:tn(e[0])}),normalImpl:qi,codegenImpl:(e,t)=>c`(${e} < ${t})`}),my=d({name:"le",signature:(...e)=>({argTypes:e,returnType:tn(e[0])}),normalImpl:(e,t)=>_a(qi(e,t),Gn(e,t)),codegenImpl:(e,t)=>c`(${e} <= ${t})`}),yy=d({name:"gt",signature:(...e)=>({argTypes:e,returnType:tn(e[0])}),normalImpl:(e,t)=>Eh(It(qi(e,t)),It(Gn(e,t))),codegenImpl:(e,t)=>c`(${e} > ${t})`}),gy=d({name:"ge",signature:(...e)=>({argTypes:e,returnType:tn(e[0])}),normalImpl:(e,t)=>It(qi(e,t)),codegenImpl:(e,t)=>c`(${e} >= ${t})`}),It=e=>T.neg[e.kind](e),wy=d({name:"not",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:It,codegenImpl:e=>c`!(${e})`}),_a=(e,t)=>T.or[e.kind](e,t),xy=d({name:"or",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:_a,codegenImpl:(e,t)=>c`(${e} | ${t})`}),Eh=(e,t)=>It(_a(It(e),It(t))),vy=d({name:"and",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Eh,codegenImpl:(e,t)=>c`(${e} & ${t})`}),za=e=>T.all[e.kind](e),by=d({name:"all",signature:(...e)=>({argTypes:e,returnType:R}),normalImpl:za,codegenImpl:e=>c`all(${e})`}),$y=d({name:"any",signature:(...e)=>({argTypes:e,returnType:R}),normalImpl:e=>!za(It(e)),codegenImpl:e=>c`any(${e})`}),Ty=d({name:"isCloseTo",signature:(...e)=>({argTypes:e,returnType:R}),normalImpl:(e,t,r=.01)=>typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<r:te(e)&&te(t)?T.isCloseToZero[e.kind](en[l].jsImpl(e,t),r):!1,codegenImpl:(e,t,r=y(.01,g,"constant"))=>Kn(e)&&Kn(t)?c`(abs(f32(${e}) - f32(${t})) <= ${r})`:!Kn(e)&&!Kn(t)?c`all(abs(${e} - ${t}) <= (${e} - ${e}) + ${r})`:"false"});function _y(e,t,r){return typeof r=="boolean"?r?t:e:T.select[e.kind](e,t,r)}var zy=d({name:"select",signature:(e,t,r)=>{let[n,i]=ge([e,t])??[e,t];return{argTypes:[n,i,r],returnType:n}},normalImpl:_y,codegenImpl:(e,t,r)=>c`select(${e}, ${t}, ${r})`}),Iy={channelType:g,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:"non-copyable"},Sy={channelType:g,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:2},Ey={channelType:g,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:4},My={channelType:$,vectorType:ve,sampleTypes:["uint"],texelSize:1},lo=new Map;function Ln(e){let t=lo.get(e);return t===void 0&&(t=ky(e),lo.set(e,t)),t}function ky(e){let t=Vy(e),r=Py(e),n=e.includes("stencil");return{channelType:t,vectorType:t===$?ve:t===B?de:I,texelSize:Ay(e),sampleTypes:Cy(e),canRenderAttachment:Uy(e),...r&&{depthAspect:r},...n&&{stencilAspect:My}}}function Py(e){if(e==="depth16unorm")return Sy;if(e==="depth32float"||e==="depth32float-stencil8")return Ey;if(e==="depth24plus"||e==="depth24plus-stencil8")return Iy}function Uy(e){return!(e.startsWith("bc")||e.startsWith("etc2")||e.startsWith("eac")||e.startsWith("astc")||e==="rgb9e5ufloat")}function Vy(e){return e==="stencil8"||e.includes("uint")?$:e.includes("sint")?B:g}function Ay(e){let[,t,r]=e.match(/^(rgba|bgra|rg|r)(8|16|32)/)??[];return t&&r?t.length*Number(r)/8:e==="stencil8"?1:e==="depth16unorm"?2:e==="depth32float"?4:e==="depth32float-stencil8"?5:e==="depth24plus"||e==="depth24plus-stencil8"?"non-copyable":/^(bc[14]-|etc2-rgb8|eac-r11)/.test(e)?8:/^(bc|astc-|etc2-rgba|eac-rg)/.test(e)?16:4}function Cy(e){return e==="stencil8"?["uint"]:e.includes("uint")?["uint"]:e.includes("sint")?["sint"]:e.includes("depth")?["depth","unfilterable-float"]:/^(r|rg|rgba)16(u|s)norm$/.test(e)?["unfilterable-float"]:["float","unfilterable-float"]}var Oy=new Set(["r32float","rg32float","rgba32float"]);function By(e,t){return Oy.has(t)&&!e.features.has("float32-filterable")?["unfilterable-float"]:Ln(t).sampleTypes}var Ia=["f16","clip_distances","dual_source_blending","subgroups","primitive_index"],Mh={f16:"shader-f16",clip_distances:"clip-distances",dual_source_blending:"dual-source-blending",subgroups:"subgroups",primitive_index:"primitive-index"},Fy={block:0,binaryExpr:1,assignmentExpr:2,logicalExpr:3,unaryExpr:4,numericLiteral:5,call:6,memberAccess:7,indexAccess:8,return:10,if:11,let:12,const:13,for:14,while:15,continue:16,break:17,arrayExpr:100,preUpdate:101,postUpdate:102,stringLiteral:103,objectExpr:104},Es={identifier:"i",destructuredObject:"d"};const jy=Object.freeze(Object.defineProperty({__proto__:null,FuncParameterType:Es,NodeTypeCatalog:Fy},Symbol.toStringTag,{value:"Module"}));function Ry(e){return e?.[F]}var We={get(e,t){if(t in e)return Reflect.get(e,t);if(t==="toString"||t===Symbol.toStringTag||t===Symbol.toPrimitive)return()=>e.toString();if(typeof t=="symbol")return;let r=Ai(e),n=xa(r,String(t));if(n)return new Proxy({[l]:!0,[z]:i=>i.resolve(n.value,n.dataType),[ke]:n,toString:()=>`${String(e)}.${t}`},We)}};function Hi(e){let t=e;for(;;){let r=Ry(t);if(!r)break;t=r}return t}function Ms(e,t){return new Gy(e,t)}function kh(e){let t=Reflect.ownKeys(e);for(let r of t){let n=e[r];(n&&typeof n=="object"||typeof n=="function")&&kh(n)}return Object.freeze(e)}var Gy=class{constructor(t,r){this.dataType=t,this.#e=r&&typeof r=="object"?kh(r):r}[l]={};#e;$name(t){return G(this,t),this}[z](t){let r=t.getUniqueName(this),n=t.resolve(this.dataType).value,i=t.resolve(this.#e,this.dataType).value;return t.addDeclaration(`const ${r}: ${n} = ${i};`),y(r,this.dataType,_e(this.dataType)?"constant":"constant-tgpu-const-ref")}toString(){return`const:${b(this)??"<unnamed>"}`}get[F](){let t=this.dataType;return new Proxy({[l]:!0,get[ke](){return y(this,t,_e(t)?"constant":"constant-tgpu-const-ref")},[z]:r=>r.resolve(this),toString:()=>`const:${b(this)??"<unnamed>"}.$`},We)}get $(){return et()?this[F]:this.#e}get value(){return this.$}};function Ly(e){return new Dy(e)}var Dy=class{constructor(t){this.declaration=t}[l]=!0;externalsToApply=[];$uses(t){return this.externalsToApply.push(t),this}[z](t){let r={};for(let i of this.externalsToApply)Wr(r,i);let n=On(t,r,this.declaration);return t.addDeclaration(n),y("",se,"constant")}toString(){return`declare: ${this.declaration}`}};function Ph(e){let t={argTypes:e.in&&Object.keys(e.in).length!==0?[Fn(e.in)]:[],returnType:se,workgroupSize:[e.workgroupSize[0]??1,e.workgroupSize[1]??1,e.workgroupSize[2]??1],isEntry:!0};return Object.assign((r,...n)=>Ny(t,e.workgroupSize,Bi(r,...n)),t)}function Ny(e,t,r){let n=Bn(r,`@compute @workgroup_size(${t.join(", ")}) `),i=e.argTypes[0];return{shell:e,$uses(s){return n.applyExternals(s),this},[l]:!0,[ue]:n,$name(s){return G(n,s),Pi(i)&&i.$name(`${s}_Input`),this},[z](s){return n.resolve(s,e.argTypes,e.returnType)},toString(){return`computeFn:${b(n)??"<unnamed>"}`}}}function O(e,t){let r={[l]:!0,argTypes:e,returnType:t??se,isEntry:!1};return Object.assign((n,...i)=>qy(r,Bi(n,...i)),r)}function Uh(e){return C(e)&&e?.resourceType==="function"}function Wy([e,t]){return`${b(e)??"<unnamed>"}=${t}`}function qy(e,t){let r=Bn(t,""),n={shell:e,resourceType:"function",$uses(a){return r.applyExternals(a),this},[ue]:r,$name(a){return G(r,a),this},with(a,o){return Vh(s,[[Vi(a)?a.slot:a,o]])},[z](a){return typeof t=="string"&&(Vp(t,e.argTypes,r.applyExternals),ju(t,e.returnType,r.applyExternals)),r.resolve(a,e.argTypes,e.returnType)}},i=d({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.argTypes,returnType:e.returnType},normalImpl:(...a)=>dc(()=>{try{if(typeof t=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");let o=a.map((h,p)=>Yt(e.argTypes[p],h)),u=t(...o);return Yt(e.returnType,u)}catch(o){throw o instanceof Ha?o.appendToTrace(s):new Ha(o,[s])}}),codegenImpl:(...a)=>{let o=Ce();return o.withResetIndentLevel(()=>c`${o.resolve(s).value}(${a})`)}}),s=Object.assign(i,n);return s[l].implementation=t,Object.defineProperty(s,"toString",{value(){return`fn:${b(r)??"<unnamed>"}`}}),s}function Vh(e,t){let r={resourceType:"function",shell:e.shell,[ur]:{inner:e,pairs:t},$uses(s){return e.$uses(s),this},[ue]:e,$name(s){return e.$name(s),this},with(s,a){return Vh(i,[...t,[Vi(s)?s.slot:s,a]])}},n=d({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.shell.argTypes,returnType:e.shell.returnType},normalImpl:e,codegenImpl:(...s)=>{let a=Ce();return a.withResetIndentLevel(()=>c`${a.resolve(i).value}(${s})`)}}),i=Object.assign(n,r);return i[l].implementation=e[l].implementation,Object.defineProperty(i,"toString",{value(){return`fn:${b(e)??"<unnamed>"}[${t.map(Wy).join(", ")}]`}}),i}function Hy(e,t,r="runtime"){return new Yy(e,t,r)}var Yy=class{[l];dataType;origin;#e;#t;constructor(t,r,n){this[l]=!0,this.dataType=r,this.origin=n,this.#e=t,this.#t=[]}$uses(t){return this.#t.push(t),this}[z](t){let r={};for(let i of this.#t)Wr(r,i);let n=On(t,r,this.#e);return y(n,this.dataType,this.origin)}toString(){return`raw(${String(this.dataType)}): "${this.#e}"`}get[F](){let t=this.dataType,r=this.origin;return new Proxy({[l]:!0,get[ke](){return y(this,t,r)},[z]:n=>n.resolve(this),toString:()=>`raw(${String(this.dataType)}): "${this.#e}".$`},We)}get $(){if(!et())throw new Error("Raw code snippets can only be used on the GPU.");return this[F]}get value(){return this.$}};function Xy(e){let t={in:e.in,out:e.out,returnType:Fn(e.out),isEntry:!0};return Object.assign((r,...n)=>Zy(t,Bi(r,...n)),t)}function Zy(e,t){let r=Bn(t,"@fragment "),n=e.returnType;return typeof t=="string"&&ju(t,n,i=>r.applyExternals(i)),{shell:e,outputType:n,$uses(i){return r.applyExternals(i),this},[l]:!0,[ue]:r,$name(i){return G(r,i),Pi(n)&&n.$name(`${i}_Output`),this},[z](i){let s=e.in?Fn(e.in,i.varyingLocations).$name(`${b(this)??""}_Input`):void 0;return s&&r.applyExternals({In:s}),r.applyExternals({Out:n}),r.resolve(i,s?[s]:[],e.returnType)},toString(){return`fragmentFn:${b(r)??"<unnamed>"}`}}}var Ah=new Set(["alias","break","case","const","const_assert","continue","continuing","default","diagnostic","discard","else","enable","false","fn","for","if","let","loop","override","requires","return","struct","switch","true","var","while","NULL","Self","abstract","active","alignas","alignof","as","asm","asm_fragment","async","attribute","auto","await","become","cast","catch","class","co_await","co_return","co_yield","coherent","column_major","common","compile","compile_fragment","concept","const_cast","consteval","constexpr","constinit","crate","debugger","decltype","delete","demote","demote_to_helper","do","dynamic_cast","enum","explicit","export","extends","extern","external","fallthrough","filter","final","finally","friend","from","fxgroup","get","goto","groupshared","highp","impl","implements","import","inline","instanceof","interface","layout","lowp","macro","macro_rules","match","mediump","meta","mod","module","move","mut","mutable","namespace","new","nil","noexcept","noinline","nointerpolation","non_coherent","noncoherent","noperspective","null","nullptr","of","operator","package","packoffset","partition","pass","patch","pixelfragment","precise","precision","premerge","priv","protected","pub","public","readonly","ref","regardless","register","reinterpret_cast","require","resource","restrict","self","set","shared","sizeof","smooth","snorm","static","static_assert","static_cast","std","subroutine","super","target","template","this","thread_local","throw","trait","try","type","typedef","typeid","typename","typeof","union","unless","unorm","unsafe","unsized","use","using","varying","virtual","volatile","wgsl","where","with","writeonly","yield","sampler"]);function Ky(e){return e?e.replaceAll(/\s/g,"_").replaceAll(/[^\w\d]/g,""):"item"}function Ch(e){if(e==="_"||e.startsWith("__")||/\s/.test(e))throw new Error(`Invalid identifier '${e}'. Choose an identifier without whitespaces or leading underscores.`);let t=e.split("_")[0];return!Ah.has(t)}var Oh=class{#e;#t;constructor(){this.#e=new Set(Ah),this.#t=[]}get usedFunctionScopeNames(){return this.#t[this.#t.length-1]}makeUnique(t,r){let n=Ky(t),i=this.getUniqueVariant(n);return r?this.#e.add(i):this.usedFunctionScopeNames?.add(i),i}makeValid(t){return Ch(t)&&!this.#e.has(t)?(this.usedFunctionScopeNames?.add(t),t):this.makeUnique(t,!1)}isUsed(t){return this.#e.has(t)||!!this.usedFunctionScopeNames?.has(t)}pushFunctionScope(){this.#t.push(new Set)}popFunctionScope(){this.#t.pop()}},Qy=class extends Oh{#e=0;getUniqueVariant(t){let r=`${t}_${this.#e++}`;for(;this.isUsed(r);)r=`${t}_${this.#e++}`;return r}},Jy=class extends Oh{getUniqueVariant(t){let r=0,n=t;for(;this.isUsed(n);)r++,n=`${t}_${r}`;return n}};function eg(e,t){let r=Bn(t,"");return{[l]:!0,[ue]:r,resourceType:"shellless-impl",argTypes:e,[z](n){return r.resolve(n,e,void 0)},toString(){return`fn*:${b(r)??"<unnamed>"}(${e.map(n=>n.toString()).join(", ")})`}}}function ks(e,t){return e.type!==t.type?!1:e.type==="ptr"&&t.type==="ptr"?e.access===t.access&&e.addressSpace===t.addressSpace&&e.implicit===t.implicit&&ks(e.inner,t.inner):e.type==="array"&&t.type==="array"?e.elementCount===t.elementCount&&ks(e.elementType,t.elementType):e.type==="struct"&&t.type==="struct"?e===t:!0}var tg=class{cache=new Map;get(t,r){let n=Ui(t);if(!n?.ast)return;if(!r&&n.ast.params.length>0)throw new Error(`Cannot resolve '${b(t)}' directly, because it expects arguments. Either call it from another function, or wrap it in a shell`);let i=(r??[]).map((o,u)=>{if(o.value instanceof zt){if(o.dataType.type==="unknown")throw new j("d.ref() created with primitive types must be stored in a variable before use");return o.dataType}if(o.dataType.type==="unknown")throw new Error(`Passed illegal value ${o.value} as the #${u} argument to ${n.name}(...)`);let h=Gt(o.dataType);if(o.origin==="constant-tgpu-const-ref"||o.origin==="runtime-tgpu-const-ref"){let p=Ce();throw new Error(`Cannot pass constant references as function arguments. Explicitly copy them by wrapping them in a schema: '${p.resolve(h).value}(...)'`)}return Xe(h)&&h.implicit&&(h=h.inner),h}),s=this.cache.get(t);if(s){let o=s.find(u=>u.argTypes.length===i.length&&u.argTypes.every((h,p)=>ks(h,i[p])));if(o)return o}else s=[],this.cache.set(t,s);let a=eg(i,t);return s.push(a),a}},rg=class{[l];constructor(t){this[l]={nameRegistry:t,shelllessRepo:new tg,memoizedResolves:new WeakMap,memoizedDerived:new WeakMap,listeners:{name:new Set}}}on(t,r){if(t==="name"){let n=this[l].listeners.name;return n.add(r),()=>n.delete(r)}throw new Error(`Unsupported event: ${t}`)}};function ng(e,t){let r=e.nameRegistry.makeUnique(b(t),!0);for(let n of e.listeners.name)n({target:t,name:r});return r}function rn(e){let{names:t="strict"}=e??{};return new rg(t==="strict"?new Jy:new Qy)}function Yi(e){return typeof e?.format=="string"}function ig(e,t){let r=[];if(Kr(e)){if(!Yi(t))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return r.push(t._layout),{usedVertexLayouts:r,bufferDefinitions:[{arrayStride:t._layout.stride,stepMode:t._layout.stepMode,attributes:[{format:t.format,offset:t.offset,shaderLocation:qt(e)??0}]}]}}let n=[],i=new WeakMap,s=0;for(let[a,o]of Object.entries(e)){if(kt(o))continue;let u=t[a];if(!u)throw new Error(`An attribute by the name of '${a}' was not provided to the shader.`);let h=u._layout,p=i.get(h);p||(r.push(h),p=[],n.push({arrayStride:h.stride,stepMode:h.stepMode,attributes:p}),i.set(h,p)),s=qt(o)??s,p.push({format:u.format,offset:u.offset,shaderLocation:s++})}return{usedVertexLayouts:r,bufferDefinitions:n}}var sg=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","vec2<bool>","vec3<bool>","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","texture_external"];function ag(e){return sg.includes(e.type)}function Ps(e,[t,r]){if(!Ch(t))throw new Error(`Property key '${t}' is a reserved WGSL word. Choose a different name.`);return`  ${da(r)}${t}: ${e.resolve(r).value},
`}function og(e,t){if(t[l].isAbstruct)throw new Error("Cannot resolve abstract struct types to WGSL.");let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>Ps(e,n)).join("")}}`),r}function ug(e,t){let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>Yi(n[1])?Ps(e,[n[0],Mt[n[1].format]]):Ps(e,n)).join("")}
}`),r}function hg(e,t){let r=e.resolve(t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function lg(e,t){let r=e.resolve(Yi(t.elementType)?Mt[t.elementType.format]:t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function Bh(e,t){if(Zr(t))return t.type==="unstruct"?ug(e,t):t.type==="disarray"?lg(e,t):t.type==="loose-decorated"?e.resolve(Yi(t.inner)?Mt[t.inner.format]:t.inner).value:e.resolve(Mt[t.type]).value;if(ag(t))return t.type;if(t.type==="struct")return og(e,t);if(t.type==="array")return hg(e,t);if(t.type==="atomic")return`atomic<${Bh(e,t.inner)}>`;if(t.type==="decorated")return e.resolve(t.inner).value;if(t.type==="ptr")return t.addressSpace==="storage"?`ptr<storage, ${e.resolve(t.inner).value}, ${t.access==="read-write"?"read_write":t.access}>`:`ptr<${t.addressSpace}, ${e.resolve(t.inner).value}>`;if(t.type==="abstractInt"||t.type==="abstractFloat"||t.type==="void"||t.type==="u16")throw new Error(`${t.type} has no representation in WGSL`);if(Ts(t))return`${t.type}<${t.format}, ${Rn[t.access]}>`;if(ih(t))return t.type.startsWith("texture_depth")?t.type:`${t.type}<${t.sampleType.type}>`;if(Td(t)||$d(t))return t.type;qr(t,"resolveData")}var Fh=class Us{constructor(t){this.bindings=t}with(t,r){return new Us([...this.bindings,[Vi(t)?t.slot:t,r]])}pipe(t){let r=t(this);return new Us([...this.bindings,...r.bindings])}};function*cg(e){let t=0;for(;;)e.has(t)||(yield t),t++}function pg(e,t){let r="size"in e?e.size:e.currentByteOffset,n=t-1,i=r&n;"skipBytes"in e?e.skipBytes(t-i&n):e.add(t-i&n)}var pe=pg,co=new WeakMap;function jh(e){let t=co.get(e);if(t)return t;let r=new ne,n={},i;for(let s in e.propTypes){let a=e.propTypes[s];if(a===void 0)throw new Error(`Property ${s} is undefined in struct`);let o=r.size;pe(r,Ke(e)?De(a):re(a)),i&&(i.padding=r.size-o);let u=A(a);n[s]={offset:r.size,size:u},i=n[s],r.add(u)}return i&&(i.padding=Ae(A(e),re(e))-r.size),co.set(e,n),n}var dg=(()=>{try{return new Function("return true"),!0}catch{return!1}})(),os=new WeakMap,ti={u32:"u32",vec2u:"u32",vec3u:"u32",vec4u:"u32",u16:"u16",i32:"i32",vec2i:"i32",vec3i:"i32",vec4i:"i32",f32:"f32",vec2f:"f32",vec3f:"f32",vec4f:"f32",f16:"f16",vec2h:"f16",vec3h:"f16",vec4h:"f16",mat2x2f:"f32",mat3x3f:"f32",mat4x4f:"f32"},fg={uint8:"u8",uint8x2:"u8",uint8x4:"u8",sint8:"i8",sint8x2:"i8",sint8x4:"i8",unorm8:"u8",unorm8x2:"u8",unorm8x4:"u8",snorm8:"i8",snorm8x2:"i8",snorm8x4:"i8",uint16:"u16",uint16x2:"u16",uint16x4:"u16",sint16:"i16",sint16x2:"i16",sint16x4:"i16",unorm16:"u16",unorm16x2:"u16",unorm16x4:"u16",snorm16:"i16",snorm16x2:"i16",snorm16x4:"i16",float16:"f16",float16x2:"f16",float16x4:"f16",float32:"f32",float32x2:"f32",float32x3:"f32",float32x4:"f32",uint32:"u32",uint32x2:"u32",uint32x3:"u32",uint32x4:"u32",sint32:"i32",sint32x2:"i32",sint32x3:"i32",sint32x4:"i32"},ri={u32:"setUint32",i32:"setInt32",f32:"setFloat32",u16:"setUint16",i16:"setInt16",f16:"setFloat16",u8:"setUint8",i8:"setInt8"},mg={unorm8:e=>`Math.round(${e} * 255)`,unorm8x2:e=>`Math.round(${e} * 255)`,unorm8x4:e=>`Math.round(${e} * 255)`,snorm8:e=>`Math.round(${e} * 127)`,snorm8x2:e=>`Math.round(${e} * 127)`,snorm8x4:e=>`Math.round(${e} * 127)`,unorm16:e=>`Math.round(${e} * 65535)`,unorm16x2:e=>`Math.round(${e} * 65535)`,unorm16x4:e=>`Math.round(${e} * 65535)`,snorm16:e=>`Math.round(${e} * 32767)`,snorm16x2:e=>`Math.round(${e} * 32767)`,snorm16x4:e=>`Math.round(${e} * 32767)`},po={"unorm10-10-10-2":{writeFunction:"setUint32",generator:(e,t)=>`output.setUint32(${e}, ((${t}.x*1023&0x3FF)<<22)|((${t}.y*1023&0x3FF)<<12)|((${t}.z*1023&0x3FF)<<2)|(${t}.w*3&3), littleEndian);
`},"unorm8x4-bgra":{writeFunction:"setUint8",generator:(e,t)=>{let r=["z","y","x","w"],n="";for(let i=0;i<4;i++)n+=`output.setUint8((${e} + ${i}), Math.round(${t}.${r[i]} * 255), littleEndian);
`;return n}}};function oi(e,t,r,n=0){let i=["i","j","k"][n]||`i${n}`;if(mi(e)||Ze(e))return oi(e.inner,t,r,n);if(ye(e)||Ke(e)){let a=jh(e),o="";for(let[u,h]of Object.entries(a)){let p=e.propTypes[u];p&&(o+=oi(p,`(${t} + ${h.offset})`,`${r}.${u}`,n))}return o}if(Ie(e)||Et(e)){let a=Ae(A(e.elementType),re(e)),o="";return o+=`for (let ${i} = 0; ${i} < ${e.elementCount}; ${i}++) {
`,o+=oi(e.elementType,`(${t} + ${i} * ${a})`,`${r}[${i}]`,n+1),o+=`}
`,o}if(ft(e)){let a=ti[e.type],o="",u=ri[a],h=["x","y","z","w"],p=ps(e)?2:ds(e)?3:4;for(let f=0;f<p;f++)o+=`output.${u}((${t} + ${f*4}), ${r}.${h[f]}, littleEndian);
`;return o}if(fi(e)){let a=ti[e.type],o=ri[a],u=Yo(e)?2:Xo(e)?3:4,h=u*u,p=Ae(u*4,8),f="";for(let m=0;m<h;m++){let w=Math.floor(m/u),v=m%u,_=w*p+v*4;f+=`output.${o}((${t} + ${_}), ${r}.columns[${w}].${["x","y","z","w"][v]}, littleEndian);
`}return f}if(Cu(e)){let a=e.type;if(a in po)return po[a].generator(t,r);let o=fg[a],u=ri[o],h=Mt[a],p=Ho(h)?4:ds(h)?3:ps(h)?2:1,f=o==="u8"||o==="i8"?1:o==="u16"||o==="i16"||o==="f16"?2:4,m=["x","y","z","w"],w=mg[a],v="";for(let _=0;_<p;_++){let S=p===1?r:`${r}.${m[_]}`,V=w?w(S):S;v+=`output.${u}((${t} + ${_*f}), ${V}, littleEndian);
`}return v}if(!Object.hasOwn(ti,e.type))throw new Error(`Primitive ${e.type} is unsupported by compiled writer`);let s=ti[e.type];return`output.${ri[s]}(${t}, ${r}, littleEndian);
`}function fo(e){if(!dg){console.warn("This environment does not allow eval - using default writer as fallback");return}if(os.has(e))return os.get(e);try{let t=oi(e,"offset","value",0),r=new Function("output","offset","value","littleEndian=true",t);return os.set(e,r),r}catch(t){console.warn(`Failed to compile writer for schema: ${e}
Reason: ${t instanceof Error?t.message:String(t)}
Falling back to default writer`)}}var Cr={bool(){throw new Error("Booleans are not host-shareable")},f32(e,t,r){e.writeFloat32(r)},f16(e,t,r){e.writeFloat16(r)},i32(e,t,r){e.writeInt32(r)},u32(e,t,r){e.writeUint32(r)},u16(e,t,r){e.writeUint16(r)},vec2f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},vec2h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},vec2i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},vec2u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},vec3f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},vec3h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z)},vec3i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},vec3u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},vec4f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},vec4h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},vec4i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},vec4u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat3x3f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat4x4f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},struct(e,t,r){let n=re(t);pe(e,n);for(let[i,s]of Object.entries(t.propTypes))pe(e,re(s)),$i(e,s,r[i]);pe(e,n)},array(e,t,r){if(t.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let n=re(t);pe(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)pe(e,n),$i(e,t.elementType,r[s]);e.seekTo(i+A(t))},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t,r){Cr[t.inner.type]?.(e,t,r)},decorated(e,t,r){let n=De(t);pe(e,n);let i=e.currentByteOffset;Cr[t.inner?.type]?.(e,t.inner,r),e.seekTo(i+A(t))},uint8(e,t,r){e.writeUint8(r)},uint8x2(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y)},uint8x4(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y),e.writeUint8(r.z),e.writeUint8(r.w)},sint8(e,t,r){e.writeInt8(r)},sint8x2(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y)},sint8x4(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y),e.writeInt8(r.z),e.writeInt8(r.w)},unorm8(e,t,r){e.writeUint8(Math.round(r*255))},unorm8x2(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255))},unorm8x4(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255)),e.writeUint8(Math.round(r.z*255)),e.writeUint8(Math.round(r.w*255))},snorm8(e,t,r){e.writeInt8(Math.round(r*127))},snorm8x2(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127))},snorm8x4(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127)),e.writeInt8(Math.round(r.z*127)),e.writeInt8(Math.round(r.w*127))},uint16(e,t,r){e.writeUint16(r)},uint16x2(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y)},uint16x4(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y),e.writeUint16(r.z),e.writeUint16(r.w)},sint16(e,t,r){e.writeInt16(r)},sint16x2(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y)},sint16x4(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y),e.writeInt16(r.z),e.writeInt16(r.w)},unorm16(e,t,r){e.writeUint16(r*65535)},unorm16x2(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535)},unorm16x4(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535),e.writeUint16(r.z*65535),e.writeUint16(r.w*65535)},snorm16(e,t,r){e.writeInt16(Math.round(r*32767))},snorm16x2(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767))},snorm16x4(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767)),e.writeInt16(Math.round(r.z*32767)),e.writeInt16(Math.round(r.w*32767))},float16(e,t,r){e.writeFloat16(r)},float16x2(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},float16x4(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},float32(e,t,r){e.writeFloat32(r)},float32x2(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},float32x3(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},float32x4(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},uint32(e,t,r){e.writeUint32(r)},uint32x2(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},uint32x3(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},uint32x4(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},sint32(e,t,r){e.writeInt32(r)},sint32x2(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},sint32x3(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},sint32x4(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},"unorm10-10-10-2"(e,t,r){let n=0;n|=(r.x*1023&1023)<<22,n|=(r.y*1023&1023)<<12,n|=(r.z*1023&1023)<<2,n|=r.w*3&3,e.writeUint32(n)},"unorm8x4-bgra"(e,t,r){e.writeUint8(r.z*255),e.writeUint8(r.y*255),e.writeUint8(r.x*255),e.writeUint8(r.w*255)},disarray(e,t,r){let n=re(t);pe(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)pe(e,n),Cr[t.elementType?.type]?.(e,t.elementType,r[s]);e.seekTo(i+A(t))},unstruct(e,t,r){let n=t.propTypes;for(let[i,s]of Object.entries(n))Cr[s.type]?.(e,s,r[i])},"loose-decorated"(e,t,r){let n=De(t);pe(e,n);let i=e.currentByteOffset,s=Cr[t.inner?.type];return s?.(e,t.inner,r),e.seekTo(i+A(t)),r}};function $i(e,t,r){let n=Cr[t.type];if(!n)throw new Error(`Cannot write data of type '${t.type}'.`);n(e,t,r)}var yg={bool(){throw new Error("Booleans are not host-shareable")},f32(e){return e.readFloat32()},f16(e){return e.readFloat16()},i32(e){return e.readInt32()},u32(e){return e.readUint32()},u16(e){return e.readUint16()},vec2f(e){return N(e.readFloat32(),e.readFloat32())},vec3f(e){return le(e.readFloat32(),e.readFloat32(),e.readFloat32())},vec4f(e){return I(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},vec2h(e){return yt(e.readFloat16(),e.readFloat16())},vec3h(e){return gt(e.readFloat16(),e.readFloat16(),e.readFloat16())},vec4h(e){return wt(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16())},vec2i(e){return ie(e.readInt32(),e.readInt32())},vec3i(e){return Oe(e.readInt32(),e.readInt32(),e.readInt32())},vec4i(e){return de(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32())},vec2u(e){return Me(e.readUint32(),e.readUint32())},vec3u(e){return ae(e.readUint32(),e.readUint32(),e.readUint32())},vec4u(e){return ve(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32())},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e){return Ut(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},mat3x3f(e){let t=()=>{let r=e.readFloat32();return e.readFloat32(),r};return Vt(e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t())},mat4x4f(e){return Y(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},struct(e,t){let r=re(t);pe(e,r);let n={},i=t.propTypes;for(let[s,a]of Object.entries(i))pe(e,re(a)),n[s]=ct(e,a);return pe(e,r),n},array(e,t){if(t.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let r=re(t),n=[];for(let i=0;i<t.elementCount;i++){pe(e,r);let s=t.elementType,a=ct(e,s);n.push(a)}return pe(e,r),n},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t){return ct(e,t.inner)},decorated(e,t){let r=De(t);pe(e,r);let n=e.currentByteOffset,i=ct(e,t.inner);return e.seekTo(n+A(t)),i},uint8:e=>e.readUint8(),uint8x2:e=>Me(e.readUint8(),e.readUint8()),uint8x4:e=>ve(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),sint8:e=>e.readInt8(),sint8x2:e=>ie(e.readInt8(),e.readInt8()),sint8x4:e=>de(e.readInt8(),e.readInt8(),e.readInt8(),e.readInt8()),unorm8:e=>e.readUint8()/255,unorm8x2:e=>N(e.readUint8()/255,e.readUint8()/255),unorm8x4:e=>I(e.readUint8()/255,e.readUint8()/255,e.readUint8()/255,e.readUint8()/255),snorm8:e=>e.readInt8()/127,snorm8x2:e=>N(e.readInt8()/127,e.readInt8()/127),snorm8x4:e=>I(e.readInt8()/127,e.readInt8()/127,e.readInt8()/127,e.readInt8()/127),uint16:e=>e.readUint16(),uint16x2:e=>Me(e.readUint16(),e.readUint16()),uint16x4:e=>ve(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16()),sint16:e=>e.readInt16(),sint16x2:e=>ie(e.readInt16(),e.readInt16()),sint16x4:e=>de(e.readInt16(),e.readInt16(),e.readInt16(),e.readInt16()),unorm16:e=>e.readUint16()/65535,unorm16x2:e=>N(e.readUint16()/65535,e.readUint16()/65535),unorm16x4:e=>I(e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535),snorm16:e=>e.readInt16()/32767,snorm16x2:e=>N(e.readInt16()/32767,e.readInt16()/32767),snorm16x4:e=>I(e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767),float16(e){return e.readFloat16()},float16x2:e=>N(e.readFloat16(),e.readFloat16()),float16x4:e=>I(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16()),float32:e=>e.readFloat32(),float32x2:e=>N(e.readFloat32(),e.readFloat32()),float32x3:e=>le(e.readFloat32(),e.readFloat32(),e.readFloat32()),float32x4:e=>I(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()),uint32:e=>e.readUint32(),uint32x2:e=>Me(e.readUint32(),e.readUint32()),uint32x3:e=>ae(e.readUint32(),e.readUint32(),e.readUint32()),uint32x4:e=>ve(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32()),sint32:e=>e.readInt32(),sint32x2:e=>ie(e.readInt32(),e.readInt32()),sint32x3:e=>Oe(e.readInt32(),e.readInt32(),e.readInt32()),sint32x4:e=>de(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32()),"unorm10-10-10-2"(e){let t=e.readUint32(),r=(t>>22)/1023,n=(t>>12&1023)/1023,i=(t>>2&1023)/1023,s=(t&3)/3;return I(r,n,i,s)},"unorm8x4-bgra"(e){let t=e.readByte()/255,r=e.readByte()/255,n=e.readByte()/255,i=e.readByte()/255;return I(n,r,t,i)},unstruct(e,t){let r={},n=t.propTypes;for(let[i,s]of Object.entries(n))r[i]=ct(e,s);return r},disarray(e,t){let r=re(t),n=[];for(let i=0;i<t.elementCount;i++)pe(e,r),n.push(ct(e,t.elementType));return pe(e,r),n},"loose-decorated"(e,t){pe(e,De(t));let r=e.currentByteOffset,n=ct(e,t.inner);return e.seekTo(r+A(t)),n}};function ct(e,t){let r=yg[t.type];if(!r)throw new Error(`Cannot read data of type '${t.type}'.`);return r(e,t)}function gg(e,t){let r=A(e);if(r===0||t===void 0||t===null)return[];let n=new ArrayBuffer(r),i=new gr(n),s=[];function a(h,p,f,m){if(p!=null){if(ye(h)||Ke(h)){let w=jh(h);for(let[v,_]of Object.entries(w)){let S=h.propTypes[v];if(!S)continue;let V=p[v];V!==void 0&&a(S,V,f+_.offset,_.padding??m)}return}if(Ie(h)||Et(h)){let w=h,v=Ae(A(w.elementType),re(w.elementType));if(!Array.isArray(p))throw new Error("Partial value for array must be an array");let _=p??[];_.sort((S,V)=>S.idx-V.idx);for(let{idx:S,value:V}of _)a(w.elementType,V,f+S*v,v-A(w.elementType))}else{let w=A(h);i.seekTo(f),$i(i,h,p),s.push({start:f,end:f+w,padding:m})}}}if(a(e,t,0),s.length===0)return[];let o=[],u=s[0];for(let h=1;h<s.length;h++){let p=s[h];if(!p||!u)throw new Error("Internal error: missing segment");p.start===u.end+(u.padding??0)?(u.end=p.end,u.padding=p.padding):(o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),u=p)}if(!u)throw new Error("Internal error: missing segment");return o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),o}function Ti(e){return!!e?.usableAsStorage}var mo=class Rh extends Error{constructor(t){super(`Resource '${b(t)??"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,Rh.prototype)}};function Gh(e){return!!e.usableAsUniform}var Lh={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},Sa=class{constructor(t,r){this.usage=t,this.buffer=r,this[l]={dataType:r.dataType},this[ue]=r}resourceType="buffer-usage";[l];[ue];$name(t){return this.buffer.$name(t),this}[z](t){let r=this.buffer.dataType,n=t.getUniqueName(this),{group:i,binding:s}=t.allocateFixedEntry(this.usage==="uniform"?{uniform:r}:{storage:r,access:this.usage},this.buffer),a=Lh[this.usage];return t.addDeclaration(`@group(${i}) @binding(${s}) var<${a}> ${n}: ${t.resolve(r).value};`),y(n,r,_e(r)?"runtime":this.usage)}toString(){return`${this.usage}:${b(this)??"<unnamed>"}`}get[F](){let t=this.buffer.dataType,r=this.usage;return new Proxy({[l]:!0,get[ke](){return y(this,t,_e(t)?"runtime":r)},[z]:n=>n.resolve(this),toString:()=>`${this.usage}:${b(this)??"<unnamed>"}.$`},We)}get $(){let t=gi(),r=yi();if(t.type==="normal")throw new Xa(r?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.read()`");return t.type==="codegen"?this[F]:t.type==="simulate"?(t.buffers.has(this.buffer)||t.buffers.set(this.buffer,Yt(this.buffer.dataType,this.buffer.initial)),t.buffers.get(this.buffer)):qr(t,"bufferUsage.ts#TgpuFixedBufferImpl/$")}get value(){return this.$}set $(t){let r=gi(),n=yi();if(r.type==="normal")throw new Xa(n?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.write()`");if(r.type==="codegen")throw new Error("Unreachable bufferUsage.ts#TgpuFixedBufferImpl/$");if(r.type==="simulate"){r.buffers.set(this.buffer,t);return}qr(r,"bufferUsage.ts#TgpuFixedBufferImpl/$")}set value(t){this.$=t}},yo=class{constructor(e,t,r){this.usage=e,this.dataType=t,this[l]={dataType:t},this.#e=r,G(this,r.key)}[l];resourceType="buffer-usage";#e;[z](e){let t=this.dataType,r=e.getUniqueName(this),n=e.allocateLayoutEntry(this.#e.layout),i=Lh[this.usage];return e.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var<${i}> ${r}: ${e.resolve(t).value};`),y(r,t,_e(t)?"runtime":this.usage)}toString(){return`${this.usage}:${b(this)??"<unnamed>"}`}get[F](){let e=this.dataType,t=this.usage;return new Proxy({[l]:!0,get[ke](){return y(this,e,_e(e)?"runtime":t)},[z]:r=>r.resolve(this),toString:()=>`${this.usage}:${b(this)??"<unnamed>"}.$`},We)}get $(){if(et())return this[F];throw new Error("Direct access to buffer values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},go=new WeakMap;function wg(e){if(!Ti(e))throw new Error(`Cannot pass ${e} to asMutable, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=go.get(e);return t||(t=new Sa("mutable",e),go.set(e,t)),t}var wo=new WeakMap;function xg(e){if(!Ti(e))throw new Error(`Cannot pass ${e} to asReadonly, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=wo.get(e);return t||(t=new Sa("readonly",e),wo.set(e,t)),t}var xo=new WeakMap;function vg(e){if(!Gh(e))throw new Error(`Cannot pass ${e} to asUniform, as it is not allowed to be used as a uniform. To allow it, call .$usage('uniform') when creating the buffer.`);let t=xo.get(e);return t||(t=new Sa("uniform",e),xo.set(e,t)),t}var bg={uniform:vg,mutable:wg,readonly:xg};function ni(e,t,r){return Zt(t)?new vo(e,t,r):new vo(e,t,r,["storage","uniform"])}function $n(e){return e.resourceType==="buffer"}var $g=mh(),vo=class{constructor(t,r,n,i){this.dataType=r,this.initialOrBuffer=n,this._disallowedUsages=i,this.#e=t.device,vs(n)?(this._ownBuffer=!1,this._buffer=n):(this._ownBuffer=!0,this.initial=n)}[l]=!0;resourceType="buffer";flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;#e;_buffer=null;_ownBuffer;_destroyed=!1;_hostBuffer;initial;usableAsUniform=!1;usableAsStorage=!1;usableAsVertex=!1;usableAsIndex=!1;get buffer(){if(this._destroyed)throw new Error("This buffer has been destroyed");return this._buffer||(this._buffer=this.#e.createBuffer({size:A(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:b(this)??"<unnamed>"}),this.initial&&(this._writeToTarget(this._buffer.getMappedRange(),this.initial),this._buffer.unmap())),this._buffer}get destroyed(){return this._destroyed}$name(t){return G(this,t),this._buffer&&(this._buffer.label=t),this}$usage(...t){for(let r of t){if(this._disallowedUsages?.includes(r))throw new Error(`Buffer of type ${this.dataType.type} cannot be used as ${r}`);this.flags|=r==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=r==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=r==="vertex"?GPUBufferUsage.VERTEX:0,this.flags|=r==="index"?GPUBufferUsage.INDEX:0,this.usableAsUniform=this.usableAsUniform||r==="uniform",this.usableAsStorage=this.usableAsStorage||r==="storage",this.usableAsVertex=this.usableAsVertex||r==="vertex",this.usableAsIndex=this.usableAsIndex||r==="index"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}compileWriter(){fo(this.dataType)}_writeToTarget(t,r){let n=fo(this.dataType);if(n)try{n(new DataView(t),0,r,$g==="little");return}catch(i){console.error(`Error when using compiled writer for buffer ${b(this)??"<unnamed>"} - this is likely a bug, please submit an issue at https://github.com/software-mansion/TypeGPU/issues
Using fallback writer instead.`,i)}$i(new gr(t),this.dataType,r)}write(t){let r=this.buffer;if(r.mapState==="mapped"){let i=r.getMappedRange();this._writeToTarget(i,t);return}let n=A(this.dataType);this._hostBuffer||(this._hostBuffer=new ArrayBuffer(n)),this._writeToTarget(this._hostBuffer,t),this.#e.queue.writeBuffer(r,0,this._hostBuffer,0,n)}writePartial(t){let r=this.buffer,n=gg(this.dataType,t);if(r.mapState==="mapped"){let i=r.getMappedRange(),s=new Uint8Array(i);for(let a of n)s.set(a.data,a.data.byteOffset)}else for(let i of n)this.#e.queue.writeBuffer(r,i.data.byteOffset,i.data,0,i.data.byteLength)}clear(){let t=this.buffer;if(t.mapState==="mapped"){new Uint8Array(t.getMappedRange()).fill(0);return}let r=this.#e.createCommandEncoder();r.clearBuffer(t),this.#e.queue.submit([r.finish()])}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let r=A(this.dataType),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t.buffer,0,this.buffer,0,r),this.#e.queue.submit([n.finish()])}async read(){let t=this.buffer;if(t.mapState==="mapped"){let s=t.getMappedRange();return ct(new Nt(s),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let s=t.getMappedRange(),a=ct(new Nt(s),this.dataType);return t.unmap(),a}let r=this.#e.createBuffer({size:A(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t,0,r,0,A(this.dataType)),this.#e.queue.submit([n.finish()]),await r.mapAsync(GPUMapMode.READ,0,A(this.dataType));let i=ct(new Nt(r.getMappedRange()),this.dataType);return r.unmap(),r.destroy(),i}as(t){return bg[t]?.(this)}destroy(){this._destroyed||(this._destroyed=!0,this._ownBuffer&&this._buffer?.destroy())}toString(){return`buffer:${b(this)??"<unnamed>"}`}};function Tg(e,t){return new Wh(va(),e,t)}function _g(e,t){return new Wh(ba(),e,t)}function Dh(e){let t=e;return t?.resourceType==="sampler"&&!!t[l]}function Nh(e){let t=e;return t?.resourceType==="sampler-comparison"&&!!t[l]}var zg=class{constructor(t,r){this.schema=t,this.#e=r,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",G(this,r.key)}[l]={unwrap:void 0};resourceType;#e;[z](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},We)}get $(){if(et())return this[F];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}toString(){return`${this.resourceType}:${b(this)??"<unnamed>"}`}},Wh=class{constructor(t,r,n){this.schema=t,this.#r=r,this.#n=n,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",this[l]={unwrap:()=>(this.#t||(this.#t=this.#n.device.createSampler({...this.#r,label:b(this)??"<unnamed>"})),this.#t)},this.#e=r.minFilter==="linear"||r.magFilter==="linear"||r.mipmapFilter==="linear"}[l];resourceType;#e;#t=null;#r;#n;[z](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(this.schema.type==="sampler_comparison"?{sampler:"comparison"}:{sampler:this.#e?"filtering":"non-filtering"},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},We)}get $(){if(et())return this[F];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}$name(t){return G(this,t),this}toString(){return`${this.resourceType}:${b(this)??"<unnamed>"}`}},Ig=class{constructor(t,r){this.schema=t,this.#e=r,G(this,r.key)}resourceType="external-texture";[l]=!0;#e;[z](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),y(r,nh(),"handle")}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`textureExternal:${b(this)??"<unnamed>"}.$`},We)}get $(){if(et())return this[F];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureExternal:${b(this)??"<unnamed>"}`}};function qh(e){let{videoWidth:t,videoHeight:r}=e;if(t&&r)return{width:t,height:r};let{naturalWidth:n,naturalHeight:i}=e;if(n&&i)return{width:n,height:i};let{codedWidth:s,codedHeight:a}=e;if(s&&a)return{width:s,height:a};let{width:o,height:u}=e;if(o&&u)return{width:o,height:u};throw new Error("Cannot determine dimensions of the provided image source.")}var Sg=`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) i: u32) -> VertexOutput {
  const pos = array(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  const uv = array(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));
  return VertexOutput(vec4f(pos[i], 0, 1), uv[i]);
}`,Eg=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  return textureSample(src, samp, uv);
}`,Mg=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  let r = textureGather(0, src, samp, uv);
  let g = textureGather(1, src, samp, uv);
  let b = textureGather(2, src, samp, uv);
  let a = textureGather(3, src, samp, uv);
  return vec4f(dot(r, vec4f(0.25)), dot(g, vec4f(0.25)), dot(b, vec4f(0.25)), dot(a, vec4f(0.25)));
}`,Vs=new WeakMap;function kg(e){let t=Vs.get(e);return t||(t={vertexModule:e.createShaderModule({code:Sg}),filterableResources:new Map,layoutResources:new Map},Vs.set(e,t)),t}function Pg(e,t,r){let n=kg(e),i=n.filterableResources.get(t);i||(i={fragmentModule:e.createShaderModule({code:t?Eg:Mg}),sampler:e.createSampler(t?{magFilter:"linear",minFilter:"linear"}:{})},n.filterableResources.set(t,i));let s=`${t}:${r}`,a=n.layoutResources.get(s);if(!a){let o=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:r}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:t?"filtering":"non-filtering"}}]});a={bindGroupLayout:o,pipelineLayout:e.createPipelineLayout({bindGroupLayouts:[o]})},n.layoutResources.set(s,a)}return{vertexModule:n.vertexModule,...i,...a}}function Hh(e){let{device:t,source:r,destination:n,format:i,filterable:s,sampleType:a}=e,o=Pg(t,s,a),u=t.createRenderPipeline({layout:o.pipelineLayout,vertex:{module:o.vertexModule},fragment:{module:o.fragmentModule,targets:[{format:i}]},primitive:{topology:"triangle-list"}}),h=t.createBindGroup({layout:o.bindGroupLayout,entries:[{binding:0,resource:r},{binding:1,resource:o.sampler}]}),p=!e.encoder,f=e.encoder??t.createCommandEncoder(),m=f.beginRenderPass({colorAttachments:[{view:n,loadOp:"clear",storeOp:"store"}]});m.setPipeline(u),m.setBindGroup(0,h),m.draw(3),m.end(),p&&t.queue.submit([f.finish()])}function Ug(e){Vs.delete(e)}function Yh(e,t,r){let n=Ln(t),i=By(e,t),s=i.includes("float"),a=i.includes("unfilterable-float");if(!s&&!a)throw new Error(`Cannot ${r} for format '${t}': only float formats are supported.`);if(!n.canRenderAttachment)throw new Error(`Cannot ${r} for format '${t}': format does not support render attachments.`);return{filterable:s,sampleType:s?"float":"unfilterable-float"}}function Vg(e,t,r=0,n){if(t.dimension!=="2d")throw new Error("Mipmap generation only supports 2D textures.");let{filterable:i,sampleType:s}=Yh(e,t.format,"generate mipmaps"),a=n??t.mipLevelCount-r;for(let o=0;o<t.depthOrArrayLayers;o++)for(let u=r;u<r+a-1;u++){let h=p=>({dimension:"2d",baseMipLevel:p,mipLevelCount:1,baseArrayLayer:o,arrayLayerCount:1});Hh({device:e,source:t.createView(h(u)),destination:t.createView(h(u+1)),format:t.format,filterable:i,sampleType:s})}}function Ag(e,t,r,n=0){if(t.dimension!=="2d")throw new Error("Resampling only supports 2D textures.");let{filterable:i}=Yh(e,t.format,"resample"),{width:s,height:a}=qh(r),o=e.createTexture({size:[s,a],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.copyExternalImageToTexture({source:r},{texture:o},[s,a]);let u=e.createTexture({size:[t.width,t.height],format:t.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),h=e.createCommandEncoder();Hh({device:e,source:o.createView(),destination:u.createView(),format:t.format,filterable:i,sampleType:"float",encoder:h}),h.copyTextureToTexture({texture:u},{texture:t,origin:{x:0,y:0,z:n}},{width:t.width,height:t.height,depthOrArrayLayers:1}),e.queue.submit([h.finish()]),o.destroy(),u.destroy()}function Cg(e){return{dimension:e.dimension??"2d",sampleType:Ln(e.format).channelType,multisampled:(e.sampleCount??1)!==1}}function Og(e,t){return new Bg(e,t)}function zn(e){return e?.resourceType==="texture"&&!!e[l]}function In(e){return e?.resourceType==="texture-view"&&!!e[l]}var Bg=class{constructor(t,r){this.props=t;let n=t.format;this.#s=r,this.#e=Ln(n);let i=this.#e.texelSize;this.#t=i==="non-copyable"?"non-copyable":t.size[0]*(t.size[1]??1)*(t.size[2]??1)*i,this[l]={unwrap:()=>{if(this.#r)throw new Error("This texture has been destroyed");return this.#i||(this.#i=r.device.createTexture({label:b(this)??"<unnamed>",format:t.format,size:t.size,usage:this.#n,dimension:t.dimension??"2d",viewFormats:t.viewFormats??[],mipLevelCount:t.mipLevelCount??1,sampleCount:t.sampleCount??1})),this.#i}}}[l];resourceType="texture";usableAsSampled=!1;usableAsStorage=!1;usableAsRender=!1;#e;#t;#r=!1;#n=GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;#i=null;#s;$name(t){return G(this,t),this}$usage(...t){let r=t.includes("storage"),n=t.includes("sampled"),i=t.includes("render");return this.#n|=n?GPUTextureUsage.TEXTURE_BINDING:0,this.#n|=r?GPUTextureUsage.STORAGE_BINDING:0,this.#n|=i?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||=r,this.usableAsSampled||=n,this.usableAsRender||=i,this}createView(t,r){return t==="render"?new jg(this,r):new Fg(t??$s(Cg(this.props)),this,r)}#a(t=0){let r=2**t,[n,i,s]=[Math.max(1,Math.floor((this.props.size[0]??1)/r)),Math.max(1,Math.floor((this.props.size[1]??1)/r)),Math.max(1,Math.floor((this.props.size[2]??1)/r))],a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot clear texture with format '${this.props.format}': this format does not support copy operations.`);this.#s.device.queue.writeTexture({texture:this[l].unwrap(),mipLevel:t},new Uint8Array(n*i*s*a),{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}clear(t="all"){if(t==="all"){let r=this.props.mipLevelCount??1;for(let n=0;n<r;n++)this.#a(n)}else this.#a(t)}generateMipmaps(t=0,r){if(this.usableAsRender===!1)throw new Error("generateMipmaps called without specifying 'render' usage. Add it via the $usage('render') method.");let n=r??(this.props.mipLevelCount??1)-t;if(n<=1){console.warn(`generateMipmaps is a no-op: would generate ${n} mip levels (base: ${t}, total: ${this.props.mipLevelCount??1})`);return}if(t>=(this.props.mipLevelCount??1))throw new Error(`Base mip level ${t} is out of range. Texture has ${this.props.mipLevelCount??1} mip levels.`);Vg(this.#s.device,this[l].unwrap(),t,n)}write(t,r=0){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){this.#u(t,r);return}let n=this.props.dimension??"2d";if(!Array.isArray(t)){this.#o(t,n==="3d"?0:void 0);return}let i=this.props.size[2]??1;t.length>i&&console.warn(`Too many image sources provided. Expected ${i} layers, got ${t.length}. Extra sources will be ignored.`);for(let s=0;s<Math.min(t.length,i);s++){let a=t[s];a&&this.#o(a,s)}}#u(t,r){let n=Math.max(1,this.props.size[0]>>r),i=Math.max(1,(this.props.size[1]??1)>>r),s=Math.max(1,(this.props.size[2]??1)>>r),a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot write to texture with format '${this.props.format}': this format does not support copy operations.`);let o=n*i*s*a,u=t.byteLength??t.byteLength;if(u!==o)throw new Error(`Buffer size mismatch. Expected ${o} bytes for mip level ${r}, got ${u} bytes.`);this.#s.device.queue.writeTexture({texture:this[l].unwrap(),mipLevel:r},"buffer"in t?t.buffer:t,{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}#o(t,r){let n=this.props.size[0],i=this.props.size[1]??1,{width:s,height:a}=qh(t);if(s!==n||a!==i){Ag(this.#s.device,this[l].unwrap(),t,r);return}this.#s.device.queue.copyExternalImageToTexture({source:t},{texture:this[l].unwrap(),...r!==void 0&&{origin:{x:0,y:0,z:r}}},r!==void 0?[n,i,1]:this.props.size)}copyFrom(t){if(t.props.format!==this.props.format)throw new Error(`Texture format mismatch. Source texture has format ${t.props.format}, target texture has format ${this.props.format}`);if(t.props.size[0]!==this.props.size[0]||(t.props.size[1]??1)!==(this.props.size[1]??1)||(t.props.size[2]??1)!==(this.props.size[2]??1))throw new Error(`Texture size mismatch. Source texture has size ${t.props.size.join("x")}, target texture has size ${this.props.size.join("x")}`);let r=this.#s.device.createCommandEncoder();r.copyTextureToTexture({texture:t[l].unwrap()},{texture:this[l].unwrap()},t.props.size),this.#s.device.queue.submit([r.finish()])}get destroyed(){return this.#r}destroy(){this.#r||(this.#r=!0,this.#i?.destroy())}},Fg=class{constructor(t,r,n){this.schema=t,this.#e=r,this.#r=n,this[l]={unwrap:()=>{if(!this.#t){let i=this.schema,s=Ts(i)?i.format:this.#e.props.format;this.#t=this.#e[l].unwrap().createView({...this.#r,label:b(this)??"<unnamed>",format:this.#r?.format??s,dimension:i.dimension})}return this.#t}}}[l];resourceType="texture-view";#e;#t;#r;$name(t){return G(this,t),this.#t&&(this.#t.label=t),this}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},We)}get $(){if(et())return this[F];throw new Error("Direct access to texture view values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureView:${b(this)??"<unnamed>"}`}[z](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(Ts(this.schema)?{storageTexture:this.schema}:{texture:this.schema,sampleType:this.#r?.sampleType??this.schema.bindingSampleType[0]},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}},bo=class{constructor(e,t){this.schema=e,this.#e=t,G(this,t.key)}[l]={unwrap:void 0};resourceType="texture-view";#e;toString(){return`textureView:${b(this)??"<unnamed>"}`}[z](e){let t=e.getUniqueName(this),r=e.allocateLayoutEntry(this.#e.layout);return e.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var ${t}: ${e.resolve(this.schema).value};`),y(t,this.schema,"handle")}get[F](){let e=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,e,"handle")},[z]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},We)}get $(){if(et())return this[F];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},jg=class{constructor(e,t={}){this.descriptor=t,this[l]={unwrap:()=>e[l].unwrap().createView({label:b(this)??"<unnamed>",...this.descriptor})}}[l];resourceType="texture-view"};function Rg(e){return!!e?.usableAsSampled}var Gg=class Xh extends Error{constructor(t){super(`Resource '${b(t)??"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,Xh.prototype)}};function Lg(e){let t={};for(let[r,n]of Object.entries(e)){if(n===null){t[r]=null;continue}if("texture"in n&&typeof n.texture=="string"){let i=n.texture;t[r]={...n,texture:$s({dimension:n.viewDimension??"2d",sampleType:i==="sint"?B:i==="uint"?$:g,multisampled:n.multisampled??!1})}}else if("storageTexture"in n&&typeof n.storageTexture=="string"){let i={readonly:"read-only",writeonly:"write-only",mutable:"read-write"};t[r]={...n,storageTexture:$s({access:i[n.access??"writeonly"],format:n.storageTexture,dimension:n.viewDimension??"2d"})}}else"externalTexture"in n&&Object.keys(n.externalTexture).length===0?t[r]={...n,externalTexture:{type:"texture_external",dimension:"2d"}}:t[r]=n}return t}function Zh(e){let t=Lg(e);return new Ng(t)}function Kh(e){return!!e&&e.resourceType==="bind-group-layout"}function _i(e){return!!e&&e.resourceType==="bind-group"}var Dg=class Qh extends Error{constructor(t,r){super(`Bind group '${t??"<unnamed>"}' is missing a required binding '${r}'`),Object.setPrototypeOf(this,Qh.prototype)}},$o=["compute","fragment"],ln=["compute","vertex","fragment"],Ng=class{constructor(e){this.entries=e;let t=0;for(let[r,n]of Object.entries(e)){if(n===null){t++;continue}let i={layout:this,key:r,idx:t};if("uniform"in n&&(this.bound[r]=new yo("uniform",n.uniform,i)),"storage"in n){let s="type"in n.storage?n.storage:n.storage(0);this.bound[r]=new yo(n.access??"readonly",s,i)}"texture"in n&&(this.bound[r]=new bo(n.texture,i)),"storageTexture"in n&&(this.bound[r]=new bo(n.storageTexture,i)),"externalTexture"in n&&(this.bound[r]=new Ig(n.externalTexture,i)),"sampler"in n&&(this.bound[r]=new zg(n.sampler==="comparison"?ba():va(),i)),Object.defineProperty(this.value,r,{get:()=>this.bound[r].value}),t++}}[l]=!0;_index;resourceType="bind-group-layout";bound={};value={};$=this.value;get[F](){return this.$}toString(){return`bindGroupLayout:${b(this)??"<unnamed>"}`}get index(){return this._index}$name(e){return G(this,e),this}$idx(e){return this._index=e,this}unwrap(e){return e.device.createBindGroupLayout({label:b(this)??"<unnamed>",entries:Object.values(this.entries).map((t,r)=>{if(t===null)return null;let n=t.visibility,i={binding:r,visibility:0};if("uniform"in t)n=n??ln,i.buffer={type:"uniform"};else if("storage"in t)n=n??(t.access==="mutable"?$o:ln),i.buffer={type:t.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in t)n=n??ln,i.sampler={type:t.sampler};else if("texture"in t){n=n??ln;let{multisampled:s,dimension:a,bindingSampleType:o}=t.texture;i.texture={sampleType:t.sampleType??o[0],viewDimension:a,multisampled:s}}else if("storageTexture"in t){n=n??$o;let{dimension:s,access:a,format:o}=t.storageTexture;i.storageTexture={access:a,format:o,viewDimension:s}}else"externalTexture"in t&&(n=n??ln,i.externalTexture={});return n?.includes("compute")&&(i.visibility|=GPUShaderStage.COMPUTE),n?.includes("vertex")&&(i.visibility|=GPUShaderStage.VERTEX),n?.includes("fragment")&&(i.visibility|=GPUShaderStage.FRAGMENT),i}).filter(t=>t!==null)})}},Jh=class{constructor(e,t){this.layout=e,this.entries=t;for(let r of Object.keys(e.entries))if(e.entries[r]!==null&&!(r in t))throw new Dg(b(e),r)}resourceType="bind-group";unwrap(e){return e.device.createBindGroup({label:b(this.layout)??"<unnamed>",layout:e.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([t,r],n)=>{if(r===null)return null;let i=this.entries[t];if(i===void 0)throw new Error(`'${t}' is a resource required to populate bind group layout '${b(this.layout)??"<unnamed>"}'.`);if("uniform"in r){let s;if($n(i)){if(!Gh(i))throw new ec(i);s={buffer:e.unwrap(i)}}else s={buffer:i};return{binding:n,resource:s}}if("storage"in r){let s;if($n(i)){if(!Ti(i))throw new mo(i);s={buffer:e.unwrap(i)}}else s={buffer:i};return{binding:n,resource:s}}if("texture"in r){let s;if(zn(i)){if(!Rg(i))throw new Gg(i);s=e.unwrap(i.createView(r.texture))}else In(i)?s=e.unwrap(i):s=i;return{binding:n,resource:s}}if("storageTexture"in r){let s;if(zn(i)){if(!Ti(i))throw new mo(i);s=e.unwrap(i.createView(r.storageTexture))}else In(i)?s=e.unwrap(i):s=i;return{binding:n,resource:s}}if("sampler"in r)return Nh(i)||Dh(i)?{binding:n,resource:e.unwrap(i)}:{binding:n,resource:i};if("externalTexture"in r)return{binding:n,resource:i};throw new Error(`Malformed bind group entry: ${Xt(i)}`)}).filter(t=>t!==null)})}};function zi(e){return new Wg(e)}var Wg=class{constructor(e=void 0){this.defaultValue=e}[l]=!0;resourceType="slot";$name(e){return G(this,e),this}areEqual(e,t){return Object.is(e,t)}toString(){return`slot:${b(this)??"<unnamed>"}`}get[F](){let e=Ce();if(!e)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return Hi(e.unwrap(this))}get value(){return this[F]}get $(){return this.value}};function Ii(e,t){return new el("private",e,t)}function To(e){return new el("workgroup",e)}var el=class{[l]={};#e;#t;#r;constructor(t,r,n){this.#e=t,this.#t=r,this.#r=n}[z](t){let r=t.getUniqueName(this),n=`var<${this.#e}> ${r}: ${t.resolve(this.#t).value}`;return this.#r?t.addDeclaration(`${n} = ${t.resolve(this.#r,this.#t).value};`):t.addDeclaration(`${n};`),y(r,this.#t,_e(this.#t)?"runtime":this.#e)}$name(t){return G(this,t),this}toString(){return`var:${b(this)??"<unnamed>"}`}get[F](){let t=this.#t,r=_e(t)?"runtime":this.#e;return new Proxy({[l]:!0,get[ke](){return y(this,t,r)},[z]:n=>n.resolve(this),toString:()=>`var:${b(this)??"<unnamed>"}.$`},We)}get $(){let t=gi(),r=yi();if(t.type==="normal")throw new Ya(r?`Cannot access variable '${b(this)??"<unnamed>"}'. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");return t.type==="codegen"?this[F]:t.type==="simulate"?(t.vars[this.#e].has(this)||t.vars[this.#e].set(this,this.#r),t.vars[this.#e].get(this)):qr(t,"tgpuVariable.ts#TgpuVarImpl/$")}set $(t){let r=gi(),n=yi();if(r.type==="normal")throw new Ya(n?`Cannot access ${String(this)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");if(r.type==="codegen")throw new Error("Unreachable tgpuVariable.ts#TgpuVarImpl/$");if(r.type==="simulate"){r.vars[this.#e].set(this,t);return}qr(r,"tgpuVariable.ts#TgpuVarImpl/$")}get value(){return this.$}set value(t){this.$=t}},tl=Ii($,0).$name("dataBlockIndex"),rl=Ii($,0).$name("dataByteIndex"),nl=zi().$name("dataBuffer"),qg=O([],$)`() {
  let i = dataByteIndex;
  dataByteIndex = dataByteIndex + 1u;
  return i;
}`.$uses({dataByteIndex:rl}).$name("nextByteIndex"),x="dataBuffer[dataBlockIndex].serializedData[nextByteIndex()]",il={f32:O([g])`(n) => {
  ${x} = bitcast<u32>(n);
}`,f16:O([he])`(n) => {
  ${x} = pack2x16float(vec2f(f32(n), 0.0));
}`,i32:O([B])`(n) => {
  ${x} = bitcast<u32>(n);
}`,u32:O([$])`(n) => {
  ${x} = n;
}`,bool:O([R])`(b) => {
  ${x} = u32(b);
}`,vec2f:O([N])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
}`,vec3f:O([le])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
  ${x} = bitcast<u32>(v.z);
}`,vec4f:O([I])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
  ${x} = bitcast<u32>(v.z);
  ${x} = bitcast<u32>(v.w);
}`,vec2h:O([yt])`(v) => {
  ${x} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
}`,vec3h:O([gt])`(v) => {
  ${x} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${x} = pack2x16float(vec2f(f32(v.z), 0.0));
}`,vec4h:O([wt])`(v) => {
  ${x} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${x} = pack2x16float(vec2f(f32(v.z), f32(v.w)));
}`,vec2i:O([ie])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
}`,vec3i:O([Oe])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
  ${x} = bitcast<u32>(v.z);
}`,vec4i:O([de])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
  ${x} = bitcast<u32>(v.z);
  ${x} = bitcast<u32>(v.w);
}`,vec2u:O([Me])`(v) => {
  ${x} = v.x;
  ${x} = v.y;
}`,vec3u:O([ae])`(v) => {
  ${x} = v.x;
  ${x} = v.y;
  ${x} = v.z;
}`,vec4u:O([ve])`(v) => {
  ${x} = v.x;
  ${x} = v.y;
  ${x} = v.z;
  ${x} = v.w;
}`,"vec2<bool>":O([fr])`(v) => {
  ${x} = u32(v.x);
  ${x} = u32(v.y);
}`,"vec3<bool>":O([mr])`(v) => {
  ${x} = u32(v.x);
  ${x} = u32(v.y);
  ${x} = u32(v.z);
}`,"vec4<bool>":O([yr])`(v) => {
  ${x} = u32(v.x);
  ${x} = u32(v.y);
  ${x} = u32(v.z);
  ${x} = u32(v.w);
}`,mat2x2f:O([Ut])`(m) => {
  ${x} = bitcast<u32>(m[0][0]);
  ${x} = bitcast<u32>(m[0][1]);
  ${x} = bitcast<u32>(m[1][0]);
  ${x} = bitcast<u32>(m[1][1]);
}`,mat3x3f:O([Vt])`(m) => {
  ${x} = bitcast<u32>(m[0][0]);
  ${x} = bitcast<u32>(m[0][1]);
  ${x} = bitcast<u32>(m[0][2]);
  ${x} = 0u;
  ${x} = bitcast<u32>(m[1][0]);
  ${x} = bitcast<u32>(m[1][1]);
  ${x} = bitcast<u32>(m[1][2]);
  ${x} = 0u;
  ${x} = bitcast<u32>(m[2][0]);
  ${x} = bitcast<u32>(m[2][1]);
  ${x} = bitcast<u32>(m[2][2]);
  ${x} = 0u;
}`,mat4x4f:O([Y])`(m) => {
  ${x} = bitcast<u32>(m[0][0]);
  ${x} = bitcast<u32>(m[0][1]);
  ${x} = bitcast<u32>(m[0][2]);
  ${x} = bitcast<u32>(m[0][3]);
  ${x} = bitcast<u32>(m[1][0]);
  ${x} = bitcast<u32>(m[1][1]);
  ${x} = bitcast<u32>(m[1][2]);
  ${x} = bitcast<u32>(m[1][3]);
  ${x} = bitcast<u32>(m[2][0]);
  ${x} = bitcast<u32>(m[2][1]);
  ${x} = bitcast<u32>(m[2][2]);
  ${x} = bitcast<u32>(m[2][3]);
  ${x} = bitcast<u32>(m[3][0]);
  ${x} = bitcast<u32>(m[3][1]);
  ${x} = bitcast<u32>(m[3][2]);
  ${x} = bitcast<u32>(m[3][3]);
}`};for(let[e,t]of Object.entries(il))t.$name(`serialize${e[0].toLocaleUpperCase()}${e.slice(1)}`).$uses({dataBlockIndex:tl,nextByteIndex:qg,dataBuffer:nl});function sl(e){return`(${e.map((t,r)=>`_arg_${r}`).join(", ")})`}function al(e,t){let r=il[e.type];if(r)return r.with(nl,t);if(ye(e)){let n=Object.keys(e.propTypes),i=Object.values(e.propTypes),s=ol(i,t);return O([e])`(arg) {\n  propsSerializer(${n.map(a=>`arg.${a}`).join(", ")});\n}`.$uses({propsSerializer:s}).$name(`${b(e)??"struct"}Serializer`)}if(Ie(e)){let n=e.elementType,i=e.elementCount,s=al(n,t);return O([e])`(arg) {\n${Array.from({length:i},(a,o)=>`  elementSerializer(arg[${o}]);`).join(`
`)}\n}`.$uses({elementSerializer:s}).$name("arraySerializer")}throw new Error(`Cannot serialize data of type ${e.type}`)}function ol(e,t){let r={},n=O(e),i=sl(e),s=e.map((a,o)=>(r[`serializer${o}`]=al(a,t),`  serializer${o}(_arg_${o});`)).join(`
`);return n`${i} {\n${s}\n}`.$uses(r).$name("compoundSerializer")}function Hg(e,t,r,n,i){let s=t.map(A).reduce((u,h)=>u+h,0);if(s>i.logSizeLimit)throw new Error(`Logged data needs to fit in ${i.logSizeLimit} bytes (one of the logs requires ${s} bytes). Consider increasing the limit by passing appropriate options to tgpu.init().`);let a=ol(t,r).$name(`log${e}serializer`),o=sl(t);return O(t)`${o} {
  dataBlockIndex = atomicAdd(&indexBuffer, 1);
  if (dataBlockIndex >= ${i.logCountLimit}) {
    return;
  }
  dataBuffer[dataBlockIndex].id = ${e};
  dataByteIndex = 0;

  compoundSerializer${o};
}`.$uses({indexBuffer:n,dataBuffer:r,dataBlockIndex:tl,dataByteIndex:rl,compoundSerializer:a}).$name(`log${e}`)}var Yg=["log","debug","info","warn","error","clear"],Xg={logCountLimit:64,logSizeLimit:252,messagePrefix:" GPU "},ul=y("/* console.log() */",se,"runtime"),Zg=class{get logResources(){}generateLog(){return console.warn("'console.log' is only supported when resolving pipelines."),ul}},Kg=class{#e;#t;#r=1;#n;#i;constructor(t){this.#e={...Xg,...t[l].logOptions},this.#t=new Map;let r=Oi({id:$,serializedData:_n($,Math.ceil(this.#e.logSizeLimit/4))}).$name("SerializedLogData");this.#i=t.createMutable(_n(r,this.#e.logCountLimit)).$name("dataBuffer"),this.#n=t.createMutable(sh($)).$name("indexBuffer")}generateLog(t,r,n){if(!Yg.includes(r))return console.warn(`Unsupported log method '${r}' was used in TGSL.`),ul;let i=kc(n),s=this.#r++,a=i.filter(h=>h.dataType!==Ye),o=Hg(s,a.map(h=>h.dataType),this.#i,this.#n,this.#e),u=i.map(h=>h.dataType===Ye?h.value:h.dataType);return this.#t.set(s,{op:r,argTypes:u}),y(c`${t.resolve(o).value}(${a})`,se,"runtime")}get logResources(){return this.#r===1?void 0:{dataBuffer:this.#i,indexBuffer:this.#n,options:this.#e,logIdToMeta:this.#t}}},_o={mat2x2f:N,mat3x3f:le,mat4x4f:I};function hl(e,t){if(Ie(e.dataType)||Et(e.dataType)){let r=e.dataType.elementType,n=_e(r),i=jr(e),s=t.origin==="constant",a;return e.origin==="constant-tgpu-const-ref"?s?a=n?"constant":"constant-tgpu-const-ref":a=n?"runtime":"runtime-tgpu-const-ref":e.origin==="runtime-tgpu-const-ref"?a=n?"runtime":"runtime-tgpu-const-ref":!i&&!n?a=e.origin:s&&e.origin==="constant"?a="constant":a="runtime",y(Ve(e)&&Ve(t)?e.value[t.value]:c`${e}[${t}]`,r,a)}if(ft(e.dataType))return y(Ve(e)&&Ve(t)?e.value[t.value]:c`${e}[${t}]`,e.dataType.primitive,e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime");if(Xe(e.dataType))return hl(Ys(e),t);if(e.value instanceof tu){let r=_o[e.value.matrix.dataType.type];return y(c`${e.value.matrix}[${t}]`,r,e.origin)}if(e.dataType.type in _o)throw new Error("The only way of accessing matrix elements in TGSL is through the 'columns' property.");if(Ve(e)&&Ve(t)||e.dataType.type==="unknown")return Ci(e.value[t.value])}var{NodeTypeCatalog:D}=jy,Qg=["==","!=","===","!==","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"],Jg=["&&","||","==","!=","===","!==","<","<=",">",">="],zo={"===":"==","!==":"!=",get">>>"(){throw new Error("The `>>>` operator is unsupported in TypeGPU functions.")},get in(){throw new Error("The `in` operator is unsupported in TypeGPU functions.")},get instanceof(){throw new Error("The `instanceof` operator is unsupported in TypeGPU functions.")},get"|>"(){throw new Error("The `|>` operator is unsupported in TypeGPU functions.")},get"??"(){throw new Error("The `??` operator is unsupported in TypeGPU functions.")},get">>>="(){throw new Error("The `>>>=` operator is unsupported in TypeGPU functions.")},get"**="(){throw new Error("The `**=` operator is unsupported in TypeGPU functions.")},get"??="(){throw new Error("The `??=` operator is unsupported in TypeGPU functions.")},get"&&="(){throw new Error("The `&&=` operator is unsupported in TypeGPU functions.")},get"||="(){throw new Error("The `||=` operator is unsupported in TypeGPU functions.")}};function Io(e,t,r){return r?Jg.includes(t)?R:t==="="?r:e:t==="!"||t==="~"?R:e}var ew={"-":Hu[l].gpuImpl},tw={"+":ma[l].gpuImpl,"-":en[l].gpuImpl,"*":jn[l].gpuImpl,"/":ya[l].gpuImpl,"**":Th[l].gpuImpl},rw=class{#e=void 0;initGenerator(e){this.#e=e}get ctx(){if(!this.#e)throw new Error("WGSL Generator has not yet been initialized. Please call initialize(ctx) before using the generator.");return this.#e}block([e,t]){this.ctx.pushBlockScope();try{this.ctx.indent();let r=t.map(n=>this.statement(n)).join(`
`);return this.ctx.dedent(),`{
${r}
${this.ctx.pre}}`}finally{this.ctx.popBlockScope()}}refVariable(e,t){let r=this.ctx.makeNameValid(e),n=Hs(t),i=y(new zt(y(r,t,"function"),n),n,"function");return this.ctx.defineVariable(e,i),r}blockVariable(e,t,r,n){let i=_e(r),s;n==="constant-tgpu-const-ref"||n==="runtime-tgpu-const-ref"?s=n:n==="argument"?i?s="runtime":s="argument":i?n==="constant"&&e==="const"?s="constant":s="runtime":s=cu(n)?"this-function":n;let a=y(this.ctx.makeNameValid(t),r,s);return this.ctx.defineVariable(t,a),a}identifier(e){if(!e)throw new Error("Cannot resolve an empty identifier");let t=this.ctx.getById(e);if(!t)throw new Error(`Identifier ${e} not found`);return t}typedExpression(e,t){let r=this.ctx.expectedType;this.ctx.expectedType=t;try{let n=this.expression(e);return nr(n,t)}finally{this.ctx.expectedType=r}}expression(e){if(typeof e=="string")return this.identifier(e);if(typeof e=="boolean")return y(e,R,"constant");if(e[0]===D.logicalExpr||e[0]===D.binaryExpr||e[0]===D.assignmentExpr){let[t,r,n,i]=e,s=this.expression(r),a=this.expression(i);if(a.value instanceof zt)throw new j(c`Cannot assign a ref to an existing variable '${s}', define a new variable instead.`);if(n==="==")throw new Error("Please use the === operator instead of ==");if(n==="==="&&Ve(s)&&Ve(a))return y(s.value===a.value,R,"constant");if(s.dataType.type==="unknown")throw new j(`Left-hand side of '${n}' is of unknown type`);if(a.dataType.type==="unknown")throw new j(`Right-hand side of '${n}' is of unknown type`);let o=tw[n];if(o)return o(s,a);let u=t===D.assignmentExpr?[s.dataType]:void 0,[h,p]=Rr([s,a],u)??[s,a],f=this.ctx.resolve(h.value,h.dataType).value,m=this.ctx.resolve(p.value,p.dataType).value,w=Io(h.dataType,n,p.dataType);if(t===D.assignmentExpr){if(h.origin==="constant"||h.origin==="constant-tgpu-const-ref"||h.origin==="runtime-tgpu-const-ref")throw new j(`'${f} = ${m}' is invalid, because ${f} is a constant.`);if(s.origin==="argument")throw new j(`'${f} ${n} ${m}' is invalid, because non-pointer arguments cannot be mutated.`);if(a.origin==="argument"&&!_e(a.dataType))throw new j(`'${f} = ${m}' is invalid, because argument references cannot be assigned.
-----
Try '${f} = ${this.ctx.resolve(a.dataType).value}(${m})' to copy the value instead.
-----`);if(!jr(a))throw new j(`'${f} = ${m}' is invalid, because references cannot be assigned.
-----
Try '${f} = ${this.ctx.resolve(a.dataType).value}(${m})' to copy the value instead.
-----`)}return y(Qg.includes(n)?`(${f} ${zo[n]??n} ${m})`:`${f} ${zo[n]??n} ${m}`,w,"runtime")}if(e[0]===D.postUpdate){let[t,r,n]=e,i=this.expression(n),s=this.ctx.resolve(i.value,i.dataType).value;return y(`${s}${r}`,i.dataType,"runtime")}if(e[0]===D.unaryExpr){let[t,r,n]=e,i=this.expression(n),s=ew[r];if(s)return s(i);let a=this.ctx.resolve(i.value,i.dataType).value,o=Io(i.dataType,r);return y(`${r}${a}`,o,"runtime")}if(e[0]===D.memberAccess){let[t,r,n]=e,i=this.expression(r);if(i.value===console)return y(new qa(n),Ye,"runtime");let s=xa(i,n);if(!s)throw new Error(c`Property '${n}' not found on value '${i}' of type ${this.ctx.resolve(i.dataType)}`);return s}if(e[0]===D.indexAccess){let[t,r,n]=e,i=this.expression(r),s=this.expression(n),a=Rr([s],[$,B],!1)?.[0]??s,o=hl(i,a);if(!o){let u=this.ctx.resolve(i.value,i.dataType).value,h=this.ctx.resolve(a.value,a.dataType).value;throw new Error(`Unable to index value ${u} of unknown type with index ${h}. If the value is an array, to address this, consider one of the following approaches: (1) declare the array using 'tgpu.const', (2) store the array in a buffer, or (3) define the array within the GPU function scope.`)}return o}if(e[0]===D.numericLiteral){let t=typeof e[1]=="string"?vi(iw(e[1])):vi(e[1]);if(!t)throw new Error(`Invalid numeric literal ${e[1]}`);return t}if(e[0]===D.call){let[t,r,n]=e,i=this.expression(r);if(ye(i.value)||Ie(i.value)){if(n.length>1)throw new j("Array and struct schemas should always be called with at most 1 argument");if(!n[0])return y(`${this.ctx.resolve(i.value).value}()`,i.value,"runtime");let o=this.typedExpression(n[0],i.value);return y(this.ctx.resolve(o.value,i.value).value,i.value,"runtime")}if(i.value===Ms)throw new Error("Constants cannot be defined within TypeGPU function scope. To address this, move the constant definition outside the function scope.");if(i.value instanceof eu){if(!n[0])throw new j(`An infix operator '${i.value.name}' was called without any arguments`);let o=this.expression(n[0]);return i.value.operator(i.value.lhs,o)}if(!C(i.value)){let o=n.map(h=>this.expression(h)),u=this.ctx.shelllessRepo.get(i.value,o);if(u){let h=o.map((p,f)=>{let m=u.argTypes[f];return nr(p,m,!1)});return this.ctx.withResetIndentLevel(()=>{let p=this.ctx.resolve(u);return y(c`${p.value}(${h})`,p.dataType,"runtime")})}throw new Error(`Function '${b(i.value)??String(i.value)}' is not marked with the 'use gpu' directive and cannot be used in a shader`)}let s=i.value[l]?.argConversionHint??"keep",a=i.value[l]?.strictSignature;try{let o;if(a)o=n.map((h,p)=>{let f=a.argTypes[p];if(!f)throw new j(`Function '${b(i.value)}' was called with too many arguments`);return this.typedExpression(h,f)});else if(Array.isArray(s))o=n.map((h,p)=>{let f=s[p];if(!f)throw new j(`Function '${b(i.value)}' was called with too many arguments`);return this.typedExpression(h,f)});else{let h=n.map(p=>this.expression(p));s==="keep"?o=h:s==="unify"?o=Rr(h)??h:o=s(...h).map((p,f)=>[p,h[f]]).map(([p,f])=>nr(f,p))}if(i.value instanceof qa)return this.ctx.generateLog(i.value.op,o);let u=i.value(...o);if(!qs(u))throw new Error("Functions running in codegen mode must return snippets");return u}catch(o){throw o instanceof Fr?o:new Fr(o,[{toString:()=>`fn:${b(i.value)}`}])}}if(e[0]===D.objectExpr){let t=e[1],r=this.ctx.expectedType;if(!r||!ye(r))throw new j(`No target type could be inferred for object with keys [${Object.keys(t).join(", ")}], please wrap the object in the corresponding schema.`);let n=Object.fromEntries(Object.entries(r.propTypes).map(([s,a])=>{let o=t[s];if(o===void 0)throw new j(`Missing property ${s} in object literal for struct ${r}`);let u=this.typedExpression(o,a);return[s,u]})),i=wc(r,n);return y(c`${this.ctx.resolve(r).value}(${i})`,r,"runtime")}if(e[0]===D.arrayExpr){let[t,r]=e,n=this.ctx.expectedType,i,s;if(Ie(n)){if(i=n.elementType,s=r.map(o=>this.typedExpression(o,i)),s.length!==n.elementCount)throw new j(`Cannot create value of type '${n}' from an array of length: ${s.length}`)}else{let o=r.map(h=>{let p=this.expression(h);if(p.origin==="argument"&&!_e(p.dataType)||!jr(p)){let f=this.ctx.resolve(p.value,p.dataType).value,m=this.ctx.resolve(Gt(p.dataType)).value;throw new j(`'${f}' reference cannot be used in an array constructor.
-----
Try '${m}(${f})' or 'arrayOf(${m}, count)([...])' to copy the value instead.
-----`)}return p});if(o.length===0)throw new j("Cannot infer the type of an empty array literal.");let u=Rr(o);if(!u)throw new j("The given values cannot be automatically converted to a common type. Consider wrapping the array in an appropriate schema");s=u,i=Gt(s[0]?.dataType)}let a=`array<${this.ctx.resolve(i).value}, ${s.length}>`;return y(c`${a}(${s})`,_n[l].jsImpl(i,s.length),"runtime")}if(e[0]===D.stringLiteral)return y(e[1],Ye,"constant");if(e[0]===D.preUpdate)throw new Error("Cannot use pre-updates in TGSL.");nw(e)}functionDefinition(e){return this.block(e)}statement(e){if(typeof e=="string")return`${this.ctx.pre}${this.ctx.resolve(this.identifier(e).value).value};`;if(typeof e=="boolean")return`${this.ctx.pre}${e?"true":"false"};`;if(e[0]===D.return){let t=e[1];if(t!==void 0){let r=this.ctx.topFunctionReturnType,n=r?this.typedExpression(t,r):this.expression(t);if(n.value instanceof zt)throw new j(c`Cannot return references, returning '${n.value.snippet}'`);if(n.origin==="argument"&&!_e(n.dataType)&&this.ctx.topFunctionScope?.functionType==="normal")throw new j(c`Cannot return references to arguments, returning '${n}'. Copy the argument before returning it.`);if(!r&&!jr(n)&&n.origin!=="this-function"){let i=this.ctx.resolve(n.value,n.dataType).value,s=this.ctx.resolve(Zn(n.dataType)).value;throw new j(`'return ${i};' is invalid, cannot return references.
-----
Try 'return ${s}(${i});' instead.
-----`)}return n=nr(n,Zn(n.dataType),!1),dt(n.dataType.type!=="unknown"),this.ctx.reportReturnType(n.dataType),c`${this.ctx.pre}return ${n};`}return`${this.ctx.pre}return;`}if(e[0]===D.if){let[t,r,n,i]=e,s=this.typedExpression(r,R),a=s.value===!1?void 0:this.block(ii(n)),o=s.value===!0||!i?void 0:this.block(ii(i));return s.value===!0?`${this.ctx.pre}${a}`:s.value===!1?o?`${this.ctx.pre}${o}`:"":o?c`\
${this.ctx.pre}if (${s}) ${a}
${this.ctx.pre}else ${o}`:c`${this.ctx.pre}if (${s}) ${a}`}if(e[0]===D.let||e[0]===D.const){let t="var",[r,n,i]=e,s=i!==void 0?this.expression(i):void 0;if(!s)throw new Error(`Cannot create variable '${n}' without an initial value.`);let a=jr(s),o=s.dataType,u=_e(o);if(Zr(s.dataType))throw new Error(`Cannot create variable '${n}' with loose data type.`);if(s.value instanceof zt){if(s.dataType.type!=="unknown")throw new j("Cannot store d.ref() in a variable if it references another value. Copy the value passed into d.ref() instead.");let p=s.value.snippet,f=this.refVariable(n,Gt(p.dataType));return c`${this.ctx.pre}var ${f} = ${nr(p,p.dataType,!1)};`}if(a){if(r===D.const)s.origin==="argument"?t="let":u&&(t=s.origin==="constant"?"const":"let");else if(s.origin==="argument"&&!u){let p=this.ctx.resolve(s.value).value,f=this.ctx.resolve(Zn(s.dataType)).value;throw new j(`'let ${n} = ${p}' is invalid, because references to arguments cannot be assigned to 'let' variable declarations.
  -----
  - Try 'let ${n} = ${f}(${p})' if you need to reassign '${n}' later
  - Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
  -----`)}}else{if(r===D.let){let p=this.ctx.resolve(s.value).value,f=this.ctx.resolve(Zn(s.dataType)).value;throw new j(`'let ${n} = ${p}' is invalid, because references cannot be assigned to 'let' variable declarations.
-----
- Try 'let ${n} = ${f}(${p})' if you need to reassign '${n}' later
- Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
-----`)}if(s.origin==="constant-tgpu-const-ref")t="const";else if(s.origin==="runtime-tgpu-const-ref")t="let";else{if(t="let",!Xe(o)){let p=du(s.origin,Gt(o));dt(p!==void 0,`Creating pointer type from origin ${s.origin}`),o=p}s.value instanceof zt||(o=uc(o))}}let h=this.blockVariable(t,n,Gt(o),s.origin);return c`${this.ctx.pre}${t} ${h.value} = ${nr(s,o,!1)};`}if(e[0]===D.block)return this.block(e);if(e[0]===D.for){let[t,r,n,i,s]=e,[a,o,u]=this.ctx.withResetIndentLevel(()=>[r?this.statement(r):void 0,n?this.typedExpression(n,R):void 0,i?this.statement(i):void 0]),h=a?a.slice(0,-1):"",p=u?u.slice(0,-1):"",f=this.block(ii(s));return c`${this.ctx.pre}for (${h}; ${o}; ${p}) ${f}`}if(e[0]===D.while){let[t,r,n]=e,i=this.typedExpression(r,R),s=this.ctx.resolve(i.value).value,a=this.block(ii(n));return`${this.ctx.pre}while (${s}) ${a}`}return e[0]===D.continue?`${this.ctx.pre}continue;`:e[0]===D.break?`${this.ctx.pre}break;`:`${this.ctx.pre}${this.ctx.resolve(this.expression(e).value).value};`}};function nw(e){throw new Error(`'${Xt(e)}' was not handled by the WGSL generator.`)}function iw(e){return/^0x[0-9a-f]+$/i.test(e)?Number.parseInt(e):/^0b[01]+$/i.test(e)?Number.parseInt(e.slice(2),2):Number.parseFloat(e)}function ii(e){return typeof e!="object"||e[0]!==D.block?[D.block,[e]]:e}var sw=new rw,ll=sw,cl="#CATCHALL#",aw=class{_stack=[];_itemDepth=0;get itemDepth(){return this._itemDepth}get topItem(){let e=this._stack[this._stack.length-1];if(!e||e.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return e}get topFunctionScope(){return this._stack.findLast(e=>e.type==="functionScope")}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}popItem(){this.pop("item")}pushSlotBindings(e){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(e)})}popSlotBindings(){this.pop("slotBinding")}pushFunctionScope(e,t,r,n,i){let s={type:"functionScope",functionType:e,args:t,argAliases:r,returnType:n,externalMap:i,reportedReturnTypes:new Set};return this._stack.push(s),s}popFunctionScope(){this.pop("functionScope")}pushBlockScope(){this._stack.push({type:"blockScope",declarations:new Map})}popBlockScope(){this.pop("blockScope")}pop(e){let t=this._stack[this._stack.length-1];if(!t||e&&t.type!==e)throw new Error(`Internal error, expected a ${e} layer to be on top.`);this._stack.pop(),e==="item"&&this._itemDepth--}readSlot(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="item")r.usedSlots.add(e);else if(r?.type==="slotBinding"){let n=r.bindingMap.get(e);if(n!==void 0)return n}else if(!(r?.type==="functionScope"||r?.type==="blockScope"))throw new Error("Unknown layer type.")}return e.defaultValue}getSnippetById(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="functionScope"){let n=r.args.find(s=>s.value===e);if(n!==void 0)return n;if(r.argAliases[e])return r.argAliases[e];let i=r.externalMap[e];return i!=null?Ci(i):void 0}if(r?.type==="blockScope"){let n=r.declarations.get(e);if(n!==void 0)return n}}}defineBlockVariable(e,t){if(t.dataType.type==="unknown")throw Error(`Tried to define variable '${e}' of unknown type`);for(let r=this._stack.length-1;r>=0;--r){let n=this._stack[r];if(n?.type==="blockScope"){n.declarations.set(e,t);return}}throw new Error("No block scope found to define a variable in.")}},ui=["","  ","    ","      ","        ","          ","            ","              ","                "],us=ui.length-1,ow=class{identLevel=0;get pre(){return ui[this.identLevel]??ui[us].repeat(this.identLevel/us)+ui[this.identLevel%us]}indent(){let e=this.pre;return this.identLevel++,e}dedent(){return this.identLevel--,this.pre}withResetLevel(e){let t=this.identLevel;this.identLevel=0;try{return e()}finally{this.identLevel=t}}},pl=class{#e;#t;_indentController=new ow;_itemStateStack=new aw;#r=[];_declarations=[];_varyingLocations;#n=new WeakSet;#i;get varyingLocations(){return this._varyingLocations}[l]={itemStateStack:this._itemStateStack};bindGroupLayoutsToPlaceholderMap=new Map;_nextFreeLayoutPlaceholderIdx=0;fixedBindings=[];enableExtensions;expectedType;constructor(e){this.enableExtensions=e.enableExtensions,this.#t=e.shaderGenerator??ll,this.#i=e.root?new Kg(e.root):new Zg,this.#e=e.namespace[l]}getUniqueName(e){return ng(this.#e,e)}makeNameValid(e){return this.#e.nameRegistry.makeValid(e)}get pre(){return this._indentController.pre}get topFunctionScope(){return this._itemStateStack.topFunctionScope}get topFunctionReturnType(){let e=this._itemStateStack.topFunctionScope;return dt(e),e.returnType}get shelllessRepo(){return this.#e.shelllessRepo}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}withResetIndentLevel(e){return this._indentController.withResetLevel(e)}getById(e){let t=this._itemStateStack.getSnippetById(e);return t===void 0?null:t}defineVariable(e,t){this._itemStateStack.defineBlockVariable(e,t)}reportReturnType(e){let t=this._itemStateStack.topFunctionScope;dt(t),t.reportedReturnTypes.add(e)}pushBlockScope(){this._itemStateStack.pushBlockScope()}popBlockScope(){this._itemStateStack.popBlockScope()}generateLog(e,t){return this.#i.generateLog(this,e,t)}get logResources(){return this.#i.logResources}fnToWgsl(e){let t=!1;try{this.#e.nameRegistry.pushFunctionScope();let r=[],n=[];for(let[o,u]of e.argTypes.entries()){let h=e.params[o],p=Xe(u)?u.addressSpace==="storage"?u.access==="read"?"readonly":"mutable":u.addressSpace:"argument";switch(h?.type){case Es.identifier:{let f=h.name,m=y(this.makeNameValid(f),u,p);r.push(m),m.value!==f&&n.push([f,m]);break}case Es.destructuredObject:{r.push(y(`_arg_${o}`,u,p)),n.push(...h.props.map(({name:f,alias:m})=>{let w=St(e.argTypes[o].propTypes[f]);return[m,y(`_arg_${o}.${f}`,w,"argument")]}));break}case void 0:r.push(y(`_arg_${o}`,u,p))}}let i=this._itemStateStack.pushFunctionScope(e.functionType,r,Object.fromEntries(n),e.returnType,e.externalMap);t=!0,this.#t.initGenerator(this);let s=this.#t.functionDefinition(e.body),a=e.returnType;if(!a){let o=[...i.reportedReturnTypes];if(o.length===0)a=se;else{let u=Zs(o);u&&!u.hasImplicitConversions&&(a=u.targetType)}if(!a)throw new Error(`Expected function to have a single return type, got [${o.join(", ")}]. Cast explicitly to the desired type.`);a=Gt(a)}return{head:uw(this,r,a),body:s,returnType:a}}finally{t&&this._itemStateStack.popFunctionScope(),this.#e.nameRegistry.popFunctionScope()}}addDeclaration(e){this._declarations.push(e)}allocateLayoutEntry(e){let t=this.bindGroupLayoutsToPlaceholderMap,r=t.get(e);return r||(r=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,t.set(e,r)),r}allocateFixedEntry(e,t){let r=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:e,resource:t}),{group:cl,binding:r}}readSlot(e){let t=this._itemStateStack.readSlot(e);if(t===void 0)throw new Jl(e);return t}withSlots(e,t){this._itemStateStack.pushSlotBindings(e);try{return t()}finally{this._itemStateStack.popSlotBindings()}}withVaryingLocations(e,t){this._varyingLocations=e;try{return t()}finally{this._varyingLocations=void 0}}unwrap(e){if(xs(e))return this.withSlots(e[ur].pairs,()=>this.unwrap(e[ur].inner));let t=e;for(;;)if(gs(t))t=this.readSlot(t);else if(ws(t))t=this._getOrCompute(t);else break;return t}_getOrCompute(e){let t=this.#e.memoizedDerived.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;this.pushMode(new Pn);let r;try{r=e["~compute"]()}finally{this.popMode("normal")}let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedDerived.set(e,t),r}catch(r){throw r instanceof Fr?r.appendToTrace(e):new Fr(r,[e])}finally{this._itemStateStack.popItem()}}_getOrInstantiate(e){let t=this.#e.memoizedResolves.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;let r;if(Kr(e))r=y(Bh(this,e),se,"runtime");else if(ws(e)||gs(e))r=this.resolve(this.unwrap(e));else if(fu(e))r=e[z](this);else if(yn(e)){let i=this.#e.shelllessRepo.get(e,void 0);if(!i)throw new Error(`Couldn't resolve ${e.name}. Make sure it's a function that accepts no arguments, or call it from another TypeGPU function.`);return this.withResetIndentLevel(()=>this.resolve(i))}else throw new TypeError(`Unresolvable internal value: ${Xt(e)}`);let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedResolves.set(e,t),r}catch(r){throw r instanceof Fr?r.appendToTrace(e):new Fr(r,[e])}finally{this._itemStateStack.popItem()}}resolve(e,t){if(Uh(e)||yn(e)){if(this.#n.has(e)&&!this.#e.memoizedResolves.has(e))throw new Error(`Recursive function ${e} detected. Recursion is not allowed on the GPU.`);this.#n.add(e)}if(xs(e))return this.withSlots(e[ur].pairs,()=>this.resolve(e[ur].inner,t));if(C(e)||yn(e)){if(this._itemStateStack.itemDepth===0)try{this.pushMode(new lc);let r=mu(this,()=>this._getOrInstantiate(e));return y(`${[...this._declarations].join(`

`)}${r.value}`,se,"runtime")}finally{this.popMode("codegen")}return this._getOrInstantiate(e)}if(typeof e=="number"){let r=t??vi(e).dataType;if(dt(r.type!=="unknown"),r.type==="abstractInt")return y(`${e}`,r,"constant");if(r.type==="u32")return y(`${e}u`,r,"constant");if(r.type==="i32")return y(`${e}i`,r,"constant");let n=e.toExponential(),i=r.type==="abstractFloat"&&Number.isInteger(e)?`${e}.`:`${e}`,s=n.length<i.length?n:i;return r.type==="f32"?y(`${s}f`,r,"constant"):r.type==="f16"?y(`${s}h`,r,"constant"):y(s,r,"constant")}if(typeof e=="boolean")return y(e?"true":"false",R,"constant");if(typeof e=="string")return y(e,se,"runtime");if(t&&Ie(t)){if(!Array.isArray(e))throw new j(`Cannot coerce ${e} into value of type '${t}'`);if(t.elementCount!==e.length)throw new j(`Cannot create value of type '${t}' from an array of length: ${e.length}`);let r=this.resolve(t.elementType);return y(c`array<${r}, ${t.elementCount}>(${e.map(n=>y(n,t.elementType,"runtime"))})`,t,"runtime")}if(Array.isArray(e))return y(c`array(${e.map(r=>this.resolve(r))})`,Ye,"runtime");if(t&&ye(t))return y(c`${this.resolve(t)}(${Object.entries(t.propTypes).map(([r,n])=>y(e[r],n,"runtime"))})`,t,"runtime");throw new j(`Value ${e} (as json: ${Xt(e)}) is not resolvable${t?` to type ${t.type}`:""}`)}pushMode(e){this.#r.push(e)}popMode(e){let t=this.#r.pop();e!==void 0&&dt(t?.type===e)}get mode(){return this.#r[this.#r.length-1]??yu}};function Xi(e,t){let r=new pl(t),n=(t.config?r.withSlots(t.config(new Fh([])).bindings,()=>r.resolve(e)):r.resolve(e)).value,i=r.bindGroupLayoutsToPlaceholderMap,s=[],a=new Set([...i.keys()].map(f=>f.index).filter(f=>f!==void 0)),o=cg(a),u=r.fixedBindings.map((f,m)=>[String(m),f.layoutEntry]),h=()=>{let f=o.next().value,m=Zh(Object.fromEntries(u));return s[f]=m,n=n.replaceAll(cl,String(f)),[f,new Jh(m,Object.fromEntries(r.fixedBindings.map((w,v)=>[String(v),w.resource])))]},p=u.length>0?h():void 0;for(let[f,m]of i.entries()){let w=f.index??o.next().value;s[w]=f,n=n.replaceAll(m,String(w))}return t.enableExtensions&&t.enableExtensions.length>0&&(n=`${t.enableExtensions.map(f=>`enable ${f};`).join(`
`)}

${n}`),{code:n,usedBindGroupLayouts:s,catchall:p,logResources:r.logResources}}function uw(e,t,r){let n=t.map(i=>`${i.value}: ${e.resolve(i.dataType).value}`).join(", ");return r.type!=="void"?`(${n}) -> ${da(r)}${e.resolve(r).value} `:`(${n}) `}function dl(e){let t=e;return t?.resourceType==="compute-pipeline"&&!!t[l]}function fl(e){let t=e;return t?.resourceType==="render-pipeline"&&!!t[l]}function hw(e){return fl(e)||dl(e)}function As(e,t){return Array.isArray(e)?pw(e,t):cw(e)}function lw(e,t){return Array.isArray(e)?As(e,t).code:As(e).code}function cw(e){let{template:t,externals:r,shaderGenerator:n,names:i="strict",config:s,enableExtensions:a}=e;t||console.warn("Calling resolve with an empty template is deprecated and will soon return an empty string. Consider using the 'tgpu.resolve(resolvableArray, options)' API instead.");let o={};Wr(o,r??{});let u={[l]:!0,[z](h){return y(On(h,o,t??""),se,"runtime")},toString:()=>"<root>"};return Xi(u,{namespace:typeof i=="string"?rn({names:i}):i,enableExtensions:a,shaderGenerator:n,config:s,root:ml(Object.values(r))})}function pw(e,t){let{shaderGenerator:r,names:n="strict",config:i,enableExtensions:s}=t??{},a={[l]:!0,[z](o){return e.forEach(u=>o.resolve(u)),y("",se,"runtime")},toString:()=>"<root>"};return Xi(a,{namespace:typeof n=="string"?rn({names:n}):n,enableExtensions:s,shaderGenerator:r,config:i,root:ml(e)})}function ml(e){let t=e.filter(hw);if(t.length>1)throw new Error(`Found ${t.length} pipelines but can only resolve one at a time.`);return t[0]?.[l].branch}function dw(e){let t=Ce()??new pl({namespace:rn(),shaderGenerator:ll}),r=[1,1,1],n=[1,1,1],i=[r[0]*n[0],r[1]*n[1],r[2]*n[2]],s=new Map,a=Array.from({length:r[0]},()=>Array.from({length:r[1]},()=>Array.from({length:r[2]},()=>new Map))),o=Array.from({length:i[0]},()=>Array.from({length:i[1]},()=>Array.from({length:i[2]},()=>new Map))),u=Array.from({length:i[0]},(h,p)=>Array.from({length:i[1]},(f,m)=>Array.from({length:i[2]},(w,v)=>{let _=Math.floor(p/n[0]),S=Math.floor(m/n[1]),V=Math.floor(v/n[2]);return new cc(s,{private:o[p][m][v],workgroup:a[_][S][V]})})));t.pushMode(u[0][0][0]);try{return{value:mu(t,e),buffers:s,privateVars:o,workgroupVars:a}}finally{t.popMode("simulate")}}function fw(e,t,r,n){return new mw(e,t,r,n)}function Ea(e){let t=e;return t?.resourceType==="query-set"&&!!t[l]}var mw=class{constructor(e,t,r,n){this.type=t,this.count=r,this.rawQuerySet=n,this.#e=e.device,this._ownQuerySet=!n,this._querySet=n||null}resourceType="query-set";#e;_querySet=null;_ownQuerySet;_destroyed=!1;_available=!0;_readBuffer=null;_resolveBuffer=null;get querySet(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");return this.rawQuerySet?this.rawQuerySet:this._querySet?this._querySet:(this._querySet=this.#e.createQuerySet({type:this.type,count:this.count}),this._querySet)}get destroyed(){return this._destroyed}get available(){return this._available}get[l](){let e=this;return{get readBuffer(){return e._readBuffer||(e._readBuffer=e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})),e._readBuffer},get resolveBuffer(){return e._resolveBuffer||(e._resolveBuffer=e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC})),e._resolveBuffer}}}$name(e){return G(this,e),this._querySet&&(this._querySet.label=e),this}resolve(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");if(!this._available)throw new Error("This QuerySet is busy resolving or reading.");let e=this.#e.createCommandEncoder();e.resolveQuerySet(this.querySet,0,this.count,this[l].resolveBuffer,0),this.#e.queue.submit([e.finish()])}async read(){if(!this._resolveBuffer)throw new Error("QuerySet must be resolved before reading.");this._available=!1;try{let e=this.#e.createCommandEncoder();e.copyBufferToBuffer(this[l].resolveBuffer,0,this[l].readBuffer,0,this.count*BigUint64Array.BYTES_PER_ELEMENT),this.#e.queue.submit([e.finish()]);let t=this[l].readBuffer;await t.mapAsync(GPUMapMode.READ);let r=new BigUint64Array(t.getMappedRange().slice());return t.unmap(),Array.from(r)}finally{this._available=!0}}destroy(){this._destroyed||(this._destroyed=!0,this._querySet&&this._ownQuerySet&&this._querySet.destroy(),this._readBuffer?.destroy(),this._resolveBuffer?.destroy(),this._readBuffer=this._resolveBuffer=null)}},So=class{constructor(e){this._make=e}_map=new WeakMap;getOrMake(e,...t){if(this._map.has(e))return this._map.get(e);let r=this._make(e,...t);return this._map.set(e,r),r}},hs=class{constructor(e,t){this.resourceType=e,this.buffer=t,this[ue]=t,this.#e=this.buffer.as(this.resourceType)}[l]=!0;[ue];#e;$name(e){return G(this[ue],e),this}write(e){this.buffer.write(e)}writePartial(e){this.buffer.writePartial(e)}read(){return this.buffer.read()}get[F](){return this.#e.$}get $(){return this.#e.$}get value(){return this.$}[z](e){return e.resolve(this.#e)}},M=e=>_h(e??0),at=e=>zh(e??0),Ar=e=>Ih(e??0),yw={f32:e=>M(e[0]),f16:e=>Ar(e[0]).x,i32:e=>at(e[0]),u32:e=>e[0]??0,bool:e=>!!e[0],vec2f:e=>N(M(e[0]),M(e[1])),vec3f:e=>le(M(e[0]),M(e[1]),M(e[2])),vec4f:e=>I(M(e[0]),M(e[1]),M(e[2]),M(e[3])),vec2h(e){let t=Ar(e[0]);return yt(t.x,t.y)},vec3h(e){let t=Ar(e[0]),r=Ar(e[1]);return gt(t.x,t.y,r.x)},vec4h(e){let t=Ar(e[0]),r=Ar(e[1]);return wt(t.x,t.y,r.x,r.y)},vec2i:e=>ie(at(e[0]),at(e[1])),vec3i:e=>Oe(at(e[0]),at(e[1]),at(e[2])),vec4i:e=>de(at(e[0]),at(e[1]),at(e[2]),at(e[3])),vec2u:e=>Me(e[0]??0,e[1]??0),vec3u:e=>ae(e[0]??0,e[1]??0,e[2]??0),vec4u:e=>ve(e[0]??0,e[1]??0,e[2]??0,e[3]??0),"vec2<bool>":e=>fr(!!e[0],!!e[1]),"vec3<bool>":e=>mr(!!e[0],!!e[1],!!e[2]),"vec4<bool>":e=>yr(!!e[0],!!e[1],!!e[2],!!e[3]),mat2x2f:e=>Ut(M(e[0]),M(e[1]),M(e[2]),M(e[3])),mat3x3f:e=>Vt(M(e[0]),M(e[1]),M(e[2]),M(e[4]),M(e[5]),M(e[6]),M(e[8]),M(e[9]),M(e[10])),mat4x4f:e=>Y(M(e[0]),M(e[1]),M(e[2]),M(e[3]),M(e[4]),M(e[5]),M(e[6]),M(e[7]),M(e[8]),M(e[9]),M(e[10]),M(e[11]),M(e[12]),M(e[13]),M(e[14]),M(e[15]))};function gw(e,t){let r=yw[t.type];if(r)return r(e);if(ye(t)){let n=Object.keys(t.propTypes),i=Object.values(t.propTypes),s=Cs(e,i);return Object.fromEntries(n.map((a,o)=>[a,s[o]]))}if(Ie(t)){let n=t.elementType,i=t.elementCount;return Cs(e,Array.from({length:i},()=>n))}throw new Error(`Cannot deserialize data of type ${t.type}`)}function Cs(e,t){let r=0;return t.map(n=>{if(!Zt(n))return n;let i=Math.ceil(A(n)/4),s=gw(e.subarray(r,r+i),n);return r+=i,s})}function ww(e,t){return Cs(e,t).map(bs)}function Os(e){let{indexBuffer:t,dataBuffer:r,logIdToMeta:n,options:i}=e;r.read().then(s=>{s.filter(a=>a.id).forEach(({id:a,serializedData:o})=>{let{argTypes:u,op:h}=n.get(a),p=ww(new Uint32Array(o),u);p.length===0&&p.push(""),console[h](`%c${i.messagePrefix}%c ${p[0]}`,"background: #936ff5; color: white;","color: inherit; background: none",...p.slice(1))})}),t.read().then(s=>{s>i.logCountLimit&&console.warn(`Log count limit per dispatch (${i.logCountLimit}) exceeded by ${s-i.logCountLimit} calls. Consider increasing the limit by passing appropriate options to tgpu.init().`)}),r.buffer.clear(),t.buffer.clear()}function yl(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Performance callback requires the "timestamp-query" feature to be enabled on GPU device.');return e.timestampWrites?{...e,performanceCallback:t}:{...e,performanceCallback:t,hasAutoQuerySet:!0,timestampWrites:{querySet:r.createQuerySet("timestamp",2),beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}}function gl(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Timestamp writes require the "timestamp-query" feature to be enabled on GPU device.');e.hasAutoQuerySet&&e.timestampWrites&&e.timestampWrites.querySet.destroy();let n={querySet:t.querySet};return t.beginningOfPassWriteIndex!==void 0&&(n.beginningOfPassWriteIndex=t.beginningOfPassWriteIndex),t.endOfPassWriteIndex!==void 0&&(n.endOfPassWriteIndex=t.endOfPassWriteIndex),{...e,hasAutoQuerySet:!1,timestampWrites:n}}function wl(e,t){if(!e.timestampWrites)return{};let{querySet:r,beginningOfPassWriteIndex:n,endOfPassWriteIndex:i}=e.timestampWrites,s={querySet:Ea(r)?t.unwrap(r):r};return n!==void 0&&(s.beginningOfPassWriteIndex=n),i!==void 0&&(s.endOfPassWriteIndex=i),{timestampWrites:s}}function Bs({root:e,priors:t}){let r=t.timestampWrites?.querySet,n=t.performanceCallback;if(!r)throw new Error("Cannot dispatch workgroups with performance callback without a query set.");if(!Ea(r))throw new Error("Performance callback with raw GPUQuerySet is not supported. Use TgpuQuerySet instead.");let i=e.device.createCommandEncoder();i.resolveQuerySet(e.unwrap(r),0,r.count,r[l].resolveBuffer,0),e.device.queue.submit([i.finish()]),e.device.queue.onSubmittedWorkDone().then(async()=>{if(!r.available)return;let s=await r.read(),a=s[t.timestampWrites?.beginningOfPassWriteIndex??0],o=s[t.timestampWrites?.endOfPassWriteIndex??1];if(a===void 0||o===void 0)throw new Error("QuerySet did not return valid timestamps.");await n(a,o)})}function xw(e,t,r){return new vw(new bw(e,t,r),{})}var vw=class fn{constructor(t,r){this._core=t,this._priors=r,this[l]={get rawPipeline(){return t.unwrap().pipeline},get priors(){return r},get branch(){return t.branch}},this[ue]=t}[l];resourceType="compute-pipeline";[ue];[z](t){return t.resolve(this._core)}toString(){return`computePipeline:${b(this)??"<unnamed>"}`}get rawPipeline(){return this._core.unwrap().pipeline}with(t,r){return _i(t)?new fn(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t.layout,t]])}):new fn(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t,r]])})}withPerformanceCallback(t){let r=yl(this._priors,t,this._core.branch);return new fn(this._core,r)}withTimestampWrites(t){let r=gl(this._priors,t,this._core.branch);return new fn(this._core,r)}dispatchWorkgroups(t,r,n){let i=this._core.unwrap(),{branch:s}=this._core,a={label:b(this._core)??"<unnamed>",...wl(this._priors,s)},o=s.device.createCommandEncoder(),u=o.beginComputePass(a);u.setPipeline(i.pipeline);let h=new Set(i.usedBindGroupLayouts);if(i.usedBindGroupLayouts.forEach((p,f)=>{if(i.catchall&&f===i.catchall[0])u.setBindGroup(f,s.unwrap(i.catchall[1])),h.delete(p);else{let m=this._priors.bindGroupLayoutMap?.get(p);m!==void 0&&(h.delete(p),u.setBindGroup(f,s.unwrap(m)))}}),h.size>0)throw new Ws(h);u.dispatchWorkgroups(t,r,n),u.end(),s.device.queue.submit([o.finish()]),i.logResources&&Os(i.logResources),this._priors.performanceCallback&&Bs({root:s,priors:this._priors})}$name(t){return G(this._core,t),this}},bw=class{constructor(e,t,r){this.branch=e,this._slotBindings=t,this._entryFn=r}[l]=!0;_memo;[z](e){return e.withSlots(this._slotBindings,()=>(e.resolve(this._entryFn),y("",se,"runtime")))}toString(){return"computePipelineCore"}unwrap(){if(this._memo===void 0){let e=this.branch.device,t=Ia.filter(h=>this.branch.enabledFeatures.has(Mh[h])),r,n=rn({names:this.branch.nameRegistrySetting});r=Xi(this,{namespace:n,enableExtensions:t,shaderGenerator:this.branch.shaderGenerator,root:this.branch});let{code:i,usedBindGroupLayouts:s,catchall:a,logResources:o}=r;a!==void 0&&s[a[0]]?.$name(`${b(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let u=e.createShaderModule({label:`${b(this)??"<unnamed>"} - Shader`,code:i});this._memo={pipeline:e.createComputePipeline({label:b(this)??"<unnamed>",layout:e.createPipelineLayout({label:`${b(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:s.map(h=>this.branch.unwrap(h))}),compute:{module:u}}),usedBindGroupLayouts:s,catchall:a,logResources:o}}return this._memo}};function Eo(e,t="vertex"){return new $w(e,t)}function xl(e){return e?.resourceType==="vertex-layout"}var Fs=Symbol("defaultAttribEntry");function hi(e,t,r,n,i){if(Ze(t)||Qe(t)){let s=qt(t);return s!==void 0&&(n[i??Fs]=s),hi(e,t.inner,Ae(r,De(t)),n)}if(ye(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Ae(s,re(u));let h=[o,hi(e,u,s,n,o)];return s+=A(u),h}))}if(Ke(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Ae(s,De(u));let h=[o,hi(e,u,s,n,o)];return s+=A(u),h}))}if("type"in t&&typeof t.type=="string"){if(Jo.includes(t.type))return{_layout:e,format:t.type,offset:r};let s=Xl[t.type];if(s)return{_layout:e,format:s,offset:r}}throw new Error(`Unsupported data used in vertex layout: ${String(t)}`)}var $w=class{constructor(e,t){this.schemaForCount=e,this.stepMode=t;let r=e(0);this.stride=Ae(A(r.elementType),re(r)),this.attrib=hi(this,r.elementType,0,this._customLocationMap)}[l]=!0;resourceType="vertex-layout";stride;attrib;_customLocationMap={};get vertexLayout(){if(this._customLocationMap[Fs]!==void 0){if(typeof this.attrib.format!="string"||typeof this.attrib.offset!="number")throw new Error("Single attribute vertex layouts must have a format and offset.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[{format:this.attrib.format,offset:this.attrib.offset,shaderLocation:this._customLocationMap[Fs]}]}}if(!Object.keys(this.attrib).every(e=>this._customLocationMap[e]!==void 0))throw new Error("All attributes must have custom locations in order to unwrap a vertex layout.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[...Object.entries(this.attrib).map(([e,t])=>({format:t.format,offset:t.offset,shaderLocation:this._customLocationMap[e]}))]}}$name(e){return G(this,e),this}};function Tw(e){return typeof e?.loadOp=="string"}function _w(e,t){if(Kr(e)){if(kt(e))return[];if(!Tw(t))throw new Error("Expected a single color attachment, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(kt(i))continue;let s=t[n];if(!s)throw new Error(`A color attachment by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function zw(e){return typeof e?.format=="string"}function Iw(e,t){if(Kr(e)){if(Ko(e))return[];if(e.type==="decorated")return[];if(!zw(t))throw new Error("Expected a single color target configuration, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(kt(i))continue;let s=t[n];if(!s)throw new Error(`A color target by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function vl(e){return new Sw(new Ew(e),{})}var Sw=class qe{[l];resourceType="render-pipeline";[ue];hasIndexBuffer=!1;constructor(t,r){this[l]={core:t,priors:r,branch:t.options.branch},this[ue]=t}[z](t){return t.resolve(this[l].core)}toString(){return`renderPipeline:${b(this)??"<unnamed>"}`}$name(t){return G(this[l].core,t),this}with(t,r){let n=this[l];if(_i(t))return new qe(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t.layout,t]])});if(Kh(t))return new qe(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t,r]])});if(xl(t))return new qe(n.core,{...n.priors,vertexLayoutMap:new Map([...n.priors.vertexLayoutMap??[],[t,r]])});throw new Error("Unsupported value passed into .with()")}withPerformanceCallback(t){let r=this[l],n=yl(r.priors,t,r.core.options.branch);return new qe(r.core,n)}withTimestampWrites(t){let r=this[l],n=gl(r.priors,t,r.core.options.branch);return new qe(r.core,n)}withColorAttachment(t){let r=this[l];return new qe(r.core,{...r.priors,colorAttachment:t})}withDepthStencilAttachment(t){let r=this[l];return new qe(r.core,{...r.priors,depthStencilAttachment:t})}withStencilReference(t){let r=this[l];return new qe(r.core,{...r.priors,stencilReference:t})}withIndexBuffer(t,r,n,i){let s=this[l];if(vs(t)){if(typeof r!="string")throw new Error("If a GPUBuffer is passed, indexFormat must be provided.");return new qe(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:r,offsetBytes:n,sizeBytes:i}})}let a={u32:"uint32",u16:"uint16"},o=t.dataType.elementType;return new qe(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:a[o.type],offsetBytes:r!==void 0?r*A(o):void 0,sizeBytes:i!==void 0?i*A(o):void 0}})}setupRenderPass(t){let r=this[l],n=r.core.unwrap(),{branch:i,fragmentFn:s}=r.core.options,a=s?_w(s.shell.out,r.priors.colorAttachment??{}).map(m=>zn(m.view)?{...m,view:i.unwrap(m.view).createView()}:In(m.view)?{...m,view:i.unwrap(m.view)}:m):[null],o={label:b(r.core)??"<unnamed>",colorAttachments:a,...wl(r.priors,i)},u=r.priors.depthStencilAttachment;if(u!==void 0){let m=zn(u.view)?i.unwrap(u.view).createView():In(u.view)?i.unwrap(u.view):u.view;o.depthStencilAttachment={...u,view:m}}let h=t.beginRenderPass(o);h.setPipeline(n.pipeline),r.priors.stencilReference!==void 0&&h.setStencilReference(r.priors.stencilReference);let p=new Set(n.usedBindGroupLayouts);n.usedBindGroupLayouts.forEach((m,w)=>{if(n.catchall&&w===n.catchall[0])h.setBindGroup(w,i.unwrap(n.catchall[1])),p.delete(m);else{let v=r.priors.bindGroupLayoutMap?.get(m);v!==void 0&&(p.delete(m),h.setBindGroup(w,i.unwrap(v)))}});let f=new Set(r.core.usedVertexLayouts);if(r.core.usedVertexLayouts.forEach((m,w)=>{let v=r.priors.vertexLayoutMap?.get(m);v&&(f.delete(m),h.setVertexBuffer(w,i.unwrap(v)))}),p.size>0)throw new Ws(p);if(f.size>0)throw new au(f);return h}draw(t,r,n,i){let s=this[l],{branch:a}=s.core.options,{logResources:o}=s.core.unwrap(),u=a.device.createCommandEncoder(),h=this.setupRenderPass(u);h.draw(t,r,n,i),h.end(),a.device.queue.submit([u.finish()]),o&&Os(o),s.priors.performanceCallback&&Bs({root:a,priors:s.priors})}drawIndexed(t,r,n,i,s){let a=this[l];if(!a.priors.indexBuffer)throw new Error("No index buffer set for this render pipeline.");let{logResources:o}=a.core.unwrap(),{branch:u}=a.core.options,{buffer:h,indexFormat:p,offsetBytes:f,sizeBytes:m}=a.priors.indexBuffer,w=u.device.createCommandEncoder(),v=this.setupRenderPass(w);vs(h)?v.setIndexBuffer(h,p,f,m):v.setIndexBuffer(u.unwrap(h),p,f,m),v.drawIndexed(t,r,n,i,s),v.end(),u.device.queue.submit([w.finish()]),o&&Os(o),a.priors.performanceCallback&&Bs({root:u,priors:a.priors})}},Ew=class{constructor(e){this.options=e;let t=ig(e.vertexFn.shell.in??{},e.vertexAttribs);this._vertexBufferLayouts=t.bufferDefinitions,this.usedVertexLayouts=t.usedVertexLayouts,this._targets=e.fragmentFn&&e.targets?Iw(e.fragmentFn.shell.out,e.targets):[null]}[l]=!0;usedVertexLayouts;_memo;_vertexBufferLayouts;_targets;[z](e){let{vertexFn:t,fragmentFn:r,slotBindings:n}=this.options,i=Mw(t.shell.out,r?.shell.in,b(t)??"<unnamed>",b(r)??"<unnamed>");return e.withVaryingLocations(i,()=>e.withSlots(n,()=>(e.resolve(t),r&&e.resolve(r),y("",se,"runtime"))))}toString(){return"renderPipelineCore"}unwrap(){if(this._memo===void 0){let{branch:e,primitiveState:t,depthStencilState:r,multisampleState:n}=this.options,i=e.device,s=Ia.filter(_=>e.enabledFeatures.has(Mh[_])),a,o=rn({names:e.nameRegistrySetting});a=Xi(this,{namespace:o,enableExtensions:s,shaderGenerator:e.shaderGenerator,root:e});let{code:u,usedBindGroupLayouts:h,catchall:p,logResources:f}=a;p!==void 0&&h[p[0]]?.$name(`${b(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let m=i.createShaderModule({label:`${b(this)??"<unnamed>"} - Shader`,code:u}),w={layout:i.createPipelineLayout({label:`${b(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:h.map(_=>e.unwrap(_))}),vertex:{module:m,buffers:this._vertexBufferLayouts}},v=b(this);v!==void 0&&(w.label=v),this.options.fragmentFn&&(w.fragment={module:m,targets:this._targets}),t&&(Zt(t.stripIndexFormat)?w.primitive={...t,stripIndexFormat:{u32:"uint32",u16:"uint16"}[t.stripIndexFormat.type]}:w.primitive=t),r&&(w.depthStencil=r),n&&(w.multisample=n),this._memo={pipeline:i.createRenderPipeline(w),usedBindGroupLayouts:h,catchall:p,logResources:f}}return this._memo}};function Mw(e,t,r,n){let i={},s=new Set;function a(u,h){i[u]=h,s.add(h)}for(let[u,h]of Object.entries(e)){let p=qt(h);p!==void 0&&a(u,p)}for(let[u,h]of Object.entries(t??{})){let p=qt(h);p!==void 0&&(i[u]===void 0?a(u,p):i[u]!==p&&console.warn(`Mismatched location between vertexFn (${r}) output (${i[u]}) and fragmentFn (${n}) input (${p}) for the key "${u}", using the location set on vertex output.`))}let o=0;for(let u of Object.keys(e??{}))if(!(kt(e[u])||i[u]!==void 0)){for(;s.has(o);)o++;a(u,o)}return i}function kw(e){if(e.includes(0))throw new Error("Size and workgroupSize cannot contain zeroes.");return ae(e[0]??1,e[1]??1,e[2]??1)}var Pw=[ae(1,1,1),ae(256,1,1),ae(16,16,1),ae(8,8,4)],Uw=class bl{#e;#t;#r;#n;#i;constructor(t,r,n,i){this.#e=t,this.#t=r,this.#r=n,this.#n=i,this.#i=ae()}with(t){return new bl(this.#e,this.#t.with(t),this.#r,this.#n)}dispatchThreads(...t){let r=kw(t),n=xh(le(r).div(le(this.#n)));Sh(r,this.#i)||(this.#i=r,this.#r.write(r)),this.#t.dispatchWorkgroups(n.x,n.y,n.z)}get pipeline(){return this.#t}get sizeUniform(){return this.#r}},Vw=class js{constructor(t,r){this._getRoot=t,this._slotBindings=r}with(t,r){return new js(this._getRoot,[...this._slotBindings,[Vi(t)?t.slot:t,r]])}withCompute(t){return new Aw(this._getRoot(),this._slotBindings,t)}createGuardedComputePipeline(t){let r=this._getRoot();if(t.length>=4)throw new Error("Guarded compute callback only supports up to three dimensions.");let n=Pw[t.length],i=O([$,$,$])(t),s=r.createUniform(ae),a=Ph({workgroupSize:n,in:{id:Fu.globalInvocationId}})`{
  if (any(in.id >= sizeUniform)) {
    return;
  }
  wrappedCallback(in.id.x, in.id.y, in.id.z);
}`.$uses({sizeUniform:s,wrappedCallback:i}),o=this.withCompute(a).createPipeline();return new Uw(r,o,s,n)}withVertex(t,r){return new Cw({branch:this._getRoot(),primitiveState:void 0,depthStencilState:void 0,slotBindings:this._slotBindings,vertexFn:t,vertexAttribs:r??{},multisampleState:void 0})}pipe(t){let r=t(new Fh([]));return new js(this._getRoot,[...this._slotBindings,...r.bindings])}},Aw=class{constructor(e,t,r){this._root=e,this._slotBindings=t,this._entryFn=r}createPipeline(){return xw(this._root,this._slotBindings,this._entryFn)}},Cw=class li{constructor(t){this._options=t}withFragment(t,r,n){return dt(typeof t!="string"),dt(r===void 0||typeof r!="string"),new Ow({...this._options,fragmentFn:t,targets:r??{}})}withPrimitive(t){return new li({...this._options,primitiveState:t})}withDepthStencil(t){return new li({...this._options,depthStencilState:t})}withMultisample(t){return new li({...this._options,multisampleState:t})}createPipeline(){return vl({...this._options,fragmentFn:null,targets:null})}},Ow=class ci{constructor(t){this._options=t}withPrimitive(t){return new ci({...this._options,primitiveState:t})}withDepthStencil(t){return new ci({...this._options,depthStencilState:t})}withMultisample(t){return new ci({...this._options,multisampleState:t})}createPipeline(){return vl(this._options)}},$l=class extends Vw{constructor(t,r,n,i,s){super(()=>this,[]),this.device=t,this.nameRegistrySetting=r,this._ownDevice=n,this.shaderGenerator=s,this["~unstable"]=this,this[l]={logOptions:i}}"~unstable";_unwrappedBindGroupLayouts=new So(t=>t.unwrap(this));_unwrappedBindGroups=new So(t=>t.unwrap(this));[l];get enabledFeatures(){return new Set(this.device.features)}createBuffer(t,r){return ni(this,t,r)}createUniform(t,r){let n=ni(this,t,r).$usage("uniform");return new hs("uniform",n)}createMutable(t,r){let n=ni(this,t,r).$usage("storage");return new hs("mutable",n)}createReadonly(t,r){let n=ni(this,t,r).$usage("storage");return new hs("readonly",n)}createQuerySet(t,r,n){return fw(this,t,r,n)}createBindGroup(t,r){return new Jh(t,r)}destroy(){Ug(this.device),this._ownDevice&&this.device.destroy()}createTexture(t){return Og(t,this)}createSampler(t){return Tg(t,this)}createComparisonSampler(t){return _g(t,this)}unwrap(t){if(dl(t))return t[l].rawPipeline;if(fl(t))return t[l].core.unwrap().pipeline;if(Kh(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(_i(t))return this._unwrappedBindGroups.getOrMake(t);if($n(t))return t.buffer;if(zn(t))return t[l].unwrap();if(In(t)){if(!t[l].unwrap)throw new Error("Cannot unwrap laid-out texture view as it has no underlying resource.");return t[l].unwrap()}if(xl(t))return t.vertexLayout;if(Dh(t)||Nh(t)){if(t[l].unwrap)return t[l].unwrap();throw new Error("Cannot unwrap laid-out sampler.")}if(Ea(t))return t.querySet;throw new Error(`Unknown resource type: ${t}`)}beginRenderPass(t,r){let n=this.device.createCommandEncoder(),i=n.beginRenderPass(t),s=new Map,a=new Map,o,u=()=>{if(!o)throw new Error("Cannot draw without a call to pass.setPipeline");let{core:h,priors:p}=o[l],f=h.unwrap();i.setPipeline(f.pipeline);let m=new Set(f.usedBindGroupLayouts);f.usedBindGroupLayouts.forEach((v,_)=>{if(f.catchall&&_===f.catchall[0])i.setBindGroup(_,this.unwrap(f.catchall[1])),m.delete(v);else{let S=p.bindGroupLayoutMap?.get(v)??s.get(v);S!==void 0&&(m.delete(v),_i(S)?i.setBindGroup(_,this.unwrap(S)):i.setBindGroup(_,S))}});let w=new Set;if(h.usedVertexLayouts.forEach((v,_)=>{let S=p.vertexLayoutMap?.get(v),V=S?{buffer:S,offset:void 0,size:void 0}:a.get(v);!V||!V.buffer?w.add(v):$n(V.buffer)?i.setVertexBuffer(_,this.unwrap(V.buffer),V.offset,V.size):i.setVertexBuffer(_,V.buffer,V.offset,V.size)}),m.size>0)throw new Ws(m);if(w.size>0)throw new au(w)};r({setViewport(...h){i.setViewport(...h)},setScissorRect(...h){i.setScissorRect(...h)},setBlendConstant(...h){i.setBlendConstant(...h)},setStencilReference(...h){i.setStencilReference(...h)},beginOcclusionQuery(...h){i.beginOcclusionQuery(...h)},endOcclusionQuery(...h){i.endOcclusionQuery(...h)},executeBundles(...h){i.executeBundles(...h)},setPipeline(h){o=h},setIndexBuffer:(h,p,f,m)=>{$n(h)?i.setIndexBuffer(this.unwrap(h),p,f,m):i.setIndexBuffer(h,p,f,m)},setVertexBuffer(h,p,f,m){a.set(h,{buffer:p,offset:f,size:m})},setBindGroup(h,p){s.set(h,p)},draw(h,p,f,m){u(),i.draw(h,p,f,m)},drawIndexed(...h){u(),i.drawIndexed(...h)},drawIndirect(...h){u(),i.drawIndirect(...h)},drawIndexedIndirect(...h){u(),i.drawIndexedIndirect(...h)}}),i.end(),this.device.queue.submit([n.finish()])}flush(){console.warn("flush() has been deprecated, and has no effect.")}};async function Bw(e){let{adapter:t,device:r,unstable_names:n="strict",unstable_logOptions:i}=e??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let s=await navigator.gpu.requestAdapter(t);if(!s)throw new Error("Could not find a compatible GPU");let a=[];for(let u of r?.requiredFeatures??[]){if(!s.features.has(u))throw new Error(`Requested feature "${u}" is not supported by the adapter.`);a.push(u)}for(let u of r?.optionalFeatures??[])s.features.has(u)?a.push(u):console.warn(`Optional feature "${u}" is not supported by the adapter.`);let o=await s.requestDevice({...r,requiredFeatures:a});return new $l(o,n,!0,i??{},e?.shaderGenerator)}function Fw(e){let{device:t,unstable_names:r="strict",unstable_logOptions:n}=e??{};return new $l(t,r,!1,n??{},e?.shaderGenerator)}function jw(e,t){return new Rw(e,t)}var Rw=class{constructor(e,t=void 0){this.schema=e,this.defaultValue=t,this.slot=zi(t),this[ue]=this.slot}[l]=!0;[ue];resourceType="accessor";slot;get[F](){return new Proxy({[l]:!0,[ke]:this.#e(),[z]:e=>e.resolve(this),toString:()=>`accessor:${b(this)??"<unnamed>"}.$`},We)}#e(){let e=Ce(),t=Hi(e.unwrap(this.slot));if(Uh(t))return t[l].gpuImpl();let r=Ai(t);if(r)return r;e.pushMode(new Pn);try{let n=Yt(this.schema,t);return y(n,this.schema,"constant")}finally{e.popMode("normal")}}$name(e){return this.slot.$name(e),this}toString(){return`accessor:${b(this)??"<unnamed>"}`}get value(){if(et())return this[F];throw new Error("`tgpu.accessor` relies on GPU resources and cannot be accessed outside of a compute dispatch or draw call")}get $(){return this.value}[z](e){let t=this.#e();return y(e.resolve(t.value,t.dataType).value,t.dataType,t.origin)}};function Gw(e){return Dw(e)}function Lw([e,t]){return`${b(e)??"<unnamed>"}=${t}`}function Dw(e){if(Ce())throw new Error("Cannot create tgpu.derived objects at the resolution stage.");return{[l]:!0,resourceType:"derived","~compute":e,get[F](){let t=Ce();if(!t)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return Hi(t.unwrap(this))},get value(){return this[F]},get $(){return this.value},with(t,r){return Tl(this,[[t,r]])},toString(){return"derived"}}}function Tl(e,t){return{[l]:!0,resourceType:"derived","~compute"(){throw new Error("'~compute' should never be read on bound derived items.")},[ur]:{inner:e,pairs:t},get[F](){let r=Ce();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return Hi(r.unwrap(this))},get value(){return this[F]},get $(){return this.value},with(r,n){return Tl(e,[...t,[r,n]])},toString(){return`derived[${t.map(Lw).join(", ")}]`}}}var Nw={fn:O,bindGroupLayout:Zh,vertexLayout:Eo,slot:zi,init:Bw,initFromDevice:Fw,resolve:lw,resolveWithContext:As,privateVar:Ii,workgroupVar:To,const:Ms,"~unstable":{fn:O,fragmentFn:Xy,vertexFn:qp,computeFn:Ph,comptime:Ht,vertexLayout:Eo,namespace:rn,derived:Gw,slot:zi,accessor:jw,privateVar:Ii,workgroupVar:To,const:Ms,declare:Ly,rawCodeSnippet:Hy,simulate:dw}},_l=Nw,Ww=Ht(((e,t)=>t===void 0?r=>Mo(e,r):Mo(e,t))).$name("disarrayOf");function Mo(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Disarray schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>Yt(e,n?.[s]))};if(Object.setPrototypeOf(r,qw),r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create disarray schema with invalid element count: ${t}.`);return r.elementCount=t,r}var qw={[l]:!0,type:"disarray",toString(){return`disarrayOf(${this.elementType}, ${this.elementCount})`}};function Hw(e){let t=r=>Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Yt(i,r?.[n])]));return Object.setPrototypeOf(t,Yw),t.propTypes=e,t}var Yw={[l]:!0,type:"unstruct",$name(e){return G(this,e),this},toString(){return`unstruct:${b(this)??"<unnamed>"}`}};function Or(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if(ye(e)&&ye(t)||Ke(e)&&Ke(t)){let r=e.propTypes,n=t.propTypes,i=Object.keys(r),s=Object.keys(n);if(i.length!==s.length)return!1;for(let a=0;a<i.length;a++){let o=i[a],u=s[a];if(o!==u||!o||!u||!Or(r[o],n[u]))return!1}return!0}if(Ie(e)&&Ie(t)||Et(e)&&Et(t))return e.elementCount===t.elementCount&&Or(e.elementType,t.elementType);if(Xe(e)&&Xe(t))return e.addressSpace===t.addressSpace&&e.access===t.access&&Or(e.inner,t.inner);if(mi(e)&&mi(t))return Or(e.inner,t.inner);if(Ze(e)&&Ze(t)||Qe(e)&&Qe(t)){if(!Or(e.inner,t.inner)||e.attribs.length!==t.attribs.length)return!1;let r=s=>{let a=s;return`${a.type}(${(a.params??[]).join(",")})`},n=e.attribs.map(r),i=t.attribs.map(r);for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1}return!0}function wr(e,t){let r=e.prototype,n=_s[t][l].jsImpl;r[t]=function(i){return n(this,i)}}wr(dr,"add");wr(dr,"sub");wr(dr,"mul");wr(dr,"div");wr(Jr,"add");wr(Jr,"sub");wr(Jr,"mul");const Xw=Object.freeze(Object.defineProperty({__proto__:null,Void:se,align:Ep,alignmentOf:$p,arrayOf:_n,atomic:sh,bool:R,builtin:Fu,comparisonSampler:ba,deepEqual:Or,disarrayOf:Ww,f16:he,f32:g,float16:tp,float16x2:rp,float16x4:np,float32:ip,float32x2:sp,float32x3:ap,float32x4:op,formatToWGSLType:Mt,i32:B,interpolate:kp,invariant:Pp,isAlignAttrib:Gs,isAtomic:mi,isBuiltin:kt,isBuiltinAttrib:Ds,isData:Kr,isDecorated:Ze,isDisarray:Et,isInterpolateAttrib:Wl,isLocationAttrib:Zo,isLooseData:Zr,isLooseDecorated:Qe,isPackedData:Cu,isPtr:Xe,isSizeAttrib:Ls,isUnstruct:Ke,isWgslArray:Ie,isWgslData:Zt,isWgslStruct:ye,location:bi,mat2x2f:Ut,mat3x3f:Vt,mat4x4f:Y,matToArray:td,packedFormats:pa,ptrFn:Hs,ptrHandle:oc,ptrPrivate:nc,ptrStorage:sc,ptrUniform:ac,ptrWorkgroup:ic,ref:fc,sampler:va,sint16:qc,sint16x2:Hc,sint16x4:Yc,sint32:pp,sint32x2:dp,sint32x3:fp,sint32x4:mp,sint8:Ac,sint8x2:Cc,sint8x4:Oc,size:Mp,sizeOf:Sp,snorm16:Qc,snorm16x2:Jc,snorm16x4:ep,snorm8:Rc,snorm8x2:Gc,snorm8x4:Lc,struct:Oi,texture1d:Yu,texture2d:ga,texture2dArray:Zu,texture3d:Ju,textureCube:Ku,textureCubeArray:Qu,textureDepth2d:md,textureDepth2dArray:gd,textureDepthCube:wd,textureDepthCubeArray:xd,textureDepthMultisampled2d:yd,textureExternal:nh,textureMultisampled2d:Xu,textureStorage1d:eh,textureStorage2d:wa,textureStorage2dArray:th,textureStorage3d:rh,u16:$c,u32:$,uint16:Dc,uint16x2:Nc,uint16x4:Wc,uint32:up,uint32x2:hp,uint32x3:lp,uint32x4:cp,uint8:Pc,uint8x2:Uc,uint8x4:Vc,unorm10_10_10_2:yp,unorm16:Xc,unorm16x2:Zc,unorm16x4:Kc,unorm8:Bc,unorm8x2:Fc,unorm8x4:jc,unorm8x4_bgra:gp,unstruct:Hw,vec2b:fr,vec2f:N,vec2h:yt,vec2i:ie,vec2u:Me,vec3b:mr,vec3f:le,vec3h:gt,vec3i:Oe,vec3u:ae,vec4b:yr,vec4f:I,vec4h:wt,vec4i:de,vec4u:ve},Symbol.toStringTag,{value:"Module"}));var Zw=d({name:"discard",normalImpl:"`discard` relies on GPU resources and cannot be executed outside of a draw call",signature:{argTypes:[],returnType:se},codegenImpl:()=>"discard;"}),Dn=jn[l].jsImpl,Kw=Fi[l].jsImpl,Qw=Fi[l].gpuImpl,Jw=ji[l].jsImpl,ex=ji[l].gpuImpl,tx=Ri[l].jsImpl,rx=Ri[l].gpuImpl,nx=Gi[l].jsImpl,ix=Gi[l].gpuImpl,sx=Li[l].jsImpl,ax=Li[l].gpuImpl,ox=d({name:"translate4",normalImpl:(e,t)=>Dn(Kw(t),e),signature:{argTypes:[Y,le],returnType:Y},codegenImpl:(e,t)=>c`(${Qw(t)} * ${e})`}),ux=d({name:"scale4",normalImpl:(e,t)=>Dn(Jw(t),e),signature:{argTypes:[Y,le],returnType:Y},codegenImpl:(e,t)=>c`(${ex(t)} * ${e})`}),Ma={argTypes:[Y,g],returnType:Y},hx=d({name:"rotateX4",normalImpl:(e,t)=>Dn(tx(t),e),signature:Ma,codegenImpl:(e,t)=>c`(${rx(t)} * ${e})`}),lx=d({name:"rotateY4",normalImpl:(e,t)=>Dn(nx(t),e),signature:Ma,codegenImpl:(e,t)=>c`(${ix(t)} * ${e})`}),cx=d({name:"rotateZ4",normalImpl:(e,t)=>Dn(sx(t),e),signature:Ma,codegenImpl:(e,t)=>c`(${ax(t)} * ${e})`}),px=d({name:"workgroupBarrier",normalImpl:"workgroupBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:se},codegenImpl:()=>"workgroupBarrier()"}),dx=d({name:"storageBarrier",normalImpl:"storageBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:se},codegenImpl:()=>"storageBarrier()"}),fx=d({name:"textureBarrier",normalImpl:"textureBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:se},codegenImpl:()=>"textureBarrier()"}),Ct="Atomic operations are not supported outside of CODEGEN mode.",mx=d({name:"atomicLoad",normalImpl:Ct,signature:e=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Xt(e)}`);return{argTypes:[e],returnType:e.inner}},codegenImpl:e=>c`atomicLoad(&${e})`}),yx=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Xt(e)}`);return{argTypes:[e,e.inner.type==="u32"?$:B],returnType:se}},xr=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Xt(e)}`);let r=e.inner.type==="u32"?$:B;return{argTypes:[e,r],returnType:r}},gx=d({name:"atomicStore",normalImpl:Ct,signature:yx,codegenImpl:(e,t)=>c`atomicStore(&${e}, ${t})`}),wx=d({name:"atomicAdd",normalImpl:Ct,signature:xr,codegenImpl:(e,t)=>c`atomicAdd(&${e}, ${t})`}),xx=d({name:"atomicSub",normalImpl:Ct,signature:xr,codegenImpl:(e,t)=>c`atomicSub(&${e}, ${t})`}),vx=d({name:"atomicMax",normalImpl:Ct,signature:xr,codegenImpl:(e,t)=>c`atomicMax(&${e}, ${t})`}),bx=d({name:"atomicMin",normalImpl:Ct,signature:xr,codegenImpl:(e,t)=>c`atomicMin(&${e}, ${t})`}),$x=d({name:"atomicAnd",normalImpl:Ct,signature:xr,codegenImpl:(e,t)=>c`atomicAnd(&${e}, ${t})`}),Tx=d({name:"atomicOr",normalImpl:Ct,signature:xr,codegenImpl:(e,t)=>c`atomicOr(&${e}, ${t})`}),_x=d({name:"atomicXor",normalImpl:Ct,signature:xr,codegenImpl:(e,t)=>c`atomicXor(&${e}, ${t})`}),Ot="Derivative builtins are not allowed on the CPU",zx=d({name:"dpdx",normalImpl:Ot,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdx(${e})`}),Ix=d({name:"dpdxCoarse",normalImpl:Ot,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxCoarse(${e})`}),Sx=d({name:"dpdxFine",normalImpl:Ot,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxFine(${e})`}),Ex=d({name:"dpdy",normalImpl:Ot,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdy(${e})`}),Mx=d({name:"dpdyCoarse",normalImpl:Ot,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyCoarse(${e})`}),kx=d({name:"dpdyFine",normalImpl:Ot,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyFine(${e})`}),Px=d({name:"fwidth",normalImpl:Ot,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidth(${e})`}),Ux=d({name:"fwidthCoarse",normalImpl:Ot,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthCoarse(${e})`}),Vx=d({name:"fwidthFine",normalImpl:Ot,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthFine(${e})`}),ko=e=>Xe(e)&&Ie(e.inner)?e.inner.elementCount:0,Ax=d({name:"arrayLength",signature:e=>{let t=Xe(e)?e:Hs(e);return{argTypes:[t],returnType:ko(t)>0?Un:$}},normalImpl:e=>gu(e)?e.$.length:e.length,codegenImpl(e){let t=ko(e.dataType);return t>0?String(t):c`arrayLength(${e})`}});function Cx(e,t,r,n,i){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var Ox=d({name:"textureSample",normalImpl:Cx,codegenImpl:(...e)=>c`textureSample(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?g:I}}});function Bx(e,t,r,n,i,s){throw new Error("Texture sampling with bias relies on GPU resources and cannot be executed outside of a draw call")}var Fx=d({name:"textureSampleBias",normalImpl:Bx,codegenImpl:(...e)=>c`textureSampleBias(${e})`,signature:(...e)=>({argTypes:e,returnType:I})});function jx(e,t,r,n,i,s){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var Rx=d({name:"textureSampleLevel",normalImpl:jx,codegenImpl:(...e)=>c`textureSampleLevel(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?g:I}}});function Gx(e,t,r){throw new Error("`textureLoad` relies on GPU resources and cannot be executed outside of a draw call")}var mn=d({name:"textureLoad",normalImpl:Gx,codegenImpl:(...e)=>c`textureLoad(${e})`,signature:(...e)=>{let t=e[0];if(ih(t)){let i=t.type.startsWith("texture_depth"),s=t.sampleType;return{argTypes:e,returnType:i?g:s.type==="f32"?I:s.type==="u32"?ve:de}}let r=t.format,n=Ln(r).vectorType;return{argTypes:e,returnType:n}}});function Lx(e,t,r,n){throw new Error("`textureStore` relies on GPU resources and cannot be executed outside of a draw call")}var Rs=d({name:"textureStore",normalImpl:Lx,codegenImpl:(...e)=>c`textureStore(${e})`,signature:(...e)=>({argTypes:e,returnType:se})});function Dx(e,t){throw new Error("`textureDimensions` relies on GPU resources and cannot be executed outside of a draw call")}var Nx=d({name:"textureDimensions",normalImpl:Dx,codegenImpl:(...e)=>c`textureDimensions(${e})`,signature:(...e)=>{let t=e[0].dimension;return t==="1d"?{argTypes:e,returnType:$}:t==="3d"?{argTypes:e,returnType:ae}:{argTypes:e,returnType:Me}}});function Wx(e,t,r,n,i,s){throw new Error("Texture comparison sampling relies on GPU resources and cannot be executed outside of a draw call")}var qx=d({name:"textureSampleCompare",normalImpl:Wx,codegenImpl:(...e)=>c`textureSampleCompare(${e})`,signature:(...e)=>({argTypes:e,returnType:g})});function Hx(e,t,r){throw new Error("Texture sampling with base clamp to edge is not supported outside of GPU mode.")}var Yx=d({name:"textureSampleBaseClampToEdge",normalImpl:Hx,codegenImpl:(...e)=>c`textureSampleBaseClampToEdge(${e})`,signature:(...e)=>({argTypes:e,returnType:I})}),ce="Subgroup operations can only be used in the GPU context.",Xx=d({name:"subgroupAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupAdd(${e})`}),Zx=d({name:"subgroupExclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupExclusiveAdd(${e})`}),Kx=d({name:"subgroupInclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupInclusiveAdd(${e})`}),Qx=d({name:"subgroupAll",signature:{argTypes:[R],returnType:R},normalImpl:ce,codegenImpl:e=>c`subgroupAll(${e})`}),Jx=d({name:"subgroupAnd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupAnd(${e})`}),ev=d({name:"subgroupAny",signature:{argTypes:[R],returnType:R},normalImpl:ce,codegenImpl:e=>c`subgroupAny(${e})`}),tv=d({name:"subgroupBallot",signature:{argTypes:[R],returnType:ve},normalImpl:ce,codegenImpl:e=>c`subgroupBallot(${e})`}),rv=d({name:"subgroupBroadcast",signature:(...e)=>{let t=ge([e[1]],[B,$]);if(!t)throw new Error(`subgroupBroadcast's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ce,codegenImpl:(e,t)=>c`subgroupBroadcast(${e}, ${t})`}),nv=d({name:"subgroupBroadcastFirst",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupBroadcastFirst(${e})`}),iv=d({name:"subgroupElect",signature:{argTypes:[],returnType:R},normalImpl:ce,codegenImpl:()=>c`subgroupElect()`}),sv=d({name:"subgroupMax",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupMax(${e})`}),av=d({name:"subgroupMin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupMin(${e})`}),ov=d({name:"subgroupMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupMul(${e})`}),uv=d({name:"subgroupExclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupExclusiveMul(${e})`}),hv=d({name:"subgroupInclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupInclusiveMul(${e})`}),lv=d({name:"subgroupOr",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupOr(${e})`}),cv=d({name:"subgroupShuffle",signature:(...e)=>{let t=ge([e[1]],[B,$]);if(!t)throw new Error(`subgroupShuffle's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ce,codegenImpl:(e,t)=>c`subgroupShuffle(${e}, ${t})`}),pv=d({name:"subgroupShuffleDown",signature:(...e)=>{let t=ge([e[1]],[$]);if(!t)throw new Error(`subgroupShuffleDown's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ce,codegenImpl:(e,t)=>c`subgroupShuffleDown(${e}, ${t})`}),dv=d({name:"subgroupShuffleUp",signature:(...e)=>{let t=ge([e[1]],[$]);if(!t)throw new Error(`subgroupShuffleUp's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ce,codegenImpl:(e,t)=>c`subgroupShuffleUp(${e}, ${t})`}),fv=d({name:"subgroupShuffleXor",signature:(...e)=>{let t=ge([e[1]],[$]);if(!t)throw new Error(`subgroupShuffleXor's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ce,codegenImpl:(e,t)=>c`subgroupShuffleXor(${e}, ${t})`}),mv=d({name:"subgroupXor",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ce,codegenImpl:e=>c`subgroupXor(${e})`}),yv=Ht(e=>{let t=Ce();if(!t)throw new Error("Functions using `extensionEnabled` cannot be called directly. Either generate WGSL from them, or use tgpu['~unstable'].simulate(...)");if(typeof e!="string"||!Ia.includes(e))throw new Error(`extensionEnabled has to be called with a string literal representing a valid WGSL extension name. Got: '${e}'`);return(t.enableExtensions??[]).includes(e)});const gv=Object.freeze(Object.defineProperty({__proto__:null,abs:Mf,acos:Pf,acosh:Vf,add:ma,all:by,allEq:Sh,and:vy,any:$y,arrayLength:Ax,asin:Cf,asinh:Bf,atan:zs,atan2:Lf,atanh:Rf,atomicAdd:wx,atomicAnd:$x,atomicLoad:mx,atomicMax:vx,atomicMin:bx,atomicOr:Tx,atomicStore:gx,atomicSub:xx,atomicXor:_x,bitcastU32toF32:_h,bitcastU32toI32:zh,ceil:xh,clamp:dn,cos:sr,cosh:Hf,countLeadingZeros:Yf,countOneBits:Xf,countTrailingZeros:Zf,cross:Kf,degrees:Jf,determinant:em,discard:Zw,distance:rm,div:ya,dot:vh,dot4I8Packed:im,dot4U8Packed:nm,dpdx:zx,dpdxCoarse:Ix,dpdxFine:Sx,dpdy:Ex,dpdyCoarse:Mx,dpdyFine:kx,eq:py,exp:am,exp2:um,extensionEnabled:yv,extractBits:hm,faceForward:lm,firstLeadingBit:cm,firstTrailingBit:pm,floor:Is,fma:mm,fract:gm,frexp:xm,fwidth:Px,fwidthCoarse:Ux,fwidthFine:Vx,ge:gy,gt:yy,identity2:Lu,identity3:Du,identity4:Nu,insertBits:vm,inverseSqrt:$m,isCloseTo:Ty,ldexp:Tm,le:my,length:bh,log:Im,log2:Em,lt:fy,max:$h,min:Pm,mix:ai,mod:dd,modf:Am,mul:jn,ne:dy,neg:Hu,normalize:Cm,not:wy,or:xy,pack2x16float:hy,pack4x8unorm:cy,pow:Th,quantizeToF16:Bm,radians:jm,reflect:Rm,refract:Gm,reverseBits:Lm,rotateX4:hx,rotateY4:lx,rotateZ4:cx,rotationX4:Ri,rotationY4:Gi,rotationZ4:Li,round:Nm,saturate:qm,scale4:ux,scaling4:ji,select:zy,sign:Ym,sin:ar,sinh:Km,smoothstep:Jm,sqrt:Ss,step:ry,storageBarrier:dx,sub:en,subgroupAdd:Xx,subgroupAll:Qx,subgroupAnd:Jx,subgroupAny:ev,subgroupBallot:tv,subgroupBroadcast:rv,subgroupBroadcastFirst:nv,subgroupElect:iv,subgroupExclusiveAdd:Zx,subgroupExclusiveMul:uv,subgroupInclusiveAdd:Kx,subgroupInclusiveMul:hv,subgroupMax:sv,subgroupMin:av,subgroupMul:ov,subgroupOr:lv,subgroupShuffle:cv,subgroupShuffleDown:pv,subgroupShuffleUp:dv,subgroupShuffleXor:fv,subgroupXor:mv,tan:iy,tanh:ay,textureBarrier:fx,textureDimensions:Nx,textureLoad:mn,textureSample:Ox,textureSampleBaseClampToEdge:Yx,textureSampleBias:Fx,textureSampleCompare:qx,textureSampleLevel:Rx,textureStore:Rs,translate4:ox,translation4:Fi,transpose:oy,trunc:uy,unpack2x16float:Ih,unpack4x8unorm:ly,workgroupBarrier:px},Symbol.toStringTag,{value:"Module"})),wv={kind:"rectilinear"};function xv(e){return e.kind==="rectilinear"&&e.mode==="manual"}function Po(e,t){if(e&&t)throw new Error("PTZ and Pane modes are mutually exclusive. Use only one.")}function vv(e){return e.kind==="4pane"?"4pane":e.orientation==="vertical"?"2pane-vertical":"2pane-horizontal"}const bv={"2pane-horizontal":[{pan:-45,tilt:0,zoom:1},{pan:45,tilt:0,zoom:1}],"2pane-vertical":[{pan:0,tilt:30,zoom:1},{pan:0,tilt:-30,zoom:1}],"4pane":[{pan:0,tilt:0,zoom:1},{pan:90,tilt:0,zoom:1},{pan:180,tilt:0,zoom:1},{pan:-90,tilt:0,zoom:1}]},zl=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Oi({fx:g,fy:g,cx:g,cy:g,alpha:g,k1:g,k2:g,k3:g,k4:g,newFx:g,newFy:g,newCx:g,newCy:g,outputWidth:g,outputHeight:g,inputWidth:g,inputHeight:g,projection:g,panRad:g,tiltRad:g,zoomFactor:g,_pad1:g}),"FisheyeUniforms"),bt=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(_l.bindGroupLayout({inputTexture:{texture:ga()},outputTexture:{storageTexture:wa("rgba8unorm")},uniforms:{uniform:zl}}),"fisheyeLayout");class $v{config;root=null;uniformBuffer=null;inputTexture=null;outputTexture=null;bindGroup=null;pipeline=null;readbackBuffers=null;readbackIndex=0;readbackHasData=[!1,!1];readbackBytesPerRow=0;readbackActualBytesPerRow=0;pixelBuffer=null;inputTextureSize=[0,0];outputTextureSize=[0,0];uniformInputWidth=0;uniformInputHeight=0;cachedNewCameraMatrix=null;constructor(t={}){this.config=this.applyDefaults(t)}applyDefaults(t){if("D"in t&&"size"in t){const K=t;return Po(K.ptz,K.pane),{K:K.K,D:K.D,size:K.size,balance:Math.max(0,Math.min(1,K.balance)),fovScale:K.fovScale,projection:K.projection,ptz:K.ptz,pane:K.pane}}const r=t,{fx:n,fy:i,cx:s,cy:a,alpha:o,k1:u,k2:h,k3:p,k4:f,width:m,height:w,balance:v,fovScale:_,projection:S,ptz:V,pane:Z}=r;return Po(V,Z),{K:n!==void 0&&i!==void 0?{fx:n,fy:i,cx:s,cy:a,alpha:o}:void 0,D:{k1:u??0,k2:h??0,k3:p??0,k4:f??0},size:{width:m??300,height:w??150},balance:Math.max(0,Math.min(1,v??0)),fovScale:_??1,projection:S??wv,ptz:V,pane:Z}}undistortPointNormalized(t,r,n,i,s,a){const o=Math.sqrt(t*t+r*r),u=Math.min(Math.max(-Math.PI/2,o),Math.PI/2);if(Math.abs(u)<1e-8)return[t,r];let h=u;for(let f=0;f<20;f++){const m=h*h,w=m*m,v=w*m,_=w*w,S=h*(1+n*m+i*w+s*v+a*_)-u,V=1+3*n*m+5*i*w+7*s*v+9*a*_,Z=S/V;if(h=h-Z,Math.abs(Z)<1e-10)break}const p=Math.tan(h)/u;return[t*p,r*p]}undistortPixelToNormalized(t,r,n,i,s,a){const o=(t-s)/n,u=(r-a)/i;return this.undistortPointNormalized(o,u,this.config.D.k1,this.config.D.k2,this.config.D.k3,this.config.D.k4)}computeNewCameraMatrix(t,r){const n=t,i=r,s=this.config.K,a=s?.fx??t,o=s?.fy??t,u=s?.cx??t/2,h=s?.cy??r/2,p=this.config.balance,f=this.config.fovScale,m=[[n/2,0],[n,i/2],[n/2,i],[0,i/2]].map(([rt,nt])=>this.undistortPixelToNormalized(rt,nt,a,o,u,h));let w=0,v=0;for(const[rt,nt]of m)w+=rt,v+=nt;w/=m.length,v/=m.length;const _=a/o,S=[w,v*_],V=m.map(([rt,nt])=>[rt,nt*_]);let Z=Number.MAX_VALUE,K=-Number.MAX_VALUE,Be=Number.MAX_VALUE,$e=-Number.MAX_VALUE;for(const[rt,nt]of V)Z=Math.min(Z,rt),K=Math.max(K,rt),Be=Math.min(Be,nt),$e=Math.max($e,nt);const tt=n*.5/(S[0]-Z),xt=n*.5/(K-S[0]),vt=i*.5*_/(S[1]-Be),Kt=i*.5*_/($e-S[1]),es=Math.min(tt,xt,vt,Kt),ts=Math.max(tt,xt,vt,Kt);let Qt=p*es+(1-p)*ts;f>0&&(Qt*=1/f);const rs=-S[0]*Qt+n*.5,ns=-S[1]*Qt/_+i*.5,Wn=this.config.size.width/n,qn=this.config.size.height/i;return{newFx:Qt*Wn,newFy:Qt/_*qn,newCx:rs*Wn,newCy:ns*qn}}async initialize(){this.root||(this.root=await _l.init(),this.uniformBuffer=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(this.root.createBuffer(zl,this.getUniformData()).$usage("uniform"),"uniformBuffer"),this.pipeline=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(this.root["~unstable"].createGuardedComputePipeline((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=((r,n)=>{"use gpu";const i=bt.$.uniforms,s=i.outputWidth,a=i.outputHeight,o=i.inputWidth,u=i.inputHeight,h=ie(r,n),p=g(h.x),f=g(h.y);if(p>=s||f>=a)return;const m=i.projection>1.5&&i.projection<2.5;let w=g(0),v=g(0),_=!1;if(m)w=p/s*o,v=f/a*u,_=!0;else{const rt=i.newFx*i.zoomFactor,nt=i.newFy*i.zoomFactor;let it=(p-i.newCx)/rt,st=(f-i.newCy)/nt,Bt=!0;if(i.projection>.5&&i.projection<1.5){const Xn=(p/s-.5)*Math.PI*2,sn=(f/a-.5)*Math.PI,an=sr(sn),vr=sr(Xn)*an;Bt=vr>.001,Bt?(it=ar(Xn)*an/vr,st=ar(sn)/vr):(it=0,st=0)}if(i.projection>2.5){const Xn=s/(Math.PI*2),sn=(p/s-.5)*Math.PI*2,an=zs((f-a*.5)/Xn),vr=sr(an),Gl=ar(sn)*vr,Ll=ar(an),as=sr(sn)*vr;Bt=as>.001,Bt?(it=Gl/as,st=Ll/as):(it=0,st=0)}let Ft=it,jt=st,Pe=g(1);const is=Ss(Ft*Ft+jt*jt+Pe*Pe);Ft=Ft/is,jt=jt/is,Pe=Pe/is;const Fa=sr(i.tiltRad),ja=ar(i.tiltRad),Ul=jt*Fa-Pe*ja,Vl=jt*ja+Pe*Fa;jt=Ul,Pe=Vl;const Ra=sr(i.panRad),Ga=ar(i.panRad),Al=Ft*Ra+Pe*Ga,Cl=-Ft*Ga+Pe*Ra;Ft=Al,Pe=Cl,Bt=Bt&&Pe>.001,Bt?(it=Ft/Pe,st=jt/Pe):(it=0,st=0);const La=Ss(it*it+st*st),ss=zs(La),Hn=ss*ss,Yn=Hn*Hn,Ol=Yn*Hn,Bl=Yn*Yn,Fl=ss*(1+i.k1*Hn+i.k2*Yn+i.k3*Ol+i.k4*Bl),jl=$h(La,1e-8),Da=Fl/jl,Rl=it*Da,Na=st*Da;w=i.fx*(Rl+i.alpha*Na)+i.cx,v=i.fy*Na+i.cy,_=Bt&&w>=0&&w<=o-1&&v>=0&&v<=u-1}if(!_){Rs(bt.$.outputTexture,h,I(0,0,0,1));return}const S=Is(w),V=Is(v),Z=w-S,K=v-V,Be=o-1,$e=u-1,tt=B(dn(S,0,Be)),xt=B(dn(V,0,$e)),vt=B(dn(S+1,0,Be)),Kt=B(dn(V+1,0,$e)),es=mn(bt.$.inputTexture,ie(tt,xt),0),ts=mn(bt.$.inputTexture,ie(vt,xt),0),Qt=mn(bt.$.inputTexture,ie(tt,Kt),0),rs=mn(bt.$.inputTexture,ie(vt,Kt),0),ns=ai(es,ts,Z),Wn=ai(Qt,rs,Z),qn=ai(ns,Wn,K);Rs(bt.$.outputTexture,h,qn)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"x"},{type:"i",name:"y"}],body:[0,[[13,"p",[7,[7,"fisheyeLayout","$"],"uniforms"]],[13,"outputW",[7,"p","outputWidth"]],[13,"outputH",[7,"p","outputHeight"]],[13,"inputW",[7,"p","inputWidth"]],[13,"inputH",[7,"p","inputHeight"]],[13,"coord",[6,[7,"d","vec2i"],["x","y"]]],[13,"coordXf",[6,[7,"d","f32"],[[7,"coord","x"]]]],[13,"coordYf",[6,[7,"d","f32"],[[7,"coord","y"]]]],[11,[3,[1,"coordXf",">=","outputW"],"||",[1,"coordYf",">=","outputH"]],[10]],[13,"isOriginal",[3,[1,[7,"p","projection"],">",[5,"1.5"]],"&&",[1,[7,"p","projection"],"<",[5,"2.5"]]]],[12,"u",[6,[7,"d","f32"],[[5,"0"]]]],[12,"v",[6,[7,"d","f32"],[[5,"0"]]]],[12,"inBounds",!1],[11,"isOriginal",[0,[[2,"u","=",[1,[1,"coordXf","/","outputW"],"*","inputW"]],[2,"v","=",[1,[1,"coordYf","/","outputH"],"*","inputH"]],[2,"inBounds","=",!0]]],[0,[[13,"zoomedNewFx",[1,[7,"p","newFx"],"*",[7,"p","zoomFactor"]]],[13,"zoomedNewFy",[1,[7,"p","newFy"],"*",[7,"p","zoomFactor"]]],[12,"normX",[1,[1,"coordXf","-",[7,"p","newCx"]],"/","zoomedNewFx"]],[12,"normY",[1,[1,"coordYf","-",[7,"p","newCy"]],"/","zoomedNewFy"]],[12,"validProjection",!0],[13,"isEquirect",[3,[1,[7,"p","projection"],">",[5,"0.5"]],"&&",[1,[7,"p","projection"],"<",[5,"1.5"]]]],[11,"isEquirect",[0,[[13,"lon",[1,[1,[1,[1,"coordXf","/","outputW"],"-",[5,"0.5"]],"*",[7,"Math","PI"]],"*",[5,"2"]]],[13,"lat",[1,[1,[1,"coordYf","/","outputH"],"-",[5,"0.5"]],"*",[7,"Math","PI"]]],[13,"cosLat",[6,[7,"std","cos"],["lat"]]],[13,"dirZ2",[1,[6,[7,"std","cos"],["lon"]],"*","cosLat"]],[2,"validProjection","=",[1,"dirZ2",">",[5,"0.001"]]],[11,"validProjection",[0,[[2,"normX","=",[1,[1,[6,[7,"std","sin"],["lon"]],"*","cosLat"],"/","dirZ2"]],[2,"normY","=",[1,[6,[7,"std","sin"],["lat"]],"/","dirZ2"]]]],[0,[[2,"normX","=",[5,"0"]],[2,"normY","=",[5,"0"]]]]]]]],[13,"isCylindrical",[1,[7,"p","projection"],">",[5,"2.5"]]],[11,"isCylindrical",[0,[[13,"fCyl",[1,"outputW","/",[1,[7,"Math","PI"],"*",[5,"2"]]]],[13,"lon",[1,[1,[1,[1,"coordXf","/","outputW"],"-",[5,"0.5"]],"*",[7,"Math","PI"]],"*",[5,"2"]]],[13,"lat",[6,[7,"std","atan"],[[1,[1,"coordYf","-",[1,"outputH","*",[5,"0.5"]]],"/","fCyl"]]]],[13,"cosLat",[6,[7,"std","cos"],["lat"]]],[13,"dirX2",[1,[6,[7,"std","sin"],["lon"]],"*","cosLat"]],[13,"dirY2",[6,[7,"std","sin"],["lat"]]],[13,"dirZ2",[1,[6,[7,"std","cos"],["lon"]],"*","cosLat"]],[2,"validProjection","=",[1,"dirZ2",">",[5,"0.001"]]],[11,"validProjection",[0,[[2,"normX","=",[1,"dirX2","/","dirZ2"]],[2,"normY","=",[1,"dirY2","/","dirZ2"]]]],[0,[[2,"normX","=",[5,"0"]],[2,"normY","=",[5,"0"]]]]]]]],[12,"dirX","normX"],[12,"dirY","normY"],[12,"dirZ",[6,[7,"d","f32"],[[5,"1"]]]],[13,"dirLen",[6,[7,"std","sqrt"],[[1,[1,[1,"dirX","*","dirX"],"+",[1,"dirY","*","dirY"]],"+",[1,"dirZ","*","dirZ"]]]]],[2,"dirX","=",[1,"dirX","/","dirLen"]],[2,"dirY","=",[1,"dirY","/","dirLen"]],[2,"dirZ","=",[1,"dirZ","/","dirLen"]],[13,"cosTilt",[6,[7,"std","cos"],[[7,"p","tiltRad"]]]],[13,"sinTilt",[6,[7,"std","sin"],[[7,"p","tiltRad"]]]],[13,"tiltedY",[1,[1,"dirY","*","cosTilt"],"-",[1,"dirZ","*","sinTilt"]]],[13,"tiltedZ",[1,[1,"dirY","*","sinTilt"],"+",[1,"dirZ","*","cosTilt"]]],[2,"dirY","=","tiltedY"],[2,"dirZ","=","tiltedZ"],[13,"cosPan",[6,[7,"std","cos"],[[7,"p","panRad"]]]],[13,"sinPan",[6,[7,"std","sin"],[[7,"p","panRad"]]]],[13,"pannedX",[1,[1,"dirX","*","cosPan"],"+",[1,"dirZ","*","sinPan"]]],[13,"pannedZ",[1,[1,[4,"-","dirX"],"*","sinPan"],"+",[1,"dirZ","*","cosPan"]]],[2,"dirX","=","pannedX"],[2,"dirZ","=","pannedZ"],[2,"validProjection","=",[3,"validProjection","&&",[1,"dirZ",">",[5,"0.001"]]]],[11,"validProjection",[0,[[2,"normX","=",[1,"dirX","/","dirZ"]],[2,"normY","=",[1,"dirY","/","dirZ"]]]],[0,[[2,"normX","=",[5,"0"]],[2,"normY","=",[5,"0"]]]]],[13,"r",[6,[7,"std","sqrt"],[[1,[1,"normX","*","normX"],"+",[1,"normY","*","normY"]]]]],[13,"theta",[6,[7,"std","atan"],["r"]]],[13,"theta2",[1,"theta","*","theta"]],[13,"theta4",[1,"theta2","*","theta2"]],[13,"theta6",[1,"theta4","*","theta2"]],[13,"theta8",[1,"theta4","*","theta4"]],[13,"thetaD",[1,"theta","*",[1,[1,[1,[1,[5,"1"],"+",[1,[7,"p","k1"],"*","theta2"]],"+",[1,[7,"p","k2"],"*","theta4"]],"+",[1,[7,"p","k3"],"*","theta6"]],"+",[1,[7,"p","k4"],"*","theta8"]]]],[13,"safeR",[6,[7,"std","max"],["r",[5,"1e-8"]]]],[13,"scale",[1,"thetaD","/","safeR"]],[13,"distortedX",[1,"normX","*","scale"]],[13,"distortedY",[1,"normY","*","scale"]],[2,"u","=",[1,[1,[7,"p","fx"],"*",[1,"distortedX","+",[1,[7,"p","alpha"],"*","distortedY"]]],"+",[7,"p","cx"]]],[2,"v","=",[1,[1,[7,"p","fy"],"*","distortedY"],"+",[7,"p","cy"]]],[2,"inBounds","=",[3,[3,[3,[3,"validProjection","&&",[1,"u",">=",[5,"0"]]],"&&",[1,"u","<=",[1,"inputW","-",[5,"1"]]]],"&&",[1,"v",">=",[5,"0"]]],"&&",[1,"v","<=",[1,"inputH","-",[5,"1"]]]]]]]],[11,[4,"!","inBounds"],[0,[[6,[7,"std","textureStore"],[[7,[7,"fisheyeLayout","$"],"outputTexture"],"coord",[6,[7,"d","vec4f"],[[5,"0"],[5,"0"],[5,"0"],[5,"1"]]]]],[10]]]],[13,"x0",[6,[7,"std","floor"],["u"]]],[13,"y0",[6,[7,"std","floor"],["v"]]],[13,"fx",[1,"u","-","x0"]],[13,"fy",[1,"v","-","y0"]],[13,"maxX",[1,"inputW","-",[5,"1"]]],[13,"maxY",[1,"inputH","-",[5,"1"]]],[13,"ix0",[6,[7,"d","i32"],[[6,[7,"std","clamp"],["x0",[5,"0"],"maxX"]]]]],[13,"iy0",[6,[7,"d","i32"],[[6,[7,"std","clamp"],["y0",[5,"0"],"maxY"]]]]],[13,"ix1",[6,[7,"d","i32"],[[6,[7,"std","clamp"],[[1,"x0","+",[5,"1"]],[5,"0"],"maxX"]]]]],[13,"iy1",[6,[7,"d","i32"],[[6,[7,"std","clamp"],[[1,"y0","+",[5,"1"]],[5,"0"],"maxY"]]]]],[13,"c00",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix0","iy0"]],[5,"0"]]]],[13,"c10",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix1","iy0"]],[5,"0"]]]],[13,"c01",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix0","iy1"]],[5,"0"]]]],[13,"c11",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix1","iy1"]],[5,"0"]]]],[13,"c0",[6,[7,"std","mix"],["c00","c10","fx"]]],[13,"c1",[6,[7,"std","mix"],["c01","c11","fx"]]],[13,"color",[6,[7,"std","mix"],["c0","c1","fy"]]],[6,[7,"std","textureStore"],[[7,[7,"fisheyeLayout","$"],"outputTexture"],"coord","color"]]]],externalNames:["fisheyeLayout","d","Math","std"]},externals:()=>({fisheyeLayout:bt,d:Xw,Math,std:gv})})&&t.f)({})),"pipeline"))}getNewCameraMatrixForUniform(t,r){const{projection:n,size:i}=this.config;return xv(n)?{newFx:n.newFx*(i.width/t),newFy:n.newFy*(i.height/r),newCx:n.newCx??i.width/2,newCy:n.newCy??i.height/2}:((!this.cachedNewCameraMatrix||this.uniformInputWidth!==t||this.uniformInputHeight!==r)&&(this.cachedNewCameraMatrix=this.computeNewCameraMatrix(t,r)),this.cachedNewCameraMatrix)}getProjectionNumericValue(t){return{rectilinear:0,equirectangular:1,original:2,cylindrical:3}[t]}getUniformData(t){const{K:r,D:n,size:i,projection:s,ptz:a}=this.config,o=this.uniformInputWidth||i.width,u=this.uniformInputHeight||i.height,h=r?.fx??o,p=r?.fy??o,f=r?.cx??o/2,m=r?.cy??u/2,w=r?.alpha??0,v=this.getNewCameraMatrixForUniform(o,u),_=this.getProjectionNumericValue(s.kind),S=t??a,V=S?.pan??0,Z=S?.tilt??0,K=S?.zoom??1,Be=V*Math.PI/180,$e=Z*Math.PI/180;return{fx:h,fy:p,cx:f,cy:m,alpha:w,k1:n.k1,k2:n.k2,k3:n.k3,k4:n.k4,newFx:v.newFx,newFy:v.newFy,newCx:v.newCx,newCy:v.newCy,outputWidth:i.width,outputHeight:i.height,inputWidth:o,inputHeight:u,projection:_,panRad:Be,tiltRad:$e,zoomFactor:K,_pad1:0}}updateUniforms(){this.uniformBuffer&&this.uniformBuffer.write(this.getUniformData())}async readbackToVideoFrame(t,r,n){const i=this.readbackBuffers;if(!i)throw new Error("Readback buffer not initialized");const s=this.readbackIndex,a=1-s,o=i[s],u=i[a];if(!o||!u)throw new Error("Readback buffer not initialized");const h=t.createCommandEncoder();h.copyTextureToBuffer({texture:r},{buffer:o,bytesPerRow:this.readbackBytesPerRow},[this.config.size.width,this.config.size.height]),t.queue.submit([h.finish()]),await t.queue.onSubmittedWorkDone(),this.readbackHasData[s]=!0,this.readbackIndex=a;const p=o;await p.mapAsync(GPUMapMode.READ);const f=p.getMappedRange(),m=this.pixelBuffer??new Uint8Array(this.config.size.width*this.config.size.height*4),w=new Uint8Array(f);for(let v=0;v<this.config.size.height;v++){const _=v*this.readbackBytesPerRow,S=v*this.readbackActualBytesPerRow;m.set(w.subarray(_,_+this.readbackActualBytesPerRow),S)}return p.unmap(),new VideoFrame(m,{format:"RGBA",codedWidth:this.config.size.width,codedHeight:this.config.size.height,timestamp:n})}createInputTexture(t,r,n){const i=[r,n];return t["~unstable"].createTexture({size:i,format:"rgba8unorm"}).$usage("sampled","render")}createOutputTexture(t,r,n){const i=[r,n];return t["~unstable"].createTexture({size:i,format:"rgba8unorm"}).$usage("storage")}calculateBytesPerRow(t){const r=t*4;return Math.ceil(r/256)*256}createReadbackBuffer(t,r,n){const i=this.calculateBytesPerRow(r)*n;return t.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}async undistortSinglePass(t,r){if(!this.root||!this.uniformBuffer)throw new Error("GPU resources not initialized");const n=this.root,i=n.device;(!this.inputTexture||this.inputTextureSize[0]!==t.displayWidth||this.inputTextureSize[1]!==t.displayHeight)&&(this.inputTexture?.destroy(),this.inputTexture=this.createInputTexture(n,t.displayWidth,t.displayHeight),this.inputTextureSize=[t.displayWidth,t.displayHeight],this.bindGroup=null),(!this.outputTexture||this.outputTextureSize[0]!==this.config.size.width||this.outputTextureSize[1]!==this.config.size.height)&&(this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.outputTexture=this.createOutputTexture(n,this.config.size.width,this.config.size.height),this.readbackBytesPerRow=this.calculateBytesPerRow(this.config.size.width),this.readbackActualBytesPerRow=this.config.size.width*4,this.pixelBuffer=new Uint8Array(this.config.size.width*this.config.size.height*4),this.readbackBuffers=[this.createReadbackBuffer(i,this.config.size.width,this.config.size.height),this.createReadbackBuffer(i,this.config.size.width,this.config.size.height)],this.readbackIndex=0,this.readbackHasData=[!1,!1],this.outputTextureSize=[this.config.size.width,this.config.size.height],this.bindGroup=null);const s=this.inputTexture,a=this.outputTexture;if(!s||!a)throw new Error("Textures not initialized");s.write(t),(this.uniformInputWidth!==t.displayWidth||this.uniformInputHeight!==t.displayHeight)&&(this.uniformInputWidth=t.displayWidth,this.uniformInputHeight=t.displayHeight,this.cachedNewCameraMatrix=null),this.uniformBuffer.write(this.getUniformData(r)),this.bindGroup||(this.bindGroup=n.createBindGroup(bt,{inputTexture:s,outputTexture:a,uniforms:this.uniformBuffer}));const o=this.bindGroup;if(!this.pipeline||!a)throw new Error("Compute pipeline or output texture not initialized");this.pipeline.with(o).dispatchThreads(this.config.size.width,this.config.size.height);const u=n.unwrap(a);return this.readbackToVideoFrame(i,u,t.timestamp)}async undistort(t){if(await this.initialize(),this.config.pane){const r=vv(this.config.pane),n=bv[r],i=[];for(const s of n){const a=await this.undistortSinglePass(t,s);i.push(a)}return i}return this.undistortSinglePass(t)}updateConfig(t){const r=this.config.size.width,n=this.config.size.height;this.config=this.applyDefaults({...this.config,...t}),this.cachedNewCameraMatrix=null,this.updateUniforms(),(this.config.size.width!==r||this.config.size.height!==n)&&(this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.outputTexture=null,this.readbackBuffers=null,this.readbackIndex=0,this.readbackHasData=[!1,!1],this.outputTextureSize=[0,0],this.readbackBytesPerRow=0,this.readbackActualBytesPerRow=0,this.pixelBuffer=null)}destroy(){this.inputTexture?.destroy(),this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.root?.destroy(),this.inputTexture=null,this.outputTexture=null,this.readbackBuffers=null,this.readbackIndex=0,this.readbackHasData=[!1,!1],this.uniformBuffer=null,this.root=null,this.bindGroup=null,this.pipeline=null,this.readbackBytesPerRow=0,this.readbackActualBytesPerRow=0,this.pixelBuffer=null,this.inputTextureSize=[0,0],this.outputTextureSize=[0,0],this.cachedNewCameraMatrix=null}}const pi=globalThis,ka=pi.ShadowRoot&&(pi.ShadyCSS===void 0||pi.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Pa=Symbol(),Uo=new WeakMap;let Il=class{constructor(t,r,n){if(this._$cssResult$=!0,n!==Pa)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=r}get styleSheet(){let t=this.o;const r=this.t;if(ka&&t===void 0){const n=r!==void 0&&r.length===1;n&&(t=Uo.get(r)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&Uo.set(r,t))}return t}toString(){return this.cssText}};const Tv=e=>new Il(typeof e=="string"?e:e+"",void 0,Pa),Zi=(e,...t)=>{const r=e.length===1?e[0]:t.reduce((n,i,s)=>n+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[s+1],e[0]);return new Il(r,e,Pa)},_v=(e,t)=>{if(ka)e.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet);else for(const r of t){const n=document.createElement("style"),i=pi.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=r.cssText,e.appendChild(n)}},Vo=ka?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let r="";for(const n of t.cssRules)r+=n.cssText;return Tv(r)})(e):e;const{is:zv,defineProperty:Iv,getOwnPropertyDescriptor:Sv,getOwnPropertyNames:Ev,getOwnPropertySymbols:Mv,getPrototypeOf:kv}=Object,Ki=globalThis,Ao=Ki.trustedTypes,Pv=Ao?Ao.emptyScript:"",Uv=Ki.reactiveElementPolyfillSupport,Tn=(e,t)=>e,Si={toAttribute(e,t){switch(t){case Boolean:e=e?Pv:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=e!==null;break;case Number:r=e===null?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch{r=null}}return r}},Ua=(e,t)=>!zv(e,t),Co={attribute:!0,type:String,converter:Si,reflect:!1,useDefault:!1,hasChanged:Ua};Symbol.metadata??=Symbol("metadata"),Ki.litPropertyMetadata??=new WeakMap;let Br=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,r=Co){if(r.state&&(r.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((r=Object.create(r)).wrapped=!0),this.elementProperties.set(t,r),!r.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(t,n,r);i!==void 0&&Iv(this.prototype,t,i)}}static getPropertyDescriptor(t,r,n){const{get:i,set:s}=Sv(this.prototype,t)??{get(){return this[r]},set(a){this[r]=a}};return{get:i,set(a){const o=i?.call(this);s?.call(this,a),this.requestUpdate(t,o,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Co}static _$Ei(){if(this.hasOwnProperty(Tn("elementProperties")))return;const t=kv(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(Tn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Tn("properties"))){const r=this.properties,n=[...Ev(r),...Mv(r)];for(const i of n)this.createProperty(i,r[i])}const t=this[Symbol.metadata];if(t!==null){const r=litPropertyMetadata.get(t);if(r!==void 0)for(const[n,i]of r)this.elementProperties.set(n,i)}this._$Eh=new Map;for(const[r,n]of this.elementProperties){const i=this._$Eu(r,n);i!==void 0&&this._$Eh.set(i,r)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const r=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const i of n)r.unshift(Vo(i))}else t!==void 0&&r.push(Vo(t));return r}static _$Eu(t,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,r=this.constructor.elementProperties;for(const n of r.keys())this.hasOwnProperty(n)&&(t.set(n,this[n]),delete this[n]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return _v(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,r,n){this._$AK(t,n)}_$ET(t,r){const n=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,n);if(i!==void 0&&n.reflect===!0){const s=(n.converter?.toAttribute!==void 0?n.converter:Si).toAttribute(r,n.type);this._$Em=t,s==null?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(t,r){const n=this.constructor,i=n._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const s=n.getPropertyOptions(i),a=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:Si;this._$Em=i;const o=a.fromAttribute(r,s.type);this[i]=o??this._$Ej?.get(i)??o,this._$Em=null}}requestUpdate(t,r,n,i=!1,s){if(t!==void 0){const a=this.constructor;if(i===!1&&(s=this[t]),n??=a.getPropertyOptions(t),!((n.hasChanged??Ua)(s,r)||n.useDefault&&n.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(a._$Eu(t,n))))return;this.C(t,r,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,r,{useDefault:n,reflect:i,wrapped:s},a){n&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,a??r??this[t]),s!==!0||a!==void 0)||(this._$AL.has(t)||(this.hasUpdated||n||(r=void 0),this._$AL.set(t,r)),i===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(r){Promise.reject(r)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,s]of this._$Ep)this[i]=s;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[i,s]of n){const{wrapped:a}=s,o=this[i];a!==!0||this._$AL.has(i)||o===void 0||this.C(i,void 0,s,o)}}let t=!1;const r=this._$AL;try{t=this.shouldUpdate(r),t?(this.willUpdate(r),this._$EO?.forEach(n=>n.hostUpdate?.()),this.update(r)):this._$EM()}catch(n){throw t=!1,this._$EM(),n}t&&this._$AE(r)}willUpdate(t){}_$AE(t){this._$EO?.forEach(r=>r.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(r=>this._$ET(r,this[r])),this._$EM()}updated(t){}firstUpdated(t){}};Br.elementStyles=[],Br.shadowRootOptions={mode:"open"},Br[Tn("elementProperties")]=new Map,Br[Tn("finalized")]=new Map,Uv?.({ReactiveElement:Br}),(Ki.reactiveElementVersions??=[]).push("2.1.2");const Va=globalThis,Oo=e=>e,Ei=Va.trustedTypes,Bo=Ei?Ei.createPolicy("lit-html",{createHTML:e=>e}):void 0,Sl="$lit$",Lt=`lit$${Math.random().toFixed(9).slice(2)}$`,El="?"+Lt,Vv=`<${El}>`,cr=document,Sn=()=>cr.createComment(""),En=e=>e===null||typeof e!="object"&&typeof e!="function",Aa=Array.isArray,Av=e=>Aa(e)||typeof e?.[Symbol.iterator]=="function",ls=`[ 	
\f\r]`,cn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Fo=/-->/g,jo=/>/g,rr=RegExp(`>|${ls}(?:([^\\s"'>=/]+)(${ls}*=${ls}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Ro=/'/g,Go=/"/g,Ml=/^(?:script|style|textarea|title)$/i,Cv=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),Te=Cv(1),Hr=Symbol.for("lit-noChange"),me=Symbol.for("lit-nothing"),Lo=new WeakMap,hr=cr.createTreeWalker(cr,129);function kl(e,t){if(!Aa(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return Bo!==void 0?Bo.createHTML(t):t}const Ov=(e,t)=>{const r=e.length-1,n=[];let i,s=t===2?"<svg>":t===3?"<math>":"",a=cn;for(let o=0;o<r;o++){const u=e[o];let h,p,f=-1,m=0;for(;m<u.length&&(a.lastIndex=m,p=a.exec(u),p!==null);)m=a.lastIndex,a===cn?p[1]==="!--"?a=Fo:p[1]!==void 0?a=jo:p[2]!==void 0?(Ml.test(p[2])&&(i=RegExp("</"+p[2],"g")),a=rr):p[3]!==void 0&&(a=rr):a===rr?p[0]===">"?(a=i??cn,f=-1):p[1]===void 0?f=-2:(f=a.lastIndex-p[2].length,h=p[1],a=p[3]===void 0?rr:p[3]==='"'?Go:Ro):a===Go||a===Ro?a=rr:a===Fo||a===jo?a=cn:(a=rr,i=void 0);const w=a===rr&&e[o+1].startsWith("/>")?" ":"";s+=a===cn?u+Vv:f>=0?(n.push(h),u.slice(0,f)+Sl+u.slice(f)+Lt+w):u+Lt+(f===-2?o:w)}return[kl(e,s+(e[r]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),n]};class Mn{constructor({strings:t,_$litType$:r},n){let i;this.parts=[];let s=0,a=0;const o=t.length-1,u=this.parts,[h,p]=Ov(t,r);if(this.el=Mn.createElement(h,n),hr.currentNode=this.el.content,r===2||r===3){const f=this.el.content.firstChild;f.replaceWith(...f.childNodes)}for(;(i=hr.nextNode())!==null&&u.length<o;){if(i.nodeType===1){if(i.hasAttributes())for(const f of i.getAttributeNames())if(f.endsWith(Sl)){const m=p[a++],w=i.getAttribute(f).split(Lt),v=/([.?@])?(.*)/.exec(m);u.push({type:1,index:s,name:v[2],strings:w,ctor:v[1]==="."?Fv:v[1]==="?"?jv:v[1]==="@"?Rv:Qi}),i.removeAttribute(f)}else f.startsWith(Lt)&&(u.push({type:6,index:s}),i.removeAttribute(f));if(Ml.test(i.tagName)){const f=i.textContent.split(Lt),m=f.length-1;if(m>0){i.textContent=Ei?Ei.emptyScript:"";for(let w=0;w<m;w++)i.append(f[w],Sn()),hr.nextNode(),u.push({type:2,index:++s});i.append(f[m],Sn())}}}else if(i.nodeType===8)if(i.data===El)u.push({type:2,index:s});else{let f=-1;for(;(f=i.data.indexOf(Lt,f+1))!==-1;)u.push({type:7,index:s}),f+=Lt.length-1}s++}}static createElement(t,r){const n=cr.createElement("template");return n.innerHTML=t,n}}function Yr(e,t,r=e,n){if(t===Hr)return t;let i=n!==void 0?r._$Co?.[n]:r._$Cl;const s=En(t)?void 0:t._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(e),i._$AT(e,r,n)),n!==void 0?(r._$Co??=[])[n]=i:r._$Cl=i),i!==void 0&&(t=Yr(e,i._$AS(e,t.values),i,n)),t}class Bv{constructor(t,r){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:r},parts:n}=this._$AD,i=(t?.creationScope??cr).importNode(r,!0);hr.currentNode=i;let s=hr.nextNode(),a=0,o=0,u=n[0];for(;u!==void 0;){if(a===u.index){let h;u.type===2?h=new Nn(s,s.nextSibling,this,t):u.type===1?h=new u.ctor(s,u.name,u.strings,this,t):u.type===6&&(h=new Gv(s,this,t)),this._$AV.push(h),u=n[++o]}a!==u?.index&&(s=hr.nextNode(),a++)}return hr.currentNode=cr,i}p(t){let r=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(t,n,r),r+=n.strings.length-2):n._$AI(t[r])),r++}}class Nn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,r,n,i){this.type=2,this._$AH=me,this._$AN=void 0,this._$AA=t,this._$AB=r,this._$AM=n,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&t?.nodeType===11&&(t=r.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,r=this){t=Yr(this,t,r),En(t)?t===me||t==null||t===""?(this._$AH!==me&&this._$AR(),this._$AH=me):t!==this._$AH&&t!==Hr&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Av(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==me&&En(this._$AH)?this._$AA.nextSibling.data=t:this.T(cr.createTextNode(t)),this._$AH=t}$(t){const{values:r,_$litType$:n}=t,i=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=Mn.createElement(kl(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===i)this._$AH.p(r);else{const s=new Bv(i,this),a=s.u(this.options);s.p(r),this.T(a),this._$AH=s}}_$AC(t){let r=Lo.get(t.strings);return r===void 0&&Lo.set(t.strings,r=new Mn(t)),r}k(t){Aa(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let n,i=0;for(const s of t)i===r.length?r.push(n=new Nn(this.O(Sn()),this.O(Sn()),this,this.options)):n=r[i],n._$AI(s),i++;i<r.length&&(this._$AR(n&&n._$AB.nextSibling,i),r.length=i)}_$AR(t=this._$AA.nextSibling,r){for(this._$AP?.(!1,!0,r);t!==this._$AB;){const n=Oo(t).nextSibling;Oo(t).remove(),t=n}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class Qi{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,r,n,i,s){this.type=1,this._$AH=me,this._$AN=void 0,this.element=t,this.name=r,this._$AM=i,this.options=s,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=me}_$AI(t,r=this,n,i){const s=this.strings;let a=!1;if(s===void 0)t=Yr(this,t,r,0),a=!En(t)||t!==this._$AH&&t!==Hr,a&&(this._$AH=t);else{const o=t;let u,h;for(t=s[0],u=0;u<s.length-1;u++)h=Yr(this,o[n+u],r,u),h===Hr&&(h=this._$AH[u]),a||=!En(h)||h!==this._$AH[u],h===me?t=me:t!==me&&(t+=(h??"")+s[u+1]),this._$AH[u]=h}a&&!i&&this.j(t)}j(t){t===me?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Fv extends Qi{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===me?void 0:t}}class jv extends Qi{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==me)}}class Rv extends Qi{constructor(t,r,n,i,s){super(t,r,n,i,s),this.type=5}_$AI(t,r=this){if((t=Yr(this,t,r,0)??me)===Hr)return;const n=this._$AH,i=t===me&&n!==me||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,s=t!==me&&(n===me||i);i&&this.element.removeEventListener(this.name,this,n),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Gv{constructor(t,r,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=r,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){Yr(this,t)}}const Lv=Va.litHtmlPolyfillSupport;Lv?.(Mn,Nn),(Va.litHtmlVersions??=[]).push("3.3.2");const Dv=(e,t,r)=>{const n=r?.renderBefore??t;let i=n._$litPart$;if(i===void 0){const s=r?.renderBefore??null;n._$litPart$=i=new Nn(t.insertBefore(Sn(),s),s,void 0,r??{})}return i._$AI(e),i};const Ca=globalThis;class lr extends Br{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Dv(r,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Hr}}lr._$litElement$=!0,lr.finalized=!0,Ca.litElementHydrateSupport?.({LitElement:lr});const Nv=Ca.litElementPolyfillSupport;Nv?.({LitElement:lr});(Ca.litElementVersions??=[]).push("4.2.2");const Oa=e=>(t,r)=>{r!==void 0?r.addInitializer(()=>{customElements.define(e,t)}):customElements.define(e,t)};const Wv={attribute:!0,type:String,converter:Si,reflect:!1,hasChanged:Ua},qv=(e=Wv,t,r)=>{const{kind:n,metadata:i}=r;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),n==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(r.name,e),n==="accessor"){const{name:a}=r;return{set(o){const u=t.get.call(this);t.set.call(this,o),this.requestUpdate(a,u,e,!0,o)},init(o){return o!==void 0&&this.C(a,void 0,e,o),o}}}if(n==="setter"){const{name:a}=r;return function(o){const u=this[a];t.call(this,o),this.requestUpdate(a,u,e,!0,o)}}throw Error("Unsupported decorator location: "+n)};function Ji(e){return(t,r)=>typeof r=="object"?qv(e,t,r):((n,i,s)=>{const a=i.hasOwnProperty(s);return i.constructor.createProperty(s,n),a?Object.getOwnPropertyDescriptor(i,s):void 0})(e,t,r)}function xe(e){return Ji({...e,state:!0,attribute:!1})}const Hv=(e,t,r)=>(r.configurable=!0,r.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(e,t,r),r);function nn(e,t){return(r,n,i)=>{const s=a=>a.renderRoot?.querySelector(e)??null;return Hv(r,n,{get(){return s(this)}})}}const Yv=Zi`
  .ptz-controls,
  .pane-controls {
    background: rgba(0, 217, 255, 0.05);
    border: 1px solid rgba(0, 217, 255, 0.2);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
  }

  .ptz-controls h3,
  .pane-controls h3 {
    color: #00d9ff;
  }

  .pane-output {
    display: grid;
    gap: 1rem;
  }

  .pane-output.4pane {
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, 1fr);
  }

  .pane-output.2pane-horizontal {
    grid-template-columns: repeat(2, 1fr);
  }

  .pane-output.2pane-vertical {
    grid-template-columns: 1fr;
    grid-template-rows: repeat(2, 1fr);
  }

  .pane-wrapper {
    background: #0a0a14;
    border-radius: 8px;
    padding: 0.5rem;
  }

  .pane-wrapper canvas {
    width: 100%;
    height: auto;
    max-width: 400px;
  }

  .pane-wrapper h4 {
    font-size: 0.65rem;
    color: #8892b0;
    margin: 0 0 0.5rem 0;
    text-align: center;
  }

  @media (max-width: 900px) {
    .pane-output.4pane {
      grid-template-columns: 1fr;
      grid-template-rows: repeat(4, auto);
    }

    .pane-output.2pane-horizontal {
      grid-template-columns: 1fr;
    }
  }
`,Xv=Zi`
  :host {
    display: block;
    font-family: system-ui, -apple-system, sans-serif;
    color: #e0e0e0;
    background: #1a1a2e;
    min-height: 100vh;
  }

  .container {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  .main {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  .sidebar-container {
    display: flex;
    flex-shrink: 0;
    background: #16213e;
    border-right: 1px solid #0f3460;
  }

  .sidebar-form {
    width: 320px;
    padding: 1.5rem;
    overflow-y: auto;
    overflow-x: hidden;
    transition: width 0.25s ease, padding 0.25s ease, opacity 0.2s ease;
  }

  .sidebar-form.closed {
    width: 0;
    padding: 0;
    min-width: 0;
    opacity: 0;
    overflow: hidden;
    pointer-events: none;
  }

  .sidebar-form .control-group {
    margin-bottom: 1.5rem;
  }

  .sidebar-form .control-group h3 {
    margin: 0 0 0.75rem;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #00d9ff;
  }

  .sidebar-form .control-hint {
    margin: 0 0 0.5rem;
    font-size: 0.7rem;
    color: #666;
    line-height: 1.3;
  }

  .sidebar-form .control-item {
    margin-bottom: 1rem;
  }

  .sidebar-form .control-item label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
    color: #a0a0a0;
  }

  .sidebar-form .control-item label span {
    font-family: monospace;
    color: #00ff88;
  }

  .sidebar-form input[type="range"] {
    width: 100%;
    height: 6px;
    background: #0f3460;
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
  }

  .sidebar-form input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    background: #00d9ff;
    border-radius: 50%;
    cursor: pointer;
  }

  .sidebar-form .sample-thumbnails {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .sidebar-form .sample-thumb {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 0.35rem;
    background: #0f3460;
    border: 2px solid #1a3a5c;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .sidebar-form .sample-thumb:hover {
    border-color: #00d9ff;
    background: #1a3a5c;
  }

  .sidebar-form .sample-thumb.active {
    border-color: #00d9ff;
    background: rgba(0, 217, 255, 0.15);
  }

  .sidebar-form .sample-thumb img {
    width: 100%;
    aspect-ratio: 4/3;
    object-fit: cover;
    border-radius: 4px;
  }

  .sidebar-form .sample-thumb span {
    font-size: 0.65rem;
    color: #8892b0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .sidebar-form .sample-thumb.active span {
    color: #00d9ff;
  }

  .sidebar-form .file-input-wrapper {
    position: relative;
  }

  .sidebar-form .file-input-wrapper input[type="file"] {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
  }

  .sidebar-form .file-input-label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #0f3460, #16213e);
    border: 2px dashed #0f3460;
    border-radius: 8px;
    color: #8892b0;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .sidebar-form .file-input-wrapper:hover .file-input-label {
    border-color: #00d9ff;
    color: #00d9ff;
  }

  .sidebar-form .preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .sidebar-form .preset-btn {
    padding: 0.5rem 0.75rem;
    background: #0f3460;
    border: 1px solid #1a3a5c;
    border-radius: 6px;
    color: #a0a0a0;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .sidebar-form .preset-btn:hover {
    border-color: #00d9ff;
    color: #00d9ff;
  }

  .sidebar-form .preset-btn.active {
    background: #00d9ff;
    border-color: #00d9ff;
    color: #1a1a2e;
  }

  .sidebar-form .btn {
    width: 100%;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #00d9ff, #00ff88);
    border: none;
    border-radius: 8px;
    color: #1a1a2e;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .sidebar-form .btn-secondary {
    background: #0f3460;
    color: #e0e0e0;
  }

  .canvas-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    gap: 1rem;
    overflow: auto;
  }

  .canvas-container {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  .canvas-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .canvas-wrapper h4 {
    margin: 0;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #8892b0;
  }

  canvas {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  #input-canvas {
    max-width: 400px;
    background: #0a0a14;
  }

  #output-canvas {
    max-width: 600px;
    background: #0a0a14;
  }

  .error {
    padding: 1rem;
    background: rgba(255, 82, 82, 0.1);
    border: 1px solid #ff5252;
    border-radius: 8px;
    color: #ff5252;
    font-size: 0.875rem;
  }

  .processing {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #00d9ff;
    font-size: 0.875rem;
  }

  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid #0f3460;
    border-top-color: #00d9ff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Tablet and mobile: stack layout */
  @media (max-width: 900px) {
    .main {
      flex-direction: column;
    }

    .sidebar-container {
      flex-direction: column;
      border-right: none;
      border-bottom: 1px solid #0f3460;
      max-height: 50vh;
      overflow: hidden;
    }

    .sidebar-form.closed {
      max-height: 0;
    }

    .canvas-container {
      flex-direction: column;
      align-items: center;
    }
  }

  /* Small mobile screens */
  @media (max-width: 600px) {
    .canvas-area {
      padding: 1rem;
      gap: 0.75rem;
    }

    .canvas-container {
      gap: 1rem;
      width: 100%;
    }

    .canvas-wrapper {
      width: 100%;
    }

    .canvas-wrapper h4 {
      font-size: 0.7rem;
    }

    #input-canvas,
    #output-canvas {
      max-width: 100%;
      width: 100%;
    }

    #input-canvas {
      max-width: 100%;
    }

    #output-canvas {
      max-width: 100%;
    }
  }

  @media (max-width: 400px) {
    .sidebar-form .control-item label {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }

    .sidebar-form .control-item label span {
      font-size: 0.75rem;
    }
  }

  /* Landscape mobile optimization */
  @media (max-height: 500px) and (orientation: landscape) {
    .container {
      height: auto;
      min-height: 100vh;
    }

    .main {
      flex-direction: row;
    }

    .canvas-area {
      padding: 0.5rem;
    }

    .canvas-container {
      flex-direction: row;
      gap: 0.5rem;
    }
  }
`,Nr=class Nr{constructor(t){this.ctx=null,this.format=null,this.device=null,this.pipeline=null,this.sampler=null,this.currentWidth=0,this.currentHeight=0,this.canvas=t,this.started=this.start()}async start(){const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("WebGPU adapter not found");this.device=await t.requestDevice(),this.format=navigator.gpu.getPreferredCanvasFormat(),this.ctx=this.canvas.getContext("webgpu"),this.ctx.configure({device:this.device,format:this.format,alphaMode:"opaque",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),this.pipeline=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.device.createShaderModule({code:Nr.vertexShaderSource}),entryPoint:"vert_main"},fragment:{module:this.device.createShaderModule({code:Nr.fragmentShaderSource}),entryPoint:"frag_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"}}),this.sampler=this.device.createSampler({})}async draw(t){if(await this.started,!this.device||!this.pipeline||!this.sampler||!this.ctx)throw new Error("WebGPU not initialized");if(this.currentWidth!==t.displayWidth||this.currentHeight!==t.displayHeight){this.canvas.width=t.displayWidth,this.canvas.height=t.displayHeight,this.currentWidth=t.displayWidth,this.currentHeight=t.displayHeight;const a=this.format;if(!a)throw new Error("WebGPU not initialized");this.ctx.configure({device:this.device,format:a,alphaMode:"opaque",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT})}const r=this.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:1,resource:this.sampler},{binding:2,resource:this.device.importExternalTexture({source:t})}]}),n=this.device.createCommandEncoder(),s={colorAttachments:[{view:this.ctx.getCurrentTexture().createView(),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}]};try{const a=n.beginRenderPass(s);a.setPipeline(this.pipeline),a.setBindGroup(0,r),a.draw(6,1,0,0),a.end(),this.device.queue.submit([n.finish()]),await this.device.queue.onSubmittedWorkDone()}finally{t.close()}}destroy(){this.device?.destroy(),this.device=null,this.ctx=null,this.pipeline=null,this.sampler=null}};Nr.vertexShaderSource=`
    struct VertexOutput {
      @builtin(position) Position: vec4<f32>,
      @location(0) uv: vec2<f32>,
    }

    @vertex
    fn vert_main(@builtin(vertex_index) VertexIndex: u32) -> VertexOutput {
      var pos = array<vec2<f32>, 6>(
        vec2<f32>( 1.0,  1.0),
        vec2<f32>( 1.0, -1.0),
        vec2<f32>(-1.0, -1.0),
        vec2<f32>( 1.0,  1.0),
        vec2<f32>(-1.0, -1.0),
        vec2<f32>(-1.0,  1.0)
      );

      var uv = array<vec2<f32>, 6>(
        vec2<f32>(1.0, 0.0),
        vec2<f32>(1.0, 1.0),
        vec2<f32>(0.0, 1.0),
        vec2<f32>(1.0, 0.0),
        vec2<f32>(0.0, 1.0),
        vec2<f32>(0.0, 0.0)
      );

      var output : VertexOutput;
      output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);
      output.uv = uv[VertexIndex];
      return output;
    }
  `,Nr.fragmentShaderSource=`
    @group(0) @binding(1) var mySampler: sampler;
    @group(0) @binding(2) var myTexture: texture_external;
    
    @fragment
    fn frag_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {
      return textureSampleBaseClampToEdge(myTexture, mySampler, uv);
    }
  `;let Mi=Nr;var Zv=Object.defineProperty,Kv=Object.getOwnPropertyDescriptor,Pl=(e,t,r,n)=>{for(var i=n>1?void 0:n?Kv(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&Zv(t,r,i),i};const Do=52;let ki=class extends lr{constructor(){super(...arguments),this.open=!0}toggle(){this.dispatchEvent(new CustomEvent("toggle",{bubbles:!0,composed:!0}))}get toggleLabel(){return this.open?"Close settings":"Open settings"}render(){return Te`
      <button
        type="button"
        class="sidebar-toggle"
        @click=${this.toggle}
        aria-expanded=${this.open}
        aria-label=${this.toggleLabel}
        title=${this.toggleLabel}
      >
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M9 18l6-6-6-6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="label">Settings</span>
      </button>
    `}};ki.styles=Zi`
    :host {
      display: block;
      flex-shrink: 0;
      width: ${Do}px;
    }

    .sidebar-toggle {
      width: 100%;
      min-height: 3rem;
      padding: 0 0.25rem;
      background: #0f3460;
      border: none;
      border-right: 1px solid #1a3a5c;
      color: #00d9ff;
      font-size: 0.8125rem;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      transition: background 0.15s, color 0.15s;
    }

    .sidebar-toggle:hover {
      background: #1a3a5c;
      color: #fff;
    }

    .sidebar-toggle .icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      transition: transform 0.25s ease;
    }

    .sidebar-toggle .label {
      line-height: 1.1;
      font-weight: 500;
      letter-spacing: 0.02em;
    }

    .sidebar-toggle[aria-expanded="true"] .icon {
      transform: rotate(180deg);
    }

    @media (max-width: 900px) {
      :host {
        width: 100%;
      }

      .sidebar-toggle {
        flex-direction: row;
        width: 100%;
        height: ${Do}px;
        padding: 0 0.75rem;
        border-right: none;
        border-bottom: 1px solid #1a3a5c;
      }

      .sidebar-toggle .label {
        flex: 1;
        text-align: left;
      }

      .sidebar-toggle[aria-expanded="true"] .icon {
        transform: rotate(0deg);
      }

      .sidebar-toggle[aria-expanded="false"] .icon {
        transform: rotate(180deg);
      }
    }
  `;Pl([Ji({type:Boolean})],ki.prototype,"open",2);ki=Pl([Oa("demo-sidebar")],ki);var Qv=Object.defineProperty,Jv=Object.getOwnPropertyDescriptor,Ba=(e,t,r,n)=>{for(var i=n>1?void 0:n?Jv(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&Qv(t,r,i),i};let kn=class extends lr{constructor(){super(...arguments),this.title="fisheye.js",this.subtitle="GPU-accelerated fisheye dewarping using WebGPU"}render(){return Te`
      <header>
        <h1>${this.title}</h1>
        <p>${this.subtitle}</p>
      </header>
    `}};kn.styles=Zi`
    :host {
      display: block;
    }

    header {
      padding: 1rem 2rem;
      background: #16213e;
      border-bottom: 1px solid #0f3460;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      background: linear-gradient(90deg, #00d9ff, #00ff88);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    header p {
      margin: 0.25rem 0 0;
      font-size: 0.875rem;
      color: #8892b0;
    }

    @media (max-width: 600px) {
      header {
        padding: 0.75rem 1rem;
      }

      header h1 {
        font-size: 1.25rem;
      }

      header p {
        font-size: 0.75rem;
      }
    }

    @media (max-height: 500px) and (orientation: landscape) {
      header {
        padding: 0.5rem 1rem;
      }

      header h1 {
        font-size: 1rem;
      }

      header p {
        display: none;
      }
    }
  `;Ba([Ji()],kn.prototype,"title",2);Ba([Ji()],kn.prototype,"subtitle",2);kn=Ba([Oa("page-header")],kn);var e1=Object.defineProperty,t1=Object.getOwnPropertyDescriptor,X=(e,t,r,n)=>{for(var i=n>1?void 0:n?t1(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&e1(t,r,i),i};const No=3264,di={fx:991,fy:991,cx:1612,cy:1617,k1:.03562009,k2:-.02587979,k3:.00564249,k4:-.00107043,balance:0,fovScale:1},cs={fx:991,fy:991,cx:1612,cy:1617,k1:.02494321,k2:.0049985,k3:-.01754164,k4:.00455207,balance:0,fovScale:1},Ee={...di,projection:{kind:"rectilinear"}},Wo=[{id:"cam1_01",label:"Cam 1-01",src:"samples/cam1_01.jpg"},{id:"cam1_02",label:"Cam 1-02",src:"samples/cam1_02.jpg"},{id:"cam1_03",label:"Cam 1-03",src:"samples/cam1_03.jpg"},{id:"cam2_01",label:"Cam 2-01",src:"samples/cam2_01.jpg"},{id:"cam2_02",label:"Cam 2-02",src:"samples/cam2_02.jpg"},{id:"cam2_03",label:"Cam 2-03",src:"samples/cam2_03.jpg"}],qo=[{id:"rectilinear",label:"Rectilinear (90)",projection:{kind:"rectilinear"}},{id:"equirectangular",label:"Equirectangular",projection:{kind:"equirectangular"}},{id:"original",label:"Original",projection:{kind:"original"}},{id:"cylindrical",label:"Cylindrical",projection:{kind:"cylindrical"}}];let L=class extends lr{constructor(){super(...arguments),this.k1=Ee.k1,this.k2=Ee.k2,this.k3=Ee.k3,this.k4=Ee.k4,this.balance=Ee.balance,this.fovScale=Ee.fovScale,this.presetId=null,this.projection=Ee.projection,this.isProcessing=!1,this.errorMessage="",this.hasWebGPU=!0,this.sidebarOpen=!0,this.selectedSampleId="cam1_01",this.vmsMode="default",this.ptzPan=0,this.ptzTilt=0,this.ptzZoom=1,this.paneKind="4pane",this.fisheye=null,this.renderer=null,this.paneRenderers=[],this.currentImageBitmap=null,this.processImagePromise=Promise.resolve(),this.processImageDebounceTimer=null,this.loadRequestId=0}connectedCallback(){super.connectedCallback(),this.checkWebGPU(),this.loadDefaultImage()}disconnectedCallback(){super.disconnectedCallback(),this.processImageDebounceTimer!==null&&(clearTimeout(this.processImageDebounceTimer),this.processImageDebounceTimer=null),this.fisheye?.destroy(),this.renderer?.destroy();for(const e of this.paneRenderers)e.destroy();this.paneRenderers=[],this.currentImageBitmap?.close()}async checkWebGPU(){navigator.gpu||(this.hasWebGPU=!1,this.errorMessage="WebGPU is not supported in this browser. Please use Chrome 113+ or Edge 113+.")}async loadDefaultImage(){try{const e=Wo[0];this.applyCalibrationFromSample(e.id);const r=await(await fetch(`/fisheye.js/${e.src}?t=${Date.now()}`)).blob();await this.loadImage(r),this.selectedSampleId=e.id}catch(e){console.warn("Failed to load default image:",e)}}async loadImage(e,t){try{const r=++this.loadRequestId;this.currentImageBitmap?.close(),this.currentImageBitmap=await createImageBitmap(e),await this.updateComplete;const n=this.inputCanvas.getContext("2d");n&&(this.inputCanvas.width=this.currentImageBitmap.width,this.inputCanvas.height=this.currentImageBitmap.height,n.drawImage(this.currentImageBitmap,0,0));const i=this.currentImageBitmap;if(await this.processImagePromise,r!==this.loadRequestId)return;this.processImagePromise=this.processImage(i,t,r).catch(()=>{}),await this.processImagePromise,await new Promise(s=>requestAnimationFrame(()=>s()))}catch(r){this.errorMessage=`Failed to load image: ${r}`}}async handleFileUpload(e){const r=e.target.files?.[0];r&&(this.selectedSampleId=null,await this.loadImage(r))}getCalibrationForCurrentSample(){return(this.selectedSampleId??"cam1_01").startsWith("cam2_")?cs:di}buildFisheyeOptions(e,t,r){const n=r!==void 0?r.startsWith("cam2_")?cs:di:this.getCalibrationForCurrentSample(),i=e/No,s=t/No,a=this.projection.kind==="rectilinear"?{kind:"rectilinear",mode:"manual",newFx:n.fx*i,newFy:n.fy*s,newCx:e/2,newCy:t/2}:this.projection;let o,u;return this.vmsMode==="ptz"?o={pan:this.ptzPan,tilt:this.ptzTilt,zoom:this.ptzZoom}:this.vmsMode==="pane"&&(this.paneKind==="4pane"?u={kind:"4pane"}:this.paneKind==="2pane-horizontal"?u={kind:"2pane",orientation:"horizontal"}:u={kind:"2pane",orientation:"vertical"}),{fx:n.fx*i,fy:n.fy*s,cx:n.cx*i,cy:n.cy*s,k1:this.k1,k2:this.k2,k3:this.k3,k4:this.k4,width:e,height:t,balance:this.balance,fovScale:this.fovScale,projection:a,ptz:o,pane:u}}applyCalibrationFromSample(e){const t=e.startsWith("cam2_")?cs:di;this.k1=t.k1,this.k2=t.k2,this.k3=t.k3,this.k4=t.k4,this.balance=t.balance,this.fovScale=t.fovScale}async handleSampleSelect(e){try{this.selectedSampleId=e.id,this.applyCalibrationFromSample(e.id),await this.updateComplete;const r=await(await fetch(`/fisheye.js/${e.src}?t=${Date.now()}`)).blob();await this.loadImage(r,e.id)}catch{this.errorMessage=`Failed to load sample: ${e.label}`}}ensureFisheyeReady(e){this.fisheye?this.fisheye.updateConfig(e):this.fisheye=new $v(e)}async drawOrCloseResult(e,t){if(!t){if(Array.isArray(e))for(const r of e)r.close();else e.close();return}this.vmsMode==="pane"&&Array.isArray(e)?await this.renderPaneFrames(e):e instanceof VideoFrame&&(this.renderer||(this.renderer=new Mi(this.outputCanvas)),await this.renderer.draw(e))}async processImage(e,t,r){const n=e??this.currentImageBitmap;if(!(!n||!this.hasWebGPU)){this.isProcessing=!0,this.errorMessage="";try{if(await this.updateComplete,r!==void 0&&r!==this.loadRequestId){this.isProcessing=!1;return}const i=n.width,s=n.height,a=this.buildFisheyeOptions(i,s,t);this.ensureFisheyeReady(a);const o=this.fisheye;if(!o){this.isProcessing=!1;return}const u=new VideoFrame(n,{timestamp:0});let h=!1;try{const p=await o.undistort(u);u.close(),h=!0;const f=r===void 0||r===this.loadRequestId;await this.drawOrCloseResult(p,f)}finally{h||u.close(),this.isProcessing=!1}}catch(i){this.errorMessage=`Processing error: ${i}`,console.error(i)}}}async renderPaneFrames(e){const t=[this.paneCanvas0,this.paneCanvas1,this.paneCanvas2,this.paneCanvas3],r=e.length;for(;this.paneRenderers.length<r;){const n=this.paneRenderers.length;t[n]&&this.paneRenderers.push(new Mi(t[n]))}for(let n=0;n<r&&n<t.length;n++)this.paneRenderers[n]&&e[n]&&await this.paneRenderers[n].draw(e[n])}enqueueProcessImage(){const e=this.processImagePromise;return this.processImagePromise=e.then(()=>this.processImage()).catch(()=>{}),this.processImagePromise}scheduleProcessImageDebounced(){this.processImageDebounceTimer!==null&&clearTimeout(this.processImageDebounceTimer),this.processImageDebounceTimer=setTimeout(()=>{this.processImageDebounceTimer=null,this.enqueueProcessImage()},L.PROCESS_IMAGE_DEBOUNCE_MS)}cancelProcessImageDebounce(){this.processImageDebounceTimer!==null&&(clearTimeout(this.processImageDebounceTimer),this.processImageDebounceTimer=null)}handleParamChange(e,t){this[e]=t,this.scheduleProcessImageDebounced()}async handlePresetChange(e){const t=qo.find(r=>r.id===e);t&&(this.cancelProcessImageDebounce(),this.presetId=t.id,this.projection=t.projection,this.fisheye=null,await this.enqueueProcessImage())}async handleVmsModeChange(e){if(this.cancelProcessImageDebounce(),this.vmsMode=e,this.fisheye?.destroy(),this.fisheye=null,e!=="pane"){for(const t of this.paneRenderers)t.destroy();this.paneRenderers=[]}await this.enqueueProcessImage()}handlePtzChange(e,t){this[e]=t,this.scheduleProcessImageDebounced()}async handlePaneKindChange(e){this.cancelProcessImageDebounce(),this.paneKind=e,this.fisheye?.destroy(),this.fisheye=null;for(const t of this.paneRenderers)t.destroy();this.paneRenderers=[],await this.enqueueProcessImage()}handleSidebarToggle(){this.sidebarOpen=!this.sidebarOpen}resetToDefaults(){this.presetId=null,this.projection=Ee.projection,this.balance=Ee.balance,this.fovScale=Ee.fovScale,this.k1=Ee.k1,this.k2=Ee.k2,this.k3=Ee.k3,this.k4=Ee.k4,this.vmsMode="default",this.ptzPan=0,this.ptzTilt=0,this.ptzZoom=1,this.paneKind="4pane",this.fisheye?.destroy(),this.fisheye=null;for(const e of this.paneRenderers)e.destroy();this.paneRenderers=[],this.loadDefaultImage()}renderSidebarFormContent(){return this.errorMessage&&!this.hasWebGPU?Te`<div class="error">${this.errorMessage}</div>`:Te`
      <div class="control-group">
        <h3>Image</h3>
        <p class="control-hint">Pick a sample or upload your own file.</p>
        <div class="sample-thumbnails">
          ${Wo.map(e=>Te`
              <button
                type="button"
                class="sample-thumb ${this.selectedSampleId===e.id?"active":""}"
                title=${e.label}
                @click=${()=>this.handleSampleSelect(e)}
              >
                <img src="${"/fisheye.js/"}${e.src}" alt=${e.label} loading="lazy" />
                <span>${e.label}</span>
              </button>
            `)}
        </div>
        <div class="file-input-wrapper">
          <input type="file" accept="image/*" @change=${this.handleFileUpload} />
          <div class="file-input-label">
            <span></span>
            Upload Image
          </div>
        </div>
      </div>

      <div class="control-group">
        <h3>VMS Mode</h3>
        <p class="control-hint">Select viewing mode: Default, PTZ (e-PTZ), or Pane (multi-view).</p>
        <div class="preset-buttons">
          <button
            class="preset-btn ${this.vmsMode==="default"?"active":""}"
            @click=${()=>this.handleVmsModeChange("default")}
          >
            Default
          </button>
          <button
            class="preset-btn ${this.vmsMode==="ptz"?"active":""}"
            @click=${()=>this.handleVmsModeChange("ptz")}
          >
            PTZ
          </button>
          <button
            class="preset-btn ${this.vmsMode==="pane"?"active":""}"
            @click=${()=>this.handleVmsModeChange("pane")}
          >
            Pane
          </button>
        </div>
      </div>

      ${this.vmsMode==="ptz"?this.renderPtzControls():""}
      ${this.vmsMode==="pane"?this.renderPaneControls():""}

      <div class="control-group">
        <h3>View preset</h3>
        <p class="control-hint">Projection mode (rectilinear, equirectangular, etc.)</p>
        <div class="preset-buttons">
          ${qo.map(e=>Te`
              <button
                class="preset-btn ${this.presetId!==null&&this.presetId===e.id?"active":""}"
                @click=${()=>this.handlePresetChange(e.id)}
              >
                ${e.label}
              </button>
            `)}
        </div>
      </div>

      <div class="control-group">
        <h3>Distortion Coefficients</h3>
        <p class="control-hint">OpenCV fisheye: _d = (1 + k1 + k2 + k3 + k4). Typical |k| &lt; 0.1.</p>
        ${this.renderSlider("k1",this.k1,-.1,.1,1e-4)}
        ${this.renderSlider("k2",this.k2,-.1,.1,1e-4)}
        ${this.renderSlider("k3",this.k3,-.1,.1,1e-4)}
        ${this.renderSlider("k4",this.k4,-.1,.1,1e-4)}
      </div>

      <div class="control-group">
        <h3>Camera Parameters</h3>
        <p class="control-hint">balance: 0 = no black edges, 1 = keep original FOV. fovScale: &gt;1 = widen FOV, &lt;1 = narrow FOV.</p>
        ${this.renderSlider("balance",this.balance,0,1,.01)}
        ${this.renderSlider("fovScale",this.fovScale,.1,3,.01)}
      </div>

      <div class="control-group">
        <button class="btn btn-secondary" @click=${this.resetToDefaults}>
          Reset to Defaults
        </button>
      </div>
    `}renderCanvasArea(){const e=this.errorMessage&&this.hasWebGPU,t=this.isProcessing;return Te`
      <div class="canvas-area">
        ${e?Te`<div class="error">${this.errorMessage}</div>`:""}
        ${t?Te`
              <div class="processing">
                <div class="spinner"></div>
                Processing...
              </div>
            `:""}

        <div class="canvas-container">
          <div class="canvas-wrapper">
            <h4>Input (Fisheye)</h4>
            <canvas id="input-canvas" width="640" height="480"></canvas>
          </div>
          ${this.vmsMode==="pane"?this.renderPaneCanvases():Te`
                <div class="canvas-wrapper">
                  <h4>Output (Dewarped)</h4>
                  <canvas id="output-canvas" width="640" height="480"></canvas>
                </div>
              `}
        </div>
      </div>
    `}render(){return Te`
      <div class="container">
        <page-header></page-header>

        <div class="main">
          <div class="sidebar-container">
            <demo-sidebar
              .open=${this.sidebarOpen}
              @toggle=${this.handleSidebarToggle}
            ></demo-sidebar>
            <div class="sidebar-form ${this.sidebarOpen?"open":"closed"}">
              ${this.renderSidebarFormContent()}
            </div>
          </div>

          ${this.renderCanvasArea()}
        </div>
      </div>
    `}renderSlider(e,t,r,n,i){return Te`
      <div class="control-item">
        <label>
          ${e}
          <span>${t.toFixed(i<=1e-4?4:i<1?3:0)}</span>
        </label>
        <input
          type="range"
          min=${r}
          max=${n}
          step=${i}
          .value=${String(t)}
          @input=${s=>this.handleParamChange(e,Number(s.target.value))}
        />
      </div>
    `}renderPtzControls(){return Te`
      <div class="control-group ptz-controls">
        <h3>PTZ Controls</h3>
        <p class="control-hint">Pan (-180 to 180), Tilt (-90 to 90), Zoom (0.5x to 4x).</p>
        <div class="control-item">
          <label>
            Pan
            <span>${this.ptzPan.toFixed(0)}</span>
          </label>
          <input
            type="range"
            min="-180"
            max="180"
            step="1"
            .value=${String(this.ptzPan)}
            @input=${e=>this.handlePtzChange("ptzPan",Number(e.target.value))}
          />
        </div>
        <div class="control-item">
          <label>
            Tilt
            <span>${this.ptzTilt.toFixed(0)}</span>
          </label>
          <input
            type="range"
            min="-90"
            max="90"
            step="1"
            .value=${String(this.ptzTilt)}
            @input=${e=>this.handlePtzChange("ptzTilt",Number(e.target.value))}
          />
        </div>
        <div class="control-item">
          <label>
            Zoom
            <span>${this.ptzZoom.toFixed(1)}x</span>
          </label>
          <input
            type="range"
            min="0.5"
            max="4"
            step="0.1"
            .value=${String(this.ptzZoom)}
            @input=${e=>this.handlePtzChange("ptzZoom",Number(e.target.value))}
          />
        </div>
      </div>
    `}renderPaneControls(){return Te`
      <div class="control-group pane-controls">
        <h3>Pane Layout</h3>
        <p class="control-hint">Select multi-view layout for VMS display.</p>
        <div class="preset-buttons">
          <button
            class="preset-btn ${this.paneKind==="2pane-horizontal"?"active":""}"
            @click=${()=>this.handlePaneKindChange("2pane-horizontal")}
          >
            2-Pane (H)
          </button>
          <button
            class="preset-btn ${this.paneKind==="2pane-vertical"?"active":""}"
            @click=${()=>this.handlePaneKindChange("2pane-vertical")}
          >
            2-Pane (V)
          </button>
          <button
            class="preset-btn ${this.paneKind==="4pane"?"active":""}"
            @click=${()=>this.handlePaneKindChange("4pane")}
          >
            4-Pane
          </button>
        </div>
      </div>
    `}renderPaneCanvases(){const e=this.paneKind==="4pane"?4:2,t=this.paneKind==="4pane"?["Front (0)","Right (90)","Back (180)","Left (-90)"]:this.paneKind==="2pane-horizontal"?["Left (-45)","Right (45)"]:["Top (tilt +30)","Bottom (tilt -30)"];return Te`
      <div class="pane-output ${this.paneKind}">
        ${Array.from({length:e},(r,n)=>Te`
          <div class="canvas-wrapper pane-wrapper">
            <h4>${t[n]}</h4>
            <canvas id="pane-canvas-${n}" width="400" height="300"></canvas>
          </div>
        `)}
      </div>
    `}};L.PROCESS_IMAGE_DEBOUNCE_MS=200;L.styles=[Xv,Yv];X([xe()],L.prototype,"k1",2);X([xe()],L.prototype,"k2",2);X([xe()],L.prototype,"k3",2);X([xe()],L.prototype,"k4",2);X([xe()],L.prototype,"balance",2);X([xe()],L.prototype,"fovScale",2);X([xe()],L.prototype,"presetId",2);X([xe()],L.prototype,"projection",2);X([xe()],L.prototype,"isProcessing",2);X([xe()],L.prototype,"errorMessage",2);X([xe()],L.prototype,"hasWebGPU",2);X([xe()],L.prototype,"sidebarOpen",2);X([xe()],L.prototype,"selectedSampleId",2);X([xe()],L.prototype,"vmsMode",2);X([xe()],L.prototype,"ptzPan",2);X([xe()],L.prototype,"ptzTilt",2);X([xe()],L.prototype,"ptzZoom",2);X([xe()],L.prototype,"paneKind",2);X([nn("#output-canvas")],L.prototype,"outputCanvas",2);X([nn("#input-canvas")],L.prototype,"inputCanvas",2);X([nn("#pane-canvas-0")],L.prototype,"paneCanvas0",2);X([nn("#pane-canvas-1")],L.prototype,"paneCanvas1",2);X([nn("#pane-canvas-2")],L.prototype,"paneCanvas2",2);X([nn("#pane-canvas-3")],L.prototype,"paneCanvas3",2);L=X([Oa("fisheye-demo")],L);
