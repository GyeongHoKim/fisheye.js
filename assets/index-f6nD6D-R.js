(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var lr="0.9.0",l=Symbol(`typegpu:${lr}:$internal`),F=Symbol(`typegpu:${lr}:$gpuValueOf`),ae=Symbol(`typegpu:${lr}:$getNameForward`),ar=Symbol(`typegpu:${lr}:$providing`),ke=Symbol(`typegpu:${lr}:$ownSnippet`),_=Symbol(`typegpu:${lr}:$resolve`),Hr=Symbol(`typegpu:${lr}:$repr`);function O(e){return!!e?.[l]}var te={[l]:!0,type:"void",toString(){return"void"}},gl=["bool","f32","f16","i32","u32","u16","vec2f","vec2h","vec2i","vec2u","vec2<bool>","vec3f","vec3h","vec3i","vec3u","vec3<bool>","vec4f","vec4h","vec4i","vec4u","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","struct","array","ptr","atomic","decorated","abstractInt","abstractFloat","void","texture_1d","texture_storage_1d","texture_2d","texture_storage_2d","texture_multisampled_2d","texture_depth_2d","texture_depth_multisampled_2d","texture_2d_array","texture_storage_2d_array","texture_depth_2d_array","texture_cube","texture_depth_cube","texture_cube_array","texture_depth_cube_array","texture_3d","texture_storage_3d","texture_external","sampler","sampler_comparison"];function J(e){let t=e;return O(t)&&typeof t.kind=="string"&&t.kind.startsWith("vec")}function rs(e){let t=e;return O(t)&&typeof t.type=="string"&&t.type.startsWith("vec2")}function ns(e){let t=e;return O(t)&&typeof t.type=="string"&&t.type.startsWith("vec3")}function So(e){let t=e;return O(t)&&typeof t.type=="string"&&t.type.startsWith("vec4")}function ft(e){return rs(e)||ns(e)||So(e)}function pt(e){let t=e;return O(t)&&typeof t.kind?.startsWith=="function"&&t.kind.startsWith("mat")}function Eo(e){return O(e)&&e?.type==="mat2x2f"}function Mo(e){return O(e)&&e?.type==="mat3x3f"}function wl(e){return O(e)&&e?.type==="mat4x4f"}function hi(e){return Eo(e)||Mo(e)||wl(e)}function Ea(e){return J(e)&&["vec2f","vec3f","vec4f"].includes(e.kind)}function Qt(e){return O(e)&&gl.includes(e?.type)}function ze(e){return O(e)&&e?.type==="array"}function me(e){return O(e)&&e?.type==="struct"}function Je(e){return O(e)&&e?.type==="ptr"}function li(e){return O(e)&&e?.type==="atomic"}function ks(e){return O(e)&&e?.type==="@align"}function Us(e){return O(e)&&e?.type==="@size"}function ko(e){return O(e)&&e?.type==="@location"}function xl(e){return O(e)&&e?.type==="@interpolate"}function Vs(e){return O(e)&&e?.type==="@builtin"}function Ke(e){return O(e)&&e?.type==="decorated"}function Uo(e){return O(e)&&e.type==="void"}function qt(e){let t=e?.type;return O(e)&&(t==="abstractInt"||t==="abstractFloat"||t==="f32"||t==="f16"||t==="i32"||t==="u32")}function Ps(e){let t=e?.type;return O(e)&&(t==="f16"||t==="vec2h"||t==="vec3h"||t==="vec4h")}var vl=["abstractInt","abstractFloat","f32","f16","i32","u32","bool"];function Te(e){return!O(e)||vl.includes(e?.type)}function $l(e){return e.schema}Object.assign(globalThis,{__TYPEGPU_AUTONAME__:(e,t)=>(zi(e)&&O(e)&&!v(e)&&e.$name(t),e)});var is=globalThis;function Vo(e){return!!e?.[ae]}function v(e){return Vo(e)?v(e[ae]):Ii(e)?.name}function L(e,t){Vo(e)&&L(e[ae],t),bl(e,{name:t})}function zi(e){return!!e?.$name}function mn(e){return!!Ii(e)?.ast}function Ii(e){return is.__TYPEGPU_META__.get(e)}function bl(e,t){is.__TYPEGPU_META__??=new WeakMap;let r=is.__TYPEGPU_META__;r.set(e,{...r.get(e),...t})}var Po=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],Tl={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"};function kt(e){return e.type==="decorated"||e.type==="loose-decorated"?e.inner:e}function qn(e){return e.type==="ptr"?e.inner:e}var _l=["unstruct","disarray","loose-decorated",...Po];function Yr(e){return O(e)&&_l.includes(e?.type)}function Ut(e){return O(e)&&e?.type==="disarray"}function et(e){return O(e)&&e?.type==="unstruct"}function tt(e){return O(e)&&e?.type==="loose-decorated"}function yn(e){return e.attribs?.find(ks)?.params[0]}function zl(e){return e.attribs?.find(Us)?.params[0]}function Ht(e){return e.attribs?.find(ko)?.params[0]}function Xr(e){return Qt(e)||Yr(e)}var Qe={type:"unknown",toString(){return"unknown"}},Ao=class{constructor(t,r,n){this.name=t,this.lhs=r,this.operator=n}},Oo=class{constructor(t){this.matrix=t}},Ma=class{constructor(t){this.op=t,L(this,"consoleLog")}[l]=!0},Il="Invariant failed";function dt(e,t){if(!e)throw new Error(Il)}var Br=class ss extends Error{constructor(t,r){let n=r.map(i=>`- ${mn(i)?`fn*:${v(i)}`:i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Resolution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,ss.prototype)}appendToTrace(t){let r=[t,...this.trace];return new ss(this.cause,r)}},ka=class as extends Error{constructor(t,r){let n=r.map(i=>`- ${i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Execution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,as.prototype)}appendToTrace(t){let r=[t,...this.trace];return new as(this.cause,r)}},Sl=class Bo extends Error{constructor(t){super(`Missing value for '${t}'`),this.slot=t,Object.setPrototypeOf(this,Bo.prototype)}},El=class Co extends Error{constructor(t){super(`Buffer '${v(t)??"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,Co.prototype)}},Ml=class Fo extends Error{constructor(t,r){super(`The function '${t??"<unnamed>"}' is missing links to the following external values: ${r}.`),Object.setPrototypeOf(this,Fo.prototype)}},As=class jo extends Error{constructor(t){super(`Missing bind groups for layouts: '${[...t].map(r=>v(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(bindGroup).(...)`),Object.setPrototypeOf(this,jo.prototype)}},Go=class Lo extends Error{constructor(t){super(`Missing vertex buffers for layouts: '${[...t].map(r=>v(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(layout, buffer).(...)`),Object.setPrototypeOf(this,Lo.prototype)}},Ua=class Ro extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ro.prototype)}},Va=class Do extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Do.prototype)}},j=class No extends Error{constructor(t){super(t),Object.setPrototypeOf(this,No.prototype)}};function os(e){return e?.resourceType==="slot"}function us(e){return e?.resourceType==="derived"}function hs(e){return e?.[ar]!==void 0}function Si(e){return e?.resourceType==="accessor"}function Wo(e){return e==="runtime"||e==="constant"||e==="argument"}function Cr(e){return Wo(e.origin)}var kl={uniform:{space:"uniform",access:"read"},readonly:{space:"storage",access:"read"},mutable:{space:"storage",access:"read-write"},workgroup:{space:"workgroup",access:"read-write"},private:{space:"private",access:"read-write"},function:{space:"function",access:"read-write"},"this-function":{space:"function",access:"read-write"}},qo=class{constructor(t,r,n){this.value=t,this.dataType=r,this.origin=n}};function Os(e){return e instanceof qo}function Hn(e){return qt(e.dataType)}function y(e,t,r){return new qo(e,kt(t),r)}function Bs(e){return At("function",e,"read-write")}function Ul(e){return At("private",e,"read-write")}function Vl(e){return At("workgroup",e,"read-write")}function Pl(e,t="read"){return At("storage",e,t)}function Al(e){return At("uniform",e,"read")}function Ol(e){return At("handle",e,"read")}function At(e,t,r,n=!1){return{[l]:!0,type:"ptr",addressSpace:e,inner:t,access:r,implicit:n,toString:()=>`ptr<${e}, ${t}, ${r}>`}}function Ho(e,t){let r=kl[e];if(r)return At(r.space,t,r.access)}function Bl(e){return At(e.addressSpace,e.inner,e.access,!0)}function Cl(e){return At(e.addressSpace,e.inner,e.access,!1)}var kn=class{type="normal"},Fl=class{type="codegen"},jl=class{constructor(t,r){this.buffers=t,this.vars=r}type="simulate"};function Yo(e){return!!e?.[_]}function Ei(e){return e?.[ke]}function Ve(e){return(typeof e.value!="string"||e.dataType.type==="unknown")&&Ei(e.value)===void 0}function Gl(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||Yo(e)||Qt(e)||os(e)||us(e)||hs(e)}function ls(e){return!!e&&typeof e=="object"&&"getMappedRange"in e&&"mapAsync"in e}var ti=!1;function Ll(e){if(ti)return e();try{return ti=!0,e()}finally{ti=!1}}function ci(){return ti}var Lt;function Xo(e,t){if(dt(Lt===void 0||Lt===e),Lt===e)return t();Lt=e;try{return t()}finally{Lt=void 0}}function Ae(){return Lt}var Zo=new kn;function pi(){return Lt?.mode??Zo}function nt(){return Lt?.mode.type==="codegen"}function c(e,...t){let r=Ae();function n(s){return Os(s)?r.resolve(s.value,s.dataType).value:s}let i="";for(let s=0;s<e.length;++s){i+=e[s];let a=t[s];Array.isArray(a)?i+=a.filter(o=>o!==void 0).map(n).join(", "):a&&(i+=n(a))}return i}var Rl=(()=>{let e=n=>{if(n.origin==="argument")throw new j(c`d.ref(${n}) is illegal, cannot take a reference of an argument. Copy the value locally first, and take a reference of the copy.`);if(n.dataType.type==="ptr")return y(n.value,Cl(n.dataType),n.origin);let i=Ho(n.origin,n.dataType);return y(new Et(n,i),i??Qe,"runtime")},t=n=>new Jo(n),r=n=>nt()?e(n):t(n);return L(r,"ref"),r.toString=()=>"ref",Object.defineProperty(r,l,{value:{jsImpl:t,gpuImpl:e,strictSignature:void 0,argConversionHint:"keep"}}),r})();function Qo(e){return e instanceof Jo}var Jo=class{[l];type;#e;constructor(t){this[l]=!0,this.type="ref",this.#e=t}get $(){return this.#e}set $(t){if(t&&typeof t=="object")for(let r of Object.keys(t))this.#e[r]=t[r];else this.#e=t}},Et=class{[l];snippet;#e;constructor(t,r){this[l]=!0,this.snippet=t,this.#e=r}get[ke](){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return y(this,this.#e,this.snippet.origin)}[_](t){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return y(c`(&${this.snippet})`,this.#e,this.snippet.origin)}};function Cs(e){if(!Je(e.dataType))return e;let t=e.dataType.inner,r=Te(t)?"runtime":e.origin;return e.value instanceof Et?y(c`${e.value.snippet}`,t,r):y(c`(*${e})`,t,r)}function Nr(e,t){throw new Error(`Failed to handle ${e} at ${t}`)}var Fs={rank:Number.POSITIVE_INFINITY,action:"none"};function di(e,t){let r=kt(e),n=kt(t);if(r.type===n.type)return{rank:0,action:"none"};if(r.type==="abstractFloat"){if(n.type==="f32")return{rank:1,action:"none"};if(n.type==="f16")return{rank:2,action:"none"}}if(r.type==="abstractInt"){if(n.type==="i32")return{rank:3,action:"none"};if(n.type==="u32")return{rank:4,action:"none"};if(n.type==="abstractFloat")return{rank:5,action:"none"};if(n.type==="f32")return{rank:6,action:"none"};if(n.type==="f16")return{rank:7,action:"none"}}return ft(r)&&ft(n)?di(r.primitive,n.primitive):hi(r)&&hi(n)?{rank:0,action:"none"}:Fs}function Dl(e,t){let r=kt(e),n=kt(t);if(r.type==="ptr"&&r.implicit&&di(r.inner,n).rank<Number.POSITIVE_INFINITY)return{rank:0,action:"deref"};if(n.type==="ptr"&&di(r,n.inner).rank<Number.POSITIVE_INFINITY)return{rank:1,action:"ref"};let i={f32:0,f16:1,i32:2,u32:3,bool:4};if(r.type in i&&n.type in i){let s=r.type,a=n.type;if(s!==a){let o=i[s];return{rank:i[a]<o?10:20,action:"cast",targetType:n}}}if(r.type==="abstractFloat"){if(n.type==="u32")return{rank:2,action:"cast",targetType:n};if(n.type==="i32")return{rank:1,action:"cast",targetType:n}}return Fs}function Nl(e,t,r){let n=di(e,t);return n.rank<Number.POSITIVE_INFINITY?n:r?Dl(e,t):Fs}function Pa(e,t,r){let n;for(let s of t){let a=[],o=0;for(let u of e){let h=Nl(u,s,r);if(o+=h.rank,h.rank===Number.POSITIVE_INFINITY)break;a.push(h)}o<(n?.sum??Number.POSITIVE_INFINITY)&&(n={type:s,details:a,sum:o})}if(!n)return;let i=n.details.map((s,a)=>({sourceIndex:a,action:s.action,...s.action==="cast"&&{targetType:s.targetType}}));return{targetType:n.type,actions:i,hasImplicitConversions:i.some(s=>s.action==="cast")}}function js(e,t){if(e.length===0)return;let r=[...new Set((t||e).map(kt))],n=Pa(e,r,!1);if(n)return n;let i=Pa(e,r,!0);if(i)return i}function Wl(e,t,r){if(t.action==="none")return y(e.value,r,e.origin);switch(t.action){case"ref":return y(new Et(e,r),r,e.origin);case"deref":return Cs(e);case"cast":return r(e);default:Nr(t.action,"applyActionToSnippet")}}function ye(e,t){if(e.some(n=>n.type==="unknown"))return;let r=js(e,t);if(r)return e.map(()=>r.targetType)}function Fr(e,t,r=!0){let n=e.map(s=>s.dataType);if(n.some(s=>s.type==="unknown"))return;let i=js(n,t);if(i)return e.map((s,a)=>{let o=i.actions[a];return dt(o),Wl(s,o,i.targetType)})}function rr(e,t,r=!0){if(t===e.dataType)return y(e.value,t,e.origin);if(e.dataType.type==="unknown")return y(c`${y(e.value,t,e.origin)}`,t,e.origin);let n=Fr([e],[t],r);if(!n)throw new j(`Cannot convert value of type '${String(e.dataType)}' to type '${t.type}'`);return n[0]}function ql(e,t){return Object.keys(e.propTypes).map(r=>{let n=t[r];if(!n)throw new Error(`Missing property ${r}`);let i=e.propTypes[r];return Fr([n],[i])?.[0]??n})}var rt=class extends Error{constructor(t){super(t),this.name=this.constructor.name}};function d(e){let t=(...n)=>{let i=Ae(),{argTypes:s,returnType:a}=typeof e.signature=="function"?e.signature(...n.map(u=>u.dataType.type==="ptr"&&u.dataType.implicit?u.dataType.inner:u.dataType)):e.signature,o=n.map((u,h)=>{let p=s[h];if(!p)throw new Error("Function called with invalid arguments");return rr(u,p,!e.ignoreImplicitCastWarning)});if(!e.noComptime&&o.every(u=>Ve(u))&&typeof e.normalImpl=="function"){i.pushMode(new kn);try{return y(e.normalImpl(...o.map(u=>u.value)),a,"constant")}catch(u){if(!(u instanceof rt))throw u}finally{i.popMode("normal")}}return y(e.codegenImpl(...o),a,"runtime")},r=((...n)=>{if(nt())return t(...n);if(typeof e.normalImpl=="string")throw new rt(e.normalImpl);return e.normalImpl(...n)});return L(r,e.name),r.toString=()=>e.name,Object.defineProperty(r,l,{value:{jsImpl:e.normalImpl,gpuImpl:t,get strictSignature(){return typeof e.signature!="function"?e.signature:void 0},argConversionHint:"keep"}}),r}var Un={[l]:!0,type:"abstractInt",toString(){return"abstractInt"}},mt={[l]:!0,type:"abstractFloat",toString(){return"abstractFloat"}},Hl=d({name:"bool",signature:e=>({argTypes:e?[e]:[],returnType:G}),normalImpl(e){return e===void 0?!1:typeof e=="boolean"?e:!!e},codegenImpl:e=>e.dataType.type==="bool"?c`${e}`:c`bool(${e})`}),G=Object.assign(Hl,{type:"bool"}),Yl=d({name:"u32",signature:e=>({argTypes:e?[e]:[],returnType:b}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:(e&4294967295)>>>0},codegenImpl:e=>e.dataType.type==="u32"?c`${e}`:c`u32(${e})`}),b=Object.assign(Yl,{type:"u32"}),Xl=d({name:"i32",signature:e=>({argTypes:e?[e]:[],returnType:V}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:e|0},codegenImpl:e=>e.dataType.type==="i32"?c`${e}`:c`i32(${e})`}),Zl={[l]:!0,type:"u16"},V=Object.assign(Xl,{type:"i32"}),Ql=d({name:"f32",signature:e=>({argTypes:e?[e]:[],returnType:g}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Math.fround(e)},codegenImpl:e=>e.dataType.type==="f32"?c`${e}`:c`f32(${e})`}),g=Object.assign(Ql,{type:"f32"}),Ko=new ArrayBuffer(4),Jl=new Float32Array(Ko),Kl=new Uint32Array(Ko);function ec(e){Jl[0]=e;let t=Kl[0],r=t>>>31&1,n=t>>>23&255,i=t&8388607;return n===255?r<<15|31744|(i?512:0):(n=n-127+15,n<=0?n<-10?r<<15:(i=(i|8388608)>>1-n,i=i+4096>>13,r<<15|i):n>=31||(i=i+4096,i&8388608&&(i=0,++n,n>=31))?r<<15|31744:r<<15|n<<10|i>>13)}function tc(e){let t=e&32768?-1:1,r=e>>10&31,n=e&1023;return r===0?n?t*n*2**-24:t*0:r===31?n?Number.NaN:t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t*(1+n/1024)*2**(r-15)}function rc(e){return tc(ec(e))}var nc=d({name:"f16",signature:e=>({argTypes:e?[e]:[],returnType:oe}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:rc(e)},codegenImpl:e=>e.dataType.type==="f16"?c`${e}`:c`f16(${e})`}),oe=Object.assign(nc,{type:"f16"}),cr=class extends Array{castElement(){return this[l].elementSchema[l].jsImpl}[_](){let t=this[l].elementSchema;return this.every(r=>!r)?y(`${this.kind}()`,t,"constant"):this.every(r=>this[0]===r)?y(`${this.kind}(${this[0]})`,t,"runtime"):y(`${this.kind}(${this.join(", ")})`,t,"runtime")}toString(){return this[_]().value}get xx(){return new this._Vec2(this[0],this[0])}get xy(){return new this._Vec2(this[0],this[1])}get xz(){return new this._Vec2(this[0],this[2])}get xw(){return new this._Vec2(this[0],this[3])}get yx(){return new this._Vec2(this[1],this[0])}get yy(){return new this._Vec2(this[1],this[1])}get yz(){return new this._Vec2(this[1],this[2])}get yw(){return new this._Vec2(this[1],this[3])}get zx(){return new this._Vec2(this[2],this[0])}get zy(){return new this._Vec2(this[2],this[1])}get zz(){return new this._Vec2(this[2],this[2])}get zw(){return new this._Vec2(this[2],this[3])}get wx(){return new this._Vec2(this[3],this[0])}get wy(){return new this._Vec2(this[3],this[1])}get wz(){return new this._Vec2(this[3],this[2])}get ww(){return new this._Vec2(this[3],this[3])}get xxx(){return new this._Vec3(this[0],this[0],this[0])}get xxy(){return new this._Vec3(this[0],this[0],this[1])}get xxz(){return new this._Vec3(this[0],this[0],this[2])}get xxw(){return new this._Vec3(this[0],this[0],this[3])}get xyx(){return new this._Vec3(this[0],this[1],this[0])}get xyy(){return new this._Vec3(this[0],this[1],this[1])}get xyz(){return new this._Vec3(this[0],this[1],this[2])}get xyw(){return new this._Vec3(this[0],this[1],this[3])}get xzx(){return new this._Vec3(this[0],this[2],this[0])}get xzy(){return new this._Vec3(this[0],this[2],this[1])}get xzz(){return new this._Vec3(this[0],this[2],this[2])}get xzw(){return new this._Vec3(this[0],this[2],this[3])}get xwx(){return new this._Vec3(this[0],this[3],this[0])}get xwy(){return new this._Vec3(this[0],this[3],this[1])}get xwz(){return new this._Vec3(this[0],this[3],this[2])}get xww(){return new this._Vec3(this[0],this[3],this[3])}get yxx(){return new this._Vec3(this[1],this[0],this[0])}get yxy(){return new this._Vec3(this[1],this[0],this[1])}get yxz(){return new this._Vec3(this[1],this[0],this[2])}get yxw(){return new this._Vec3(this[1],this[0],this[3])}get yyx(){return new this._Vec3(this[1],this[1],this[0])}get yyy(){return new this._Vec3(this[1],this[1],this[1])}get yyz(){return new this._Vec3(this[1],this[1],this[2])}get yyw(){return new this._Vec3(this[1],this[1],this[3])}get yzx(){return new this._Vec3(this[1],this[2],this[0])}get yzy(){return new this._Vec3(this[1],this[2],this[1])}get yzz(){return new this._Vec3(this[1],this[2],this[2])}get yzw(){return new this._Vec3(this[1],this[2],this[3])}get ywx(){return new this._Vec3(this[1],this[3],this[0])}get ywy(){return new this._Vec3(this[1],this[3],this[1])}get ywz(){return new this._Vec3(this[1],this[3],this[2])}get yww(){return new this._Vec3(this[1],this[3],this[3])}get zxx(){return new this._Vec3(this[2],this[0],this[0])}get zxy(){return new this._Vec3(this[2],this[0],this[1])}get zxz(){return new this._Vec3(this[2],this[0],this[2])}get zxw(){return new this._Vec3(this[2],this[0],this[3])}get zyx(){return new this._Vec3(this[2],this[1],this[0])}get zyy(){return new this._Vec3(this[2],this[1],this[1])}get zyz(){return new this._Vec3(this[2],this[1],this[2])}get zyw(){return new this._Vec3(this[2],this[1],this[3])}get zzx(){return new this._Vec3(this[2],this[2],this[0])}get zzy(){return new this._Vec3(this[2],this[2],this[1])}get zzz(){return new this._Vec3(this[2],this[2],this[2])}get zzw(){return new this._Vec3(this[2],this[2],this[3])}get zwx(){return new this._Vec3(this[2],this[3],this[0])}get zwy(){return new this._Vec3(this[2],this[3],this[1])}get zwz(){return new this._Vec3(this[2],this[3],this[2])}get zww(){return new this._Vec3(this[2],this[3],this[3])}get wxx(){return new this._Vec3(this[3],this[0],this[0])}get wxy(){return new this._Vec3(this[3],this[0],this[1])}get wxz(){return new this._Vec3(this[3],this[0],this[2])}get wxw(){return new this._Vec3(this[3],this[0],this[3])}get wyx(){return new this._Vec3(this[3],this[1],this[0])}get wyy(){return new this._Vec3(this[3],this[1],this[1])}get wyz(){return new this._Vec3(this[3],this[1],this[2])}get wyw(){return new this._Vec3(this[3],this[1],this[3])}get wzx(){return new this._Vec3(this[3],this[2],this[0])}get wzy(){return new this._Vec3(this[3],this[2],this[1])}get wzz(){return new this._Vec3(this[3],this[2],this[2])}get wzw(){return new this._Vec3(this[3],this[2],this[3])}get wwx(){return new this._Vec3(this[3],this[3],this[0])}get wwy(){return new this._Vec3(this[3],this[3],this[1])}get wwz(){return new this._Vec3(this[3],this[3],this[2])}get www(){return new this._Vec3(this[3],this[3],this[3])}get xxxx(){return new this._Vec4(this[0],this[0],this[0],this[0])}get xxxy(){return new this._Vec4(this[0],this[0],this[0],this[1])}get xxxz(){return new this._Vec4(this[0],this[0],this[0],this[2])}get xxxw(){return new this._Vec4(this[0],this[0],this[0],this[3])}get xxyx(){return new this._Vec4(this[0],this[0],this[1],this[0])}get xxyy(){return new this._Vec4(this[0],this[0],this[1],this[1])}get xxyz(){return new this._Vec4(this[0],this[0],this[1],this[2])}get xxyw(){return new this._Vec4(this[0],this[0],this[1],this[3])}get xxzx(){return new this._Vec4(this[0],this[0],this[2],this[0])}get xxzy(){return new this._Vec4(this[0],this[0],this[2],this[1])}get xxzz(){return new this._Vec4(this[0],this[0],this[2],this[2])}get xxzw(){return new this._Vec4(this[0],this[0],this[2],this[3])}get xxwx(){return new this._Vec4(this[0],this[0],this[3],this[0])}get xxwy(){return new this._Vec4(this[0],this[0],this[3],this[1])}get xxwz(){return new this._Vec4(this[0],this[0],this[3],this[2])}get xxww(){return new this._Vec4(this[0],this[0],this[3],this[3])}get xyxx(){return new this._Vec4(this[0],this[1],this[0],this[0])}get xyxy(){return new this._Vec4(this[0],this[1],this[0],this[1])}get xyxz(){return new this._Vec4(this[0],this[1],this[0],this[2])}get xyxw(){return new this._Vec4(this[0],this[1],this[0],this[3])}get xyyx(){return new this._Vec4(this[0],this[1],this[1],this[0])}get xyyy(){return new this._Vec4(this[0],this[1],this[1],this[1])}get xyyz(){return new this._Vec4(this[0],this[1],this[1],this[2])}get xyyw(){return new this._Vec4(this[0],this[1],this[1],this[3])}get xyzx(){return new this._Vec4(this[0],this[1],this[2],this[0])}get xyzy(){return new this._Vec4(this[0],this[1],this[2],this[1])}get xyzz(){return new this._Vec4(this[0],this[1],this[2],this[2])}get xyzw(){return new this._Vec4(this[0],this[1],this[2],this[3])}get xywx(){return new this._Vec4(this[0],this[1],this[3],this[0])}get xywy(){return new this._Vec4(this[0],this[1],this[3],this[1])}get xywz(){return new this._Vec4(this[0],this[1],this[3],this[2])}get xyww(){return new this._Vec4(this[0],this[1],this[3],this[3])}get xzxx(){return new this._Vec4(this[0],this[2],this[0],this[0])}get xzxy(){return new this._Vec4(this[0],this[2],this[0],this[1])}get xzxz(){return new this._Vec4(this[0],this[2],this[0],this[2])}get xzxw(){return new this._Vec4(this[0],this[2],this[0],this[3])}get xzyx(){return new this._Vec4(this[0],this[2],this[1],this[0])}get xzyy(){return new this._Vec4(this[0],this[2],this[1],this[1])}get xzyz(){return new this._Vec4(this[0],this[2],this[1],this[2])}get xzyw(){return new this._Vec4(this[0],this[2],this[1],this[3])}get xzzx(){return new this._Vec4(this[0],this[2],this[2],this[0])}get xzzy(){return new this._Vec4(this[0],this[2],this[2],this[1])}get xzzz(){return new this._Vec4(this[0],this[2],this[2],this[2])}get xzzw(){return new this._Vec4(this[0],this[2],this[2],this[3])}get xzwx(){return new this._Vec4(this[0],this[2],this[3],this[0])}get xzwy(){return new this._Vec4(this[0],this[2],this[3],this[1])}get xzwz(){return new this._Vec4(this[0],this[2],this[3],this[2])}get xzww(){return new this._Vec4(this[0],this[2],this[3],this[3])}get xwxx(){return new this._Vec4(this[0],this[3],this[0],this[0])}get xwxy(){return new this._Vec4(this[0],this[3],this[0],this[1])}get xwxz(){return new this._Vec4(this[0],this[3],this[0],this[2])}get xwxw(){return new this._Vec4(this[0],this[3],this[0],this[3])}get xwyx(){return new this._Vec4(this[0],this[3],this[1],this[0])}get xwyy(){return new this._Vec4(this[0],this[3],this[1],this[1])}get xwyz(){return new this._Vec4(this[0],this[3],this[1],this[2])}get xwyw(){return new this._Vec4(this[0],this[3],this[1],this[3])}get xwzx(){return new this._Vec4(this[0],this[3],this[2],this[0])}get xwzy(){return new this._Vec4(this[0],this[3],this[2],this[1])}get xwzz(){return new this._Vec4(this[0],this[3],this[2],this[2])}get xwzw(){return new this._Vec4(this[0],this[3],this[2],this[3])}get xwwx(){return new this._Vec4(this[0],this[3],this[3],this[0])}get xwwy(){return new this._Vec4(this[0],this[3],this[3],this[1])}get xwwz(){return new this._Vec4(this[0],this[3],this[3],this[2])}get xwww(){return new this._Vec4(this[0],this[3],this[3],this[3])}get yxxx(){return new this._Vec4(this[1],this[0],this[0],this[0])}get yxxy(){return new this._Vec4(this[1],this[0],this[0],this[1])}get yxxz(){return new this._Vec4(this[1],this[0],this[0],this[2])}get yxxw(){return new this._Vec4(this[1],this[0],this[0],this[3])}get yxyx(){return new this._Vec4(this[1],this[0],this[1],this[0])}get yxyy(){return new this._Vec4(this[1],this[0],this[1],this[1])}get yxyz(){return new this._Vec4(this[1],this[0],this[1],this[2])}get yxyw(){return new this._Vec4(this[1],this[0],this[1],this[3])}get yxzx(){return new this._Vec4(this[1],this[0],this[2],this[0])}get yxzy(){return new this._Vec4(this[1],this[0],this[2],this[1])}get yxzz(){return new this._Vec4(this[1],this[0],this[2],this[2])}get yxzw(){return new this._Vec4(this[1],this[0],this[2],this[3])}get yxwx(){return new this._Vec4(this[1],this[0],this[3],this[0])}get yxwy(){return new this._Vec4(this[1],this[0],this[3],this[1])}get yxwz(){return new this._Vec4(this[1],this[0],this[3],this[2])}get yxww(){return new this._Vec4(this[1],this[0],this[3],this[3])}get yyxx(){return new this._Vec4(this[1],this[1],this[0],this[0])}get yyxy(){return new this._Vec4(this[1],this[1],this[0],this[1])}get yyxz(){return new this._Vec4(this[1],this[1],this[0],this[2])}get yyxw(){return new this._Vec4(this[1],this[1],this[0],this[3])}get yyyx(){return new this._Vec4(this[1],this[1],this[1],this[0])}get yyyy(){return new this._Vec4(this[1],this[1],this[1],this[1])}get yyyz(){return new this._Vec4(this[1],this[1],this[1],this[2])}get yyyw(){return new this._Vec4(this[1],this[1],this[1],this[3])}get yyzx(){return new this._Vec4(this[1],this[1],this[2],this[0])}get yyzy(){return new this._Vec4(this[1],this[1],this[2],this[1])}get yyzz(){return new this._Vec4(this[1],this[1],this[2],this[2])}get yyzw(){return new this._Vec4(this[1],this[1],this[2],this[3])}get yywx(){return new this._Vec4(this[1],this[1],this[3],this[0])}get yywy(){return new this._Vec4(this[1],this[1],this[3],this[1])}get yywz(){return new this._Vec4(this[1],this[1],this[3],this[2])}get yyww(){return new this._Vec4(this[1],this[1],this[3],this[3])}get yzxx(){return new this._Vec4(this[1],this[2],this[0],this[0])}get yzxy(){return new this._Vec4(this[1],this[2],this[0],this[1])}get yzxz(){return new this._Vec4(this[1],this[2],this[0],this[2])}get yzxw(){return new this._Vec4(this[1],this[2],this[0],this[3])}get yzyx(){return new this._Vec4(this[1],this[2],this[1],this[0])}get yzyy(){return new this._Vec4(this[1],this[2],this[1],this[1])}get yzyz(){return new this._Vec4(this[1],this[2],this[1],this[2])}get yzyw(){return new this._Vec4(this[1],this[2],this[1],this[3])}get yzzx(){return new this._Vec4(this[1],this[2],this[2],this[0])}get yzzy(){return new this._Vec4(this[1],this[2],this[2],this[1])}get yzzz(){return new this._Vec4(this[1],this[2],this[2],this[2])}get yzzw(){return new this._Vec4(this[1],this[2],this[2],this[3])}get yzwx(){return new this._Vec4(this[1],this[2],this[3],this[0])}get yzwy(){return new this._Vec4(this[1],this[2],this[3],this[1])}get yzwz(){return new this._Vec4(this[1],this[2],this[3],this[2])}get yzww(){return new this._Vec4(this[1],this[2],this[3],this[3])}get ywxx(){return new this._Vec4(this[1],this[3],this[0],this[0])}get ywxy(){return new this._Vec4(this[1],this[3],this[0],this[1])}get ywxz(){return new this._Vec4(this[1],this[3],this[0],this[2])}get ywxw(){return new this._Vec4(this[1],this[3],this[0],this[3])}get ywyx(){return new this._Vec4(this[1],this[3],this[1],this[0])}get ywyy(){return new this._Vec4(this[1],this[3],this[1],this[1])}get ywyz(){return new this._Vec4(this[1],this[3],this[1],this[2])}get ywyw(){return new this._Vec4(this[1],this[3],this[1],this[3])}get ywzx(){return new this._Vec4(this[1],this[3],this[2],this[0])}get ywzy(){return new this._Vec4(this[1],this[3],this[2],this[1])}get ywzz(){return new this._Vec4(this[1],this[3],this[2],this[2])}get ywzw(){return new this._Vec4(this[1],this[3],this[2],this[3])}get ywwx(){return new this._Vec4(this[1],this[3],this[3],this[0])}get ywwy(){return new this._Vec4(this[1],this[3],this[3],this[1])}get ywwz(){return new this._Vec4(this[1],this[3],this[3],this[2])}get ywww(){return new this._Vec4(this[1],this[3],this[3],this[3])}get zxxx(){return new this._Vec4(this[2],this[0],this[0],this[0])}get zxxy(){return new this._Vec4(this[2],this[0],this[0],this[1])}get zxxz(){return new this._Vec4(this[2],this[0],this[0],this[2])}get zxxw(){return new this._Vec4(this[2],this[0],this[0],this[3])}get zxyx(){return new this._Vec4(this[2],this[0],this[1],this[0])}get zxyy(){return new this._Vec4(this[2],this[0],this[1],this[1])}get zxyz(){return new this._Vec4(this[2],this[0],this[1],this[2])}get zxyw(){return new this._Vec4(this[2],this[0],this[1],this[3])}get zxzx(){return new this._Vec4(this[2],this[0],this[2],this[0])}get zxzy(){return new this._Vec4(this[2],this[0],this[2],this[1])}get zxzz(){return new this._Vec4(this[2],this[0],this[2],this[2])}get zxzw(){return new this._Vec4(this[2],this[0],this[2],this[3])}get zxwx(){return new this._Vec4(this[2],this[0],this[3],this[0])}get zxwy(){return new this._Vec4(this[2],this[0],this[3],this[1])}get zxwz(){return new this._Vec4(this[2],this[0],this[3],this[2])}get zxww(){return new this._Vec4(this[2],this[0],this[3],this[3])}get zyxx(){return new this._Vec4(this[2],this[1],this[0],this[0])}get zyxy(){return new this._Vec4(this[2],this[1],this[0],this[1])}get zyxz(){return new this._Vec4(this[2],this[1],this[0],this[2])}get zyxw(){return new this._Vec4(this[2],this[1],this[0],this[3])}get zyyx(){return new this._Vec4(this[2],this[1],this[1],this[0])}get zyyy(){return new this._Vec4(this[2],this[1],this[1],this[1])}get zyyz(){return new this._Vec4(this[2],this[1],this[1],this[2])}get zyyw(){return new this._Vec4(this[2],this[1],this[1],this[3])}get zyzx(){return new this._Vec4(this[2],this[1],this[2],this[0])}get zyzy(){return new this._Vec4(this[2],this[1],this[2],this[1])}get zyzz(){return new this._Vec4(this[2],this[1],this[2],this[2])}get zyzw(){return new this._Vec4(this[2],this[1],this[2],this[3])}get zywx(){return new this._Vec4(this[2],this[1],this[3],this[0])}get zywy(){return new this._Vec4(this[2],this[1],this[3],this[1])}get zywz(){return new this._Vec4(this[2],this[1],this[3],this[2])}get zyww(){return new this._Vec4(this[2],this[1],this[3],this[3])}get zzxx(){return new this._Vec4(this[2],this[2],this[0],this[0])}get zzxy(){return new this._Vec4(this[2],this[2],this[0],this[1])}get zzxz(){return new this._Vec4(this[2],this[2],this[0],this[2])}get zzxw(){return new this._Vec4(this[2],this[2],this[0],this[3])}get zzyx(){return new this._Vec4(this[2],this[2],this[1],this[0])}get zzyy(){return new this._Vec4(this[2],this[2],this[1],this[1])}get zzyz(){return new this._Vec4(this[2],this[2],this[1],this[2])}get zzyw(){return new this._Vec4(this[2],this[2],this[1],this[3])}get zzzx(){return new this._Vec4(this[2],this[2],this[2],this[0])}get zzzy(){return new this._Vec4(this[2],this[2],this[2],this[1])}get zzzz(){return new this._Vec4(this[2],this[2],this[2],this[2])}get zzzw(){return new this._Vec4(this[2],this[2],this[2],this[3])}get zzwx(){return new this._Vec4(this[2],this[2],this[3],this[0])}get zzwy(){return new this._Vec4(this[2],this[2],this[3],this[1])}get zzwz(){return new this._Vec4(this[2],this[2],this[3],this[2])}get zzww(){return new this._Vec4(this[2],this[2],this[3],this[3])}get zwxx(){return new this._Vec4(this[2],this[3],this[0],this[0])}get zwxy(){return new this._Vec4(this[2],this[3],this[0],this[1])}get zwxz(){return new this._Vec4(this[2],this[3],this[0],this[2])}get zwxw(){return new this._Vec4(this[2],this[3],this[0],this[3])}get zwyx(){return new this._Vec4(this[2],this[3],this[1],this[0])}get zwyy(){return new this._Vec4(this[2],this[3],this[1],this[1])}get zwyz(){return new this._Vec4(this[2],this[3],this[1],this[2])}get zwyw(){return new this._Vec4(this[2],this[3],this[1],this[3])}get zwzx(){return new this._Vec4(this[2],this[3],this[2],this[0])}get zwzy(){return new this._Vec4(this[2],this[3],this[2],this[1])}get zwzz(){return new this._Vec4(this[2],this[3],this[2],this[2])}get zwzw(){return new this._Vec4(this[2],this[3],this[2],this[3])}get zwwx(){return new this._Vec4(this[2],this[3],this[3],this[0])}get zwwy(){return new this._Vec4(this[2],this[3],this[3],this[1])}get zwwz(){return new this._Vec4(this[2],this[3],this[3],this[2])}get zwww(){return new this._Vec4(this[2],this[3],this[3],this[3])}get wxxx(){return new this._Vec4(this[3],this[0],this[0],this[0])}get wxxy(){return new this._Vec4(this[3],this[0],this[0],this[1])}get wxxz(){return new this._Vec4(this[3],this[0],this[0],this[2])}get wxxw(){return new this._Vec4(this[3],this[0],this[0],this[3])}get wxyx(){return new this._Vec4(this[3],this[0],this[1],this[0])}get wxyy(){return new this._Vec4(this[3],this[0],this[1],this[1])}get wxyz(){return new this._Vec4(this[3],this[0],this[1],this[2])}get wxyw(){return new this._Vec4(this[3],this[0],this[1],this[3])}get wxzx(){return new this._Vec4(this[3],this[0],this[2],this[0])}get wxzy(){return new this._Vec4(this[3],this[0],this[2],this[1])}get wxzz(){return new this._Vec4(this[3],this[0],this[2],this[2])}get wxzw(){return new this._Vec4(this[3],this[0],this[2],this[3])}get wxwx(){return new this._Vec4(this[3],this[0],this[3],this[0])}get wxwy(){return new this._Vec4(this[3],this[0],this[3],this[1])}get wxwz(){return new this._Vec4(this[3],this[0],this[3],this[2])}get wxww(){return new this._Vec4(this[3],this[0],this[3],this[3])}get wyxx(){return new this._Vec4(this[3],this[1],this[0],this[0])}get wyxy(){return new this._Vec4(this[3],this[1],this[0],this[1])}get wyxz(){return new this._Vec4(this[3],this[1],this[0],this[2])}get wyxw(){return new this._Vec4(this[3],this[1],this[0],this[3])}get wyyx(){return new this._Vec4(this[3],this[1],this[1],this[0])}get wyyy(){return new this._Vec4(this[3],this[1],this[1],this[1])}get wyyz(){return new this._Vec4(this[3],this[1],this[1],this[2])}get wyyw(){return new this._Vec4(this[3],this[1],this[1],this[3])}get wyzx(){return new this._Vec4(this[3],this[1],this[2],this[0])}get wyzy(){return new this._Vec4(this[3],this[1],this[2],this[1])}get wyzz(){return new this._Vec4(this[3],this[1],this[2],this[2])}get wyzw(){return new this._Vec4(this[3],this[1],this[2],this[3])}get wywx(){return new this._Vec4(this[3],this[1],this[3],this[0])}get wywy(){return new this._Vec4(this[3],this[1],this[3],this[1])}get wywz(){return new this._Vec4(this[3],this[1],this[3],this[2])}get wyww(){return new this._Vec4(this[3],this[1],this[3],this[3])}get wzxx(){return new this._Vec4(this[3],this[2],this[0],this[0])}get wzxy(){return new this._Vec4(this[3],this[2],this[0],this[1])}get wzxz(){return new this._Vec4(this[3],this[2],this[0],this[2])}get wzxw(){return new this._Vec4(this[3],this[2],this[0],this[3])}get wzyx(){return new this._Vec4(this[3],this[2],this[1],this[0])}get wzyy(){return new this._Vec4(this[3],this[2],this[1],this[1])}get wzyz(){return new this._Vec4(this[3],this[2],this[1],this[2])}get wzyw(){return new this._Vec4(this[3],this[2],this[1],this[3])}get wzzx(){return new this._Vec4(this[3],this[2],this[2],this[0])}get wzzy(){return new this._Vec4(this[3],this[2],this[2],this[1])}get wzzz(){return new this._Vec4(this[3],this[2],this[2],this[2])}get wzzw(){return new this._Vec4(this[3],this[2],this[2],this[3])}get wzwx(){return new this._Vec4(this[3],this[2],this[3],this[0])}get wzwy(){return new this._Vec4(this[3],this[2],this[3],this[1])}get wzwz(){return new this._Vec4(this[3],this[2],this[3],this[2])}get wzww(){return new this._Vec4(this[3],this[2],this[3],this[3])}get wwxx(){return new this._Vec4(this[3],this[3],this[0],this[0])}get wwxy(){return new this._Vec4(this[3],this[3],this[0],this[1])}get wwxz(){return new this._Vec4(this[3],this[3],this[0],this[2])}get wwxw(){return new this._Vec4(this[3],this[3],this[0],this[3])}get wwyx(){return new this._Vec4(this[3],this[3],this[1],this[0])}get wwyy(){return new this._Vec4(this[3],this[3],this[1],this[1])}get wwyz(){return new this._Vec4(this[3],this[3],this[1],this[2])}get wwyw(){return new this._Vec4(this[3],this[3],this[1],this[3])}get wwzx(){return new this._Vec4(this[3],this[3],this[2],this[0])}get wwzy(){return new this._Vec4(this[3],this[3],this[2],this[1])}get wwzz(){return new this._Vec4(this[3],this[3],this[2],this[2])}get wwzw(){return new this._Vec4(this[3],this[3],this[2],this[3])}get wwwx(){return new this._Vec4(this[3],this[3],this[3],this[0])}get wwwy(){return new this._Vec4(this[3],this[3],this[3],this[1])}get wwwz(){return new this._Vec4(this[3],this[3],this[3],this[2])}get wwww(){return new this._Vec4(this[3],this[3],this[3],this[3])}},Vn=class extends cr{e0;e1;constructor(t,r){super(2),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t)}get 0(){return this.e0}get 1(){return this.e1}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}},Pn=class extends cr{e0;e1;e2;constructor(t,r,n){super(3),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}set z(t){this[2]=this.castElement()(t)}},An=class extends cr{e0;e1;e2;e3;constructor(t,r,n,i){super(4),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t),this.e3=this.castElement()(i??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}get 3(){return this.e3}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}set 3(t){this.e3=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set w(t){this[3]=t}},Gs=class eu extends Vn{get[l](){return{elementSchema:g}}get kind(){return"vec2f"}get _Vec2(){return eu}get _Vec3(){return Ws}get _Vec4(){return Zs}},Ls=class tu extends Vn{get[l](){return{elementSchema:oe}}get kind(){return"vec2h"}get _Vec2(){return tu}get _Vec3(){return qs}get _Vec4(){return Qs}},Rs=class ru extends Vn{get[l](){return{elementSchema:V}}get kind(){return"vec2i"}get _Vec2(){return ru}get _Vec3(){return Hs}get _Vec4(){return Js}},Ds=class nu extends Vn{get[l](){return{elementSchema:b}}get kind(){return"vec2u"}get _Vec2(){return nu}get _Vec3(){return Ys}get _Vec4(){return Ks}},Ns=class iu extends Vn{get[l](){return{elementSchema:G}}get kind(){return"vec2<bool>"}get _Vec2(){return iu}get _Vec3(){return Xs}get _Vec4(){return ea}},Ws=class su extends Pn{get[l](){return{elementSchema:g}}get kind(){return"vec3f"}get _Vec2(){return Gs}get _Vec3(){return su}get _Vec4(){return Zs}},qs=class au extends Pn{get[l](){return{elementSchema:oe}}get kind(){return"vec3h"}get _Vec2(){return Ls}get _Vec3(){return au}get _Vec4(){return Qs}},Hs=class ou extends Pn{get[l](){return{elementSchema:V}}get kind(){return"vec3i"}get _Vec2(){return Rs}get _Vec3(){return ou}get _Vec4(){return Js}},Ys=class uu extends Pn{get[l](){return{elementSchema:b}}get kind(){return"vec3u"}get _Vec2(){return Ds}get _Vec3(){return uu}get _Vec4(){return Ks}},Xs=class hu extends Pn{get[l](){return{elementSchema:G}}get kind(){return"vec3<bool>"}get _Vec2(){return Ns}get _Vec3(){return hu}get _Vec4(){return ea}},Zs=class lu extends An{get[l](){return{elementSchema:g}}get kind(){return"vec4f"}get _Vec2(){return Gs}get _Vec3(){return Ws}get _Vec4(){return lu}},Qs=class cu extends An{get[l](){return{elementSchema:oe}}get kind(){return"vec4h"}get _Vec2(){return Ls}get _Vec3(){return qs}get _Vec4(){return cu}},Js=class pu extends An{get[l](){return{elementSchema:V}}get kind(){return"vec4i"}get _Vec2(){return Rs}get _Vec3(){return Hs}get _Vec4(){return pu}},Ks=class du extends An{get[l](){return{elementSchema:b}}get kind(){return"vec4u"}get _Vec2(){return Ds}get _Vec3(){return Ys}get _Vec4(){return du}},ea=class fu extends An{get[l](){return{elementSchema:G}}get kind(){return"vec4<bool>"}get _Vec2(){return Ns}get _Vec3(){return Xs}get _Vec4(){return fu}},D=Ie(Gs,g),yt=Ie(Ls,oe),q=Ie(Rs,V),Me=Ie(Ds,b),pr=Ie(Ns,G),ue=Ie(Ws,g),gt=Ie(qs,oe),Oe=Ie(Hs,V),ie=Ie(Ys,b),dr=Ie(Xs,G),I=Ie(Zs,g),wt=Ie(Qs,oe),pe=Ie(Js,V),ve=Ie(Ks,b),fr=Ie(ea,G),fi={vec2f:D,vec2h:yt,vec2i:q,vec2u:Me,"vec2<bool>":pr,vec3f:ue,vec3h:gt,vec3i:Oe,vec3u:ie,"vec3<bool>":dr,vec4f:I,vec4h:wt,vec4i:pe,vec4u:ve,"vec4<bool>":fr};function Ie(e,t){let{kind:r,length:n}=new e,i=d({name:r,signature:(...a)=>({argTypes:a.map(o=>ft(o)?o:t),returnType:s}),normalImpl:(...a)=>{let o=new Array(a.length),u=0;for(let h of a)if(typeof h=="number"||typeof h=="boolean")o[u++]=h;else for(let p=0;p<h.length;++p)o[u++]=h[p];if(o.length<=1||o.length===n)return new e(...o);throw new Error(`'${r}' constructor called with invalid number of arguments.`)},ignoreImplicitCastWarning:!0,codegenImpl:(...a)=>a.length===1&&a[0]?.dataType===s?c`${a[0]}`:c`${r}(${a})`}),s=Object.assign(i,{type:r,primitive:t,[Hr]:void 0});return e.prototype.schema=s,s}function mi(e){return e>=2**63||e<-9223372036854776e3?y(e,mt,"constant"):Number.isInteger(e)?(Number.isSafeInteger(e)||console.warn(`The integer ${e} exceeds the safe integer range and may have lost precision.`),y(e,Un,"constant")):y(e,mt,"constant")}function Rt(e){return e.type==="abstractFloat"?g:e.type==="abstractInt"?V:e}function ic(e){return e.map(t=>y(t.value,Rt(t.dataType),t.origin))}function Mi(e){if(Os(e))return e;if(Qo(e))throw new Error("Cannot use refs (d.ref(...)) from the outer scope.");return Ei(e)||(J(e)||pt(e)?y(e,$l(e),"constant"):typeof e=="string"||typeof e=="function"||typeof e=="object"||typeof e=="symbol"||typeof e>"u"||e===null?y(e,Qe,"constant"):typeof e=="number"?mi(e):typeof e=="boolean"?y(e,G,"constant"):y(e,Qe,"constant"))}function Yt(e){let t=(...n)=>{let i=n;if(!i.every(s=>Ve(s)))throw new j(`Called comptime function with runtime-known values: ${i.filter(s=>!Ve(s)).map(s=>`'${s.value}'`).join(", ")}`);return Mi(e(...i.map(s=>s.value)))},r=((...n)=>{let i=Ae();if(i?.mode.type==="codegen"){i.pushMode(new kn);try{return t(...n)}finally{i.popMode("normal")}}return e(...n)});return r.toString=()=>"comptime",r[ae]=e,r.$name=n=>(L(e,n),r),Object.defineProperty(r,l,{value:{jsImpl:e,gpuImpl:t,argConversionHint:"keep"}}),r}var S=class{constructor(t){this.type=t}[l]=!0},Vt={uint8:b,uint8x2:Me,uint8x4:ve,sint8:V,sint8x2:q,sint8x4:pe,unorm8:g,unorm8x2:D,unorm8x4:I,snorm8:g,snorm8x2:D,snorm8x4:I,uint16:b,uint16x2:Me,uint16x4:ve,sint16:V,sint16x2:q,sint16x4:pe,unorm16:g,unorm16x2:D,unorm16x4:I,snorm16:g,snorm16x2:D,snorm16x4:I,float16:g,float16x2:D,float16x4:I,float32:g,float32x2:D,float32x3:ue,float32x4:I,uint32:b,uint32x2:Me,uint32x3:ie,uint32x4:ve,sint32:V,sint32x2:q,sint32x3:Oe,sint32x4:pe,"unorm10-10-10-2":I,"unorm8x4-bgra":I},ta=new Set(Object.keys(Vt)),sc=new S("uint8"),ac=new S("uint8x2"),oc=new S("uint8x4"),uc=new S("sint8"),hc=new S("sint8x2"),lc=new S("sint8x4"),cc=new S("unorm8"),pc=new S("unorm8x2"),dc=new S("unorm8x4"),fc=new S("snorm8"),mc=new S("snorm8x2"),yc=new S("snorm8x4"),gc=new S("uint16"),wc=new S("uint16x2"),xc=new S("uint16x4"),vc=new S("sint16"),$c=new S("sint16x2"),bc=new S("sint16x4"),Tc=new S("unorm16"),_c=new S("unorm16x2"),zc=new S("unorm16x4"),Ic=new S("snorm16"),Sc=new S("snorm16x2"),Ec=new S("snorm16x4"),Mc=new S("float16"),kc=new S("float16x2"),Uc=new S("float16x4"),Vc=new S("float32"),Pc=new S("float32x2"),Ac=new S("float32x3"),Oc=new S("float32x4"),Bc=new S("uint32"),Cc=new S("uint32x2"),Fc=new S("uint32x3"),jc=new S("uint32x4"),Gc=new S("sint32"),Lc=new S("sint32x2"),Rc=new S("sint32x3"),Dc=new S("sint32x4"),Nc=new S("unorm10-10-10-2"),Wc=new S("unorm8x4-bgra");function mu(e){return O(e)&&ta.has(e?.type)}function Xt(e,t){let r=e?.type,n=r in Vt?Vt[r]:e;return typeof n!="function"?t:t===void 0?n():n(t)}function ki(e){return yu(e,!1)}function de(e){return yu(e,!0)}function yu(e,t){let r=n=>Object.fromEntries(Object.entries(e).map(([i,s])=>[i,Xt(s,n?.[i])]));return Object.setPrototypeOf(r,qc),r.propTypes=e,Object.defineProperty(r,l,{value:{isAbstruct:t}}),r}var qc={type:"struct",$name(e){return L(this,e),this},toString(){return`struct:${v(this)??"<unnamed>"}`}};function Zt(e){let t=String(e);if(t!=="[object Object]")return t;try{return JSON.stringify(e)}catch(r){return console.error("Error parsing JSON:",r),"<invalid json>"}}function cs(e){return J(e)||pt(e)?e.toString():Array.isArray(e)?`[${e.map(cs).join(", ")}]`:e&&typeof e=="object"?`{ ${Object.entries(e).map(([t,r])=>`${t}: ${cs(r)}`).join(", ")} }`:String(e)}var Hc={f32:4,f16:2,i32:4,u32:4,bool:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec2b:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec3b:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,vec4b:16,mat2x2f:8,mat3x3f:16,mat4x4f:16,atomic:4};function Yc(e){let t=e?.type,r=Hc[t];if(r!==void 0)return r;if(me(e))return Object.values(e.propTypes).map(K).reduce((n,i)=>n>i?n:i);if(ze(e))return K(e.elementType);if(et(e)){let n=Object.values(e.propTypes)[0];return n?yn(n)??1:1}if(Ut(e))return yn(e.elementType)??1;if(Ke(e)||tt(e))return yn(e)??K(e.inner);if(ta.has(t))return 1;throw new Error(`Cannot determine alignment of data: ${Zt(e)}`)}function Xc(e){if(et(e)){let t=Object.values(e.propTypes)[0];return t?De(t):1}return Ut(e)?De(e.elementType):tt(e)?yn(e)??De(e.inner):yn(e)??1}var Aa=new WeakMap,Oa=new WeakMap;function K(e){let t=Aa.get(e);return t===void 0&&(t=Yc(e),Aa.set(e,t)),t}function De(e){let t=Oa.get(e);return t===void 0&&(t=Xc(e),Oa.set(e,t)),t}function Zc(e){return K(e)}var Pe=(e,t)=>{let r=t-1,n=~r;return(e&r)===0?e:(e&n)+t},Qc={bool:4,f32:4,f16:2,i32:4,u32:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,"vec2<bool>":8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,"vec3<bool>":12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,"vec4<bool>":16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4,atomic:4};function Jc(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){if(Number.isNaN(t))throw new Error("Only the last property of a struct can be unbounded");if(t=Pe(t,K(n)),t+=P(n),Number.isNaN(t)&&n.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return Pe(t,K(e))}function Kc(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){let i=De(n);t=Pe(t,i),t+=P(n)}return t}function ep(e){let t=Qc[e?.type];if(t!==void 0)return t;if(me(e))return Jc(e);if(et(e))return Kc(e);if(ze(e)){if(e.elementCount===0)return Number.NaN;let r=K(e.elementType);return Pe(P(e.elementType),r)*e.elementCount}if(Ut(e)){let r=De(e.elementType);return Pe(P(e.elementType),r)*e.elementCount}if(Ke(e)||tt(e))return zl(e)??P(e.inner);throw new Error(`Cannot determine size of data: ${e}`)}var Ba=new WeakMap;function P(e){let t=Ba.get(e);return t===void 0&&(t=ep(e),Ba.set(e,t)),t}function tp(e){return P(e)}function Zr(e,t){return Ke(e)?new Ca(e.inner,[t,...e.attribs]):tt(e)?new Fa(e.inner,[t,...e.attribs]):Yr(e)?new Fa(e,[t]):new Ca(e,[t])}function rp(e,t){return Zr(t,{[l]:!0,type:"@align",params:[e]})}function np(e,t){return Zr(t,{[l]:!0,type:"@size",params:[e]})}function yi(e,t){return Zr(t,{[l]:!0,type:"@location",params:[e]})}function ip(e,t){return Zr(t,{[l]:!0,type:"@interpolate",params:[e]})}function sp(e){if(!Pt(e))throw new Error("The @invariant attribute must only be applied to the position built-in value.");let t=Ke(e)||tt(e)?e.attribs.find(Vs):void 0;if(!t||t.params[0]!=="position")throw new Error("The @invariant attribute must only be applied to the position built-in value.");return Zr(e,{[l]:!0,type:"@invariant",params:[]})}function Pt(e){return(Ke(e)||tt(e))&&e.attribs.find(Vs)!==void 0}function ra(e){return!Ke(e)&&!tt(e)?"":e.attribs.map(t=>t.params.length===0?`${t.type} `:`${t.type}(${t.params.join(", ")}) `).join("")}var gu=class{constructor(t,r){this.inner=t,this.attribs=r;let n=r.find(ks)?.params[0],i=r.find(Us)?.params[0];if(n!==void 0){if(n<=0)throw new Error(`Custom data alignment must be a positive number, got: ${n}.`);if(Math.log2(n)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${n}.`);if(Qt(this.inner)&&n%K(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${n}, expected multiple of: ${K(this.inner)}.`)}if(i!==void 0){if(i<P(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${i}, expected at least: ${P(this.inner)}.`);if(i<=0)throw new Error(`Custom data size must be a positive number. Got: ${i}.`)}}[l]=!0},Ca=class extends gu{[l]=!0;type="decorated"},Fa=class extends gu{[l]=!0;type="loose-decorated"},Tn=Yt(((e,t)=>t===void 0?Yt(r=>ja(e,r)):ja(e,t))).$name("arrayOf");function ja(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Array schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>Xt(e,n?.[s]))};if(Object.setPrototypeOf(r,ap),Number.isNaN(P(e)))throw new Error("Cannot nest runtime sized arrays.");if(r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create array schema with invalid element count: ${t}.`);return r.elementCount=t,r}var ap={[l]:!0,type:"array",toString(){return`arrayOf(${this.elementType}, ${this.elementCount})`}};function _e(e,t){return Zr(e,{[l]:!0,type:"@builtin",params:[t]})}var wu={vertexIndex:_e(b,"vertex_index"),instanceIndex:_e(b,"instance_index"),position:_e(I,"position"),clipDistances:_e(Tn(b,8),"clip_distances"),frontFacing:_e(G,"front_facing"),fragDepth:_e(g,"frag_depth"),sampleIndex:_e(b,"sample_index"),sampleMask:_e(b,"sample_mask"),localInvocationId:_e(ie,"local_invocation_id"),localInvocationIndex:_e(b,"local_invocation_index"),globalInvocationId:_e(ie,"global_invocation_id"),workgroupId:_e(ie,"workgroup_id"),numWorkgroups:_e(ie,"num_workgroups"),subgroupInvocationId:_e(b,"subgroup_invocation_id"),subgroupSize:_e(b,"subgroup_size")};function Dr(e,t){for(let[r,n]of Object.entries(t))e[r]=n,n&&(typeof n=="object"||typeof n=="function")&&v(n)===void 0&&L(n,r)}function op(e,t,r){let n=[...e.matchAll(/:\s*(?<arg>.*?)\s*[,)]/g)].map(i=>i?i[1]:void 0);r(Object.fromEntries(t.flatMap((i,s)=>{let a=n?n[s]:void 0;return me(i)&&a!==void 0?[[a,i]]:[]})))}function xu(e,t,r){let n=e.match(/->\s(?<output>[\w\d_]+)\s{/),i=n?n[1]?.trim():void 0;me(t)&&i&&!/\s/g.test(i)&&r({[i]:t})}function up(e){return new RegExp(`(?<![\\w\\$_.])${e.replaceAll(".","\\.").replaceAll("$","\\$")}(?![\\w\\$_])`,"g")}function On(e,t,r){return Object.entries(t).reduce((n,[i,s])=>{let a=up(i);if(r&&i!=="Out"&&i!=="In"&&!a.test(r)&&console.warn(`The external '${i}' wasn't used in the resolved template.`),Gl(s)||Yr(s)||mn(s))return n.replaceAll(a,e.resolve(s).value);if(s!==null&&typeof s=="object"){let o=[...r.matchAll(new RegExp(`${i.replaceAll(".","\\.").replaceAll("$","\\$")}\\.(?<prop>.*?)(?![\\w\\$_])`,"g"))].map(u=>u[1]);return[...new Set(o)].reduce((u,h)=>h&&h in s?On(e,{[`${i}.${h}`]:s[h]},u):u,n)}return console.warn(`During resolution, the external '${i}' has been omitted. Only TGPU resources, 'use gpu' functions, primitives, and plain JS objects can be used as externals.`),n},r)}function hp(e){let{strippedCode:t,argRange:r}=lp(e),n=new vu(t);n.consume("(");let i=[];for(;!n.isAt(")");){let a=[];for(;n.isAt("@");)n.parseUntil(Ga,La),n.consume(")"),a.push(n.lastParsed);n.parseUntil(pp);let o=n.lastParsed,u;n.isAt(":")&&(n.consume(":"),n.parseUntil(dp,mp),u=n.lastParsed),i.push({identifier:o,attributes:a,type:u}),n.isAt(",")&&n.consume(",")}n.consume(")");let s;if(n.isAt("->")){n.consume("->");let a=[];for(;n.isAt("@");)n.parseUntil(Ga,La),n.consume(")"),a.push(n.lastParsed);s={type:n.str.slice(n.pos),attributes:a}}return{args:i,ret:s,range:{begin:r[0],end:r[1]}}}function lp(e){let t=new vu(e),r="",n;for(;!t.isFinished();){if(t.isAt(cp)){t.advanceBy(1);continue}if(t.isAt("//")){t.consume("//"),t.parseUntil($u),t.advanceBy(1);continue}if(t.isAt("/*")){t.parseUntil(fp,yp),t.consume("*/");continue}if(t.isAt("{"))return{strippedCode:r,argRange:[n,t.pos]};t.isAt("(")&&n===void 0&&(n=t.pos),n!==void 0&&(r+=t.str[t.pos]),t.advanceBy(1)}throw new Error("Invalid wgsl code!")}var vu=class{constructor(t){this.str=t,this.#t=0}#e;#t;get pos(){return this.#t}get lastParsed(){if(this.#e===void 0)throw new Error("Parse was not called yet!");return this.str.slice(this.#e,this.pos)}isFinished(){return this.#t>=this.str.length}isAt(t){if(typeof t=="string"){for(let r=0;r<t.length;r++)if(this.str[this.#t+r]!==t[r])return!1;return!0}for(let r of t)if(this.isAt(r))return!0;return!1}parseUntil(t,r){this.#e=this.#t;let n=0;for(;this.#t<this.str.length;){if(r&&this.isAt(r[0])&&(n+=1),r&&this.isAt(r[1])&&(n-=1),n===0&&this.isAt(t))return this.#t;this.#t+=1}throw new Error("Reached the end of the string without finding a match!")}advanceBy(t){this.#t+=t}consume(t){if(!this.isAt(t))throw new Error(`Expected '${t}' at position ${this.#t}, but found '${this.str.slice(this.#t,this.#t+t.length)}'`);this.advanceBy(t.length)}},$u=new Set([`
`,"\v","\f","\r","","\u2028","\u2029"]),cp=new Set([...$u," ","	","",""]),Ga=new Set([")"]),pp=new Set([":",",",")"]),dp=new Set([",",")"]),fp=new Set(["*/"]),La=["(",")"],mp=["<",">"],yp=["/*","*/"];function Bn(e,t=""){let r=[],n={applyExternals(s){r.push(s)},resolve(s,a,o){let u={};for(let ne of r)Dr(u,ne);let h=s.getUniqueName(this);if(typeof e=="string"){if(!o)throw new Error("Explicit return type is required for string implementation");let ne=On(s,u,e),qe="",xt="";if(t!==""){let Be=me(a[0])?`(in: ${s.resolve(a[0]).value})`:"()",vt=Qt(o)?ra(o):"",$t=o!==te?me(o)?`-> ${s.resolve(o).value}`:`-> ${vt!==""?vt:"@location(0)"} ${s.resolve(o).value}`:"";qe=`${Be} ${$t} `,xt=ne}else{let Be=hp(ne);if(Be.args.length!==a.length)throw new Error(`WGSL implementation has ${Be.args.length} arguments, while the shell has ${a.length} arguments.`);let vt=Be.args.map((Gt,tn)=>`${Gt.identifier}: ${Ra(s,`parameter ${Gt.identifier}`,Gt.type,a[tn])}`).join(", "),$t=o===te?"":`-> ${Ra(s,"return type",Be.ret?.type,o)}`;qe=`(${vt}) ${$t}`,xt=ne.slice(Be.range.end)}return s.addDeclaration(`${t}fn ${h}${qe}${xt}`),y(h,o,"runtime")}let p=Ii(e),f=typeof p?.externals=="function"?p.externals():p?.externals;if(f){let ne=Object.fromEntries(Object.entries(f).filter(([qe])=>!(qe in u)));Dr(u,ne)}let m=p?.ast;if(!m)throw new Error("Missing metadata for tgpu.fn function body (either missing 'use gpu' directive, or misconfigured `unplugin-typegpu`)");let x=m.externalNames.filter(ne=>!(ne in u));if(x.length>0)throw new Ml(v(this),x);let $=m.params[1];$&&$.type==="i"&&t!==""&&Dr(u,{[$.name]:kt(o)});let{head:z,body:B,returnType:A}=s.fnToWgsl({functionType:t.includes("@compute")?"compute":t.includes("@vertex")?"vertex":t.includes("@fragment")?"fragment":"normal",argTypes:a,params:m.params,returnType:o,body:m.body,externalMap:u});return s.addDeclaration(`${t}fn ${h}${s.resolve(z).value}${s.resolve(B).value}`),y(h,A,"runtime")}},i=v(e);return i!==void 0&&L(n,i),n}function Ra(e,t,r,n){let i=e.resolve(n).value.replace(/\s/g,"");if(!r)return i;let s=r.replace(/\s/g,"");if(s!==i)throw new Error(`Type mismatch between TGPU shell and WGSL code string: ${t}, JS type "${i}", WGSL type "${s}".`);return r}function gp(e,t={}){let r=0,n=new Set;return Object.fromEntries(Object.entries(e??{}).map(([i,s])=>{let a=Ht(s);if(a!==void 0){if(n.has(a))throw new Error("Duplicate custom location attributes found");n.add(a)}return[i,s]}).map(([i,s])=>{if(Pt(s))return[i,s];if(Ht(s)!==void 0)return[i,s];if(t[i])return[i,yi(t[i],s)];for(;n.has(r);)r++;return[i,yi(r++,s)]}))}function Cn(e,t={}){return Xr(e)?Uo(e)||Pt(e)||Ht(e)!==void 0?e:yi(0,e):ki(gp(e,t))}function Ui(e,...t){return wp(e)?xp(e,...t):e}function wp(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)&&e.raw.every(t=>typeof t=="string")}function xp(e,...t){return e.slice(1).reduce((r,n,i)=>`${r}${t[i]}${n}`,e[0])}function vp(e){if(Object.keys(e.out).length===0)throw new Error("A vertexFn output cannot be empty since it must include the 'position' builtin.");let t={in:e.in,out:e.out,argTypes:e.in&&Object.keys(e.in).length!==0?[Cn(e.in)]:[],isEntry:!0};return Object.assign((r,...n)=>$p(t,Ui(r,...n)),t)}function $p(e,t){let r=Bn(t,"@vertex "),n=e.argTypes[0];return{shell:e,$uses(i){return r.applyExternals(i),this},[l]:!0,[ae]:r,$name(i){return L(r,i),zi(n)&&n.$name(`${i}_Input`),this},[_](i){let s=Cn(e.out,i.varyingLocations).$name(`${v(this)??""}_Output`);return typeof t=="string"&&(n&&r.applyExternals({In:n}),r.applyExternals({Out:s})),r.resolve(i,e.argTypes,s)},toString(){return`vertexFn:${v(r)??"<unnamed>"}`}}}var Qr=class{};function na(e){let t=d({name:e.type,normalImpl:(...n)=>{let i=[];for(let s of n)if(typeof s=="number")i.push(s);else for(let a=0;a<s.length;++a)i.push(s[a]);if(i.length!==0&&i.length!==e.columns*e.rows)throw new Error(`'${e.type}' constructor called with invalid number of arguments.`);for(let s=i.length;s<e.columns*e.rows;++s)i.push(0);return new e.MatImpl(...i)},ignoreImplicitCastWarning:!0,signature:(...n)=>({argTypes:n.map(i=>ft(i)?i:g),returnType:r}),codegenImpl:(...n)=>c`${e.type}(${n})`}),r=Object.assign(t,{type:e.type,identity:Ep[e.columns],translation:e.columns===4?Vi:void 0,scaling:e.columns===4?Pi:void 0,rotationX:e.columns===4?Ai:void 0,rotationY:e.columns===4?Oi:void 0,rotationZ:e.columns===4?Bi:void 0});return e.MatImpl.prototype.schema=r,r}var bp=class extends Qr{[l]=!0;columns;length=4;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1]),this.makeColumn(t[2],t[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[1].x=t}set 3(t){this.columns[1].y=t}*[Symbol.iterator](){yield this[0],yield this[1],yield this[2],yield this[3]}[_](){return y(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,Ot,"runtime")}toString(){return this[_]().value}},Tp=class extends bp{kind="mat2x2f";makeColumn(t,r){return D(t,r)}},_p=class extends Qr{[l]=!0;columns;length=12;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2]),this.makeColumn(t[3],t[4],t[5]),this.makeColumn(t[6],t[7],t[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){}*[Symbol.iterator](){for(let t=0;t<12;t++)yield this[t]}[_](){return y(`${this.kind}(${this[0]}, ${this[1]}, ${this[2]}, ${this[4]}, ${this[5]}, ${this[6]}, ${this[8]}, ${this[9]}, ${this[10]})`,Bt,"runtime")}toString(){return this[_]().value}},zp=class extends _p{kind="mat3x3f";makeColumn(t,r,n){return ue(t,r,n)}},Ip=class extends Qr{[l]=!0;columns;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2],t[3]),this.makeColumn(t[4],t[5],t[6],t[7]),this.makeColumn(t[8],t[9],t[10],t[11]),this.makeColumn(t[12],t[13],t[14],t[15])]}length=16;get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){this.columns[0].w=t}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){this.columns[1].w=t}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){this.columns[2].w=t}set 12(t){this.columns[3].x=t}set 13(t){this.columns[3].y=t}set 14(t){this.columns[3].z=t}set 15(t){this.columns[3].w=t}*[Symbol.iterator](){for(let t=0;t<16;t++)yield this[t]}[_](){return y(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,Y,"runtime")}toString(){return this[_]().value}},Sp=class extends Ip{kind="mat4x4f";makeColumn(t,r,n,i){return I(t,r,n,i)}},bu=Yt(()=>Ot(1,0,0,1)).$name("identity2"),Tu=Yt(()=>Bt(1,0,0,0,1,0,0,0,1)).$name("identity3"),_u=Yt(()=>Y(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)).$name("identity4"),Ep={2:bu,3:Tu,4:_u},Vi=d({name:"translation4",normalImpl:e=>Y(1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1),get signature(){return{argTypes:[ue],returnType:Y}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, ${e}.x, ${e}.y, ${e}.z, 1)`}),Pi=d({name:"scaling4",normalImpl:e=>Y(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),get signature(){return{argTypes:[ue],returnType:Y}},codegenImpl:e=>c`mat4x4f(${e}.x, 0, 0, 0, 0, ${e}.y, 0, 0, 0, 0, ${e}.z, 0, 0, 0, 0, 1)`}),Ai=d({name:"rotationX4",normalImpl:e=>Y(1,0,0,0,0,Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[g],returnType:Y}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1)`}),Oi=d({name:"rotationY4",normalImpl:e=>Y(Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[g],returnType:Y}},codegenImpl:e=>c`mat4x4f(cos(${e}), 0, -sin(${e}), 0, 0, 1, 0, 0, sin(${e}), 0, cos(${e}), 0, 0, 0, 0, 1)`}),Bi=d({name:"rotationZ4",normalImpl:e=>Y(Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1),get signature(){return{argTypes:[g],returnType:Y}},codegenImpl:e=>c`mat4x4f(cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)`}),Ot=na({type:"mat2x2f",rows:2,columns:2,MatImpl:Tp}),Bt=na({type:"mat3x3f",rows:3,columns:3,MatImpl:zp}),Y=na({type:"mat4x4f",rows:4,columns:4,MatImpl:Sp});function Mp(e){return e.kind==="mat3x3f"?[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]:Array.from({length:e.length}).map((t,r)=>e[r])}var nr=(e,t,r)=>{if(e===t)return 0;let n=M((r-e)/(t-e),0,1);return n*n*(3-2*n)},M=(e,t,r)=>Math.min(Math.max(t,e),r),xr=(e,t)=>t===0?e:Math.trunc(e/t);function ot(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getFloat32(0,!0)}function ut(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getInt32(0,!0)}var Fe=pr[l].jsImpl,Le=D[l].jsImpl,It=yt[l].jsImpl,jr=q[l].jsImpl,gn=Me[l].jsImpl,je=dr[l].jsImpl,Ue=ue[l].jsImpl,ht=gt[l].jsImpl,Gr=Oe[l].jsImpl,wn=ie[l].jsImpl,Ge=fr[l].jsImpl,Re=I[l].jsImpl,St=wt[l].jsImpl,Lr=pe[l].jsImpl,xn=ve[l].jsImpl,vr=e=>Math.sqrt(e.x**2+e.y**2),$r=e=>Math.sqrt(e.x**2+e.y**2+e.z**2),br=e=>Math.sqrt(e.x**2+e.y**2+e.z**2+e.w**2),Yn=(e,t)=>e.x*t.x+e.y*t.y,Xn=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z,Zn=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,H=e=>t=>Le(e(t.x),e(t.y)),X=e=>t=>It(e(t.x),e(t.y)),Tr=e=>t=>jr(e(t.x),e(t.y)),on=e=>t=>gn(e(t.x),e(t.y)),W=e=>t=>Ue(e(t.x),e(t.y),e(t.z)),Z=e=>t=>ht(e(t.x),e(t.y),e(t.z)),_r=e=>t=>Gr(e(t.x),e(t.y),e(t.z)),un=e=>t=>wn(e(t.x),e(t.y),e(t.z)),N=e=>t=>Re(e(t.x),e(t.y),e(t.z),e(t.w)),Q=e=>t=>St(e(t.x),e(t.y),e(t.z),e(t.w)),zr=e=>t=>Lr(e(t.x),e(t.y),e(t.z),e(t.w)),hn=e=>t=>xn(e(t.x),e(t.y),e(t.z),e(t.w)),Da=e=>t=>{let r=t.columns;return Ot(H(e)(r[0]),H(e)(r[1]))},Na=e=>t=>{let r=t.columns;return Bt(W(e)(r[0]),W(e)(r[1]),W(e)(r[2]))},Wa=e=>t=>{let r=t.columns;return Y(N(e)(r[0]),N(e)(r[1]),N(e)(r[2]),N(e)(r[3]))},_t=e=>(t,r)=>Le(e(t.x,r.x),e(t.y,r.y)),Jt=e=>(t,r)=>It(e(t.x,r.x),e(t.y,r.y)),Ir=e=>(t,r)=>jr(e(t.x,r.x),e(t.y,r.y)),Sr=e=>(t,r)=>gn(e(t.x,r.x),e(t.y,r.y)),lt=e=>(t,r)=>Ue(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Kt=e=>(t,r)=>ht(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Er=e=>(t,r)=>Gr(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Mr=e=>(t,r)=>wn(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Ze=e=>(t,r)=>Re(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),er=e=>(t,r)=>St(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),kr=e=>(t,r)=>Lr(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),Ur=e=>(t,r)=>xn(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),kp=e=>(t,r)=>{let n=t.columns,i=r.columns;return Ot(_t(e)(n[0],i[0]),_t(e)(n[1],i[1]))},Up=e=>(t,r)=>{let n=t.columns,i=r.columns;return Bt(lt(e)(n[0],i[0]),lt(e)(n[1],i[1]),lt(e)(n[2],i[2]))},Vp=e=>(t,r)=>{let n=t.columns,i=r.columns;return Y(Ze(e)(n[0],i[0]),Ze(e)(n[1],i[1]),Ze(e)(n[2],i[2]),Ze(e)(n[3],i[3]))},Pp=e=>(t,r,n)=>Le(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),Ap=e=>(t,r,n)=>It(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),Op=e=>(t,r,n)=>Ue(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),Bp=e=>(t,r,n)=>ht(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),Cp=e=>(t,r,n)=>Re(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),Fp=e=>(t,r,n)=>St(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),T={eq:{vec2f:(e,t)=>Fe(e.x===t.x,e.y===t.y),vec2h:(e,t)=>Fe(e.x===t.x,e.y===t.y),vec2i:(e,t)=>Fe(e.x===t.x,e.y===t.y),vec2u:(e,t)=>Fe(e.x===t.x,e.y===t.y),"vec2<bool>":(e,t)=>Fe(e.x===t.x,e.y===t.y),vec3f:(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),vec3h:(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),vec3i:(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),vec3u:(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),"vec3<bool>":(e,t)=>je(e.x===t.x,e.y===t.y,e.z===t.z),vec4f:(e,t)=>Ge(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4h:(e,t)=>Ge(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4i:(e,t)=>Ge(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4u:(e,t)=>Ge(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),"vec4<bool>":(e,t)=>Ge(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w)},lt:{vec2f:(e,t)=>Fe(e.x<t.x,e.y<t.y),vec2h:(e,t)=>Fe(e.x<t.x,e.y<t.y),vec2i:(e,t)=>Fe(e.x<t.x,e.y<t.y),vec2u:(e,t)=>Fe(e.x<t.x,e.y<t.y),vec3f:(e,t)=>je(e.x<t.x,e.y<t.y,e.z<t.z),vec3h:(e,t)=>je(e.x<t.x,e.y<t.y,e.z<t.z),vec3i:(e,t)=>je(e.x<t.x,e.y<t.y,e.z<t.z),vec3u:(e,t)=>je(e.x<t.x,e.y<t.y,e.z<t.z),vec4f:(e,t)=>Ge(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4h:(e,t)=>Ge(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4i:(e,t)=>Ge(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4u:(e,t)=>Ge(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w)},or:{"vec2<bool>":(e,t)=>Fe(e.x||t.x,e.y||t.y),"vec3<bool>":(e,t)=>je(e.x||t.x,e.y||t.y,e.z||t.z),"vec4<bool>":(e,t)=>Ge(e.x||t.x,e.y||t.y,e.z||t.z,e.w||t.w)},all:{"vec2<bool>":e=>e.x&&e.y,"vec3<bool>":e=>e.x&&e.y&&e.z,"vec4<bool>":e=>e.x&&e.y&&e.z&&e.w},abs:{vec2f:H(Math.abs),vec2h:X(Math.abs),vec2i:Tr(Math.abs),vec2u:on(Math.abs),vec3f:W(Math.abs),vec3h:Z(Math.abs),vec3i:_r(Math.abs),vec3u:un(Math.abs),vec4f:N(Math.abs),vec4h:Q(Math.abs),vec4i:zr(Math.abs),vec4u:hn(Math.abs)},atan2:{vec2f:_t(Math.atan2),vec2h:Jt(Math.atan2),vec3f:lt(Math.atan2),vec3h:Kt(Math.atan2),vec4f:Ze(Math.atan2),vec4h:er(Math.atan2)},acos:{vec2f:H(Math.acos),vec2h:X(Math.acos),vec2i:Tr(Math.acos),vec2u:on(Math.acos),vec3f:W(Math.acos),vec3h:Z(Math.acos),vec3i:_r(Math.acos),vec3u:un(Math.acos),vec4f:N(Math.acos),vec4h:Q(Math.acos),vec4i:zr(Math.acos),vec4u:hn(Math.acos)},acosh:{vec2f:H(Math.acosh),vec2h:X(Math.acosh),vec3f:W(Math.acosh),vec3h:Z(Math.acosh),vec4f:N(Math.acosh),vec4h:Q(Math.acosh)},asin:{vec2f:H(Math.asin),vec2h:X(Math.asin),vec3f:W(Math.asin),vec3h:Z(Math.asin),vec4f:N(Math.asin),vec4h:Q(Math.asin)},asinh:{vec2f:H(Math.asinh),vec2h:X(Math.asinh),vec3f:W(Math.asinh),vec3h:Z(Math.asinh),vec4f:N(Math.asinh),vec4h:Q(Math.asinh)},atan:{vec2f:H(Math.atan),vec2h:X(Math.atan),vec3f:W(Math.atan),vec3h:Z(Math.atan),vec4f:N(Math.atan),vec4h:Q(Math.atan)},atanh:{vec2f:H(Math.atanh),vec2h:X(Math.atanh),vec3f:W(Math.atanh),vec3h:Z(Math.atanh),vec4f:N(Math.atanh),vec4h:Q(Math.atanh)},ceil:{vec2f:H(Math.ceil),vec2h:X(Math.ceil),vec3f:W(Math.ceil),vec3h:Z(Math.ceil),vec4f:N(Math.ceil),vec4h:Q(Math.ceil)},clamp:{vec2f:(e,t,r)=>Le(M(e.x,t.x,r.x),M(e.y,t.y,r.y)),vec2h:(e,t,r)=>It(M(e.x,t.x,r.x),M(e.y,t.y,r.y)),vec2i:(e,t,r)=>jr(M(e.x,t.x,r.x),M(e.y,t.y,r.y)),vec2u:(e,t,r)=>gn(M(e.x,t.x,r.x),M(e.y,t.y,r.y)),vec3f:(e,t,r)=>Ue(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z)),vec3h:(e,t,r)=>ht(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z)),vec3i:(e,t,r)=>Gr(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z)),vec3u:(e,t,r)=>wn(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z)),vec4f:(e,t,r)=>Re(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z),M(e.w,t.w,r.w)),vec4h:(e,t,r)=>St(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z),M(e.w,t.w,r.w)),vec4i:(e,t,r)=>Lr(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z),M(e.w,t.w,r.w)),vec4u:(e,t,r)=>xn(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z),M(e.w,t.w,r.w))},length:{vec2f:vr,vec2h:vr,vec3f:$r,vec3h:$r,vec4f:br,vec4h:br},add:{vec2f:_t((e,t)=>e+t),vec2h:Jt((e,t)=>e+t),vec2i:Ir((e,t)=>e+t),vec2u:Sr((e,t)=>e+t),vec3f:lt((e,t)=>e+t),vec3h:Kt((e,t)=>e+t),vec3i:Er((e,t)=>e+t),vec3u:Mr((e,t)=>e+t),vec4f:Ze((e,t)=>e+t),vec4h:er((e,t)=>e+t),vec4i:kr((e,t)=>e+t),vec4u:Ur((e,t)=>e+t),mat2x2f:kp((e,t)=>e+t),mat3x3f:Up((e,t)=>e+t),mat4x4f:Vp((e,t)=>e+t)},smoothstep:{vec2f:Pp(nr),vec2h:Ap(nr),vec3f:Op(nr),vec3h:Bp(nr),vec4f:Cp(nr),vec4h:Fp(nr)},addMixed:{vec2f:(e,t)=>H(r=>r+t)(e),vec2h:(e,t)=>X(r=>r+t)(e),vec2i:(e,t)=>Tr(r=>r+t)(e),vec2u:(e,t)=>on(r=>r+t)(e),vec3f:(e,t)=>W(r=>r+t)(e),vec3h:(e,t)=>Z(r=>r+t)(e),vec3i:(e,t)=>_r(r=>r+t)(e),vec3u:(e,t)=>un(r=>r+t)(e),vec4f:(e,t)=>N(r=>r+t)(e),vec4h:(e,t)=>Q(r=>r+t)(e),vec4i:(e,t)=>zr(r=>r+t)(e),vec4u:(e,t)=>hn(r=>r+t)(e),mat2x2f:(e,t)=>Da(r=>r+t)(e),mat3x3f:(e,t)=>Na(r=>r+t)(e),mat4x4f:(e,t)=>Wa(r=>r+t)(e)},mulSxV:{vec2f:(e,t)=>H(r=>e*r)(t),vec2h:(e,t)=>X(r=>e*r)(t),vec2i:(e,t)=>Tr(r=>e*r)(t),vec2u:(e,t)=>on(r=>e*r)(t),vec3f:(e,t)=>W(r=>e*r)(t),vec3h:(e,t)=>Z(r=>e*r)(t),vec3i:(e,t)=>_r(r=>e*r)(t),vec3u:(e,t)=>un(r=>e*r)(t),vec4f:(e,t)=>N(r=>e*r)(t),vec4h:(e,t)=>Q(r=>e*r)(t),vec4i:(e,t)=>zr(r=>e*r)(t),vec4u:(e,t)=>hn(r=>e*r)(t),mat2x2f:(e,t)=>Da(r=>e*r)(t),mat3x3f:(e,t)=>Na(r=>e*r)(t),mat4x4f:(e,t)=>Wa(r=>e*r)(t)},mulVxV:{vec2f:_t((e,t)=>e*t),vec2h:Jt((e,t)=>e*t),vec2i:Ir((e,t)=>e*t),vec2u:Sr((e,t)=>e*t),vec3f:lt((e,t)=>e*t),vec3h:Kt((e,t)=>e*t),vec3i:Er((e,t)=>e*t),vec3u:Mr((e,t)=>e*t),vec4f:Ze((e,t)=>e*t),vec4h:er((e,t)=>e*t),vec4i:kr((e,t)=>e*t),vec4u:Ur((e,t)=>e*t),mat2x2f:(e,t)=>{let r=e.columns,n=t.columns;return Ot(r[0].x*n[0].x+r[1].x*n[0].y,r[0].y*n[0].x+r[1].y*n[0].y,r[0].x*n[1].x+r[1].x*n[1].y,r[0].y*n[1].x+r[1].y*n[1].y)},mat3x3f:(e,t)=>{let r=e.columns,n=t.columns;return Bt(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z)},mat4x4f:(e,t)=>{let r=e.columns,n=t.columns;return Y(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z+r[3].x*n[0].w,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z+r[3].y*n[0].w,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z+r[3].z*n[0].w,r[0].w*n[0].x+r[1].w*n[0].y+r[2].w*n[0].z+r[3].w*n[0].w,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z+r[3].x*n[1].w,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z+r[3].y*n[1].w,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z+r[3].z*n[1].w,r[0].w*n[1].x+r[1].w*n[1].y+r[2].w*n[1].z+r[3].w*n[1].w,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z+r[3].x*n[2].w,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z+r[3].y*n[2].w,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z+r[3].z*n[2].w,r[0].w*n[2].x+r[1].w*n[2].y+r[2].w*n[2].z+r[3].w*n[2].w,r[0].x*n[3].x+r[1].x*n[3].y+r[2].x*n[3].z+r[3].x*n[3].w,r[0].y*n[3].x+r[1].y*n[3].y+r[2].y*n[3].z+r[3].y*n[3].w,r[0].z*n[3].x+r[1].z*n[3].y+r[2].z*n[3].z+r[3].z*n[3].w,r[0].w*n[3].x+r[1].w*n[3].y+r[2].w*n[3].z+r[3].w*n[3].w)}},mulMxV:{mat2x2f:(e,t)=>{let r=e.columns;return Le(r[0].x*t.x+r[1].x*t.y,r[0].y*t.x+r[1].y*t.y)},mat3x3f:(e,t)=>{let r=e.columns;return Ue(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z)},mat4x4f:(e,t)=>{let r=e.columns;return Re(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z+r[3].x*t.w,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z+r[3].y*t.w,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z+r[3].z*t.w,r[0].w*t.x+r[1].w*t.y+r[2].w*t.z+r[3].w*t.w)}},mulVxM:{mat2x2f:(e,t)=>{let r=t.columns;return Le(e.x*r[0].x+e.y*r[0].y,e.x*r[1].x+e.y*r[1].y)},mat3x3f:(e,t)=>{let r=t.columns;return Ue(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z)},mat4x4f:(e,t)=>{let r=t.columns;return Re(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z+e.w*r[0].w,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z+e.w*r[1].w,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z+e.w*r[2].w,e.x*r[3].x+e.y*r[3].y+e.z*r[3].z+e.w*r[3].w)}},div:{vec2f:_t((e,t)=>e/t),vec2h:Jt((e,t)=>e/t),vec2i:Ir(xr),vec2u:Sr(xr),vec3f:lt((e,t)=>e/t),vec3h:Kt((e,t)=>e/t),vec3i:Er(xr),vec3u:Mr(xr),vec4f:Ze((e,t)=>e/t),vec4h:er((e,t)=>e/t),vec4i:kr(xr),vec4u:Ur(xr)},dot:{vec2f:Yn,vec2h:Yn,vec2i:Yn,vec2u:Yn,vec3f:Xn,vec3h:Xn,vec3i:Xn,vec3u:Xn,vec4f:Zn,vec4h:Zn,vec4i:Zn,vec4u:Zn},normalize:{vec2f:e=>{let t=vr(e);return Le(e.x/t,e.y/t)},vec2h:e=>{let t=vr(e);return It(e.x/t,e.y/t)},vec2i:e=>{let t=vr(e);return jr(e.x/t,e.y/t)},vec2u:e=>{let t=vr(e);return gn(e.x/t,e.y/t)},vec3f:e=>{let t=$r(e);return Ue(e.x/t,e.y/t,e.z/t)},vec3h:e=>{let t=$r(e);return ht(e.x/t,e.y/t,e.z/t)},vec3i:e=>{let t=$r(e);return Gr(e.x/t,e.y/t,e.z/t)},vec3u:e=>{let t=$r(e);return wn(e.x/t,e.y/t,e.z/t)},vec4f:e=>{let t=br(e);return Re(e.x/t,e.y/t,e.z/t,e.w/t)},vec4h:e=>{let t=br(e);return St(e.x/t,e.y/t,e.z/t,e.w/t)},vec4i:e=>{let t=br(e);return Lr(e.x/t,e.y/t,e.z/t,e.w/t)},vec4u:e=>{let t=br(e);return xn(e.x/t,e.y/t,e.z/t,e.w/t)}},cross:{vec3f:(e,t)=>Ue(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x),vec3h:(e,t)=>ht(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},mod:{vec2f:_t((e,t)=>e%t),vec2h:Jt((e,t)=>e%t),vec2i:Ir((e,t)=>e%t),vec2u:Sr((e,t)=>e%t),vec3f:lt((e,t)=>e%t),vec3h:Kt((e,t)=>e%t),vec3i:Er((e,t)=>e%t),vec3u:Mr((e,t)=>e%t),vec4f:Ze((e,t)=>e%t),vec4h:er((e,t)=>e%t),vec4i:kr((e,t)=>e%t),vec4u:Ur((e,t)=>e%t)},floor:{vec2f:H(Math.floor),vec2h:X(Math.floor),vec3f:W(Math.floor),vec3h:Z(Math.floor),vec4f:N(Math.floor),vec4h:Q(Math.floor)},max:{vec2f:_t(Math.max),vec2h:Jt(Math.max),vec2i:Ir(Math.max),vec2u:Sr(Math.max),vec3f:lt(Math.max),vec3h:Kt(Math.max),vec3i:Er(Math.max),vec3u:Mr(Math.max),vec4f:Ze(Math.max),vec4h:er(Math.max),vec4i:kr(Math.max),vec4u:Ur(Math.max)},min:{vec2f:_t(Math.min),vec2h:Jt(Math.min),vec2i:Ir(Math.min),vec2u:Sr(Math.min),vec3f:lt(Math.min),vec3h:Kt(Math.min),vec3i:Er(Math.min),vec3u:Mr(Math.min),vec4f:Ze(Math.min),vec4h:er(Math.min),vec4i:kr(Math.min),vec4u:Ur(Math.min)},pow:{vec2f:(e,t)=>Le(e.x**t.x,e.y**t.y),vec2h:(e,t)=>It(e.x**t.x,e.y**t.y),vec3f:(e,t)=>Ue(e.x**t.x,e.y**t.y,e.z**t.z),vec3h:(e,t)=>ht(e.x**t.x,e.y**t.y,e.z**t.z),vec4f:(e,t)=>Re(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w),vec4h:(e,t)=>St(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w)},sign:{vec2f:H(Math.sign),vec2h:X(Math.sign),vec2i:Tr(Math.sign),vec3f:W(Math.sign),vec3h:Z(Math.sign),vec3i:_r(Math.sign),vec4f:N(Math.sign),vec4h:Q(Math.sign),vec4i:zr(Math.sign)},sqrt:{vec2f:H(Math.sqrt),vec2h:X(Math.sqrt),vec3f:W(Math.sqrt),vec3h:Z(Math.sqrt),vec4f:N(Math.sqrt),vec4h:Q(Math.sqrt)},mix:{vec2f:(e,t,r)=>typeof r=="number"?Le(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):Le(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec2h:(e,t,r)=>typeof r=="number"?It(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):It(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec3f:(e,t,r)=>typeof r=="number"?Ue(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):Ue(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec3h:(e,t,r)=>typeof r=="number"?ht(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):ht(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec4f:(e,t,r)=>typeof r=="number"?Re(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):Re(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w),vec4h:(e,t,r)=>typeof r=="number"?St(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):St(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w)},sin:{vec2f:H(Math.sin),vec2h:X(Math.sin),vec3f:W(Math.sin),vec3h:Z(Math.sin),vec4f:N(Math.sin),vec4h:Q(Math.sin)},cos:{vec2f:H(Math.cos),vec2h:X(Math.cos),vec3f:W(Math.cos),vec3h:Z(Math.cos),vec4f:N(Math.cos),vec4h:Q(Math.cos)},cosh:{vec2f:H(Math.cosh),vec2h:X(Math.cosh),vec3f:W(Math.cosh),vec3h:Z(Math.cosh),vec4f:N(Math.cosh),vec4h:Q(Math.cosh)},exp:{vec2f:H(Math.exp),vec2h:X(Math.exp),vec3f:W(Math.exp),vec3h:Z(Math.exp),vec4f:N(Math.exp),vec4h:Q(Math.exp)},exp2:{vec2f:H(e=>2**e),vec2h:X(e=>2**e),vec3f:W(e=>2**e),vec3h:Z(e=>2**e),vec4f:N(e=>2**e),vec4h:Q(e=>2**e)},log:{vec2f:H(Math.log),vec2h:X(Math.log),vec3f:W(Math.log),vec3h:Z(Math.log),vec4f:N(Math.log),vec4h:Q(Math.log)},log2:{vec2f:H(Math.log2),vec2h:X(Math.log2),vec3f:W(Math.log2),vec3h:Z(Math.log2),vec4f:N(Math.log2),vec4h:Q(Math.log2)},fract:{vec2f:H(e=>e-Math.floor(e)),vec2h:X(e=>e-Math.floor(e)),vec3f:W(e=>e-Math.floor(e)),vec3h:Z(e=>e-Math.floor(e)),vec4f:N(e=>e-Math.floor(e)),vec4h:Q(e=>e-Math.floor(e))},isCloseToZero:{vec2f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec2h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec3f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec3h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec4f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t,vec4h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t},neg:{vec2f:H(e=>-e),vec2h:X(e=>-e),vec2i:Tr(e=>-e),vec2u:on(e=>-e),"vec2<bool>":e=>Fe(!e.x,!e.y),vec3f:W(e=>-e),vec3h:Z(e=>-e),vec3i:_r(e=>-e),vec3u:un(e=>-e),"vec3<bool>":e=>je(!e.x,!e.y,!e.z),vec4f:N(e=>-e),vec4h:Q(e=>-e),vec4i:zr(e=>-e),vec4u:hn(e=>-e),"vec4<bool>":e=>Ge(!e.x,!e.y,!e.z,!e.w)},select:{vec2f:(e,t,r)=>Le(r.x?t.x:e.x,r.y?t.y:e.y),vec2h:(e,t,r)=>It(r.x?t.x:e.x,r.y?t.y:e.y),vec2i:(e,t,r)=>jr(r.x?t.x:e.x,r.y?t.y:e.y),vec2u:(e,t,r)=>gn(r.x?t.x:e.x,r.y?t.y:e.y),"vec2<bool>":(e,t,r)=>Fe(r.x?t.x:e.x,r.y?t.y:e.y),vec3f:(e,t,r)=>Ue(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3h:(e,t,r)=>ht(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3i:(e,t,r)=>Gr(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3u:(e,t,r)=>wn(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),"vec3<bool>":(e,t,r)=>je(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec4f:(e,t,r)=>Re(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4h:(e,t,r)=>St(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4i:(e,t,r)=>Lr(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4u:(e,t,r)=>xn(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),"vec4<bool>":(e,t,r)=>Ge(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w)},tanh:{vec2f:H(Math.tanh),vec2h:X(Math.tanh),vec3f:W(Math.tanh),vec3h:Z(Math.tanh),vec4f:N(Math.tanh),vec4h:Q(Math.tanh)},bitcastU32toF32:{vec2u:e=>Le(ot(e.x),ot(e.y)),vec3u:e=>Ue(ot(e.x),ot(e.y),ot(e.z)),vec4u:e=>Re(ot(e.x),ot(e.y),ot(e.z),ot(e.w))},bitcastU32toI32:{vec2u:e=>jr(ut(e.x),ut(e.y)),vec3u:e=>Gr(ut(e.x),ut(e.y),ut(e.z)),vec4u:e=>Lr(ut(e.x),ut(e.y),ut(e.z),ut(e.w))}};function zu(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="number"&&J(t))return T.addMixed[t.kind](t,e);if(J(e)&&typeof t=="number")return T.addMixed[e.kind](e,t);if(J(e)&&J(t)||pt(e)&&pt(t))return T.add[e.kind](e,t);throw new Error("Add/Sub called with invalid arguments.")}var ia=d({name:"add",signature:(...e)=>{let t=ye(e)??e;return{argTypes:t,returnType:qt(t[0])?t[1]:t[0]}},normalImpl:zu,codegenImpl:(e,t)=>c`(${e} + ${t})`});function jp(e,t){return zu(e,Iu(-1,t))}var Jr=d({name:"sub",signature:(...e)=>{let t=ye(e)??e;return{argTypes:t,returnType:qt(t[0])?t[1]:t[0]}},normalImpl:jp,codegenImpl:(e,t)=>c`(${e} - ${t})`});function Iu(e,t){if(typeof e=="number"&&typeof t=="number")return e*t;if(typeof e=="number"&&(J(t)||pt(t)))return T.mulSxV[t.kind](e,t);if((J(e)||pt(e))&&typeof t=="number")return T.mulSxV[e.kind](t,e);if(J(e)&&J(t))return T.mulVxV[e.kind](e,t);if(Ea(e)&&pt(t))return T.mulVxM[t.kind](e,t);if(pt(e)&&Ea(t))return T.mulMxV[e.kind](e,t);if(pt(e)&&pt(t))return T.mulVxV[e.kind](e,t);throw new Error("Mul called with invalid arguments.")}var Fn=d({name:"mul",signature:(...e)=>{let t=ye(e)??e,r=qt(t[0])?t[1]:qt(t[1])||t[0].type.startsWith("vec")?t[0]:t[1].type.startsWith("vec")?t[1]:t[0];return{argTypes:t,returnType:r}},normalImpl:Iu,codegenImpl:(e,t)=>c`(${e} * ${t})`});function Gp(e,t){if(typeof e=="number"&&typeof t=="number")return e/t;if(typeof e=="number"&&J(t)){let r=fi[t.kind][l].jsImpl;return T.div[t.kind](r(e),t)}if(J(e)&&typeof t=="number"){let r=fi[e.kind][l].jsImpl;return T.div[e.kind](e,r(t))}if(J(e)&&J(t))return T.div[e.kind](e,t);throw new Error("Div called with invalid arguments.")}var sa=d({name:"div",signature:(...e)=>{let t=ye(e,[g,oe,mt])??e;return{argTypes:t,returnType:qt(t[0])?t[1]:t[0]}},normalImpl:Gp,codegenImpl:(e,t)=>c`(${e} / ${t})`,ignoreImplicitCastWarning:!0}),Lp=d({name:"mod",signature:(...e)=>{let t=ye(e)??e;return{argTypes:t,returnType:qt(t[0])?t[1]:t[0]}},normalImpl(e,t){if(typeof e=="number"&&typeof t=="number")return e%t;if(typeof e=="number"&&J(t)){let r=fi[t.kind];return T.mod[t.kind](r(e),t)}if(J(e)&&typeof t=="number"){let r=fi[e.kind];return T.mod[e.kind](e,r(t))}if(J(e)&&J(t))return T.mod[e.kind](e,t);throw new Error("Mod called with invalid arguments, expected types: number or vector.")},codegenImpl:(e,t)=>c`(${e} % ${t})`});function Rp(e){return typeof e=="number"?-e:T.neg[e.kind](e)}var Su=d({name:"neg",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Rp,codegenImpl:e=>c`-(${e})`});function ps(e){if("multisampled"in e){if(e.multisampled){if(e.dimension==="2d")return Mu(e.sampleType);throw new Error(`Multisampled textures only support '2d' dimension, got '${e.dimension}'`)}switch(e.dimension){case"1d":return Eu(e.sampleType);case"2d":return aa(e.sampleType);case"2d-array":return ku(e.sampleType);case"3d":return Pu(e.sampleType);case"cube":return Uu(e.sampleType);case"cube-array":return Vu(e.sampleType);default:throw new Error(`Unsupported texture dimension: '${e.dimension}'`)}}if(!("access"in e))throw new Error("Descriptor is neither a sampled nor a storage texture");switch(e.dimension){case"1d":return Au(e.format,e.access);case"2d":return oa(e.format,e.access);case"2d-array":return Ou(e.format,e.access);case"3d":return Bu(e.format,e.access);default:throw new Error(`Unsupported storage texture dimension: '${e.dimension}'`)}}function Ne(e,t){let r=e.startsWith("texture_depth")?["depth","float","unfilterable-float"]:t.sampleType.type==="i32"?["sint"]:t.sampleType.type==="u32"?["uint"]:["float","unfilterable-float"];return{[l]:!0,[Hr]:void 0,type:e,bindingSampleType:r,...t}}function Ci(e,t){return{[l]:!0,[Hr]:void 0,type:e,...t}}var qa=new Map,jn={"write-only":"write","read-only":"read","read-write":"read_write"};function $e(e,t){let r=qa.get(e);return r||(r=t(),qa.set(e,r)),r}function Eu(e){let t=e||g,r=`texture_1d<${t.type}>`;return $e(r,()=>Ne("texture_1d",{dimension:"1d",sampleType:t,multisampled:!1}))}function aa(e){let t=e||g,r=`texture_2d<${t.type}>`;return $e(r,()=>Ne("texture_2d",{dimension:"2d",sampleType:t,multisampled:!1}))}function Mu(e){let t=e||g,r=`texture_multisampled_2d<${t.type}>`;return $e(r,()=>Ne("texture_multisampled_2d",{dimension:"2d",sampleType:t,multisampled:!0}))}function ku(e){let t=e||g,r=`texture_2d_array<${t.type}>`;return $e(r,()=>Ne("texture_2d_array",{dimension:"2d-array",sampleType:t,multisampled:!1}))}function Uu(e){let t=e||g,r=`texture_cube<${t.type}>`;return $e(r,()=>Ne("texture_cube",{dimension:"cube",sampleType:t,multisampled:!1}))}function Vu(e){let t=e||g,r=`texture_cube_array<${t.type}>`;return $e(r,()=>Ne("texture_cube_array",{dimension:"cube-array",sampleType:t,multisampled:!1}))}function Pu(e){let t=e||g,r=`texture_3d<${t.type}>`;return $e(r,()=>Ne("texture_3d",{dimension:"3d",sampleType:t,multisampled:!1}))}function Au(e,t){let r=t||"write-only",n=`texture_storage_1d<${e}, ${jn[r]}>`;return $e(n,()=>Ci("texture_storage_1d",{dimension:"1d",format:e,access:r}))}function oa(e,t){let r=t||"write-only",n=`texture_storage_2d<${e}, ${jn[r]}>`;return $e(n,()=>Ci("texture_storage_2d",{dimension:"2d",format:e,access:r}))}function Ou(e,t){let r=t||"write-only",n=`texture_storage_2d_array<${e}, ${jn[r]}>`;return $e(n,()=>Ci("texture_storage_2d_array",{dimension:"2d-array",format:e,access:r}))}function Bu(e,t){let r=t||"write-only",n=`texture_storage_3d<${e}, ${jn[r]}>`;return $e(n,()=>Ci("texture_storage_3d",{dimension:"3d",format:e,access:r}))}function Dp(){return $e("texture_depth_2d",()=>Ne("texture_depth_2d",{dimension:"2d",sampleType:g,multisampled:!1}))}function Np(){return $e("texture_depth_multisampled_2d",()=>Ne("texture_depth_multisampled_2d",{dimension:"2d",sampleType:g,multisampled:!0}))}function Wp(){return $e("texture_depth_2d_array",()=>Ne("texture_depth_2d_array",{dimension:"2d-array",sampleType:g,multisampled:!1}))}function qp(){return $e("texture_depth_cube",()=>Ne("texture_depth_cube",{dimension:"cube",sampleType:g,multisampled:!1}))}function Hp(){return $e("texture_depth_cube_array",()=>Ne("texture_depth_cube_array",{dimension:"cube-array",sampleType:g,multisampled:!1}))}function Cu(){return $e("texture_external",()=>({[l]:!0,[Hr]:void 0,type:"texture_external",dimension:"2d"}))}function Fu(e){return!!e[l]&&typeof e.multisampled=="boolean"}function ds(e){return!!e[l]&&typeof e.format=="string"&&typeof e.access=="string"}var Yp=["vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"],fs={add:ia,sub:Jr,mul:Fn,div:sa},Xp={f:{1:g,2:D,3:ue,4:I},h:{1:oe,2:yt,3:gt,4:wt},i:{1:V,2:q,3:Oe,4:pe},u:{1:b,2:Me,3:ie,4:ve},b:{1:G,2:pr,3:dr,4:fr}};function ua(e,t){if(Yp.includes(e.dataType.type)&&t in fs)return y(new Ao(t,e,fs[t][l].gpuImpl),Qe,e.origin);if(ze(e.dataType)&&t==="length")return e.dataType.elementCount===0?y(c`arrayLength(&${e})`,b,"runtime"):y(e.dataType.elementCount,Un,"constant");if(hi(e.dataType)&&t==="columns")return y(new Oo(e),Qe,e.origin);if(me(e.dataType)||et(e.dataType)){let n=e.dataType.propTypes[t];return n?(n=kt(n),y(c`${e}.${t}`,n,e.origin==="argument"?"argument":!Cr(e)&&!Te(n)?e.origin:e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime")):void 0}if(Je(e.dataType)){let n=Cs(e);return t==="$"?n:ua(n,t)}if(ft(e.dataType)&&t==="kind")return y(e.dataType.type,Qe,"constant");let r=t.length;if(ft(e.dataType)&&r>=1&&r<=4){let n=e.dataType.type.includes("bool")?"b":e.dataType.type[4],i=Xp[n][r];return i?y(Ve(e)?e.value[t]:c`${e}.${t}`,i,e.origin==="argument"&&r===1?"argument":e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime"):void 0}if(Ve(e)||e.dataType.type==="unknown")return Mi(e.value[t])}function ha(){return{[l]:!0,type:"sampler",[Hr]:void 0}}function la(){return{[l]:!0,type:"sampler_comparison",[Hr]:void 0}}function Zp(e){return!!e[l]&&e.type==="sampler"}function Qp(e){return!!e[l]&&e.type==="sampler_comparison"}function ju(e){return new Jp(e)}var Jp=class{constructor(t){this.inner=t}[l]=!0;type="atomic"},Gu=Object.defineProperty,Kp=(e,t,r)=>t in e?Gu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ed=(e,t)=>{for(var r in t)Gu(e,r,{get:t[r],enumerable:!0})},k=(e,t,r)=>Kp(e,typeof t!="symbol"?t+"":t,r),td={};ed(td,{BufferReader:()=>Wt,BufferWriter:()=>mr,MaxValue:()=>se,Measurer:()=>ee,UnresolvedReferenceError:()=>sr,ValidationError:()=>Fi,arrayOf:()=>ad,bool:()=>ud,byte:()=>fd,chars:()=>Ed,concat:()=>Vd,dynamicArrayOf:()=>Ad,f16:()=>_d,f32:()=>Id,f32Array:()=>Zd,f64Array:()=>Qd,generic:()=>kd,genericEnum:()=>Ud,i16:()=>yd,i16Array:()=>Yd,i32:()=>vd,i32Array:()=>Xd,i8:()=>pd,i8Array:()=>Hd,keyed:()=>Cd,object:()=>Md,optional:()=>jd,string:()=>ld,tupleOf:()=>Rd,u16:()=>wd,u16Array:()=>Wd,u32:()=>bd,u32Array:()=>qd,u8:()=>Wu,u8Array:()=>Dd,u8ClampedArray:()=>Nd});var sr=class Lu extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Lu.prototype)}},Fi=class Ru extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ru.prototype)}},rd=class{constructor(){k(this,"size",Number.NaN),k(this,"unbounded",this),k(this,"isUnbounded",!0)}add(){return this}fork(){return this}},nd=new rd,ee=class Du{constructor(){k(this,"size",0),k(this,"unbounded",nd),k(this,"isUnbounded",!1)}add(t){return this.size+=t,this}fork(){const t=new Du;return t.size=this.size,t}},se=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),ge=class{constructor(){k(this,"__unwrapped")}resolveReferences(e){}seekProperty(e,t){return null}},id=class{constructor(e){this.key=e}},vn={STRING:"string",ENUM:"enum"},sd=class extends ge{constructor(e,t){super(),this._unstableElementSchema=e,this.length=t,k(this,"elementSchema"),this.elementSchema=e}resolveReferences(e){this.elementSchema=e.resolve(this._unstableElementSchema)}write(e,t){if(t.length!==this.length)throw new Fi(`Expected array of length ${this.length}, got ${t.length}`);for(const r of t)this.elementSchema.write(e,r)}read(e){const t=[];for(let r=0;r<this.length;++r)t.push(this.elementSchema.read(e));return t}get maxSize(){return this.elementSchema.measure(se).size*this.length}measure(e,t=new ee){for(let r=0;r<this.length;++r)this.elementSchema.measure(e===se?se:e[r],t);return t}};function ad(e,t){return new sd(e,t)}var od=class extends ge{constructor(){super(...arguments),k(this,"maxSize",1)}read(e){return e.readBool()}write(e,t){e.writeBool(t)}measure(e,t=new ee){return t.add(1)}},ud=new od,Nu=class pn extends ge{static get _encoder(){return pn._cachedEncoder||(pn._cachedEncoder=new TextEncoder),pn._cachedEncoder}read(t){return t.readString()}write(t,r){t.writeString(r)}measure(t,r=new ee){if(t===se)return r.unbounded;const n=pn._encoder.encode(t);return r.add(n.byteLength+1)}};k(Nu,"_cachedEncoder");var hd=Nu,ld=new hd,cd=class extends ge{constructor(){super(...arguments),k(this,"maxSize",1)}read(e){return e.readInt8()}write(e,t){e.writeInt8(t)}measure(e,t=new ee){return t.add(1)}},pd=new cd,dd=class extends ge{constructor(){super(...arguments),k(this,"maxSize",1)}read(e){return e.readUint8()}write(e,t){e.writeUint8(t)}measure(e,t=new ee){return t.add(1)}},Wu=new dd,fd=Wu,md=class extends ge{constructor(){super(...arguments),k(this,"maxSize",2)}read(e){return e.readInt16()}write(e,t){e.writeInt16(t)}measure(e,t=new ee){return t.add(2)}},yd=new md,gd=class extends ge{constructor(){super(...arguments),k(this,"maxSize",2)}read(e){return e.readUint16()}write(e,t){e.writeUint16(t)}measure(e,t=new ee){return t.add(2)}},wd=new gd,xd=class extends ge{constructor(){super(...arguments),k(this,"maxSize",4)}read(e){return e.readInt32()}write(e,t){e.writeInt32(t)}measure(e,t=new ee){return t.add(4)}},vd=new xd,$d=class extends ge{constructor(){super(...arguments),k(this,"maxSize",4)}read(e){return e.readUint32()}write(e,t){e.writeUint32(t)}measure(e,t=new ee){return t.add(4)}},bd=new $d,Td=class extends ge{constructor(){super(...arguments),k(this,"maxSize",2)}read(e){return e.readFloat16()}write(e,t){e.writeFloat16(t)}measure(e,t=new ee){return t.add(2)}},_d=new Td,zd=class extends ge{constructor(){super(...arguments),k(this,"maxSize",4)}read(e){return e.readFloat32()}write(e,t){e.writeFloat32(t)}measure(e,t=new ee){return t.add(4)}},Id=new zd,Sd=class extends ge{constructor(e){super(),this.length=e}write(e,t){if(t.length!==this.length)throw new Fi(`Expected char-string of length ${this.length}, got ${t.length}`);for(let r=0;r<t.length;++r)e.writeUint8(t.charCodeAt(r))}read(e){let t="";for(let r=0;r<this.length;++r)t+=String.fromCharCode(e.readByte());return t}measure(e,t=new ee){return t.add(this.length)}};function Ed(e){return new Sd(e)}function Nt(e){return Object.entries(e)}function qu(e,t){const r={};for(const[n,i]of Nt(t))r[n]=e.resolve(i);return r}var ca=class extends ge{constructor(e){super(),this._properties=e,k(this,"properties"),this.properties=e}resolveReferences(e){this.properties=qu(e,this._properties)}write(e,t){for(const[r,n]of Nt(this.properties))n.write(e,t[r])}read(e){const t={};for(const[r,n]of Nt(this.properties))t[r]=n.read(e);return t}get maxSize(){const e=new ee;for(const t of Object.values(this.properties))t.measure(se,e);return e.size}measure(e,t=new ee){for(const[r,n]of Nt(this.properties))n.measure(e===se?se:e[r],t);return t}seekProperty(e,t){let r=0;for(const[n,i]of Nt(this.properties)){if(n===t)return{bufferOffset:r,schema:i};r+=i.measure(e).size}return null}};function Md(e){return new ca(e)}var Hu=class extends ge{constructor(e,t,r){super(),this.keyedBy=e,this._subTypeMap=r,k(this,"_baseObject"),k(this,"subTypeMap"),this._baseObject=new ca(t),this.subTypeMap=r}resolveReferences(e){this._baseObject.resolveReferences(e),this.subTypeMap=qu(e,this._subTypeMap)}write(e,t){const r=t.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===vn.ENUM?e.writeUint8(t.type):e.writeString(t.type),this._baseObject.write(e,t);for(const[i,s]of Nt(n.properties))s.write(e,t[i])}read(e){const t=this.keyedBy===vn.ENUM?e.readByte():e.readString(),r=this.subTypeMap[t]||null;if(r===null)throw new Error(`Unknown sub-type '${t}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const n=this._baseObject.read(e);if(n.type=t,r!==null)for(const[i,s]of Nt(r.properties))n[i]=s.read(e);return n}measure(e,t=new ee){if(this._baseObject.measure(e,t),this.keyedBy===vn.ENUM)t.add(1);else if(e!==se)t.add(e.type.length+1);else return t.unbounded;if(e===se){const r=Object.values(this.subTypeMap).map(n=>{const i=t.fork();for(const s of Object.values(n.properties))s.measure(se,i);return[n,i.size]}).reduce((n,i)=>n[1]>i[1]?n:i)[0];for(const n of Object.values(r.properties))n.measure(se,t)}else{const r=e.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[i,s]of Nt(n.properties))s.measure(e[i],t)}return t}};function kd(e,t){return new Hu(vn.STRING,e,t)}function Ud(e,t){return new Hu(vn.ENUM,e,t)}function Vd(e){return new ca(Object.fromEntries(e.flatMap(({properties:t})=>Object.entries(t))))}var Pd=class extends ge{constructor(e){super(),this._unstableElementType=e,k(this,"elementType"),this.elementType=e}resolveReferences(e){this.elementType=e.resolve(this._unstableElementType)}write(e,t){e.writeUint32(t.length);for(const r of t)this.elementType.write(e,r)}read(e){const t=[],r=e.readUint32();for(let n=0;n<r;++n)t.push(this.elementType.read(e));return t}get maxSize(){return this.measure(se).size}measure(e,t=new ee){if(e===se)return t.unbounded;t.add(4);for(const r of e)this.elementType.measure(r,t);return t}seekProperty(e,t){if(typeof t=="symbol")return null;const r=Number.parseInt(String(t),10);if(Number.isNaN(r))return null;if(e===se)return{bufferOffset:this.elementType.measure(se).size*r,schema:this.elementType};if(r>=e.length)return null;const n=new ee;for(let i=0;i<r;++i)this.elementType.measure(e[i],n);return{bufferOffset:n.size,schema:this.elementType}}};function Ad(e){return new Pd(e)}var Yu=class{constructor(e){k(this,"__unwrapped"),k(this,"ref"),this.ref=new id(e)}resolveReferences(){throw new sr("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new sr("Tried to read a reference directly. Resolve it instead.")}write(){throw new sr("Tried to write a reference directly. Resolve it instead.")}measure(){throw new sr("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new sr("Tried to seek property of a reference directly. Resolve it instead.")}},Od=class{constructor(){k(this,"registry",{})}hasKey(e){return this.registry[e]!==void 0}register(e,t){this.registry[e]=t}resolve(e){if(e instanceof Yu){const r=e.ref.key;if(this.registry[r]!==void 0)return this.registry[r];throw new sr(`Couldn't resolve reference to ${r}. Unknown key.`)}return e.resolveReferences(this),e}},Bd=class{constructor(e,t){this.key=e,k(this,"__unwrapped"),k(this,"__keyDefinition"),k(this,"innerType"),this.innerType=t(new Yu(e)),this.resolveReferences(new Od)}resolveReferences(e){e.hasKey(this.key)||(e.register(this.key,this.innerType),this.innerType.resolveReferences(e))}read(e){return this.innerType.read(e)}write(e,t){this.innerType.write(e,t)}get maxSize(){return this.measure(se).size}measure(e,t=new ee){return this.innerType.measure(e,t)}seekProperty(e,t){return this.innerType.seekProperty(e,t)}};function Cd(e,t){return new Bd(e,t)}var Fd=class extends ge{constructor(e){super(),this._innerUnstableSchema=e,k(this,"innerSchema"),this.innerSchema=e}resolveReferences(e){this.innerSchema=e.resolve(this._innerUnstableSchema)}write(e,t){t!=null?(e.writeBool(!0),this.innerSchema.write(e,t)):e.writeBool(!1)}read(e){if(e.readBool())return this.innerSchema.read(e)}get maxSize(){return this.measure(se).size}measure(e,t=new ee){return e!==void 0&&this.innerSchema.measure(e,t),t.add(1)}};function jd(e){return new Fd(e)}function Gd(e,t){return t.map(r=>e.resolve(r))}var Ld=class extends ge{constructor(e){super(),this._unstableSchemas=e,k(this,"schemas"),this.schemas=e}resolveReferences(e){this.schemas=Gd(e,this._unstableSchemas)}write(e,t){if(t.length!==this.schemas.length)throw new Fi(`Expected tuple of length ${this.schemas.length}, got ${t.length}`);for(let r=0;r<this.schemas.length;++r)this.schemas[r].write(e,t[r])}read(e){const t=[];for(let r=0;r<this.schemas.length;++r)t.push(this.schemas[r].read(e));return t}get maxSize(){return this.measure(se).size}measure(e,t=new ee){for(let r=0;r<this.schemas.length;++r)this.schemas[r].measure(e===se?se:e[r],t);return t}};function Rd(e){return new Ld(e)}var Ct=class extends ge{constructor(e,t){super(),this.length=e,this._arrayConstructor=t,k(this,"byteLength"),this.byteLength=e*t.BYTES_PER_ELEMENT}write(e,t){e.writeSlice(t)}read(e){const t=new ArrayBuffer(this.byteLength),r=new this._arrayConstructor(t,0,this.length);return e.readSlice(r,0,this.byteLength),r}measure(e,t=new ee){return t.add(this.byteLength)}},Dd=e=>new Ct(e,Uint8Array),Nd=e=>new Ct(e,Uint8ClampedArray),Wd=e=>new Ct(e,Uint16Array),qd=e=>new Ct(e,Uint32Array),Hd=e=>new Ct(e,Int8Array),Yd=e=>new Ct(e,Int16Array),Xd=e=>new Ct(e,Int32Array),Zd=e=>new Ct(e,Float32Array),Qd=e=>new Ct(e,Float64Array);function Jd(){const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return t[0]=1,e[0]===0}function Xu(){return Jd()?"big":"little"}function pa(e){let t=0,r=e;return r&&"buffer"in r&&"byteOffset"in r&&(t+=r.byteOffset,r=r.buffer),{buffer:r,byteOffset:t,byteLength:e.byteLength}}var Zu=class{constructor(e,t){k(this,"dataView"),k(this,"littleEndian"),k(this,"byteOffset",0),k(this,"endianness");const{byteOffset:r=0,endianness:n="system"}=t??{};this.byteOffset=r;const i=Xu();this.endianness=n==="system"?i:n,this.littleEndian=this.endianness==="little";const s=pa(e);this.byteOffset+=s.byteOffset,this.dataView=new DataView(s.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(e){this.byteOffset=e}skipBytes(e){this.byteOffset+=e}};function Kd(e){if(e===0)return 0;if(Number.isNaN(e))return 32256;if(!Number.isFinite(e))return e>0?31744:64512;const t=e<0?1:0,r=Math.abs(e),n=Math.floor(Math.log2(r)),i=r/2**n-1,s=n+15,a=Math.floor(i*1024);return t<<15|s<<10|a}function ef(e){const t=(e&32768)>>15,r=(e&31744)>>10,n=e&1023;return r===0?t===0?n/1024:-n/1024:r===31?n===0?t===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(t===0?1:-1)*(1+n/1024)*2**(r-15)}var Wt=class extends Zu{constructor(){super(...arguments),k(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const e=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readUint16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readInt32(){const e=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readUint32(){const e=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readFloat16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,ef(e)}readFloat32(){const e=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readString(){let e=0;for(;this.byteOffset+e<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+e++)!==0;);const t=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,e-1));return this.byteOffset+=e,t}readSlice(e,t,r){const n=pa(e),i=new Uint8Array(n.buffer,n.byteOffset+t);for(let s=0;s<r;++s)i[s]=this.dataView.getUint8(this.byteOffset++)}},mr=class extends Zu{constructor(){super(...arguments),k(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(e){this.dataView.setUint8(this.byteOffset++,e?1:0)}writeByte(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt8(e){this.dataView.setInt8(this.byteOffset++,e)}writeUint8(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt16(e){this.dataView.setInt16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeUint16(e){this.dataView.setUint16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeInt32(e){this.dataView.setInt32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeUint32(e){this.dataView.setUint32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeFloat16(e){this.dataView.setUint16(this.byteOffset,Kd(e),this.littleEndian),this.byteOffset+=2}writeFloat32(e){this.dataView.setFloat32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeString(e){const t=this._textEncoder.encodeInto(e,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=t.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(e){const t=pa(e),r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(const n of r)this.dataView.setUint8(this.byteOffset++,n)}},U=e=>({argTypes:[e],returnType:e}),ji=(...e)=>{let t=ye(e)??e;return{argTypes:t,returnType:t[0]}};function Qu(e){return(t,...r)=>{let n=t;for(let i of r)n=e(n,i);return n}}function Ju(e){return(t,...r)=>{let n=c`${t}`;for(let i of r)n=c`${e}(${n}, ${i})`;return n}}function tf(e){return typeof e=="number"?Math.abs(e):T.abs[e.kind](e)}var rf=d({name:"abs",signature:U,normalImpl:tf,codegenImpl:e=>c`abs(${e})`});function nf(e){return typeof e=="number"?Math.acos(e):T.acos[e.kind](e)}var sf=d({name:"acos",signature:U,normalImpl:nf,codegenImpl:e=>c`acos(${e})`});function af(e){return typeof e=="number"?Math.acosh(e):T.acosh[e.kind](e)}var of=d({name:"acosh",signature:U,normalImpl:af,codegenImpl:e=>c`acosh(${e})`});function uf(e){return typeof e=="number"?Math.asin(e):T.asin[e.kind](e)}var hf=d({name:"asin",signature:U,normalImpl:uf,codegenImpl:e=>c`asin(${e})`});function lf(e){return typeof e=="number"?Math.asinh(e):T.asinh[e.kind](e)}var cf=d({name:"asinh",signature:U,normalImpl:lf,codegenImpl:e=>c`asinh(${e})`});function pf(e){return typeof e=="number"?Math.atan(e):T.atan[e.kind](e)}var Ku=d({name:"atan",signature:U,normalImpl:pf,codegenImpl:e=>c`atan(${e})`});function df(e){return typeof e=="number"?Math.atanh(e):T.atanh[e.kind](e)}var ff=d({name:"atanh",signature:U,normalImpl:df,codegenImpl:e=>c`atanh(${e})`});function mf(e,t){return typeof e=="number"&&typeof t=="number"?Math.atan2(e,t):T.atan2[e.kind](e,t)}var yf=d({name:"atan2",signature:(...e)=>{let t=ye(e,[g,oe,mt])??e;return{argTypes:t,returnType:t[0]}},normalImpl:mf,codegenImpl:(e,t)=>c`atan2(${e}, ${t})`});function gf(e){return typeof e=="number"?Math.ceil(e):T.ceil[e.kind](e)}var eh=d({name:"ceil",signature:U,normalImpl:gf,codegenImpl:e=>c`ceil(${e})`});function wf(e,t,r){return typeof e=="number"?Math.min(Math.max(t,e),r):T.clamp[e.kind](e,t,r)}var bt=d({name:"clamp",signature:ji,normalImpl:wf,codegenImpl:(e,t,r)=>c`clamp(${e}, ${t}, ${r})`});function xf(e){return typeof e=="number"?Math.cos(e):T.cos[e.kind](e)}var ms=d({name:"cos",signature:U,normalImpl:xf,codegenImpl:e=>c`cos(${e})`});function vf(e){return typeof e=="number"?Math.cosh(e):T.cosh[e.kind](e)}var $f=d({name:"cosh",signature:U,normalImpl:vf,codegenImpl:e=>c`cosh(${e})`}),bf=d({name:"countLeadingZeros",signature:U,normalImpl:"CPU implementation for countLeadingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countLeadingZeros(${e})`}),Tf=d({name:"countOneBits",signature:U,normalImpl:"CPU implementation for countOneBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countOneBits(${e})`}),_f=d({name:"countTrailingZeros",signature:U,normalImpl:"CPU implementation for countTrailingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countTrailingZeros(${e})`}),zf=d({name:"cross",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>T.cross[e.kind](e,t),codegenImpl:(e,t)=>c`cross(${e}, ${t})`});function If(e){if(typeof e=="number")return e*180/Math.PI;throw new rt("CPU implementation for degrees on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Sf=d({name:"degrees",signature:U,normalImpl:If,codegenImpl:e=>c`degrees(${e})`}),Ef=d({name:"determinant",signature:U,normalImpl:"CPU implementation for determinant not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`determinant(${e})`});function Mf(e,t){return typeof e=="number"&&typeof t=="number"?Math.abs(e-t):rh(Jr(e,t))}var kf=d({name:"distance",signature:(...e)=>({argTypes:e,returnType:Ps(e[0])?oe:g}),normalImpl:Mf,codegenImpl:(e,t)=>c`distance(${e}, ${t})`}),th=d({name:"dot",signature:(...e)=>({argTypes:e,returnType:e[0].primitive}),normalImpl:(e,t)=>T.dot[e.kind](e,t),codegenImpl:(e,t)=>c`dot(${e}, ${t})`}),Uf=d({name:"dot4U8Packed",signature:{argTypes:[b,b],returnType:b},normalImpl:"CPU implementation for dot4U8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4U8Packed(${e}, ${t})`}),Vf=d({name:"dot4I8Packed",signature:{argTypes:[b,b],returnType:V},normalImpl:"CPU implementation for dot4I8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4I8Packed(${e}, ${t})`});function Pf(e){return typeof e=="number"?Math.exp(e):T.exp[e.kind](e)}var Af=d({name:"exp",signature:U,normalImpl:Pf,codegenImpl:e=>c`exp(${e})`});function Of(e){return typeof e=="number"?2**e:T.exp2[e.kind](e)}var Bf=d({name:"exp2",signature:U,normalImpl:Of,codegenImpl:e=>c`exp2(${e})`}),Cf=d({name:"extractBits",signature:(e,t,r)=>({argTypes:[e,b,b],returnType:e}),normalImpl:"CPU implementation for extractBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`extractBits(${e}, ${t}, ${r})`}),Ff=d({name:"faceForward",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:"CPU implementation for faceForward not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`faceForward(${e}, ${t}, ${r})`}),jf=d({name:"firstLeadingBit",signature:U,normalImpl:"CPU implementation for firstLeadingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstLeadingBit(${e})`}),Gf=d({name:"firstTrailingBit",signature:U,normalImpl:"CPU implementation for firstTrailingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstTrailingBit(${e})`});function Lf(e){return typeof e=="number"?Math.floor(e):T.floor[e.kind](e)}var dn=d({name:"floor",signature:U,normalImpl:Lf,codegenImpl:e=>c`floor(${e})`});function Rf(e,t,r){if(typeof e=="number")return e*t+r;throw new rt("CPU implementation for fma on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Df=d({name:"fma",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Rf,codegenImpl:(e,t,r)=>c`fma(${e}, ${t}, ${r})`});function Nf(e){return typeof e=="number"?e-Math.floor(e):T.fract[e.kind](e)}var Wf=d({name:"fract",signature:U,normalImpl:Nf,codegenImpl:e=>c`fract(${e})`}),qf={f32:de({fract:g,exp:V}),f16:de({fract:oe,exp:V}),abstractFloat:de({fract:mt,exp:Un}),vec2f:de({fract:D,exp:q}),vec3f:de({fract:ue,exp:Oe}),vec4f:de({fract:I,exp:pe}),vec2h:de({fract:yt,exp:q}),vec3h:de({fract:gt,exp:Oe}),vec4h:de({fract:wt,exp:pe})},Hf=d({name:"frexp",normalImpl:"CPU implementation for frexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",signature:e=>{let t=qf[e.type];if(!t)throw new Error(`Unsupported data type for frexp: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},codegenImpl:e=>c`frexp(${e})`}),Yf=d({name:"insertBits",signature:(e,t,r,n)=>({argTypes:[e,t,b,b],returnType:e}),normalImpl:"CPU implementation for insertBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r,n)=>c`insertBits(${e}, ${t}, ${r}, ${n})`});function Xf(e){if(typeof e=="number")return 1/Math.sqrt(e);throw new rt("CPU implementation for inverseSqrt on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Zf=d({name:"inverseSqrt",signature:U,normalImpl:Xf,codegenImpl:e=>c`inverseSqrt(${e})`}),Qf=d({name:"ldexp",signature:(e,t)=>{switch(e.type){case"abstractFloat":return{argTypes:[e,Un],returnType:e};case"f32":case"f16":return{argTypes:[e,V],returnType:e};case"vec2f":case"vec2h":return{argTypes:[e,q],returnType:e};case"vec3f":case"vec3h":return{argTypes:[e,Oe],returnType:e};case"vec4f":case"vec4h":return{argTypes:[e,pe],returnType:e};default:throw new Error(`Unsupported data type for ldexp: ${e.type}. Supported types are abstractFloat, f32, f16, vec2f, vec2h, vec3f, vec3h, vec4f, vec4h.`)}},normalImpl:"CPU implementation for ldexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`ldexp(${e}, ${t})`});function Jf(e){return typeof e=="number"?Math.abs(e):T.length[e.kind](e)}var rh=d({name:"length",signature:e=>({argTypes:[e],returnType:Ps(e)?oe:g}),normalImpl:Jf,codegenImpl:e=>c`length(${e})`});function Kf(e){return typeof e=="number"?Math.log(e):T.log[e.kind](e)}var em=d({name:"log",signature:U,normalImpl:Kf,codegenImpl:e=>c`log(${e})`});function tm(e){return typeof e=="number"?Math.log2(e):T.log2[e.kind](e)}var rm=d({name:"log2",signature:U,normalImpl:tm,codegenImpl:e=>c`log2(${e})`});function nm(e,t){return typeof e=="number"?Math.max(e,t):T.max[e.kind](e,t)}var nh=d({name:"max",signature:ji,normalImpl:Qu(nm),codegenImpl:Ju("max")});function im(e,t){return typeof e=="number"?Math.min(e,t):T.min[e.kind](e,t)}var sm=d({name:"min",signature:ji,normalImpl:Qu(im),codegenImpl:Ju("min")});function am(e,t,r){if(typeof e=="number"){if(typeof r!="number"||typeof t!="number")throw new Error("When e1 and e2 are numbers, the blend factor must be a number.");return e*(1-r)+t*r}if(typeof e=="number"||typeof t=="number")throw new Error("e1 and e2 need to both be vectors of the same kind.");return T.mix[e.kind](e,t,r)}var ir=d({name:"mix",signature:ji,normalImpl:am,codegenImpl:(e,t,r)=>c`mix(${e}, ${t}, ${r})`}),om={f32:de({fract:g,whole:g}),f16:de({fract:oe,whole:oe}),abstractFloat:de({fract:mt,whole:mt}),vec2f:de({fract:D,whole:D}),vec3f:de({fract:ue,whole:ue}),vec4f:de({fract:I,whole:I}),vec2h:de({fract:yt,whole:yt}),vec3h:de({fract:gt,whole:gt}),vec4h:de({fract:wt,whole:wt})},um=d({name:"modf",signature:e=>{let t=om[e.type];if(!t)throw new Error(`Unsupported data type for modf: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},normalImpl:"CPU implementation for modf not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`modf(${e})`}),hm=d({name:"normalize",signature:U,normalImpl:e=>T.normalize[e.kind](e),codegenImpl:e=>c`normalize(${e})`});function lm(e,t){if(typeof e=="number"&&typeof t=="number")return e**t;if(J(e)&&J(t))return T.pow[e.kind](e,t);throw new Error("Invalid arguments to pow()")}var ih=d({name:"pow",signature:(...e)=>{let t=ye(e,[g,oe,mt])??e;return{argTypes:t,returnType:qt(t[0])?t[1]:t[0]}},normalImpl:lm,codegenImpl:(e,t)=>c`pow(${e}, ${t})`}),cm=d({name:"quantizeToF16",signature:U,normalImpl:"CPU implementation for quantizeToF16 not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`quantizeToF16(${e})`});function pm(e){if(typeof e=="number")return e*Math.PI/180;throw new rt("CPU implementation for radians on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var dm=d({name:"radians",signature:(...e)=>{let t=ye(e,[g,oe,mt])??e;return{argTypes:t,returnType:t[0]}},normalImpl:pm,codegenImpl:e=>c`radians(${e})`}),fm=d({name:"reflect",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>Jr(e,Fn(2*th(t,e),t)),codegenImpl:(e,t)=>c`reflect(${e}, ${t})`}),mm=d({name:"refract",normalImpl:"CPU implementation for refract not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`refract(${e}, ${t}, ${r})`,signature:(e,t,r)=>({argTypes:[e,t,Ps(e)?oe:g],returnType:e})}),ym=d({name:"reverseBits",signature:U,normalImpl:"CPU implementation for reverseBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`reverseBits(${e})`});function gm(e){if(typeof e=="number")return Math.round(e);throw new rt("CPU implementation for round on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var wm=d({name:"round",signature:U,normalImpl:gm,codegenImpl:e=>c`round(${e})`});function xm(e){if(typeof e=="number")return Math.max(0,Math.min(1,e));throw new rt("CPU implementation for saturate on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var vm=d({name:"saturate",signature:U,normalImpl:xm,codegenImpl:e=>c`saturate(${e})`});function $m(e){return typeof e=="number"?Math.sign(e):T.sign[e.kind](e)}var bm=d({name:"sign",signature:U,normalImpl:$m,codegenImpl:e=>c`sign(${e})`});function Tm(e){return typeof e=="number"?Math.sin(e):T.sin[e.kind](e)}var ys=d({name:"sin",signature:U,normalImpl:Tm,codegenImpl:e=>c`sin(${e})`});function _m(e){if(typeof e=="number")return Math.sinh(e);throw new rt("CPU implementation for sinh on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var zm=d({name:"sinh",signature:U,normalImpl:_m,codegenImpl:e=>c`sinh(${e})`});function Im(e,t,r){return typeof r=="number"?nr(e,t,r):T.smoothstep[r.kind](e,t,r)}var Sm=d({name:"smoothstep",signature:(...e)=>({argTypes:e,returnType:e[2]}),normalImpl:Im,codegenImpl:(e,t,r)=>c`smoothstep(${e}, ${t}, ${r})`});function Em(e){return typeof e=="number"?Math.sqrt(e):T.sqrt[e.kind](e)}var sh=d({name:"sqrt",signature:U,normalImpl:Em,codegenImpl:e=>c`sqrt(${e})`});function Mm(e,t){if(typeof e=="number")return e<=t?1:0;throw new rt("CPU implementation for step on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var km=d({name:"step",signature:(...e)=>{let t=ye(e,[g,oe,mt])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Mm,codegenImpl:(e,t)=>c`step(${e}, ${t})`});function Um(e){if(typeof e=="number")return Math.tan(e);throw new rt("CPU implementation for tan on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Vm=d({name:"tan",signature:U,normalImpl:Um,codegenImpl:e=>c`tan(${e})`});function Pm(e){return typeof e=="number"?Math.tanh(e):T.tanh[e.kind](e)}var Am=d({name:"tanh",signature:U,normalImpl:Pm,codegenImpl:e=>c`tanh(${e})`}),Om=d({name:"transpose",signature:U,normalImpl:"CPU implementation for transpose not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`transpose(${e})`}),Bm=d({name:"trunc",signature:U,normalImpl:"CPU implementation for trunc not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`trunc(${e})`}),ah=d({name:"bitcastU32toF32",normalImpl:(e=>typeof e=="number"?ot(e):T.bitcastU32toF32[e.kind](e)),codegenImpl:e=>c`bitcast<f32>(${e})`,signature:(...e)=>{let t=ye(e,[b])??e;return{argTypes:t,returnType:ft(t[0])?t[0].type==="vec2u"?D:t[0].type==="vec3u"?ue:I:g}}}),oh=d({name:"bitcastU32toI32",normalImpl:(e=>typeof e=="number"?ut(e):T.bitcastU32toI32[e.kind](e)),codegenImpl:e=>c`bitcast<i32>(${e})`,signature:(...e)=>{let t=ye(e,[b])??e;return{argTypes:t,returnType:ft(t[0])?t[0].type==="vec2u"?q:t[0].type==="vec3u"?Oe:pe:V}}}),uh=d({name:"unpack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4);new mr(t).writeUint32(e);let r=new Wt(t);return D(r.readFloat16(),r.readFloat16())},signature:{argTypes:[b],returnType:D},codegenImpl:e=>c`unpack2x16float(${e})`}),Cm=d({name:"pack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4),r=new mr(t);r.writeFloat16(e.x),r.writeFloat16(e.y);let n=new Wt(t);return b(n.readUint32())},signature:{argTypes:[D],returnType:b},codegenImpl:e=>c`pack2x16float(${e})`}),Fm=d({name:"unpack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4);new mr(t).writeUint32(e);let r=new Wt(t);return I(r.readUint8()/255,r.readUint8()/255,r.readUint8()/255,r.readUint8()/255)},signature:{argTypes:[b],returnType:I},codegenImpl:e=>c`unpack4x8unorm(${e})`}),jm=d({name:"pack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4),r=new mr(t);r.writeUint8(e.x*255),r.writeUint8(e.y*255),r.writeUint8(e.z*255),r.writeUint8(e.w*255);let n=new Wt(t);return b(n.readUint32())},signature:{argTypes:[I],returnType:b},codegenImpl:e=>c`pack4x8unorm(${e})`});function Kr(e){return e.type.includes("2")?pr:e.type.includes("3")?dr:fr}var hh=d({name:"allEq",signature:(...e)=>({argTypes:e,returnType:G}),normalImpl:(e,t)=>fa(Gn(e,t)),codegenImpl:(e,t)=>c`all(${e} == ${t})`}),Gn=(e,t)=>T.eq[e.kind](e,t),Gm=d({name:"eq",signature:(...e)=>({argTypes:e,returnType:Kr(e[0])}),normalImpl:Gn,codegenImpl:(e,t)=>c`(${e} == ${t})`}),Lm=d({name:"ne",signature:(...e)=>({argTypes:e,returnType:Kr(e[0])}),normalImpl:(e,t)=>Mt(Gn(e,t)),codegenImpl:(e,t)=>c`(${e} != ${t})`}),Gi=(e,t)=>T.lt[e.kind](e,t),Rm=d({name:"lt",signature:(...e)=>({argTypes:e,returnType:Kr(e[0])}),normalImpl:Gi,codegenImpl:(e,t)=>c`(${e} < ${t})`}),Dm=d({name:"le",signature:(...e)=>({argTypes:e,returnType:Kr(e[0])}),normalImpl:(e,t)=>da(Gi(e,t),Gn(e,t)),codegenImpl:(e,t)=>c`(${e} <= ${t})`}),Nm=d({name:"gt",signature:(...e)=>({argTypes:e,returnType:Kr(e[0])}),normalImpl:(e,t)=>lh(Mt(Gi(e,t)),Mt(Gn(e,t))),codegenImpl:(e,t)=>c`(${e} > ${t})`}),Wm=d({name:"ge",signature:(...e)=>({argTypes:e,returnType:Kr(e[0])}),normalImpl:(e,t)=>Mt(Gi(e,t)),codegenImpl:(e,t)=>c`(${e} >= ${t})`}),Mt=e=>T.neg[e.kind](e),qm=d({name:"not",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Mt,codegenImpl:e=>c`!(${e})`}),da=(e,t)=>T.or[e.kind](e,t),Hm=d({name:"or",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:da,codegenImpl:(e,t)=>c`(${e} | ${t})`}),lh=(e,t)=>Mt(da(Mt(e),Mt(t))),Ym=d({name:"and",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:lh,codegenImpl:(e,t)=>c`(${e} & ${t})`}),fa=e=>T.all[e.kind](e),Xm=d({name:"all",signature:(...e)=>({argTypes:e,returnType:G}),normalImpl:fa,codegenImpl:e=>c`all(${e})`}),Zm=d({name:"any",signature:(...e)=>({argTypes:e,returnType:G}),normalImpl:e=>!fa(Mt(e)),codegenImpl:e=>c`any(${e})`}),Qm=d({name:"isCloseTo",signature:(...e)=>({argTypes:e,returnType:G}),normalImpl:(e,t,r=.01)=>typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<r:J(e)&&J(t)?T.isCloseToZero[e.kind](Jr[l].jsImpl(e,t),r):!1,codegenImpl:(e,t,r=y(.01,g,"constant"))=>Hn(e)&&Hn(t)?c`(abs(f32(${e}) - f32(${t})) <= ${r})`:!Hn(e)&&!Hn(t)?c`all(abs(${e} - ${t}) <= (${e} - ${e}) + ${r})`:"false"});function Jm(e,t,r){return typeof r=="boolean"?r?t:e:T.select[e.kind](e,t,r)}var Km=d({name:"select",signature:(e,t,r)=>{let[n,i]=ye([e,t])??[e,t];return{argTypes:[n,i,r],returnType:n}},normalImpl:Jm,codegenImpl:(e,t,r)=>c`select(${e}, ${t}, ${r})`}),ey={channelType:g,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:"non-copyable"},ty={channelType:g,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:2},ry={channelType:g,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:4},ny={channelType:b,vectorType:ve,sampleTypes:["uint"],texelSize:1},Ha=new Map;function Ln(e){let t=Ha.get(e);return t===void 0&&(t=iy(e),Ha.set(e,t)),t}function iy(e){let t=oy(e),r=sy(e),n=e.includes("stencil");return{channelType:t,vectorType:t===b?ve:t===V?pe:I,texelSize:uy(e),sampleTypes:hy(e),canRenderAttachment:ay(e),...r&&{depthAspect:r},...n&&{stencilAspect:ny}}}function sy(e){if(e==="depth16unorm")return ty;if(e==="depth32float"||e==="depth32float-stencil8")return ry;if(e==="depth24plus"||e==="depth24plus-stencil8")return ey}function ay(e){return!(e.startsWith("bc")||e.startsWith("etc2")||e.startsWith("eac")||e.startsWith("astc")||e==="rgb9e5ufloat")}function oy(e){return e==="stencil8"||e.includes("uint")?b:e.includes("sint")?V:g}function uy(e){let[,t,r]=e.match(/^(rgba|bgra|rg|r)(8|16|32)/)??[];return t&&r?t.length*Number(r)/8:e==="stencil8"?1:e==="depth16unorm"?2:e==="depth32float"?4:e==="depth32float-stencil8"?5:e==="depth24plus"||e==="depth24plus-stencil8"?"non-copyable":/^(bc[14]-|etc2-rgb8|eac-r11)/.test(e)?8:/^(bc|astc-|etc2-rgba|eac-rg)/.test(e)?16:4}function hy(e){return e==="stencil8"?["uint"]:e.includes("uint")?["uint"]:e.includes("sint")?["sint"]:e.includes("depth")?["depth","unfilterable-float"]:/^(r|rg|rgba)16(u|s)norm$/.test(e)?["unfilterable-float"]:["float","unfilterable-float"]}var ly=new Set(["r32float","rg32float","rgba32float"]);function cy(e,t){return ly.has(t)&&!e.features.has("float32-filterable")?["unfilterable-float"]:Ln(t).sampleTypes}var ma=["f16","clip_distances","dual_source_blending","subgroups","primitive_index"],ch={f16:"shader-f16",clip_distances:"clip-distances",dual_source_blending:"dual-source-blending",subgroups:"subgroups",primitive_index:"primitive-index"},py={block:0,binaryExpr:1,assignmentExpr:2,logicalExpr:3,unaryExpr:4,numericLiteral:5,call:6,memberAccess:7,indexAccess:8,return:10,if:11,let:12,const:13,for:14,while:15,continue:16,break:17,arrayExpr:100,preUpdate:101,postUpdate:102,stringLiteral:103,objectExpr:104},gs={identifier:"i",destructuredObject:"d"};const dy=Object.freeze(Object.defineProperty({__proto__:null,FuncParameterType:gs,NodeTypeCatalog:py},Symbol.toStringTag,{value:"Module"}));function fy(e){return e?.[F]}var We={get(e,t){if(t in e)return Reflect.get(e,t);if(t==="toString"||t===Symbol.toStringTag||t===Symbol.toPrimitive)return()=>e.toString();if(typeof t=="symbol")return;let r=Ei(e),n=ua(r,String(t));if(n)return new Proxy({[l]:!0,[_]:i=>i.resolve(n.value,n.dataType),[ke]:n,toString:()=>`${String(e)}.${t}`},We)}};function Li(e){let t=e;for(;;){let r=fy(t);if(!r)break;t=r}return t}function ws(e,t){return new my(e,t)}function ph(e){let t=Reflect.ownKeys(e);for(let r of t){let n=e[r];(n&&typeof n=="object"||typeof n=="function")&&ph(n)}return Object.freeze(e)}var my=class{constructor(t,r){this.dataType=t,this.#e=r&&typeof r=="object"?ph(r):r}[l]={};#e;$name(t){return L(this,t),this}[_](t){let r=t.getUniqueName(this),n=t.resolve(this.dataType).value,i=t.resolve(this.#e,this.dataType).value;return t.addDeclaration(`const ${r}: ${n} = ${i};`),y(r,this.dataType,Te(this.dataType)?"constant":"constant-tgpu-const-ref")}toString(){return`const:${v(this)??"<unnamed>"}`}get[F](){let t=this.dataType;return new Proxy({[l]:!0,get[ke](){return y(this,t,Te(t)?"constant":"constant-tgpu-const-ref")},[_]:r=>r.resolve(this),toString:()=>`const:${v(this)??"<unnamed>"}.$`},We)}get $(){return nt()?this[F]:this.#e}get value(){return this.$}};function yy(e){return new gy(e)}var gy=class{constructor(t){this.declaration=t}[l]=!0;externalsToApply=[];$uses(t){return this.externalsToApply.push(t),this}[_](t){let r={};for(let i of this.externalsToApply)Dr(r,i);let n=On(t,r,this.declaration);return t.addDeclaration(n),y("",te,"constant")}toString(){return`declare: ${this.declaration}`}};function dh(e){let t={argTypes:e.in&&Object.keys(e.in).length!==0?[Cn(e.in)]:[],returnType:te,workgroupSize:[e.workgroupSize[0]??1,e.workgroupSize[1]??1,e.workgroupSize[2]??1],isEntry:!0};return Object.assign((r,...n)=>wy(t,e.workgroupSize,Ui(r,...n)),t)}function wy(e,t,r){let n=Bn(r,`@compute @workgroup_size(${t.join(", ")}) `),i=e.argTypes[0];return{shell:e,$uses(s){return n.applyExternals(s),this},[l]:!0,[ae]:n,$name(s){return L(n,s),zi(i)&&i.$name(`${s}_Input`),this},[_](s){return n.resolve(s,e.argTypes,e.returnType)},toString(){return`computeFn:${v(n)??"<unnamed>"}`}}}function C(e,t){let r={[l]:!0,argTypes:e,returnType:t??te,isEntry:!1};return Object.assign((n,...i)=>vy(r,Ui(n,...i)),r)}function fh(e){return O(e)&&e?.resourceType==="function"}function xy([e,t]){return`${v(e)??"<unnamed>"}=${t}`}function vy(e,t){let r=Bn(t,""),n={shell:e,resourceType:"function",$uses(a){return r.applyExternals(a),this},[ae]:r,$name(a){return L(r,a),this},with(a,o){return mh(s,[[Si(a)?a.slot:a,o]])},[_](a){return typeof t=="string"&&(op(t,e.argTypes,r.applyExternals),xu(t,e.returnType,r.applyExternals)),r.resolve(a,e.argTypes,e.returnType)}},i=d({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.argTypes,returnType:e.returnType},normalImpl:(...a)=>Ll(()=>{try{if(typeof t=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");let o=a.map((h,p)=>Xt(e.argTypes[p],h)),u=t(...o);return Xt(e.returnType,u)}catch(o){throw o instanceof ka?o.appendToTrace(s):new ka(o,[s])}}),codegenImpl:(...a)=>{let o=Ae();return o.withResetIndentLevel(()=>c`${o.resolve(s).value}(${a})`)}}),s=Object.assign(i,n);return s[l].implementation=t,Object.defineProperty(s,"toString",{value(){return`fn:${v(r)??"<unnamed>"}`}}),s}function mh(e,t){let r={resourceType:"function",shell:e.shell,[ar]:{inner:e,pairs:t},$uses(s){return e.$uses(s),this},[ae]:e,$name(s){return e.$name(s),this},with(s,a){return mh(i,[...t,[Si(s)?s.slot:s,a]])}},n=d({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.shell.argTypes,returnType:e.shell.returnType},normalImpl:e,codegenImpl:(...s)=>{let a=Ae();return a.withResetIndentLevel(()=>c`${a.resolve(i).value}(${s})`)}}),i=Object.assign(n,r);return i[l].implementation=e[l].implementation,Object.defineProperty(i,"toString",{value(){return`fn:${v(e)??"<unnamed>"}[${t.map(xy).join(", ")}]`}}),i}function $y(e,t,r="runtime"){return new by(e,t,r)}var by=class{[l];dataType;origin;#e;#t;constructor(t,r,n){this[l]=!0,this.dataType=r,this.origin=n,this.#e=t,this.#t=[]}$uses(t){return this.#t.push(t),this}[_](t){let r={};for(let i of this.#t)Dr(r,i);let n=On(t,r,this.#e);return y(n,this.dataType,this.origin)}toString(){return`raw(${String(this.dataType)}): "${this.#e}"`}get[F](){let t=this.dataType,r=this.origin;return new Proxy({[l]:!0,get[ke](){return y(this,t,r)},[_]:n=>n.resolve(this),toString:()=>`raw(${String(this.dataType)}): "${this.#e}".$`},We)}get $(){if(!nt())throw new Error("Raw code snippets can only be used on the GPU.");return this[F]}get value(){return this.$}};function Ty(e){let t={in:e.in,out:e.out,returnType:Cn(e.out),isEntry:!0};return Object.assign((r,...n)=>_y(t,Ui(r,...n)),t)}function _y(e,t){let r=Bn(t,"@fragment "),n=e.returnType;return typeof t=="string"&&xu(t,n,i=>r.applyExternals(i)),{shell:e,outputType:n,$uses(i){return r.applyExternals(i),this},[l]:!0,[ae]:r,$name(i){return L(r,i),zi(n)&&n.$name(`${i}_Output`),this},[_](i){let s=e.in?Cn(e.in,i.varyingLocations).$name(`${v(this)??""}_Input`):void 0;return s&&r.applyExternals({In:s}),r.applyExternals({Out:n}),r.resolve(i,s?[s]:[],e.returnType)},toString(){return`fragmentFn:${v(r)??"<unnamed>"}`}}}var yh=new Set(["alias","break","case","const","const_assert","continue","continuing","default","diagnostic","discard","else","enable","false","fn","for","if","let","loop","override","requires","return","struct","switch","true","var","while","NULL","Self","abstract","active","alignas","alignof","as","asm","asm_fragment","async","attribute","auto","await","become","cast","catch","class","co_await","co_return","co_yield","coherent","column_major","common","compile","compile_fragment","concept","const_cast","consteval","constexpr","constinit","crate","debugger","decltype","delete","demote","demote_to_helper","do","dynamic_cast","enum","explicit","export","extends","extern","external","fallthrough","filter","final","finally","friend","from","fxgroup","get","goto","groupshared","highp","impl","implements","import","inline","instanceof","interface","layout","lowp","macro","macro_rules","match","mediump","meta","mod","module","move","mut","mutable","namespace","new","nil","noexcept","noinline","nointerpolation","non_coherent","noncoherent","noperspective","null","nullptr","of","operator","package","packoffset","partition","pass","patch","pixelfragment","precise","precision","premerge","priv","protected","pub","public","readonly","ref","regardless","register","reinterpret_cast","require","resource","restrict","self","set","shared","sizeof","smooth","snorm","static","static_assert","static_cast","std","subroutine","super","target","template","this","thread_local","throw","trait","try","type","typedef","typeid","typename","typeof","union","unless","unorm","unsafe","unsized","use","using","varying","virtual","volatile","wgsl","where","with","writeonly","yield","sampler"]);function zy(e){return e?e.replaceAll(/\s/g,"_").replaceAll(/[^\w\d]/g,""):"item"}function gh(e){if(e==="_"||e.startsWith("__")||/\s/.test(e))throw new Error(`Invalid identifier '${e}'. Choose an identifier without whitespaces or leading underscores.`);let t=e.split("_")[0];return!yh.has(t)}var wh=class{#e;#t;constructor(){this.#e=new Set(yh),this.#t=[]}get usedFunctionScopeNames(){return this.#t[this.#t.length-1]}makeUnique(t,r){let n=zy(t),i=this.getUniqueVariant(n);return r?this.#e.add(i):this.usedFunctionScopeNames?.add(i),i}makeValid(t){return gh(t)&&!this.#e.has(t)?(this.usedFunctionScopeNames?.add(t),t):this.makeUnique(t,!1)}isUsed(t){return this.#e.has(t)||!!this.usedFunctionScopeNames?.has(t)}pushFunctionScope(){this.#t.push(new Set)}popFunctionScope(){this.#t.pop()}},Iy=class extends wh{#e=0;getUniqueVariant(t){let r=`${t}_${this.#e++}`;for(;this.isUsed(r);)r=`${t}_${this.#e++}`;return r}},Sy=class extends wh{getUniqueVariant(t){let r=0,n=t;for(;this.isUsed(n);)r++,n=`${t}_${r}`;return n}};function Ey(e,t){let r=Bn(t,"");return{[l]:!0,[ae]:r,resourceType:"shellless-impl",argTypes:e,[_](n){return r.resolve(n,e,void 0)},toString(){return`fn*:${v(r)??"<unnamed>"}(${e.map(n=>n.toString()).join(", ")})`}}}function xs(e,t){return e.type!==t.type?!1:e.type==="ptr"&&t.type==="ptr"?e.access===t.access&&e.addressSpace===t.addressSpace&&e.implicit===t.implicit&&xs(e.inner,t.inner):e.type==="array"&&t.type==="array"?e.elementCount===t.elementCount&&xs(e.elementType,t.elementType):e.type==="struct"&&t.type==="struct"?e===t:!0}var My=class{cache=new Map;get(t,r){let n=Ii(t);if(!n?.ast)return;if(!r&&n.ast.params.length>0)throw new Error(`Cannot resolve '${v(t)}' directly, because it expects arguments. Either call it from another function, or wrap it in a shell`);let i=(r??[]).map((o,u)=>{if(o.value instanceof Et){if(o.dataType.type==="unknown")throw new j("d.ref() created with primitive types must be stored in a variable before use");return o.dataType}if(o.dataType.type==="unknown")throw new Error(`Passed illegal value ${o.value} as the #${u} argument to ${n.name}(...)`);let h=Rt(o.dataType);if(o.origin==="constant-tgpu-const-ref"||o.origin==="runtime-tgpu-const-ref"){let p=Ae();throw new Error(`Cannot pass constant references as function arguments. Explicitly copy them by wrapping them in a schema: '${p.resolve(h).value}(...)'`)}return Je(h)&&h.implicit&&(h=h.inner),h}),s=this.cache.get(t);if(s){let o=s.find(u=>u.argTypes.length===i.length&&u.argTypes.every((h,p)=>xs(h,i[p])));if(o)return o}else s=[],this.cache.set(t,s);let a=Ey(i,t);return s.push(a),a}},ky=class{[l];constructor(t){this[l]={nameRegistry:t,shelllessRepo:new My,memoizedResolves:new WeakMap,memoizedDerived:new WeakMap,listeners:{name:new Set}}}on(t,r){if(t==="name"){let n=this[l].listeners.name;return n.add(r),()=>n.delete(r)}throw new Error(`Unsupported event: ${t}`)}};function Uy(e,t){let r=e.nameRegistry.makeUnique(v(t),!0);for(let n of e.listeners.name)n({target:t,name:r});return r}function en(e){let{names:t="strict"}=e??{};return new ky(t==="strict"?new Sy:new Iy)}function Ri(e){return typeof e?.format=="string"}function Vy(e,t){let r=[];if(Xr(e)){if(!Ri(t))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return r.push(t._layout),{usedVertexLayouts:r,bufferDefinitions:[{arrayStride:t._layout.stride,stepMode:t._layout.stepMode,attributes:[{format:t.format,offset:t.offset,shaderLocation:Ht(e)??0}]}]}}let n=[],i=new WeakMap,s=0;for(let[a,o]of Object.entries(e)){if(Pt(o))continue;let u=t[a];if(!u)throw new Error(`An attribute by the name of '${a}' was not provided to the shader.`);let h=u._layout,p=i.get(h);p||(r.push(h),p=[],n.push({arrayStride:h.stride,stepMode:h.stepMode,attributes:p}),i.set(h,p)),s=Ht(o)??s,p.push({format:u.format,offset:u.offset,shaderLocation:s++})}return{usedVertexLayouts:r,bufferDefinitions:n}}var Py=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","vec2<bool>","vec3<bool>","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","texture_external"];function Ay(e){return Py.includes(e.type)}function vs(e,[t,r]){if(!gh(t))throw new Error(`Property key '${t}' is a reserved WGSL word. Choose a different name.`);return`  ${ra(r)}${t}: ${e.resolve(r).value},
`}function Oy(e,t){if(t[l].isAbstruct)throw new Error("Cannot resolve abstract struct types to WGSL.");let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>vs(e,n)).join("")}}`),r}function By(e,t){let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>Ri(n[1])?vs(e,[n[0],Vt[n[1].format]]):vs(e,n)).join("")}
}`),r}function Cy(e,t){let r=e.resolve(t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function Fy(e,t){let r=e.resolve(Ri(t.elementType)?Vt[t.elementType.format]:t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function xh(e,t){if(Yr(t))return t.type==="unstruct"?By(e,t):t.type==="disarray"?Fy(e,t):t.type==="loose-decorated"?e.resolve(Ri(t.inner)?Vt[t.inner.format]:t.inner).value:e.resolve(Vt[t.type]).value;if(Ay(t))return t.type;if(t.type==="struct")return Oy(e,t);if(t.type==="array")return Cy(e,t);if(t.type==="atomic")return`atomic<${xh(e,t.inner)}>`;if(t.type==="decorated")return e.resolve(t.inner).value;if(t.type==="ptr")return t.addressSpace==="storage"?`ptr<storage, ${e.resolve(t.inner).value}, ${t.access==="read-write"?"read_write":t.access}>`:`ptr<${t.addressSpace}, ${e.resolve(t.inner).value}>`;if(t.type==="abstractInt"||t.type==="abstractFloat"||t.type==="void"||t.type==="u16")throw new Error(`${t.type} has no representation in WGSL`);if(ds(t))return`${t.type}<${t.format}, ${jn[t.access]}>`;if(Fu(t))return t.type.startsWith("texture_depth")?t.type:`${t.type}<${t.sampleType.type}>`;if(Qp(t)||Zp(t))return t.type;Nr(t,"resolveData")}var vh=class $s{constructor(t){this.bindings=t}with(t,r){return new $s([...this.bindings,[Si(t)?t.slot:t,r]])}pipe(t){let r=t(this);return new $s([...this.bindings,...r.bindings])}};function*jy(e){let t=0;for(;;)e.has(t)||(yield t),t++}function Gy(e,t){let r="size"in e?e.size:e.currentByteOffset,n=t-1,i=r&n;"skipBytes"in e?e.skipBytes(t-i&n):e.add(t-i&n)}var ce=Gy,Ya=new WeakMap;function $h(e){let t=Ya.get(e);if(t)return t;let r=new ee,n={},i;for(let s in e.propTypes){let a=e.propTypes[s];if(a===void 0)throw new Error(`Property ${s} is undefined in struct`);let o=r.size;ce(r,et(e)?De(a):K(a)),i&&(i.padding=r.size-o);let u=P(a);n[s]={offset:r.size,size:u},i=n[s],r.add(u)}return i&&(i.padding=Pe(P(e),K(e))-r.size),Ya.set(e,n),n}var Ly=(()=>{try{return new Function("return true"),!0}catch{return!1}})(),Ji=new WeakMap,Qn={u32:"u32",vec2u:"u32",vec3u:"u32",vec4u:"u32",u16:"u16",i32:"i32",vec2i:"i32",vec3i:"i32",vec4i:"i32",f32:"f32",vec2f:"f32",vec3f:"f32",vec4f:"f32",f16:"f16",vec2h:"f16",vec3h:"f16",vec4h:"f16",mat2x2f:"f32",mat3x3f:"f32",mat4x4f:"f32"},Ry={uint8:"u8",uint8x2:"u8",uint8x4:"u8",sint8:"i8",sint8x2:"i8",sint8x4:"i8",unorm8:"u8",unorm8x2:"u8",unorm8x4:"u8",snorm8:"i8",snorm8x2:"i8",snorm8x4:"i8",uint16:"u16",uint16x2:"u16",uint16x4:"u16",sint16:"i16",sint16x2:"i16",sint16x4:"i16",unorm16:"u16",unorm16x2:"u16",unorm16x4:"u16",snorm16:"i16",snorm16x2:"i16",snorm16x4:"i16",float16:"f16",float16x2:"f16",float16x4:"f16",float32:"f32",float32x2:"f32",float32x3:"f32",float32x4:"f32",uint32:"u32",uint32x2:"u32",uint32x3:"u32",uint32x4:"u32",sint32:"i32",sint32x2:"i32",sint32x3:"i32",sint32x4:"i32"},Jn={u32:"setUint32",i32:"setInt32",f32:"setFloat32",u16:"setUint16",i16:"setInt16",f16:"setFloat16",u8:"setUint8",i8:"setInt8"},Dy={unorm8:e=>`Math.round(${e} * 255)`,unorm8x2:e=>`Math.round(${e} * 255)`,unorm8x4:e=>`Math.round(${e} * 255)`,snorm8:e=>`Math.round(${e} * 127)`,snorm8x2:e=>`Math.round(${e} * 127)`,snorm8x4:e=>`Math.round(${e} * 127)`,unorm16:e=>`Math.round(${e} * 65535)`,unorm16x2:e=>`Math.round(${e} * 65535)`,unorm16x4:e=>`Math.round(${e} * 65535)`,snorm16:e=>`Math.round(${e} * 32767)`,snorm16x2:e=>`Math.round(${e} * 32767)`,snorm16x4:e=>`Math.round(${e} * 32767)`},Xa={"unorm10-10-10-2":{writeFunction:"setUint32",generator:(e,t)=>`output.setUint32(${e}, ((${t}.x*1023&0x3FF)<<22)|((${t}.y*1023&0x3FF)<<12)|((${t}.z*1023&0x3FF)<<2)|(${t}.w*3&3), littleEndian);
`},"unorm8x4-bgra":{writeFunction:"setUint8",generator:(e,t)=>{let r=["z","y","x","w"],n="";for(let i=0;i<4;i++)n+=`output.setUint8((${e} + ${i}), Math.round(${t}.${r[i]} * 255), littleEndian);
`;return n}}};function ri(e,t,r,n=0){let i=["i","j","k"][n]||`i${n}`;if(li(e)||Ke(e))return ri(e.inner,t,r,n);if(me(e)||et(e)){let a=$h(e),o="";for(let[u,h]of Object.entries(a)){let p=e.propTypes[u];p&&(o+=ri(p,`(${t} + ${h.offset})`,`${r}.${u}`,n))}return o}if(ze(e)||Ut(e)){let a=Pe(P(e.elementType),K(e)),o="";return o+=`for (let ${i} = 0; ${i} < ${e.elementCount}; ${i}++) {
`,o+=ri(e.elementType,`(${t} + ${i} * ${a})`,`${r}[${i}]`,n+1),o+=`}
`,o}if(ft(e)){let a=Qn[e.type],o="",u=Jn[a],h=["x","y","z","w"],p=rs(e)?2:ns(e)?3:4;for(let f=0;f<p;f++)o+=`output.${u}((${t} + ${f*4}), ${r}.${h[f]}, littleEndian);
`;return o}if(hi(e)){let a=Qn[e.type],o=Jn[a],u=Eo(e)?2:Mo(e)?3:4,h=u*u,p=Pe(u*4,8),f="";for(let m=0;m<h;m++){let x=Math.floor(m/u),$=m%u,z=x*p+$*4;f+=`output.${o}((${t} + ${z}), ${r}.columns[${x}].${["x","y","z","w"][$]}, littleEndian);
`}return f}if(mu(e)){let a=e.type;if(a in Xa)return Xa[a].generator(t,r);let o=Ry[a],u=Jn[o],h=Vt[a],p=So(h)?4:ns(h)?3:rs(h)?2:1,f=o==="u8"||o==="i8"?1:o==="u16"||o==="i16"||o==="f16"?2:4,m=["x","y","z","w"],x=Dy[a],$="";for(let z=0;z<p;z++){let B=p===1?r:`${r}.${m[z]}`,A=x?x(B):B;$+=`output.${u}((${t} + ${z*f}), ${A}, littleEndian);
`}return $}if(!Object.hasOwn(Qn,e.type))throw new Error(`Primitive ${e.type} is unsupported by compiled writer`);let s=Qn[e.type];return`output.${Jn[s]}(${t}, ${r}, littleEndian);
`}function Za(e){if(!Ly){console.warn("This environment does not allow eval - using default writer as fallback");return}if(Ji.has(e))return Ji.get(e);try{let t=ri(e,"offset","value",0),r=new Function("output","offset","value","littleEndian=true",t);return Ji.set(e,r),r}catch(t){console.warn(`Failed to compile writer for schema: ${e}
Reason: ${t instanceof Error?t.message:String(t)}
Falling back to default writer`)}}var Pr={bool(){throw new Error("Booleans are not host-shareable")},f32(e,t,r){e.writeFloat32(r)},f16(e,t,r){e.writeFloat16(r)},i32(e,t,r){e.writeInt32(r)},u32(e,t,r){e.writeUint32(r)},u16(e,t,r){e.writeUint16(r)},vec2f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},vec2h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},vec2i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},vec2u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},vec3f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},vec3h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z)},vec3i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},vec3u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},vec4f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},vec4h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},vec4i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},vec4u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat3x3f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat4x4f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},struct(e,t,r){let n=K(t);ce(e,n);for(let[i,s]of Object.entries(t.propTypes))ce(e,K(s)),gi(e,s,r[i]);ce(e,n)},array(e,t,r){if(t.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let n=K(t);ce(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)ce(e,n),gi(e,t.elementType,r[s]);e.seekTo(i+P(t))},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t,r){Pr[t.inner.type]?.(e,t,r)},decorated(e,t,r){let n=De(t);ce(e,n);let i=e.currentByteOffset;Pr[t.inner?.type]?.(e,t.inner,r),e.seekTo(i+P(t))},uint8(e,t,r){e.writeUint8(r)},uint8x2(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y)},uint8x4(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y),e.writeUint8(r.z),e.writeUint8(r.w)},sint8(e,t,r){e.writeInt8(r)},sint8x2(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y)},sint8x4(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y),e.writeInt8(r.z),e.writeInt8(r.w)},unorm8(e,t,r){e.writeUint8(Math.round(r*255))},unorm8x2(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255))},unorm8x4(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255)),e.writeUint8(Math.round(r.z*255)),e.writeUint8(Math.round(r.w*255))},snorm8(e,t,r){e.writeInt8(Math.round(r*127))},snorm8x2(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127))},snorm8x4(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127)),e.writeInt8(Math.round(r.z*127)),e.writeInt8(Math.round(r.w*127))},uint16(e,t,r){e.writeUint16(r)},uint16x2(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y)},uint16x4(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y),e.writeUint16(r.z),e.writeUint16(r.w)},sint16(e,t,r){e.writeInt16(r)},sint16x2(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y)},sint16x4(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y),e.writeInt16(r.z),e.writeInt16(r.w)},unorm16(e,t,r){e.writeUint16(r*65535)},unorm16x2(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535)},unorm16x4(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535),e.writeUint16(r.z*65535),e.writeUint16(r.w*65535)},snorm16(e,t,r){e.writeInt16(Math.round(r*32767))},snorm16x2(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767))},snorm16x4(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767)),e.writeInt16(Math.round(r.z*32767)),e.writeInt16(Math.round(r.w*32767))},float16(e,t,r){e.writeFloat16(r)},float16x2(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},float16x4(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},float32(e,t,r){e.writeFloat32(r)},float32x2(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},float32x3(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},float32x4(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},uint32(e,t,r){e.writeUint32(r)},uint32x2(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},uint32x3(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},uint32x4(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},sint32(e,t,r){e.writeInt32(r)},sint32x2(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},sint32x3(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},sint32x4(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},"unorm10-10-10-2"(e,t,r){let n=0;n|=(r.x*1023&1023)<<22,n|=(r.y*1023&1023)<<12,n|=(r.z*1023&1023)<<2,n|=r.w*3&3,e.writeUint32(n)},"unorm8x4-bgra"(e,t,r){e.writeUint8(r.z*255),e.writeUint8(r.y*255),e.writeUint8(r.x*255),e.writeUint8(r.w*255)},disarray(e,t,r){let n=K(t);ce(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)ce(e,n),Pr[t.elementType?.type]?.(e,t.elementType,r[s]);e.seekTo(i+P(t))},unstruct(e,t,r){let n=t.propTypes;for(let[i,s]of Object.entries(n))Pr[s.type]?.(e,s,r[i])},"loose-decorated"(e,t,r){let n=De(t);ce(e,n);let i=e.currentByteOffset,s=Pr[t.inner?.type];return s?.(e,t.inner,r),e.seekTo(i+P(t)),r}};function gi(e,t,r){let n=Pr[t.type];if(!n)throw new Error(`Cannot write data of type '${t.type}'.`);n(e,t,r)}var Ny={bool(){throw new Error("Booleans are not host-shareable")},f32(e){return e.readFloat32()},f16(e){return e.readFloat16()},i32(e){return e.readInt32()},u32(e){return e.readUint32()},u16(e){return e.readUint16()},vec2f(e){return D(e.readFloat32(),e.readFloat32())},vec3f(e){return ue(e.readFloat32(),e.readFloat32(),e.readFloat32())},vec4f(e){return I(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},vec2h(e){return yt(e.readFloat16(),e.readFloat16())},vec3h(e){return gt(e.readFloat16(),e.readFloat16(),e.readFloat16())},vec4h(e){return wt(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16())},vec2i(e){return q(e.readInt32(),e.readInt32())},vec3i(e){return Oe(e.readInt32(),e.readInt32(),e.readInt32())},vec4i(e){return pe(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32())},vec2u(e){return Me(e.readUint32(),e.readUint32())},vec3u(e){return ie(e.readUint32(),e.readUint32(),e.readUint32())},vec4u(e){return ve(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32())},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e){return Ot(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},mat3x3f(e){let t=()=>{let r=e.readFloat32();return e.readFloat32(),r};return Bt(e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t())},mat4x4f(e){return Y(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},struct(e,t){let r=K(t);ce(e,r);let n={},i=t.propTypes;for(let[s,a]of Object.entries(i))ce(e,K(a)),n[s]=ct(e,a);return ce(e,r),n},array(e,t){if(t.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let r=K(t),n=[];for(let i=0;i<t.elementCount;i++){ce(e,r);let s=t.elementType,a=ct(e,s);n.push(a)}return ce(e,r),n},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t){return ct(e,t.inner)},decorated(e,t){let r=De(t);ce(e,r);let n=e.currentByteOffset,i=ct(e,t.inner);return e.seekTo(n+P(t)),i},uint8:e=>e.readUint8(),uint8x2:e=>Me(e.readUint8(),e.readUint8()),uint8x4:e=>ve(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),sint8:e=>e.readInt8(),sint8x2:e=>q(e.readInt8(),e.readInt8()),sint8x4:e=>pe(e.readInt8(),e.readInt8(),e.readInt8(),e.readInt8()),unorm8:e=>e.readUint8()/255,unorm8x2:e=>D(e.readUint8()/255,e.readUint8()/255),unorm8x4:e=>I(e.readUint8()/255,e.readUint8()/255,e.readUint8()/255,e.readUint8()/255),snorm8:e=>e.readInt8()/127,snorm8x2:e=>D(e.readInt8()/127,e.readInt8()/127),snorm8x4:e=>I(e.readInt8()/127,e.readInt8()/127,e.readInt8()/127,e.readInt8()/127),uint16:e=>e.readUint16(),uint16x2:e=>Me(e.readUint16(),e.readUint16()),uint16x4:e=>ve(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16()),sint16:e=>e.readInt16(),sint16x2:e=>q(e.readInt16(),e.readInt16()),sint16x4:e=>pe(e.readInt16(),e.readInt16(),e.readInt16(),e.readInt16()),unorm16:e=>e.readUint16()/65535,unorm16x2:e=>D(e.readUint16()/65535,e.readUint16()/65535),unorm16x4:e=>I(e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535),snorm16:e=>e.readInt16()/32767,snorm16x2:e=>D(e.readInt16()/32767,e.readInt16()/32767),snorm16x4:e=>I(e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767),float16(e){return e.readFloat16()},float16x2:e=>D(e.readFloat16(),e.readFloat16()),float16x4:e=>I(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16()),float32:e=>e.readFloat32(),float32x2:e=>D(e.readFloat32(),e.readFloat32()),float32x3:e=>ue(e.readFloat32(),e.readFloat32(),e.readFloat32()),float32x4:e=>I(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()),uint32:e=>e.readUint32(),uint32x2:e=>Me(e.readUint32(),e.readUint32()),uint32x3:e=>ie(e.readUint32(),e.readUint32(),e.readUint32()),uint32x4:e=>ve(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32()),sint32:e=>e.readInt32(),sint32x2:e=>q(e.readInt32(),e.readInt32()),sint32x3:e=>Oe(e.readInt32(),e.readInt32(),e.readInt32()),sint32x4:e=>pe(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32()),"unorm10-10-10-2"(e){let t=e.readUint32(),r=(t>>22)/1023,n=(t>>12&1023)/1023,i=(t>>2&1023)/1023,s=(t&3)/3;return I(r,n,i,s)},"unorm8x4-bgra"(e){let t=e.readByte()/255,r=e.readByte()/255,n=e.readByte()/255,i=e.readByte()/255;return I(n,r,t,i)},unstruct(e,t){let r={},n=t.propTypes;for(let[i,s]of Object.entries(n))r[i]=ct(e,s);return r},disarray(e,t){let r=K(t),n=[];for(let i=0;i<t.elementCount;i++)ce(e,r),n.push(ct(e,t.elementType));return ce(e,r),n},"loose-decorated"(e,t){ce(e,De(t));let r=e.currentByteOffset,n=ct(e,t.inner);return e.seekTo(r+P(t)),n}};function ct(e,t){let r=Ny[t.type];if(!r)throw new Error(`Cannot read data of type '${t.type}'.`);return r(e,t)}function Wy(e,t){let r=P(e);if(r===0||t===void 0||t===null)return[];let n=new ArrayBuffer(r),i=new mr(n),s=[];function a(h,p,f,m){if(p!=null){if(me(h)||et(h)){let x=$h(h);for(let[$,z]of Object.entries(x)){let B=h.propTypes[$];if(!B)continue;let A=p[$];A!==void 0&&a(B,A,f+z.offset,z.padding??m)}return}if(ze(h)||Ut(h)){let x=h,$=Pe(P(x.elementType),K(x.elementType));if(!Array.isArray(p))throw new Error("Partial value for array must be an array");let z=p??[];z.sort((B,A)=>B.idx-A.idx);for(let{idx:B,value:A}of z)a(x.elementType,A,f+B*$,$-P(x.elementType))}else{let x=P(h);i.seekTo(f),gi(i,h,p),s.push({start:f,end:f+x,padding:m})}}}if(a(e,t,0),s.length===0)return[];let o=[],u=s[0];for(let h=1;h<s.length;h++){let p=s[h];if(!p||!u)throw new Error("Internal error: missing segment");p.start===u.end+(u.padding??0)?(u.end=p.end,u.padding=p.padding):(o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),u=p)}if(!u)throw new Error("Internal error: missing segment");return o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),o}function wi(e){return!!e?.usableAsStorage}var Qa=class bh extends Error{constructor(t){super(`Resource '${v(t)??"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,bh.prototype)}};function Th(e){return!!e.usableAsUniform}var _h={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},ya=class{constructor(e,t){this.usage=e,this.buffer=t,this[l]={dataType:t.dataType},this[ae]=t}resourceType="buffer-usage";[l];[ae];$name(e){return this.buffer.$name(e),this}[_](e){let t=this.buffer.dataType,r=e.getUniqueName(this),{group:n,binding:i}=e.allocateFixedEntry(this.usage==="uniform"?{uniform:t}:{storage:t,access:this.usage},this.buffer),s=_h[this.usage];return e.addDeclaration(`@group(${n}) @binding(${i}) var<${s}> ${r}: ${e.resolve(t).value};`),y(r,t,Te(t)?"runtime":this.usage)}toString(){return`${this.usage}:${v(this)??"<unnamed>"}`}get[F](){let e=this.buffer.dataType,t=this.usage;return new Proxy({[l]:!0,get[ke](){return y(this,e,Te(e)?"runtime":t)},[_]:r=>r.resolve(this),toString:()=>`${this.usage}:${v(this)??"<unnamed>"}.$`},We)}get $(){let e=pi(),t=ci();if(e.type==="normal")throw new Va(t?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.read()`");return e.type==="codegen"?this[F]:e.type==="simulate"?(e.buffers.has(this.buffer)||e.buffers.set(this.buffer,Xt(this.buffer.dataType,this.buffer.initial)),e.buffers.get(this.buffer)):Nr(e,"bufferUsage.ts#TgpuFixedBufferImpl/$")}get value(){return this.$}set $(e){let t=pi(),r=ci();if(t.type==="normal")throw new Va(r?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.write()`");if(t.type==="codegen")throw new Error("Unreachable bufferUsage.ts#TgpuFixedBufferImpl/$");if(t.type==="simulate"){t.buffers.set(this.buffer,e);return}Nr(t,"bufferUsage.ts#TgpuFixedBufferImpl/$")}set value(e){this.$=e}},Ja=class{constructor(e,t,r){this.usage=e,this.dataType=t,this[l]={dataType:t},this.#e=r,L(this,r.key)}[l];resourceType="buffer-usage";#e;[_](e){let t=this.dataType,r=e.getUniqueName(this),n=e.allocateLayoutEntry(this.#e.layout),i=_h[this.usage];return e.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var<${i}> ${r}: ${e.resolve(t).value};`),y(r,t,Te(t)?"runtime":this.usage)}toString(){return`${this.usage}:${v(this)??"<unnamed>"}`}get[F](){let e=this.dataType,t=this.usage;return new Proxy({[l]:!0,get[ke](){return y(this,e,Te(e)?"runtime":t)},[_]:r=>r.resolve(this),toString:()=>`${this.usage}:${v(this)??"<unnamed>"}.$`},We)}get $(){if(nt())return this[F];throw new Error("Direct access to buffer values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},Ka=new WeakMap;function qy(e){if(!wi(e))throw new Error(`Cannot pass ${e} to asMutable, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=Ka.get(e);return t||(t=new ya("mutable",e),Ka.set(e,t)),t}var eo=new WeakMap;function Hy(e){if(!wi(e))throw new Error(`Cannot pass ${e} to asReadonly, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=eo.get(e);return t||(t=new ya("readonly",e),eo.set(e,t)),t}var to=new WeakMap;function Yy(e){if(!Th(e))throw new Error(`Cannot pass ${e} to asUniform, as it is not allowed to be used as a uniform. To allow it, call .$usage('uniform') when creating the buffer.`);let t=to.get(e);return t||(t=new ya("uniform",e),to.set(e,t)),t}var Xy={uniform:Yy,mutable:qy,readonly:Hy};function Kn(e,t,r){return Qt(t)?new ro(e,t,r):new ro(e,t,r,["storage","uniform"])}function $n(e){return e.resourceType==="buffer"}var Zy=Xu(),ro=class{constructor(t,r,n,i){this.dataType=r,this.initialOrBuffer=n,this._disallowedUsages=i,this.#e=t.device,ls(n)?(this._ownBuffer=!1,this._buffer=n):(this._ownBuffer=!0,this.initial=n)}[l]=!0;resourceType="buffer";flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;#e;_buffer=null;_ownBuffer;_destroyed=!1;_hostBuffer;initial;usableAsUniform=!1;usableAsStorage=!1;usableAsVertex=!1;usableAsIndex=!1;get buffer(){if(this._destroyed)throw new Error("This buffer has been destroyed");return this._buffer||(this._buffer=this.#e.createBuffer({size:P(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:v(this)??"<unnamed>"}),this.initial&&(this._writeToTarget(this._buffer.getMappedRange(),this.initial),this._buffer.unmap())),this._buffer}get destroyed(){return this._destroyed}$name(t){return L(this,t),this._buffer&&(this._buffer.label=t),this}$usage(...t){for(let r of t){if(this._disallowedUsages?.includes(r))throw new Error(`Buffer of type ${this.dataType.type} cannot be used as ${r}`);this.flags|=r==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=r==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=r==="vertex"?GPUBufferUsage.VERTEX:0,this.flags|=r==="index"?GPUBufferUsage.INDEX:0,this.usableAsUniform=this.usableAsUniform||r==="uniform",this.usableAsStorage=this.usableAsStorage||r==="storage",this.usableAsVertex=this.usableAsVertex||r==="vertex",this.usableAsIndex=this.usableAsIndex||r==="index"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}compileWriter(){Za(this.dataType)}_writeToTarget(t,r){let n=Za(this.dataType);if(n)try{n(new DataView(t),0,r,Zy==="little");return}catch(i){console.error(`Error when using compiled writer for buffer ${v(this)??"<unnamed>"} - this is likely a bug, please submit an issue at https://github.com/software-mansion/TypeGPU/issues
Using fallback writer instead.`,i)}gi(new mr(t),this.dataType,r)}write(t){let r=this.buffer;if(r.mapState==="mapped"){let i=r.getMappedRange();this._writeToTarget(i,t);return}let n=P(this.dataType);this._hostBuffer||(this._hostBuffer=new ArrayBuffer(n)),this._writeToTarget(this._hostBuffer,t),this.#e.queue.writeBuffer(r,0,this._hostBuffer,0,n)}writePartial(t){let r=this.buffer,n=Wy(this.dataType,t);if(r.mapState==="mapped"){let i=r.getMappedRange(),s=new Uint8Array(i);for(let a of n)s.set(a.data,a.data.byteOffset)}else for(let i of n)this.#e.queue.writeBuffer(r,i.data.byteOffset,i.data,0,i.data.byteLength)}clear(){let t=this.buffer;if(t.mapState==="mapped"){new Uint8Array(t.getMappedRange()).fill(0);return}let r=this.#e.createCommandEncoder();r.clearBuffer(t),this.#e.queue.submit([r.finish()])}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let r=P(this.dataType),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t.buffer,0,this.buffer,0,r),this.#e.queue.submit([n.finish()])}async read(){let t=this.buffer;if(t.mapState==="mapped"){let s=t.getMappedRange();return ct(new Wt(s),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let s=t.getMappedRange(),a=ct(new Wt(s),this.dataType);return t.unmap(),a}let r=this.#e.createBuffer({size:P(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t,0,r,0,P(this.dataType)),this.#e.queue.submit([n.finish()]),await r.mapAsync(GPUMapMode.READ,0,P(this.dataType));let i=ct(new Wt(r.getMappedRange()),this.dataType);return r.unmap(),r.destroy(),i}as(t){return Xy[t]?.(this)}destroy(){this._destroyed||(this._destroyed=!0,this._ownBuffer&&this._buffer?.destroy())}toString(){return`buffer:${v(this)??"<unnamed>"}`}};function Qy(e,t){return new Sh(ha(),e,t)}function Jy(e,t){return new Sh(la(),e,t)}function zh(e){let t=e;return t?.resourceType==="sampler"&&!!t[l]}function Ih(e){let t=e;return t?.resourceType==="sampler-comparison"&&!!t[l]}var Ky=class{constructor(t,r){this.schema=t,this.#e=r,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",L(this,r.key)}[l]={unwrap:void 0};resourceType;#e;[_](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[_]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},We)}get $(){if(nt())return this[F];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}toString(){return`${this.resourceType}:${v(this)??"<unnamed>"}`}},Sh=class{constructor(t,r,n){this.schema=t,this.#r=r,this.#n=n,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",this[l]={unwrap:()=>(this.#t||(this.#t=this.#n.device.createSampler({...this.#r,label:v(this)??"<unnamed>"})),this.#t)},this.#e=r.minFilter==="linear"||r.magFilter==="linear"||r.mipmapFilter==="linear"}[l];resourceType;#e;#t=null;#r;#n;[_](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(this.schema.type==="sampler_comparison"?{sampler:"comparison"}:{sampler:this.#e?"filtering":"non-filtering"},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[_]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},We)}get $(){if(nt())return this[F];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}$name(t){return L(this,t),this}toString(){return`${this.resourceType}:${v(this)??"<unnamed>"}`}},eg=class{constructor(t,r){this.schema=t,this.#e=r,L(this,r.key)}resourceType="external-texture";[l]=!0;#e;[_](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),y(r,Cu(),"handle")}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[_]:r=>r.resolve(this),toString:()=>`textureExternal:${v(this)??"<unnamed>"}.$`},We)}get $(){if(nt())return this[F];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureExternal:${v(this)??"<unnamed>"}`}};function Eh(e){let{videoWidth:t,videoHeight:r}=e;if(t&&r)return{width:t,height:r};let{naturalWidth:n,naturalHeight:i}=e;if(n&&i)return{width:n,height:i};let{codedWidth:s,codedHeight:a}=e;if(s&&a)return{width:s,height:a};let{width:o,height:u}=e;if(o&&u)return{width:o,height:u};throw new Error("Cannot determine dimensions of the provided image source.")}var tg=`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) i: u32) -> VertexOutput {
  const pos = array(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  const uv = array(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));
  return VertexOutput(vec4f(pos[i], 0, 1), uv[i]);
}`,rg=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  return textureSample(src, samp, uv);
}`,ng=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  let r = textureGather(0, src, samp, uv);
  let g = textureGather(1, src, samp, uv);
  let b = textureGather(2, src, samp, uv);
  let a = textureGather(3, src, samp, uv);
  return vec4f(dot(r, vec4f(0.25)), dot(g, vec4f(0.25)), dot(b, vec4f(0.25)), dot(a, vec4f(0.25)));
}`,bs=new WeakMap;function ig(e){let t=bs.get(e);return t||(t={vertexModule:e.createShaderModule({code:tg}),filterableResources:new Map,layoutResources:new Map},bs.set(e,t)),t}function sg(e,t,r){let n=ig(e),i=n.filterableResources.get(t);i||(i={fragmentModule:e.createShaderModule({code:t?rg:ng}),sampler:e.createSampler(t?{magFilter:"linear",minFilter:"linear"}:{})},n.filterableResources.set(t,i));let s=`${t}:${r}`,a=n.layoutResources.get(s);if(!a){let o=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:r}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:t?"filtering":"non-filtering"}}]});a={bindGroupLayout:o,pipelineLayout:e.createPipelineLayout({bindGroupLayouts:[o]})},n.layoutResources.set(s,a)}return{vertexModule:n.vertexModule,...i,...a}}function Mh(e){let{device:t,source:r,destination:n,format:i,filterable:s,sampleType:a}=e,o=sg(t,s,a),u=t.createRenderPipeline({layout:o.pipelineLayout,vertex:{module:o.vertexModule},fragment:{module:o.fragmentModule,targets:[{format:i}]},primitive:{topology:"triangle-list"}}),h=t.createBindGroup({layout:o.bindGroupLayout,entries:[{binding:0,resource:r},{binding:1,resource:o.sampler}]}),p=!e.encoder,f=e.encoder??t.createCommandEncoder(),m=f.beginRenderPass({colorAttachments:[{view:n,loadOp:"clear",storeOp:"store"}]});m.setPipeline(u),m.setBindGroup(0,h),m.draw(3),m.end(),p&&t.queue.submit([f.finish()])}function ag(e){bs.delete(e)}function kh(e,t,r){let n=Ln(t),i=cy(e,t),s=i.includes("float"),a=i.includes("unfilterable-float");if(!s&&!a)throw new Error(`Cannot ${r} for format '${t}': only float formats are supported.`);if(!n.canRenderAttachment)throw new Error(`Cannot ${r} for format '${t}': format does not support render attachments.`);return{filterable:s,sampleType:s?"float":"unfilterable-float"}}function og(e,t,r=0,n){if(t.dimension!=="2d")throw new Error("Mipmap generation only supports 2D textures.");let{filterable:i,sampleType:s}=kh(e,t.format,"generate mipmaps"),a=n??t.mipLevelCount-r;for(let o=0;o<t.depthOrArrayLayers;o++)for(let u=r;u<r+a-1;u++){let h=p=>({dimension:"2d",baseMipLevel:p,mipLevelCount:1,baseArrayLayer:o,arrayLayerCount:1});Mh({device:e,source:t.createView(h(u)),destination:t.createView(h(u+1)),format:t.format,filterable:i,sampleType:s})}}function ug(e,t,r,n=0){if(t.dimension!=="2d")throw new Error("Resampling only supports 2D textures.");let{filterable:i}=kh(e,t.format,"resample"),{width:s,height:a}=Eh(r),o=e.createTexture({size:[s,a],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.copyExternalImageToTexture({source:r},{texture:o},[s,a]);let u=e.createTexture({size:[t.width,t.height],format:t.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),h=e.createCommandEncoder();Mh({device:e,source:o.createView(),destination:u.createView(),format:t.format,filterable:i,sampleType:"float",encoder:h}),h.copyTextureToTexture({texture:u},{texture:t,origin:{x:0,y:0,z:n}},{width:t.width,height:t.height,depthOrArrayLayers:1}),e.queue.submit([h.finish()]),o.destroy(),u.destroy()}function hg(e){return{dimension:e.dimension??"2d",sampleType:Ln(e.format).channelType,multisampled:(e.sampleCount??1)!==1}}function lg(e,t){return new cg(e,t)}function _n(e){return e?.resourceType==="texture"&&!!e[l]}function zn(e){return e?.resourceType==="texture-view"&&!!e[l]}var cg=class{constructor(t,r){this.props=t;let n=t.format;this.#s=r,this.#e=Ln(n);let i=this.#e.texelSize;this.#t=i==="non-copyable"?"non-copyable":t.size[0]*(t.size[1]??1)*(t.size[2]??1)*i,this[l]={unwrap:()=>{if(this.#r)throw new Error("This texture has been destroyed");return this.#i||(this.#i=r.device.createTexture({label:v(this)??"<unnamed>",format:t.format,size:t.size,usage:this.#n,dimension:t.dimension??"2d",viewFormats:t.viewFormats??[],mipLevelCount:t.mipLevelCount??1,sampleCount:t.sampleCount??1})),this.#i}}}[l];resourceType="texture";usableAsSampled=!1;usableAsStorage=!1;usableAsRender=!1;#e;#t;#r=!1;#n=GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;#i=null;#s;$name(t){return L(this,t),this}$usage(...t){let r=t.includes("storage"),n=t.includes("sampled"),i=t.includes("render");return this.#n|=n?GPUTextureUsage.TEXTURE_BINDING:0,this.#n|=r?GPUTextureUsage.STORAGE_BINDING:0,this.#n|=i?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||=r,this.usableAsSampled||=n,this.usableAsRender||=i,this}createView(t,r){return t==="render"?new dg(this,r):new pg(t??ps(hg(this.props)),this,r)}#a(t=0){let r=2**t,[n,i,s]=[Math.max(1,Math.floor((this.props.size[0]??1)/r)),Math.max(1,Math.floor((this.props.size[1]??1)/r)),Math.max(1,Math.floor((this.props.size[2]??1)/r))],a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot clear texture with format '${this.props.format}': this format does not support copy operations.`);this.#s.device.queue.writeTexture({texture:this[l].unwrap(),mipLevel:t},new Uint8Array(n*i*s*a),{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}clear(t="all"){if(t==="all"){let r=this.props.mipLevelCount??1;for(let n=0;n<r;n++)this.#a(n)}else this.#a(t)}generateMipmaps(t=0,r){if(this.usableAsRender===!1)throw new Error("generateMipmaps called without specifying 'render' usage. Add it via the $usage('render') method.");let n=r??(this.props.mipLevelCount??1)-t;if(n<=1){console.warn(`generateMipmaps is a no-op: would generate ${n} mip levels (base: ${t}, total: ${this.props.mipLevelCount??1})`);return}if(t>=(this.props.mipLevelCount??1))throw new Error(`Base mip level ${t} is out of range. Texture has ${this.props.mipLevelCount??1} mip levels.`);og(this.#s.device,this[l].unwrap(),t,n)}write(t,r=0){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){this.#u(t,r);return}let n=this.props.dimension??"2d";if(!Array.isArray(t)){this.#o(t,n==="3d"?0:void 0);return}let i=this.props.size[2]??1;t.length>i&&console.warn(`Too many image sources provided. Expected ${i} layers, got ${t.length}. Extra sources will be ignored.`);for(let s=0;s<Math.min(t.length,i);s++){let a=t[s];a&&this.#o(a,s)}}#u(t,r){let n=Math.max(1,this.props.size[0]>>r),i=Math.max(1,(this.props.size[1]??1)>>r),s=Math.max(1,(this.props.size[2]??1)>>r),a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot write to texture with format '${this.props.format}': this format does not support copy operations.`);let o=n*i*s*a,u=t.byteLength??t.byteLength;if(u!==o)throw new Error(`Buffer size mismatch. Expected ${o} bytes for mip level ${r}, got ${u} bytes.`);this.#s.device.queue.writeTexture({texture:this[l].unwrap(),mipLevel:r},"buffer"in t?t.buffer:t,{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}#o(t,r){let n=this.props.size[0],i=this.props.size[1]??1,{width:s,height:a}=Eh(t);if(s!==n||a!==i){ug(this.#s.device,this[l].unwrap(),t,r);return}this.#s.device.queue.copyExternalImageToTexture({source:t},{texture:this[l].unwrap(),...r!==void 0&&{origin:{x:0,y:0,z:r}}},r!==void 0?[n,i,1]:this.props.size)}copyFrom(t){if(t.props.format!==this.props.format)throw new Error(`Texture format mismatch. Source texture has format ${t.props.format}, target texture has format ${this.props.format}`);if(t.props.size[0]!==this.props.size[0]||(t.props.size[1]??1)!==(this.props.size[1]??1)||(t.props.size[2]??1)!==(this.props.size[2]??1))throw new Error(`Texture size mismatch. Source texture has size ${t.props.size.join("x")}, target texture has size ${this.props.size.join("x")}`);let r=this.#s.device.createCommandEncoder();r.copyTextureToTexture({texture:t[l].unwrap()},{texture:this[l].unwrap()},t.props.size),this.#s.device.queue.submit([r.finish()])}get destroyed(){return this.#r}destroy(){this.#r||(this.#r=!0,this.#i?.destroy())}},pg=class{constructor(t,r,n){this.schema=t,this.#e=r,this.#r=n,this[l]={unwrap:()=>{if(!this.#t){let i=this.schema,s=ds(i)?i.format:this.#e.props.format;this.#t=this.#e[l].unwrap().createView({...this.#r,label:v(this)??"<unnamed>",format:this.#r?.format??s,dimension:i.dimension})}return this.#t}}}[l];resourceType="texture-view";#e;#t;#r;$name(t){return L(this,t),this.#t&&(this.#t.label=t),this}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[_]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},We)}get $(){if(nt())return this[F];throw new Error("Direct access to texture view values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureView:${v(this)??"<unnamed>"}`}[_](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(ds(this.schema)?{storageTexture:this.schema}:{texture:this.schema,sampleType:this.#r?.sampleType??this.schema.bindingSampleType[0]},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}},no=class{constructor(e,t){this.schema=e,this.#e=t,L(this,t.key)}[l]={unwrap:void 0};resourceType="texture-view";#e;toString(){return`textureView:${v(this)??"<unnamed>"}`}[_](e){let t=e.getUniqueName(this),r=e.allocateLayoutEntry(this.#e.layout);return e.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var ${t}: ${e.resolve(this.schema).value};`),y(t,this.schema,"handle")}get[F](){let e=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,e,"handle")},[_]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},We)}get $(){if(nt())return this[F];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},dg=class{constructor(e,t={}){this.descriptor=t,this[l]={unwrap:()=>e[l].unwrap().createView({label:v(this)??"<unnamed>",...this.descriptor})}}[l];resourceType="texture-view"};function fg(e){return!!e?.usableAsSampled}var mg=class Uh extends Error{constructor(t){super(`Resource '${v(t)??"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,Uh.prototype)}};function yg(e){let t={};for(let[r,n]of Object.entries(e)){if(n===null){t[r]=null;continue}if("texture"in n&&typeof n.texture=="string"){let i=n.texture;t[r]={...n,texture:ps({dimension:n.viewDimension??"2d",sampleType:i==="sint"?V:i==="uint"?b:g,multisampled:n.multisampled??!1})}}else if("storageTexture"in n&&typeof n.storageTexture=="string"){let i={readonly:"read-only",writeonly:"write-only",mutable:"read-write"};t[r]={...n,storageTexture:ps({access:i[n.access??"writeonly"],format:n.storageTexture,dimension:n.viewDimension??"2d"})}}else"externalTexture"in n&&Object.keys(n.externalTexture).length===0?t[r]={...n,externalTexture:{type:"texture_external",dimension:"2d"}}:t[r]=n}return t}function Vh(e){let t=yg(e);return new wg(t)}function Ph(e){return!!e&&e.resourceType==="bind-group-layout"}function xi(e){return!!e&&e.resourceType==="bind-group"}var gg=class Ah extends Error{constructor(t,r){super(`Bind group '${t??"<unnamed>"}' is missing a required binding '${r}'`),Object.setPrototypeOf(this,Ah.prototype)}},io=["compute","fragment"],ln=["compute","vertex","fragment"],wg=class{constructor(e){this.entries=e;let t=0;for(let[r,n]of Object.entries(e)){if(n===null){t++;continue}let i={layout:this,key:r,idx:t};if("uniform"in n&&(this.bound[r]=new Ja("uniform",n.uniform,i)),"storage"in n){let s="type"in n.storage?n.storage:n.storage(0);this.bound[r]=new Ja(n.access??"readonly",s,i)}"texture"in n&&(this.bound[r]=new no(n.texture,i)),"storageTexture"in n&&(this.bound[r]=new no(n.storageTexture,i)),"externalTexture"in n&&(this.bound[r]=new eg(n.externalTexture,i)),"sampler"in n&&(this.bound[r]=new Ky(n.sampler==="comparison"?la():ha(),i)),Object.defineProperty(this.value,r,{get:()=>this.bound[r].value}),t++}}[l]=!0;_index;resourceType="bind-group-layout";bound={};value={};$=this.value;get[F](){return this.$}toString(){return`bindGroupLayout:${v(this)??"<unnamed>"}`}get index(){return this._index}$name(e){return L(this,e),this}$idx(e){return this._index=e,this}unwrap(e){return e.device.createBindGroupLayout({label:v(this)??"<unnamed>",entries:Object.values(this.entries).map((t,r)=>{if(t===null)return null;let n=t.visibility,i={binding:r,visibility:0};if("uniform"in t)n=n??ln,i.buffer={type:"uniform"};else if("storage"in t)n=n??(t.access==="mutable"?io:ln),i.buffer={type:t.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in t)n=n??ln,i.sampler={type:t.sampler};else if("texture"in t){n=n??ln;let{multisampled:s,dimension:a,bindingSampleType:o}=t.texture;i.texture={sampleType:t.sampleType??o[0],viewDimension:a,multisampled:s}}else if("storageTexture"in t){n=n??io;let{dimension:s,access:a,format:o}=t.storageTexture;i.storageTexture={access:a,format:o,viewDimension:s}}else"externalTexture"in t&&(n=n??ln,i.externalTexture={});return n?.includes("compute")&&(i.visibility|=GPUShaderStage.COMPUTE),n?.includes("vertex")&&(i.visibility|=GPUShaderStage.VERTEX),n?.includes("fragment")&&(i.visibility|=GPUShaderStage.FRAGMENT),i}).filter(t=>t!==null)})}},Oh=class{constructor(t,r){this.layout=t,this.entries=r;for(let n of Object.keys(t.entries))if(t.entries[n]!==null&&!(n in r))throw new gg(v(t),n)}resourceType="bind-group";unwrap(t){return t.device.createBindGroup({label:v(this.layout)??"<unnamed>",layout:t.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([r,n],i)=>{if(n===null)return null;let s=this.entries[r];if(s===void 0)throw new Error(`'${r}' is a resource required to populate bind group layout '${v(this.layout)??"<unnamed>"}'.`);if("uniform"in n){let a;if($n(s)){if(!Th(s))throw new El(s);a={buffer:t.unwrap(s)}}else a={buffer:s};return{binding:i,resource:a}}if("storage"in n){let a;if($n(s)){if(!wi(s))throw new Qa(s);a={buffer:t.unwrap(s)}}else a={buffer:s};return{binding:i,resource:a}}if("texture"in n){let a;if(_n(s)){if(!fg(s))throw new mg(s);a=t.unwrap(s.createView(n.texture))}else zn(s)?a=t.unwrap(s):a=s;return{binding:i,resource:a}}if("storageTexture"in n){let a;if(_n(s)){if(!wi(s))throw new Qa(s);a=t.unwrap(s.createView(n.storageTexture))}else zn(s)?a=t.unwrap(s):a=s;return{binding:i,resource:a}}if("sampler"in n)return Ih(s)||zh(s)?{binding:i,resource:t.unwrap(s)}:{binding:i,resource:s};if("externalTexture"in n)return{binding:i,resource:s};throw new Error(`Malformed bind group entry: ${Zt(s)}`)}).filter(r=>r!==null)})}};function vi(e){return new xg(e)}var xg=class{constructor(e=void 0){this.defaultValue=e}[l]=!0;resourceType="slot";$name(e){return L(this,e),this}areEqual(e,t){return Object.is(e,t)}toString(){return`slot:${v(this)??"<unnamed>"}`}get[F](){let e=Ae();if(!e)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return Li(e.unwrap(this))}get value(){return this[F]}get $(){return this.value}};function $i(e,t){return new Bh("private",e,t)}function so(e){return new Bh("workgroup",e)}var Bh=class{[l]={};#e;#t;#r;constructor(t,r,n){this.#e=t,this.#t=r,this.#r=n}[_](t){let r=t.getUniqueName(this),n=`var<${this.#e}> ${r}: ${t.resolve(this.#t).value}`;return this.#r?t.addDeclaration(`${n} = ${t.resolve(this.#r,this.#t).value};`):t.addDeclaration(`${n};`),y(r,this.#t,Te(this.#t)?"runtime":this.#e)}$name(t){return L(this,t),this}toString(){return`var:${v(this)??"<unnamed>"}`}get[F](){let t=this.#t,r=Te(t)?"runtime":this.#e;return new Proxy({[l]:!0,get[ke](){return y(this,t,r)},[_]:n=>n.resolve(this),toString:()=>`var:${v(this)??"<unnamed>"}.$`},We)}get $(){let t=pi(),r=ci();if(t.type==="normal")throw new Ua(r?`Cannot access variable '${v(this)??"<unnamed>"}'. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");return t.type==="codegen"?this[F]:t.type==="simulate"?(t.vars[this.#e].has(this)||t.vars[this.#e].set(this,this.#r),t.vars[this.#e].get(this)):Nr(t,"tgpuVariable.ts#TgpuVarImpl/$")}set $(t){let r=pi(),n=ci();if(r.type==="normal")throw new Ua(n?`Cannot access ${String(this)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");if(r.type==="codegen")throw new Error("Unreachable tgpuVariable.ts#TgpuVarImpl/$");if(r.type==="simulate"){r.vars[this.#e].set(this,t);return}Nr(r,"tgpuVariable.ts#TgpuVarImpl/$")}get value(){return this.$}set value(t){this.$=t}},Ch=$i(b,0).$name("dataBlockIndex"),Fh=$i(b,0).$name("dataByteIndex"),jh=vi().$name("dataBuffer"),vg=C([],b)`() {
  let i = dataByteIndex;
  dataByteIndex = dataByteIndex + 1u;
  return i;
}`.$uses({dataByteIndex:Fh}).$name("nextByteIndex"),w="dataBuffer[dataBlockIndex].serializedData[nextByteIndex()]",Gh={f32:C([g])`(n) => {
  ${w} = bitcast<u32>(n);
}`,f16:C([oe])`(n) => {
  ${w} = pack2x16float(vec2f(f32(n), 0.0));
}`,i32:C([V])`(n) => {
  ${w} = bitcast<u32>(n);
}`,u32:C([b])`(n) => {
  ${w} = n;
}`,bool:C([G])`(b) => {
  ${w} = u32(b);
}`,vec2f:C([D])`(v) => {
  ${w} = bitcast<u32>(v.x);
  ${w} = bitcast<u32>(v.y);
}`,vec3f:C([ue])`(v) => {
  ${w} = bitcast<u32>(v.x);
  ${w} = bitcast<u32>(v.y);
  ${w} = bitcast<u32>(v.z);
}`,vec4f:C([I])`(v) => {
  ${w} = bitcast<u32>(v.x);
  ${w} = bitcast<u32>(v.y);
  ${w} = bitcast<u32>(v.z);
  ${w} = bitcast<u32>(v.w);
}`,vec2h:C([yt])`(v) => {
  ${w} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
}`,vec3h:C([gt])`(v) => {
  ${w} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${w} = pack2x16float(vec2f(f32(v.z), 0.0));
}`,vec4h:C([wt])`(v) => {
  ${w} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${w} = pack2x16float(vec2f(f32(v.z), f32(v.w)));
}`,vec2i:C([q])`(v) => {
  ${w} = bitcast<u32>(v.x);
  ${w} = bitcast<u32>(v.y);
}`,vec3i:C([Oe])`(v) => {
  ${w} = bitcast<u32>(v.x);
  ${w} = bitcast<u32>(v.y);
  ${w} = bitcast<u32>(v.z);
}`,vec4i:C([pe])`(v) => {
  ${w} = bitcast<u32>(v.x);
  ${w} = bitcast<u32>(v.y);
  ${w} = bitcast<u32>(v.z);
  ${w} = bitcast<u32>(v.w);
}`,vec2u:C([Me])`(v) => {
  ${w} = v.x;
  ${w} = v.y;
}`,vec3u:C([ie])`(v) => {
  ${w} = v.x;
  ${w} = v.y;
  ${w} = v.z;
}`,vec4u:C([ve])`(v) => {
  ${w} = v.x;
  ${w} = v.y;
  ${w} = v.z;
  ${w} = v.w;
}`,"vec2<bool>":C([pr])`(v) => {
  ${w} = u32(v.x);
  ${w} = u32(v.y);
}`,"vec3<bool>":C([dr])`(v) => {
  ${w} = u32(v.x);
  ${w} = u32(v.y);
  ${w} = u32(v.z);
}`,"vec4<bool>":C([fr])`(v) => {
  ${w} = u32(v.x);
  ${w} = u32(v.y);
  ${w} = u32(v.z);
  ${w} = u32(v.w);
}`,mat2x2f:C([Ot])`(m) => {
  ${w} = bitcast<u32>(m[0][0]);
  ${w} = bitcast<u32>(m[0][1]);
  ${w} = bitcast<u32>(m[1][0]);
  ${w} = bitcast<u32>(m[1][1]);
}`,mat3x3f:C([Bt])`(m) => {
  ${w} = bitcast<u32>(m[0][0]);
  ${w} = bitcast<u32>(m[0][1]);
  ${w} = bitcast<u32>(m[0][2]);
  ${w} = 0u;
  ${w} = bitcast<u32>(m[1][0]);
  ${w} = bitcast<u32>(m[1][1]);
  ${w} = bitcast<u32>(m[1][2]);
  ${w} = 0u;
  ${w} = bitcast<u32>(m[2][0]);
  ${w} = bitcast<u32>(m[2][1]);
  ${w} = bitcast<u32>(m[2][2]);
  ${w} = 0u;
}`,mat4x4f:C([Y])`(m) => {
  ${w} = bitcast<u32>(m[0][0]);
  ${w} = bitcast<u32>(m[0][1]);
  ${w} = bitcast<u32>(m[0][2]);
  ${w} = bitcast<u32>(m[0][3]);
  ${w} = bitcast<u32>(m[1][0]);
  ${w} = bitcast<u32>(m[1][1]);
  ${w} = bitcast<u32>(m[1][2]);
  ${w} = bitcast<u32>(m[1][3]);
  ${w} = bitcast<u32>(m[2][0]);
  ${w} = bitcast<u32>(m[2][1]);
  ${w} = bitcast<u32>(m[2][2]);
  ${w} = bitcast<u32>(m[2][3]);
  ${w} = bitcast<u32>(m[3][0]);
  ${w} = bitcast<u32>(m[3][1]);
  ${w} = bitcast<u32>(m[3][2]);
  ${w} = bitcast<u32>(m[3][3]);
}`};for(let[e,t]of Object.entries(Gh))t.$name(`serialize${e[0].toLocaleUpperCase()}${e.slice(1)}`).$uses({dataBlockIndex:Ch,nextByteIndex:vg,dataBuffer:jh});function Lh(e){return`(${e.map((t,r)=>`_arg_${r}`).join(", ")})`}function Rh(e,t){let r=Gh[e.type];if(r)return r.with(jh,t);if(me(e)){let n=Object.keys(e.propTypes),i=Object.values(e.propTypes),s=Dh(i,t);return C([e])`(arg) {\n  propsSerializer(${n.map(a=>`arg.${a}`).join(", ")});\n}`.$uses({propsSerializer:s}).$name(`${v(e)??"struct"}Serializer`)}if(ze(e)){let n=e.elementType,i=e.elementCount,s=Rh(n,t);return C([e])`(arg) {\n${Array.from({length:i},(a,o)=>`  elementSerializer(arg[${o}]);`).join(`
`)}\n}`.$uses({elementSerializer:s}).$name("arraySerializer")}throw new Error(`Cannot serialize data of type ${e.type}`)}function Dh(e,t){let r={},n=C(e),i=Lh(e),s=e.map((a,o)=>(r[`serializer${o}`]=Rh(a,t),`  serializer${o}(_arg_${o});`)).join(`
`);return n`${i} {\n${s}\n}`.$uses(r).$name("compoundSerializer")}function $g(e,t,r,n,i){let s=t.map(P).reduce((u,h)=>u+h,0);if(s>i.logSizeLimit)throw new Error(`Logged data needs to fit in ${i.logSizeLimit} bytes (one of the logs requires ${s} bytes). Consider increasing the limit by passing appropriate options to tgpu.init().`);let a=Dh(t,r).$name(`log${e}serializer`),o=Lh(t);return C(t)`${o} {
  dataBlockIndex = atomicAdd(&indexBuffer, 1);
  if (dataBlockIndex >= ${i.logCountLimit}) {
    return;
  }
  dataBuffer[dataBlockIndex].id = ${e};
  dataByteIndex = 0;

  compoundSerializer${o};
}`.$uses({indexBuffer:n,dataBuffer:r,dataBlockIndex:Ch,dataByteIndex:Fh,compoundSerializer:a}).$name(`log${e}`)}var bg=["log","debug","info","warn","error","clear"],Tg={logCountLimit:64,logSizeLimit:252,messagePrefix:" GPU "},Nh=y("/* console.log() */",te,"runtime"),_g=class{get logResources(){}generateLog(){return console.warn("'console.log' is only supported when resolving pipelines."),Nh}},zg=class{#e;#t;#r=1;#n;#i;constructor(t){this.#e={...Tg,...t[l].logOptions},this.#t=new Map;let r=ki({id:b,serializedData:Tn(b,Math.ceil(this.#e.logSizeLimit/4))}).$name("SerializedLogData");this.#i=t.createMutable(Tn(r,this.#e.logCountLimit)).$name("dataBuffer"),this.#n=t.createMutable(ju(b)).$name("indexBuffer")}generateLog(t,r,n){if(!bg.includes(r))return console.warn(`Unsupported log method '${r}' was used in TGSL.`),Nh;let i=ic(n),s=this.#r++,a=i.filter(h=>h.dataType!==Qe),o=$g(s,a.map(h=>h.dataType),this.#i,this.#n,this.#e),u=i.map(h=>h.dataType===Qe?h.value:h.dataType);return this.#t.set(s,{op:r,argTypes:u}),y(c`${t.resolve(o).value}(${a})`,te,"runtime")}get logResources(){return this.#r===1?void 0:{dataBuffer:this.#i,indexBuffer:this.#n,options:this.#e,logIdToMeta:this.#t}}},ao={mat2x2f:D,mat3x3f:ue,mat4x4f:I};function Wh(e,t){if(ze(e.dataType)||Ut(e.dataType)){let r=e.dataType.elementType,n=Te(r),i=Cr(e),s=t.origin==="constant",a;return e.origin==="constant-tgpu-const-ref"?s?a=n?"constant":"constant-tgpu-const-ref":a=n?"runtime":"runtime-tgpu-const-ref":e.origin==="runtime-tgpu-const-ref"?a=n?"runtime":"runtime-tgpu-const-ref":!i&&!n?a=e.origin:s&&e.origin==="constant"?a="constant":a="runtime",y(Ve(e)&&Ve(t)?e.value[t.value]:c`${e}[${t}]`,r,a)}if(ft(e.dataType))return y(Ve(e)&&Ve(t)?e.value[t.value]:c`${e}[${t}]`,e.dataType.primitive,e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime");if(Je(e.dataType))return Wh(Cs(e),t);if(e.value instanceof Oo){let r=ao[e.value.matrix.dataType.type];return y(c`${e.value.matrix}[${t}]`,r,e.origin)}if(e.dataType.type in ao)throw new Error("The only way of accessing matrix elements in TGSL is through the 'columns' property.");if(Ve(e)&&Ve(t)||e.dataType.type==="unknown")return Mi(e.value[t.value])}var{NodeTypeCatalog:R}=dy,Ig=["==","!=","===","!==","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"],Sg=["&&","||","==","!=","===","!==","<","<=",">",">="],oo={"===":"==","!==":"!=",get">>>"(){throw new Error("The `>>>` operator is unsupported in TypeGPU functions.")},get in(){throw new Error("The `in` operator is unsupported in TypeGPU functions.")},get instanceof(){throw new Error("The `instanceof` operator is unsupported in TypeGPU functions.")},get"|>"(){throw new Error("The `|>` operator is unsupported in TypeGPU functions.")},get"??"(){throw new Error("The `??` operator is unsupported in TypeGPU functions.")},get">>>="(){throw new Error("The `>>>=` operator is unsupported in TypeGPU functions.")},get"**="(){throw new Error("The `**=` operator is unsupported in TypeGPU functions.")},get"??="(){throw new Error("The `??=` operator is unsupported in TypeGPU functions.")},get"&&="(){throw new Error("The `&&=` operator is unsupported in TypeGPU functions.")},get"||="(){throw new Error("The `||=` operator is unsupported in TypeGPU functions.")}};function uo(e,t,r){return r?Sg.includes(t)?G:t==="="?r:e:t==="!"||t==="~"?G:e}var Eg={"-":Su[l].gpuImpl},Mg={"+":ia[l].gpuImpl,"-":Jr[l].gpuImpl,"*":Fn[l].gpuImpl,"/":sa[l].gpuImpl,"**":ih[l].gpuImpl},kg=class{#e=void 0;initGenerator(e){this.#e=e}get ctx(){if(!this.#e)throw new Error("WGSL Generator has not yet been initialized. Please call initialize(ctx) before using the generator.");return this.#e}block([e,t]){this.ctx.pushBlockScope();try{this.ctx.indent();let r=t.map(n=>this.statement(n)).join(`
`);return this.ctx.dedent(),`{
${r}
${this.ctx.pre}}`}finally{this.ctx.popBlockScope()}}refVariable(e,t){let r=this.ctx.makeNameValid(e),n=Bs(t),i=y(new Et(y(r,t,"function"),n),n,"function");return this.ctx.defineVariable(e,i),r}blockVariable(e,t,r,n){let i=Te(r),s;n==="constant-tgpu-const-ref"||n==="runtime-tgpu-const-ref"?s=n:n==="argument"?i?s="runtime":s="argument":i?n==="constant"&&e==="const"?s="constant":s="runtime":s=Wo(n)?"this-function":n;let a=y(this.ctx.makeNameValid(t),r,s);return this.ctx.defineVariable(t,a),a}identifier(e){if(!e)throw new Error("Cannot resolve an empty identifier");let t=this.ctx.getById(e);if(!t)throw new Error(`Identifier ${e} not found`);return t}typedExpression(e,t){let r=this.ctx.expectedType;this.ctx.expectedType=t;try{let n=this.expression(e);return rr(n,t)}finally{this.ctx.expectedType=r}}expression(e){if(typeof e=="string")return this.identifier(e);if(typeof e=="boolean")return y(e,G,"constant");if(e[0]===R.logicalExpr||e[0]===R.binaryExpr||e[0]===R.assignmentExpr){let[t,r,n,i]=e,s=this.expression(r),a=this.expression(i);if(a.value instanceof Et)throw new j(c`Cannot assign a ref to an existing variable '${s}', define a new variable instead.`);if(n==="==")throw new Error("Please use the === operator instead of ==");if(n==="==="&&Ve(s)&&Ve(a))return y(s.value===a.value,G,"constant");if(s.dataType.type==="unknown")throw new j(`Left-hand side of '${n}' is of unknown type`);if(a.dataType.type==="unknown")throw new j(`Right-hand side of '${n}' is of unknown type`);let o=Mg[n];if(o)return o(s,a);let u=t===R.assignmentExpr?[s.dataType]:void 0,[h,p]=Fr([s,a],u)??[s,a],f=this.ctx.resolve(h.value,h.dataType).value,m=this.ctx.resolve(p.value,p.dataType).value,x=uo(h.dataType,n,p.dataType);if(t===R.assignmentExpr){if(h.origin==="constant"||h.origin==="constant-tgpu-const-ref"||h.origin==="runtime-tgpu-const-ref")throw new j(`'${f} = ${m}' is invalid, because ${f} is a constant.`);if(s.origin==="argument")throw new j(`'${f} ${n} ${m}' is invalid, because non-pointer arguments cannot be mutated.`);if(a.origin==="argument"&&!Te(a.dataType))throw new j(`'${f} = ${m}' is invalid, because argument references cannot be assigned.
-----
Try '${f} = ${this.ctx.resolve(a.dataType).value}(${m})' to copy the value instead.
-----`);if(!Cr(a))throw new j(`'${f} = ${m}' is invalid, because references cannot be assigned.
-----
Try '${f} = ${this.ctx.resolve(a.dataType).value}(${m})' to copy the value instead.
-----`)}return y(Ig.includes(n)?`(${f} ${oo[n]??n} ${m})`:`${f} ${oo[n]??n} ${m}`,x,"runtime")}if(e[0]===R.postUpdate){let[t,r,n]=e,i=this.expression(n),s=this.ctx.resolve(i.value,i.dataType).value;return y(`${s}${r}`,i.dataType,"runtime")}if(e[0]===R.unaryExpr){let[t,r,n]=e,i=this.expression(n),s=Eg[r];if(s)return s(i);let a=this.ctx.resolve(i.value,i.dataType).value,o=uo(i.dataType,r);return y(`${r}${a}`,o,"runtime")}if(e[0]===R.memberAccess){let[t,r,n]=e,i=this.expression(r);if(i.value===console)return y(new Ma(n),Qe,"runtime");let s=ua(i,n);if(!s)throw new Error(c`Property '${n}' not found on value '${i}' of type ${this.ctx.resolve(i.dataType)}`);return s}if(e[0]===R.indexAccess){let[t,r,n]=e,i=this.expression(r),s=this.expression(n),a=Fr([s],[b,V],!1)?.[0]??s,o=Wh(i,a);if(!o){let u=this.ctx.resolve(i.value,i.dataType).value,h=this.ctx.resolve(a.value,a.dataType).value;throw new Error(`Unable to index value ${u} of unknown type with index ${h}. If the value is an array, to address this, consider one of the following approaches: (1) declare the array using 'tgpu.const', (2) store the array in a buffer, or (3) define the array within the GPU function scope.`)}return o}if(e[0]===R.numericLiteral){let t=typeof e[1]=="string"?mi(Vg(e[1])):mi(e[1]);if(!t)throw new Error(`Invalid numeric literal ${e[1]}`);return t}if(e[0]===R.call){let[t,r,n]=e,i=this.expression(r);if(me(i.value)||ze(i.value)){if(n.length>1)throw new j("Array and struct schemas should always be called with at most 1 argument");if(!n[0])return y(`${this.ctx.resolve(i.value).value}()`,i.value,"runtime");let o=this.typedExpression(n[0],i.value);return y(this.ctx.resolve(o.value,i.value).value,i.value,"runtime")}if(i.value===ws)throw new Error("Constants cannot be defined within TypeGPU function scope. To address this, move the constant definition outside the function scope.");if(i.value instanceof Ao){if(!n[0])throw new j(`An infix operator '${i.value.name}' was called without any arguments`);let o=this.expression(n[0]);return i.value.operator(i.value.lhs,o)}if(!O(i.value)){let o=n.map(h=>this.expression(h)),u=this.ctx.shelllessRepo.get(i.value,o);if(u){let h=o.map((p,f)=>{let m=u.argTypes[f];return rr(p,m,!1)});return this.ctx.withResetIndentLevel(()=>{let p=this.ctx.resolve(u);return y(c`${p.value}(${h})`,p.dataType,"runtime")})}throw new Error(`Function '${v(i.value)??String(i.value)}' is not marked with the 'use gpu' directive and cannot be used in a shader`)}let s=i.value[l]?.argConversionHint??"keep",a=i.value[l]?.strictSignature;try{let o;if(a)o=n.map((h,p)=>{let f=a.argTypes[p];if(!f)throw new j(`Function '${v(i.value)}' was called with too many arguments`);return this.typedExpression(h,f)});else if(Array.isArray(s))o=n.map((h,p)=>{let f=s[p];if(!f)throw new j(`Function '${v(i.value)}' was called with too many arguments`);return this.typedExpression(h,f)});else{let h=n.map(p=>this.expression(p));s==="keep"?o=h:s==="unify"?o=Fr(h)??h:o=s(...h).map((p,f)=>[p,h[f]]).map(([p,f])=>rr(f,p))}if(i.value instanceof Ma)return this.ctx.generateLog(i.value.op,o);let u=i.value(...o);if(!Os(u))throw new Error("Functions running in codegen mode must return snippets");return u}catch(o){throw o instanceof Br?o:new Br(o,[{toString:()=>`fn:${v(i.value)}`}])}}if(e[0]===R.objectExpr){let t=e[1],r=this.ctx.expectedType;if(!r||!me(r))throw new j(`No target type could be inferred for object with keys [${Object.keys(t).join(", ")}], please wrap the object in the corresponding schema.`);let n=Object.fromEntries(Object.entries(r.propTypes).map(([s,a])=>{let o=t[s];if(o===void 0)throw new j(`Missing property ${s} in object literal for struct ${r}`);let u=this.typedExpression(o,a);return[s,u]})),i=ql(r,n);return y(c`${this.ctx.resolve(r).value}(${i})`,r,"runtime")}if(e[0]===R.arrayExpr){let[t,r]=e,n=this.ctx.expectedType,i,s;if(ze(n)){if(i=n.elementType,s=r.map(o=>this.typedExpression(o,i)),s.length!==n.elementCount)throw new j(`Cannot create value of type '${n}' from an array of length: ${s.length}`)}else{let o=r.map(h=>{let p=this.expression(h);if(p.origin==="argument"&&!Te(p.dataType)||!Cr(p)){let f=this.ctx.resolve(p.value,p.dataType).value,m=this.ctx.resolve(Rt(p.dataType)).value;throw new j(`'${f}' reference cannot be used in an array constructor.
-----
Try '${m}(${f})' or 'arrayOf(${m}, count)([...])' to copy the value instead.
-----`)}return p});if(o.length===0)throw new j("Cannot infer the type of an empty array literal.");let u=Fr(o);if(!u)throw new j("The given values cannot be automatically converted to a common type. Consider wrapping the array in an appropriate schema");s=u,i=Rt(s[0]?.dataType)}let a=`array<${this.ctx.resolve(i).value}, ${s.length}>`;return y(c`${a}(${s})`,Tn[l].jsImpl(i,s.length),"runtime")}if(e[0]===R.stringLiteral)return y(e[1],Qe,"constant");if(e[0]===R.preUpdate)throw new Error("Cannot use pre-updates in TGSL.");Ug(e)}functionDefinition(e){return this.block(e)}statement(e){if(typeof e=="string")return`${this.ctx.pre}${this.ctx.resolve(this.identifier(e).value).value};`;if(typeof e=="boolean")return`${this.ctx.pre}${e?"true":"false"};`;if(e[0]===R.return){let t=e[1];if(t!==void 0){let r=this.ctx.topFunctionReturnType,n=r?this.typedExpression(t,r):this.expression(t);if(n.value instanceof Et)throw new j(c`Cannot return references, returning '${n.value.snippet}'`);if(n.origin==="argument"&&!Te(n.dataType)&&this.ctx.topFunctionScope?.functionType==="normal")throw new j(c`Cannot return references to arguments, returning '${n}'. Copy the argument before returning it.`);if(!r&&!Cr(n)&&n.origin!=="this-function"){let i=this.ctx.resolve(n.value,n.dataType).value,s=this.ctx.resolve(qn(n.dataType)).value;throw new j(`'return ${i};' is invalid, cannot return references.
-----
Try 'return ${s}(${i});' instead.
-----`)}return n=rr(n,qn(n.dataType),!1),dt(n.dataType.type!=="unknown"),this.ctx.reportReturnType(n.dataType),c`${this.ctx.pre}return ${n};`}return`${this.ctx.pre}return;`}if(e[0]===R.if){let[t,r,n,i]=e,s=this.typedExpression(r,G),a=s.value===!1?void 0:this.block(ei(n)),o=s.value===!0||!i?void 0:this.block(ei(i));return s.value===!0?`${this.ctx.pre}${a}`:s.value===!1?o?`${this.ctx.pre}${o}`:"":o?c`\
${this.ctx.pre}if (${s}) ${a}
${this.ctx.pre}else ${o}`:c`${this.ctx.pre}if (${s}) ${a}`}if(e[0]===R.let||e[0]===R.const){let t="var",[r,n,i]=e,s=i!==void 0?this.expression(i):void 0;if(!s)throw new Error(`Cannot create variable '${n}' without an initial value.`);let a=Cr(s),o=s.dataType,u=Te(o);if(Yr(s.dataType))throw new Error(`Cannot create variable '${n}' with loose data type.`);if(s.value instanceof Et){if(s.dataType.type!=="unknown")throw new j("Cannot store d.ref() in a variable if it references another value. Copy the value passed into d.ref() instead.");let p=s.value.snippet,f=this.refVariable(n,Rt(p.dataType));return c`${this.ctx.pre}var ${f} = ${rr(p,p.dataType,!1)};`}if(a){if(r===R.const)s.origin==="argument"?t="let":u&&(t=s.origin==="constant"?"const":"let");else if(s.origin==="argument"&&!u){let p=this.ctx.resolve(s.value).value,f=this.ctx.resolve(qn(s.dataType)).value;throw new j(`'let ${n} = ${p}' is invalid, because references to arguments cannot be assigned to 'let' variable declarations.
  -----
  - Try 'let ${n} = ${f}(${p})' if you need to reassign '${n}' later
  - Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
  -----`)}}else{if(r===R.let){let p=this.ctx.resolve(s.value).value,f=this.ctx.resolve(qn(s.dataType)).value;throw new j(`'let ${n} = ${p}' is invalid, because references cannot be assigned to 'let' variable declarations.
-----
- Try 'let ${n} = ${f}(${p})' if you need to reassign '${n}' later
- Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
-----`)}if(s.origin==="constant-tgpu-const-ref")t="const";else if(s.origin==="runtime-tgpu-const-ref")t="let";else{if(t="let",!Je(o)){let p=Ho(s.origin,Rt(o));dt(p!==void 0,`Creating pointer type from origin ${s.origin}`),o=p}s.value instanceof Et||(o=Bl(o))}}let h=this.blockVariable(t,n,Rt(o),s.origin);return c`${this.ctx.pre}${t} ${h.value} = ${rr(s,o,!1)};`}if(e[0]===R.block)return this.block(e);if(e[0]===R.for){let[t,r,n,i,s]=e,[a,o,u]=this.ctx.withResetIndentLevel(()=>[r?this.statement(r):void 0,n?this.typedExpression(n,G):void 0,i?this.statement(i):void 0]),h=a?a.slice(0,-1):"",p=u?u.slice(0,-1):"",f=this.block(ei(s));return c`${this.ctx.pre}for (${h}; ${o}; ${p}) ${f}`}if(e[0]===R.while){let[t,r,n]=e,i=this.typedExpression(r,G),s=this.ctx.resolve(i.value).value,a=this.block(ei(n));return`${this.ctx.pre}while (${s}) ${a}`}return e[0]===R.continue?`${this.ctx.pre}continue;`:e[0]===R.break?`${this.ctx.pre}break;`:`${this.ctx.pre}${this.ctx.resolve(this.expression(e).value).value};`}};function Ug(e){throw new Error(`'${Zt(e)}' was not handled by the WGSL generator.`)}function Vg(e){return/^0x[0-9a-f]+$/i.test(e)?Number.parseInt(e):/^0b[01]+$/i.test(e)?Number.parseInt(e.slice(2),2):Number.parseFloat(e)}function ei(e){return typeof e!="object"||e[0]!==R.block?[R.block,[e]]:e}var Pg=new kg,qh=Pg,Hh="#CATCHALL#",Ag=class{_stack=[];_itemDepth=0;get itemDepth(){return this._itemDepth}get topItem(){let e=this._stack[this._stack.length-1];if(!e||e.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return e}get topFunctionScope(){return this._stack.findLast(e=>e.type==="functionScope")}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}popItem(){this.pop("item")}pushSlotBindings(e){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(e)})}popSlotBindings(){this.pop("slotBinding")}pushFunctionScope(e,t,r,n,i){let s={type:"functionScope",functionType:e,args:t,argAliases:r,returnType:n,externalMap:i,reportedReturnTypes:new Set};return this._stack.push(s),s}popFunctionScope(){this.pop("functionScope")}pushBlockScope(){this._stack.push({type:"blockScope",declarations:new Map})}popBlockScope(){this.pop("blockScope")}pop(e){let t=this._stack[this._stack.length-1];if(!t||e&&t.type!==e)throw new Error(`Internal error, expected a ${e} layer to be on top.`);this._stack.pop(),e==="item"&&this._itemDepth--}readSlot(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="item")r.usedSlots.add(e);else if(r?.type==="slotBinding"){let n=r.bindingMap.get(e);if(n!==void 0)return n}else if(!(r?.type==="functionScope"||r?.type==="blockScope"))throw new Error("Unknown layer type.")}return e.defaultValue}getSnippetById(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="functionScope"){let n=r.args.find(s=>s.value===e);if(n!==void 0)return n;if(r.argAliases[e])return r.argAliases[e];let i=r.externalMap[e];return i!=null?Mi(i):void 0}if(r?.type==="blockScope"){let n=r.declarations.get(e);if(n!==void 0)return n}}}defineBlockVariable(e,t){if(t.dataType.type==="unknown")throw Error(`Tried to define variable '${e}' of unknown type`);for(let r=this._stack.length-1;r>=0;--r){let n=this._stack[r];if(n?.type==="blockScope"){n.declarations.set(e,t);return}}throw new Error("No block scope found to define a variable in.")}},ni=["","  ","    ","      ","        ","          ","            ","              ","                "],Ki=ni.length-1,Og=class{identLevel=0;get pre(){return ni[this.identLevel]??ni[Ki].repeat(this.identLevel/Ki)+ni[this.identLevel%Ki]}indent(){let e=this.pre;return this.identLevel++,e}dedent(){return this.identLevel--,this.pre}withResetLevel(e){let t=this.identLevel;this.identLevel=0;try{return e()}finally{this.identLevel=t}}},Yh=class{#e;#t;_indentController=new Og;_itemStateStack=new Ag;#r=[];_declarations=[];_varyingLocations;#n=new WeakSet;#i;get varyingLocations(){return this._varyingLocations}[l]={itemStateStack:this._itemStateStack};bindGroupLayoutsToPlaceholderMap=new Map;_nextFreeLayoutPlaceholderIdx=0;fixedBindings=[];enableExtensions;expectedType;constructor(e){this.enableExtensions=e.enableExtensions,this.#t=e.shaderGenerator??qh,this.#i=e.root?new zg(e.root):new _g,this.#e=e.namespace[l]}getUniqueName(e){return Uy(this.#e,e)}makeNameValid(e){return this.#e.nameRegistry.makeValid(e)}get pre(){return this._indentController.pre}get topFunctionScope(){return this._itemStateStack.topFunctionScope}get topFunctionReturnType(){let e=this._itemStateStack.topFunctionScope;return dt(e),e.returnType}get shelllessRepo(){return this.#e.shelllessRepo}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}withResetIndentLevel(e){return this._indentController.withResetLevel(e)}getById(e){let t=this._itemStateStack.getSnippetById(e);return t===void 0?null:t}defineVariable(e,t){this._itemStateStack.defineBlockVariable(e,t)}reportReturnType(e){let t=this._itemStateStack.topFunctionScope;dt(t),t.reportedReturnTypes.add(e)}pushBlockScope(){this._itemStateStack.pushBlockScope()}popBlockScope(){this._itemStateStack.popBlockScope()}generateLog(e,t){return this.#i.generateLog(this,e,t)}get logResources(){return this.#i.logResources}fnToWgsl(e){let t=!1;try{this.#e.nameRegistry.pushFunctionScope();let r=[],n=[];for(let[o,u]of e.argTypes.entries()){let h=e.params[o],p=Je(u)?u.addressSpace==="storage"?u.access==="read"?"readonly":"mutable":u.addressSpace:"argument";switch(h?.type){case gs.identifier:{let f=h.name,m=y(this.makeNameValid(f),u,p);r.push(m),m.value!==f&&n.push([f,m]);break}case gs.destructuredObject:{r.push(y(`_arg_${o}`,u,p)),n.push(...h.props.map(({name:f,alias:m})=>{let x=kt(e.argTypes[o].propTypes[f]);return[m,y(`_arg_${o}.${f}`,x,"argument")]}));break}case void 0:r.push(y(`_arg_${o}`,u,p))}}let i=this._itemStateStack.pushFunctionScope(e.functionType,r,Object.fromEntries(n),e.returnType,e.externalMap);t=!0,this.#t.initGenerator(this);let s=this.#t.functionDefinition(e.body),a=e.returnType;if(!a){let o=[...i.reportedReturnTypes];if(o.length===0)a=te;else{let u=js(o);u&&!u.hasImplicitConversions&&(a=u.targetType)}if(!a)throw new Error(`Expected function to have a single return type, got [${o.join(", ")}]. Cast explicitly to the desired type.`);a=Rt(a)}return{head:Bg(this,r,a),body:s,returnType:a}}finally{t&&this._itemStateStack.popFunctionScope(),this.#e.nameRegistry.popFunctionScope()}}addDeclaration(e){this._declarations.push(e)}allocateLayoutEntry(e){let t=this.bindGroupLayoutsToPlaceholderMap,r=t.get(e);return r||(r=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,t.set(e,r)),r}allocateFixedEntry(e,t){let r=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:e,resource:t}),{group:Hh,binding:r}}readSlot(e){let t=this._itemStateStack.readSlot(e);if(t===void 0)throw new Sl(e);return t}withSlots(e,t){this._itemStateStack.pushSlotBindings(e);try{return t()}finally{this._itemStateStack.popSlotBindings()}}withVaryingLocations(e,t){this._varyingLocations=e;try{return t()}finally{this._varyingLocations=void 0}}unwrap(e){if(hs(e))return this.withSlots(e[ar].pairs,()=>this.unwrap(e[ar].inner));let t=e;for(;;)if(os(t))t=this.readSlot(t);else if(us(t))t=this._getOrCompute(t);else break;return t}_getOrCompute(e){let t=this.#e.memoizedDerived.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;this.pushMode(new kn);let r;try{r=e["~compute"]()}finally{this.popMode("normal")}let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedDerived.set(e,t),r}catch(r){throw r instanceof Br?r.appendToTrace(e):new Br(r,[e])}finally{this._itemStateStack.popItem()}}_getOrInstantiate(e){let t=this.#e.memoizedResolves.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;let r;if(Xr(e))r=y(xh(this,e),te,"runtime");else if(us(e)||os(e))r=this.resolve(this.unwrap(e));else if(Yo(e))r=e[_](this);else if(mn(e)){let i=this.#e.shelllessRepo.get(e,void 0);if(!i)throw new Error(`Couldn't resolve ${e.name}. Make sure it's a function that accepts no arguments, or call it from another TypeGPU function.`);return this.withResetIndentLevel(()=>this.resolve(i))}else throw new TypeError(`Unresolvable internal value: ${Zt(e)}`);let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedResolves.set(e,t),r}catch(r){throw r instanceof Br?r.appendToTrace(e):new Br(r,[e])}finally{this._itemStateStack.popItem()}}resolve(e,t){if(fh(e)||mn(e)){if(this.#n.has(e)&&!this.#e.memoizedResolves.has(e))throw new Error(`Recursive function ${e} detected. Recursion is not allowed on the GPU.`);this.#n.add(e)}if(hs(e))return this.withSlots(e[ar].pairs,()=>this.resolve(e[ar].inner,t));if(O(e)||mn(e)){if(this._itemStateStack.itemDepth===0)try{this.pushMode(new Fl);let r=Xo(this,()=>this._getOrInstantiate(e));return y(`${[...this._declarations].join(`

`)}${r.value}`,te,"runtime")}finally{this.popMode("codegen")}return this._getOrInstantiate(e)}if(typeof e=="number"){let r=t??mi(e).dataType;if(dt(r.type!=="unknown"),r.type==="abstractInt")return y(`${e}`,r,"constant");if(r.type==="u32")return y(`${e}u`,r,"constant");if(r.type==="i32")return y(`${e}i`,r,"constant");let n=e.toExponential(),i=r.type==="abstractFloat"&&Number.isInteger(e)?`${e}.`:`${e}`,s=n.length<i.length?n:i;return r.type==="f32"?y(`${s}f`,r,"constant"):r.type==="f16"?y(`${s}h`,r,"constant"):y(s,r,"constant")}if(typeof e=="boolean")return y(e?"true":"false",G,"constant");if(typeof e=="string")return y(e,te,"runtime");if(t&&ze(t)){if(!Array.isArray(e))throw new j(`Cannot coerce ${e} into value of type '${t}'`);if(t.elementCount!==e.length)throw new j(`Cannot create value of type '${t}' from an array of length: ${e.length}`);let r=this.resolve(t.elementType);return y(c`array<${r}, ${t.elementCount}>(${e.map(n=>y(n,t.elementType,"runtime"))})`,t,"runtime")}if(Array.isArray(e))return y(c`array(${e.map(r=>this.resolve(r))})`,Qe,"runtime");if(t&&me(t))return y(c`${this.resolve(t)}(${Object.entries(t.propTypes).map(([r,n])=>y(e[r],n,"runtime"))})`,t,"runtime");throw new j(`Value ${e} (as json: ${Zt(e)}) is not resolvable${t?` to type ${t.type}`:""}`)}pushMode(e){this.#r.push(e)}popMode(e){let t=this.#r.pop();e!==void 0&&dt(t?.type===e)}get mode(){return this.#r[this.#r.length-1]??Zo}};function Di(e,t){let r=new Yh(t),n=(t.config?r.withSlots(t.config(new vh([])).bindings,()=>r.resolve(e)):r.resolve(e)).value,i=r.bindGroupLayoutsToPlaceholderMap,s=[],a=new Set([...i.keys()].map(f=>f.index).filter(f=>f!==void 0)),o=jy(a),u=r.fixedBindings.map((f,m)=>[String(m),f.layoutEntry]),h=()=>{let f=o.next().value,m=Vh(Object.fromEntries(u));return s[f]=m,n=n.replaceAll(Hh,String(f)),[f,new Oh(m,Object.fromEntries(r.fixedBindings.map((x,$)=>[String($),x.resource])))]},p=u.length>0?h():void 0;for(let[f,m]of i.entries()){let x=f.index??o.next().value;s[x]=f,n=n.replaceAll(m,String(x))}return t.enableExtensions&&t.enableExtensions.length>0&&(n=`${t.enableExtensions.map(f=>`enable ${f};`).join(`
`)}

${n}`),{code:n,usedBindGroupLayouts:s,catchall:p,logResources:r.logResources}}function Bg(e,t,r){let n=t.map(i=>`${i.value}: ${e.resolve(i.dataType).value}`).join(", ");return r.type!=="void"?`(${n}) -> ${ra(r)}${e.resolve(r).value} `:`(${n}) `}function Xh(e){let t=e;return t?.resourceType==="compute-pipeline"&&!!t[l]}function Zh(e){let t=e;return t?.resourceType==="render-pipeline"&&!!t[l]}function Cg(e){return Zh(e)||Xh(e)}function Ts(e,t){return Array.isArray(e)?Gg(e,t):jg(e)}function Fg(e,t){return Array.isArray(e)?Ts(e,t).code:Ts(e).code}function jg(e){let{template:t,externals:r,shaderGenerator:n,names:i="strict",config:s,enableExtensions:a}=e;t||console.warn("Calling resolve with an empty template is deprecated and will soon return an empty string. Consider using the 'tgpu.resolve(resolvableArray, options)' API instead.");let o={};Dr(o,r??{});let u={[l]:!0,[_](h){return y(On(h,o,t??""),te,"runtime")},toString:()=>"<root>"};return Di(u,{namespace:typeof i=="string"?en({names:i}):i,enableExtensions:a,shaderGenerator:n,config:s,root:Qh(Object.values(r))})}function Gg(e,t){let{shaderGenerator:r,names:n="strict",config:i,enableExtensions:s}=t??{},a={[l]:!0,[_](o){return e.forEach(u=>o.resolve(u)),y("",te,"runtime")},toString:()=>"<root>"};return Di(a,{namespace:typeof n=="string"?en({names:n}):n,enableExtensions:s,shaderGenerator:r,config:i,root:Qh(e)})}function Qh(e){let t=e.filter(Cg);if(t.length>1)throw new Error(`Found ${t.length} pipelines but can only resolve one at a time.`);return t[0]?.[l].branch}function Lg(e){let t=Ae()??new Yh({namespace:en(),shaderGenerator:qh}),r=[1,1,1],n=[1,1,1],i=[r[0]*n[0],r[1]*n[1],r[2]*n[2]],s=new Map,a=Array.from({length:r[0]},()=>Array.from({length:r[1]},()=>Array.from({length:r[2]},()=>new Map))),o=Array.from({length:i[0]},()=>Array.from({length:i[1]},()=>Array.from({length:i[2]},()=>new Map))),u=Array.from({length:i[0]},(h,p)=>Array.from({length:i[1]},(f,m)=>Array.from({length:i[2]},(x,$)=>{let z=Math.floor(p/n[0]),B=Math.floor(m/n[1]),A=Math.floor($/n[2]);return new jl(s,{private:o[p][m][$],workgroup:a[z][B][A]})})));t.pushMode(u[0][0][0]);try{return{value:Xo(t,e),buffers:s,privateVars:o,workgroupVars:a}}finally{t.popMode("simulate")}}function Rg(e,t,r,n){return new Dg(e,t,r,n)}function ga(e){let t=e;return t?.resourceType==="query-set"&&!!t[l]}var Dg=class{constructor(e,t,r,n){this.type=t,this.count=r,this.rawQuerySet=n,this.#e=e.device,this._ownQuerySet=!n,this._querySet=n||null}resourceType="query-set";#e;_querySet=null;_ownQuerySet;_destroyed=!1;_available=!0;_readBuffer=null;_resolveBuffer=null;get querySet(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");return this.rawQuerySet?this.rawQuerySet:this._querySet?this._querySet:(this._querySet=this.#e.createQuerySet({type:this.type,count:this.count}),this._querySet)}get destroyed(){return this._destroyed}get available(){return this._available}get[l](){let e=this;return{get readBuffer(){return e._readBuffer||(e._readBuffer=e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})),e._readBuffer},get resolveBuffer(){return e._resolveBuffer||(e._resolveBuffer=e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC})),e._resolveBuffer}}}$name(e){return L(this,e),this._querySet&&(this._querySet.label=e),this}resolve(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");if(!this._available)throw new Error("This QuerySet is busy resolving or reading.");let e=this.#e.createCommandEncoder();e.resolveQuerySet(this.querySet,0,this.count,this[l].resolveBuffer,0),this.#e.queue.submit([e.finish()])}async read(){if(!this._resolveBuffer)throw new Error("QuerySet must be resolved before reading.");this._available=!1;try{let e=this.#e.createCommandEncoder();e.copyBufferToBuffer(this[l].resolveBuffer,0,this[l].readBuffer,0,this.count*BigUint64Array.BYTES_PER_ELEMENT),this.#e.queue.submit([e.finish()]);let t=this[l].readBuffer;await t.mapAsync(GPUMapMode.READ);let r=new BigUint64Array(t.getMappedRange().slice());return t.unmap(),Array.from(r)}finally{this._available=!0}}destroy(){this._destroyed||(this._destroyed=!0,this._querySet&&this._ownQuerySet&&this._querySet.destroy(),this._readBuffer?.destroy(),this._resolveBuffer?.destroy(),this._readBuffer=this._resolveBuffer=null)}},ho=class{constructor(e){this._make=e}_map=new WeakMap;getOrMake(e,...t){if(this._map.has(e))return this._map.get(e);let r=this._make(e,...t);return this._map.set(e,r),r}},es=class{constructor(e,t){this.resourceType=e,this.buffer=t,this[ae]=t,this.#e=this.buffer.as(this.resourceType)}[l]=!0;[ae];#e;$name(e){return L(this[ae],e),this}write(e){this.buffer.write(e)}writePartial(e){this.buffer.writePartial(e)}read(){return this.buffer.read()}get[F](){return this.#e.$}get $(){return this.#e.$}get value(){return this.$}[_](e){return e.resolve(this.#e)}},E=e=>ah(e??0),at=e=>oh(e??0),Vr=e=>uh(e??0),Ng={f32:e=>E(e[0]),f16:e=>Vr(e[0]).x,i32:e=>at(e[0]),u32:e=>e[0]??0,bool:e=>!!e[0],vec2f:e=>D(E(e[0]),E(e[1])),vec3f:e=>ue(E(e[0]),E(e[1]),E(e[2])),vec4f:e=>I(E(e[0]),E(e[1]),E(e[2]),E(e[3])),vec2h(e){let t=Vr(e[0]);return yt(t.x,t.y)},vec3h(e){let t=Vr(e[0]),r=Vr(e[1]);return gt(t.x,t.y,r.x)},vec4h(e){let t=Vr(e[0]),r=Vr(e[1]);return wt(t.x,t.y,r.x,r.y)},vec2i:e=>q(at(e[0]),at(e[1])),vec3i:e=>Oe(at(e[0]),at(e[1]),at(e[2])),vec4i:e=>pe(at(e[0]),at(e[1]),at(e[2]),at(e[3])),vec2u:e=>Me(e[0]??0,e[1]??0),vec3u:e=>ie(e[0]??0,e[1]??0,e[2]??0),vec4u:e=>ve(e[0]??0,e[1]??0,e[2]??0,e[3]??0),"vec2<bool>":e=>pr(!!e[0],!!e[1]),"vec3<bool>":e=>dr(!!e[0],!!e[1],!!e[2]),"vec4<bool>":e=>fr(!!e[0],!!e[1],!!e[2],!!e[3]),mat2x2f:e=>Ot(E(e[0]),E(e[1]),E(e[2]),E(e[3])),mat3x3f:e=>Bt(E(e[0]),E(e[1]),E(e[2]),E(e[4]),E(e[5]),E(e[6]),E(e[8]),E(e[9]),E(e[10])),mat4x4f:e=>Y(E(e[0]),E(e[1]),E(e[2]),E(e[3]),E(e[4]),E(e[5]),E(e[6]),E(e[7]),E(e[8]),E(e[9]),E(e[10]),E(e[11]),E(e[12]),E(e[13]),E(e[14]),E(e[15]))};function Wg(e,t){let r=Ng[t.type];if(r)return r(e);if(me(t)){let n=Object.keys(t.propTypes),i=Object.values(t.propTypes),s=_s(e,i);return Object.fromEntries(n.map((a,o)=>[a,s[o]]))}if(ze(t)){let n=t.elementType,i=t.elementCount;return _s(e,Array.from({length:i},()=>n))}throw new Error(`Cannot deserialize data of type ${t.type}`)}function _s(e,t){let r=0;return t.map(n=>{if(!Qt(n))return n;let i=Math.ceil(P(n)/4),s=Wg(e.subarray(r,r+i),n);return r+=i,s})}function qg(e,t){return _s(e,t).map(cs)}function zs(e){let{indexBuffer:t,dataBuffer:r,logIdToMeta:n,options:i}=e;r.read().then(s=>{s.filter(a=>a.id).forEach(({id:a,serializedData:o})=>{let{argTypes:u,op:h}=n.get(a),p=qg(new Uint32Array(o),u);p.length===0&&p.push(""),console[h](`%c${i.messagePrefix}%c ${p[0]}`,"background: #936ff5; color: white;","color: inherit; background: none",...p.slice(1))})}),t.read().then(s=>{s>i.logCountLimit&&console.warn(`Log count limit per dispatch (${i.logCountLimit}) exceeded by ${s-i.logCountLimit} calls. Consider increasing the limit by passing appropriate options to tgpu.init().`)}),r.buffer.clear(),t.buffer.clear()}function Jh(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Performance callback requires the "timestamp-query" feature to be enabled on GPU device.');return e.timestampWrites?{...e,performanceCallback:t}:{...e,performanceCallback:t,hasAutoQuerySet:!0,timestampWrites:{querySet:r.createQuerySet("timestamp",2),beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}}function Kh(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Timestamp writes require the "timestamp-query" feature to be enabled on GPU device.');e.hasAutoQuerySet&&e.timestampWrites&&e.timestampWrites.querySet.destroy();let n={querySet:t.querySet};return t.beginningOfPassWriteIndex!==void 0&&(n.beginningOfPassWriteIndex=t.beginningOfPassWriteIndex),t.endOfPassWriteIndex!==void 0&&(n.endOfPassWriteIndex=t.endOfPassWriteIndex),{...e,hasAutoQuerySet:!1,timestampWrites:n}}function el(e,t){if(!e.timestampWrites)return{};let{querySet:r,beginningOfPassWriteIndex:n,endOfPassWriteIndex:i}=e.timestampWrites,s={querySet:ga(r)?t.unwrap(r):r};return n!==void 0&&(s.beginningOfPassWriteIndex=n),i!==void 0&&(s.endOfPassWriteIndex=i),{timestampWrites:s}}function Is({root:e,priors:t}){let r=t.timestampWrites?.querySet,n=t.performanceCallback;if(!r)throw new Error("Cannot dispatch workgroups with performance callback without a query set.");if(!ga(r))throw new Error("Performance callback with raw GPUQuerySet is not supported. Use TgpuQuerySet instead.");let i=e.device.createCommandEncoder();i.resolveQuerySet(e.unwrap(r),0,r.count,r[l].resolveBuffer,0),e.device.queue.submit([i.finish()]),e.device.queue.onSubmittedWorkDone().then(async()=>{if(!r.available)return;let s=await r.read(),a=s[t.timestampWrites?.beginningOfPassWriteIndex??0],o=s[t.timestampWrites?.endOfPassWriteIndex??1];if(a===void 0||o===void 0)throw new Error("QuerySet did not return valid timestamps.");await n(a,o)})}function Hg(e,t,r){return new Yg(new Xg(e,t,r),{})}var Yg=class fn{constructor(t,r){this._core=t,this._priors=r,this[l]={get rawPipeline(){return t.unwrap().pipeline},get priors(){return r},get branch(){return t.branch}},this[ae]=t}[l];resourceType="compute-pipeline";[ae];[_](t){return t.resolve(this._core)}toString(){return`computePipeline:${v(this)??"<unnamed>"}`}get rawPipeline(){return this._core.unwrap().pipeline}with(t,r){return xi(t)?new fn(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t.layout,t]])}):new fn(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t,r]])})}withPerformanceCallback(t){let r=Jh(this._priors,t,this._core.branch);return new fn(this._core,r)}withTimestampWrites(t){let r=Kh(this._priors,t,this._core.branch);return new fn(this._core,r)}dispatchWorkgroups(t,r,n){let i=this._core.unwrap(),{branch:s}=this._core,a={label:v(this._core)??"<unnamed>",...el(this._priors,s)},o=s.device.createCommandEncoder(),u=o.beginComputePass(a);u.setPipeline(i.pipeline);let h=new Set(i.usedBindGroupLayouts);if(i.usedBindGroupLayouts.forEach((p,f)=>{if(i.catchall&&f===i.catchall[0])u.setBindGroup(f,s.unwrap(i.catchall[1])),h.delete(p);else{let m=this._priors.bindGroupLayoutMap?.get(p);m!==void 0&&(h.delete(p),u.setBindGroup(f,s.unwrap(m)))}}),h.size>0)throw new As(h);u.dispatchWorkgroups(t,r,n),u.end(),s.device.queue.submit([o.finish()]),i.logResources&&zs(i.logResources),this._priors.performanceCallback&&Is({root:s,priors:this._priors})}$name(t){return L(this._core,t),this}},Xg=class{constructor(e,t,r){this.branch=e,this._slotBindings=t,this._entryFn=r}[l]=!0;_memo;[_](e){return e.withSlots(this._slotBindings,()=>(e.resolve(this._entryFn),y("",te,"runtime")))}toString(){return"computePipelineCore"}unwrap(){if(this._memo===void 0){let e=this.branch.device,t=ma.filter(h=>this.branch.enabledFeatures.has(ch[h])),r,n=en({names:this.branch.nameRegistrySetting});r=Di(this,{namespace:n,enableExtensions:t,shaderGenerator:this.branch.shaderGenerator,root:this.branch});let{code:i,usedBindGroupLayouts:s,catchall:a,logResources:o}=r;a!==void 0&&s[a[0]]?.$name(`${v(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let u=e.createShaderModule({label:`${v(this)??"<unnamed>"} - Shader`,code:i});this._memo={pipeline:e.createComputePipeline({label:v(this)??"<unnamed>",layout:e.createPipelineLayout({label:`${v(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:s.map(h=>this.branch.unwrap(h))}),compute:{module:u}}),usedBindGroupLayouts:s,catchall:a,logResources:o}}return this._memo}};function lo(e,t="vertex"){return new Zg(e,t)}function tl(e){return e?.resourceType==="vertex-layout"}var Ss=Symbol("defaultAttribEntry");function ii(e,t,r,n,i){if(Ke(t)||tt(t)){let s=Ht(t);return s!==void 0&&(n[i??Ss]=s),ii(e,t.inner,Pe(r,De(t)),n)}if(me(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Pe(s,K(u));let h=[o,ii(e,u,s,n,o)];return s+=P(u),h}))}if(et(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Pe(s,De(u));let h=[o,ii(e,u,s,n,o)];return s+=P(u),h}))}if("type"in t&&typeof t.type=="string"){if(Po.includes(t.type))return{_layout:e,format:t.type,offset:r};let s=Tl[t.type];if(s)return{_layout:e,format:s,offset:r}}throw new Error(`Unsupported data used in vertex layout: ${String(t)}`)}var Zg=class{constructor(e,t){this.schemaForCount=e,this.stepMode=t;let r=e(0);this.stride=Pe(P(r.elementType),K(r)),this.attrib=ii(this,r.elementType,0,this._customLocationMap)}[l]=!0;resourceType="vertex-layout";stride;attrib;_customLocationMap={};get vertexLayout(){if(this._customLocationMap[Ss]!==void 0){if(typeof this.attrib.format!="string"||typeof this.attrib.offset!="number")throw new Error("Single attribute vertex layouts must have a format and offset.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[{format:this.attrib.format,offset:this.attrib.offset,shaderLocation:this._customLocationMap[Ss]}]}}if(!Object.keys(this.attrib).every(e=>this._customLocationMap[e]!==void 0))throw new Error("All attributes must have custom locations in order to unwrap a vertex layout.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[...Object.entries(this.attrib).map(([e,t])=>({format:t.format,offset:t.offset,shaderLocation:this._customLocationMap[e]}))]}}$name(e){return L(this,e),this}};function Qg(e){return typeof e?.loadOp=="string"}function Jg(e,t){if(Xr(e)){if(Pt(e))return[];if(!Qg(t))throw new Error("Expected a single color attachment, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(Pt(i))continue;let s=t[n];if(!s)throw new Error(`A color attachment by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function Kg(e){return typeof e?.format=="string"}function ew(e,t){if(Xr(e)){if(Uo(e))return[];if(e.type==="decorated")return[];if(!Kg(t))throw new Error("Expected a single color target configuration, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(Pt(i))continue;let s=t[n];if(!s)throw new Error(`A color target by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function rl(e){return new tw(new rw(e),{})}var tw=class Xe{[l];resourceType="render-pipeline";[ae];hasIndexBuffer=!1;constructor(t,r){this[l]={core:t,priors:r,branch:t.options.branch},this[ae]=t}[_](t){return t.resolve(this[l].core)}toString(){return`renderPipeline:${v(this)??"<unnamed>"}`}$name(t){return L(this[l].core,t),this}with(t,r){let n=this[l];if(xi(t))return new Xe(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t.layout,t]])});if(Ph(t))return new Xe(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t,r]])});if(tl(t))return new Xe(n.core,{...n.priors,vertexLayoutMap:new Map([...n.priors.vertexLayoutMap??[],[t,r]])});throw new Error("Unsupported value passed into .with()")}withPerformanceCallback(t){let r=this[l],n=Jh(r.priors,t,r.core.options.branch);return new Xe(r.core,n)}withTimestampWrites(t){let r=this[l],n=Kh(r.priors,t,r.core.options.branch);return new Xe(r.core,n)}withColorAttachment(t){let r=this[l];return new Xe(r.core,{...r.priors,colorAttachment:t})}withDepthStencilAttachment(t){let r=this[l];return new Xe(r.core,{...r.priors,depthStencilAttachment:t})}withStencilReference(t){let r=this[l];return new Xe(r.core,{...r.priors,stencilReference:t})}withIndexBuffer(t,r,n,i){let s=this[l];if(ls(t)){if(typeof r!="string")throw new Error("If a GPUBuffer is passed, indexFormat must be provided.");return new Xe(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:r,offsetBytes:n,sizeBytes:i}})}let a={u32:"uint32",u16:"uint16"},o=t.dataType.elementType;return new Xe(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:a[o.type],offsetBytes:r!==void 0?r*P(o):void 0,sizeBytes:i!==void 0?i*P(o):void 0}})}setupRenderPass(t){let r=this[l],n=r.core.unwrap(),{branch:i,fragmentFn:s}=r.core.options,a=s?Jg(s.shell.out,r.priors.colorAttachment??{}).map(m=>_n(m.view)?{...m,view:i.unwrap(m.view).createView()}:zn(m.view)?{...m,view:i.unwrap(m.view)}:m):[null],o={label:v(r.core)??"<unnamed>",colorAttachments:a,...el(r.priors,i)},u=r.priors.depthStencilAttachment;if(u!==void 0){let m=_n(u.view)?i.unwrap(u.view).createView():zn(u.view)?i.unwrap(u.view):u.view;o.depthStencilAttachment={...u,view:m}}let h=t.beginRenderPass(o);h.setPipeline(n.pipeline),r.priors.stencilReference!==void 0&&h.setStencilReference(r.priors.stencilReference);let p=new Set(n.usedBindGroupLayouts);n.usedBindGroupLayouts.forEach((m,x)=>{if(n.catchall&&x===n.catchall[0])h.setBindGroup(x,i.unwrap(n.catchall[1])),p.delete(m);else{let $=r.priors.bindGroupLayoutMap?.get(m);$!==void 0&&(p.delete(m),h.setBindGroup(x,i.unwrap($)))}});let f=new Set(r.core.usedVertexLayouts);if(r.core.usedVertexLayouts.forEach((m,x)=>{let $=r.priors.vertexLayoutMap?.get(m);$&&(f.delete(m),h.setVertexBuffer(x,i.unwrap($)))}),p.size>0)throw new As(p);if(f.size>0)throw new Go(f);return h}draw(t,r,n,i){let s=this[l],{branch:a}=s.core.options,{logResources:o}=s.core.unwrap(),u=a.device.createCommandEncoder(),h=this.setupRenderPass(u);h.draw(t,r,n,i),h.end(),a.device.queue.submit([u.finish()]),o&&zs(o),s.priors.performanceCallback&&Is({root:a,priors:s.priors})}drawIndexed(t,r,n,i,s){let a=this[l];if(!a.priors.indexBuffer)throw new Error("No index buffer set for this render pipeline.");let{logResources:o}=a.core.unwrap(),{branch:u}=a.core.options,{buffer:h,indexFormat:p,offsetBytes:f,sizeBytes:m}=a.priors.indexBuffer,x=u.device.createCommandEncoder(),$=this.setupRenderPass(x);ls(h)?$.setIndexBuffer(h,p,f,m):$.setIndexBuffer(u.unwrap(h),p,f,m),$.drawIndexed(t,r,n,i,s),$.end(),u.device.queue.submit([x.finish()]),o&&zs(o),a.priors.performanceCallback&&Is({root:u,priors:a.priors})}},rw=class{constructor(e){this.options=e;let t=Vy(e.vertexFn.shell.in??{},e.vertexAttribs);this._vertexBufferLayouts=t.bufferDefinitions,this.usedVertexLayouts=t.usedVertexLayouts,this._targets=e.fragmentFn&&e.targets?ew(e.fragmentFn.shell.out,e.targets):[null]}[l]=!0;usedVertexLayouts;_memo;_vertexBufferLayouts;_targets;[_](e){let{vertexFn:t,fragmentFn:r,slotBindings:n}=this.options,i=nw(t.shell.out,r?.shell.in,v(t)??"<unnamed>",v(r)??"<unnamed>");return e.withVaryingLocations(i,()=>e.withSlots(n,()=>(e.resolve(t),r&&e.resolve(r),y("",te,"runtime"))))}toString(){return"renderPipelineCore"}unwrap(){if(this._memo===void 0){let{branch:e,primitiveState:t,depthStencilState:r,multisampleState:n}=this.options,i=e.device,s=ma.filter(z=>e.enabledFeatures.has(ch[z])),a,o=en({names:e.nameRegistrySetting});a=Di(this,{namespace:o,enableExtensions:s,shaderGenerator:e.shaderGenerator,root:e});let{code:u,usedBindGroupLayouts:h,catchall:p,logResources:f}=a;p!==void 0&&h[p[0]]?.$name(`${v(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let m=i.createShaderModule({label:`${v(this)??"<unnamed>"} - Shader`,code:u}),x={layout:i.createPipelineLayout({label:`${v(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:h.map(z=>e.unwrap(z))}),vertex:{module:m,buffers:this._vertexBufferLayouts}},$=v(this);$!==void 0&&(x.label=$),this.options.fragmentFn&&(x.fragment={module:m,targets:this._targets}),t&&(Qt(t.stripIndexFormat)?x.primitive={...t,stripIndexFormat:{u32:"uint32",u16:"uint16"}[t.stripIndexFormat.type]}:x.primitive=t),r&&(x.depthStencil=r),n&&(x.multisample=n),this._memo={pipeline:i.createRenderPipeline(x),usedBindGroupLayouts:h,catchall:p,logResources:f}}return this._memo}};function nw(e,t,r,n){let i={},s=new Set;function a(u,h){i[u]=h,s.add(h)}for(let[u,h]of Object.entries(e)){let p=Ht(h);p!==void 0&&a(u,p)}for(let[u,h]of Object.entries(t??{})){let p=Ht(h);p!==void 0&&(i[u]===void 0?a(u,p):i[u]!==p&&console.warn(`Mismatched location between vertexFn (${r}) output (${i[u]}) and fragmentFn (${n}) input (${p}) for the key "${u}", using the location set on vertex output.`))}let o=0;for(let u of Object.keys(e??{}))if(!(Pt(e[u])||i[u]!==void 0)){for(;s.has(o);)o++;a(u,o)}return i}function iw(e){if(e.includes(0))throw new Error("Size and workgroupSize cannot contain zeroes.");return ie(e[0]??1,e[1]??1,e[2]??1)}var sw=[ie(1,1,1),ie(256,1,1),ie(16,16,1),ie(8,8,4)],aw=class nl{#e;#t;#r;#n;#i;constructor(t,r,n,i){this.#e=t,this.#t=r,this.#r=n,this.#n=i,this.#i=ie()}with(t){return new nl(this.#e,this.#t.with(t),this.#r,this.#n)}dispatchThreads(...t){let r=iw(t),n=eh(ue(r).div(ue(this.#n)));hh(r,this.#i)||(this.#i=r,this.#r.write(r)),this.#t.dispatchWorkgroups(n.x,n.y,n.z)}get pipeline(){return this.#t}get sizeUniform(){return this.#r}},ow=class Es{constructor(t,r){this._getRoot=t,this._slotBindings=r}with(t,r){return new Es(this._getRoot,[...this._slotBindings,[Si(t)?t.slot:t,r]])}withCompute(t){return new uw(this._getRoot(),this._slotBindings,t)}createGuardedComputePipeline(t){let r=this._getRoot();if(t.length>=4)throw new Error("Guarded compute callback only supports up to three dimensions.");let n=sw[t.length],i=C([b,b,b])(t),s=r.createUniform(ie),a=dh({workgroupSize:n,in:{id:wu.globalInvocationId}})`{
  if (any(in.id >= sizeUniform)) {
    return;
  }
  wrappedCallback(in.id.x, in.id.y, in.id.z);
}`.$uses({sizeUniform:s,wrappedCallback:i}),o=this.withCompute(a).createPipeline();return new aw(r,o,s,n)}withVertex(t,r){return new hw({branch:this._getRoot(),primitiveState:void 0,depthStencilState:void 0,slotBindings:this._slotBindings,vertexFn:t,vertexAttribs:r??{},multisampleState:void 0})}pipe(t){let r=t(new vh([]));return new Es(this._getRoot,[...this._slotBindings,...r.bindings])}},uw=class{constructor(e,t,r){this._root=e,this._slotBindings=t,this._entryFn=r}createPipeline(){return Hg(this._root,this._slotBindings,this._entryFn)}},hw=class si{constructor(t){this._options=t}withFragment(t,r,n){return dt(typeof t!="string"),dt(r===void 0||typeof r!="string"),new lw({...this._options,fragmentFn:t,targets:r??{}})}withPrimitive(t){return new si({...this._options,primitiveState:t})}withDepthStencil(t){return new si({...this._options,depthStencilState:t})}withMultisample(t){return new si({...this._options,multisampleState:t})}createPipeline(){return rl({...this._options,fragmentFn:null,targets:null})}},lw=class ai{constructor(t){this._options=t}withPrimitive(t){return new ai({...this._options,primitiveState:t})}withDepthStencil(t){return new ai({...this._options,depthStencilState:t})}withMultisample(t){return new ai({...this._options,multisampleState:t})}createPipeline(){return rl(this._options)}},il=class extends ow{constructor(t,r,n,i,s){super(()=>this,[]),this.device=t,this.nameRegistrySetting=r,this._ownDevice=n,this.shaderGenerator=s,this["~unstable"]=this,this[l]={logOptions:i}}"~unstable";_unwrappedBindGroupLayouts=new ho(t=>t.unwrap(this));_unwrappedBindGroups=new ho(t=>t.unwrap(this));[l];get enabledFeatures(){return new Set(this.device.features)}createBuffer(t,r){return Kn(this,t,r)}createUniform(t,r){let n=Kn(this,t,r).$usage("uniform");return new es("uniform",n)}createMutable(t,r){let n=Kn(this,t,r).$usage("storage");return new es("mutable",n)}createReadonly(t,r){let n=Kn(this,t,r).$usage("storage");return new es("readonly",n)}createQuerySet(t,r,n){return Rg(this,t,r,n)}createBindGroup(t,r){return new Oh(t,r)}destroy(){ag(this.device),this._ownDevice&&this.device.destroy()}createTexture(t){return lg(t,this)}createSampler(t){return Qy(t,this)}createComparisonSampler(t){return Jy(t,this)}unwrap(t){if(Xh(t))return t[l].rawPipeline;if(Zh(t))return t[l].core.unwrap().pipeline;if(Ph(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(xi(t))return this._unwrappedBindGroups.getOrMake(t);if($n(t))return t.buffer;if(_n(t))return t[l].unwrap();if(zn(t)){if(!t[l].unwrap)throw new Error("Cannot unwrap laid-out texture view as it has no underlying resource.");return t[l].unwrap()}if(tl(t))return t.vertexLayout;if(zh(t)||Ih(t)){if(t[l].unwrap)return t[l].unwrap();throw new Error("Cannot unwrap laid-out sampler.")}if(ga(t))return t.querySet;throw new Error(`Unknown resource type: ${t}`)}beginRenderPass(t,r){let n=this.device.createCommandEncoder(),i=n.beginRenderPass(t),s=new Map,a=new Map,o,u=()=>{if(!o)throw new Error("Cannot draw without a call to pass.setPipeline");let{core:h,priors:p}=o[l],f=h.unwrap();i.setPipeline(f.pipeline);let m=new Set(f.usedBindGroupLayouts);f.usedBindGroupLayouts.forEach(($,z)=>{if(f.catchall&&z===f.catchall[0])i.setBindGroup(z,this.unwrap(f.catchall[1])),m.delete($);else{let B=p.bindGroupLayoutMap?.get($)??s.get($);B!==void 0&&(m.delete($),xi(B)?i.setBindGroup(z,this.unwrap(B)):i.setBindGroup(z,B))}});let x=new Set;if(h.usedVertexLayouts.forEach(($,z)=>{let B=p.vertexLayoutMap?.get($),A=B?{buffer:B,offset:void 0,size:void 0}:a.get($);!A||!A.buffer?x.add($):$n(A.buffer)?i.setVertexBuffer(z,this.unwrap(A.buffer),A.offset,A.size):i.setVertexBuffer(z,A.buffer,A.offset,A.size)}),m.size>0)throw new As(m);if(x.size>0)throw new Go(x)};r({setViewport(...h){i.setViewport(...h)},setScissorRect(...h){i.setScissorRect(...h)},setBlendConstant(...h){i.setBlendConstant(...h)},setStencilReference(...h){i.setStencilReference(...h)},beginOcclusionQuery(...h){i.beginOcclusionQuery(...h)},endOcclusionQuery(...h){i.endOcclusionQuery(...h)},executeBundles(...h){i.executeBundles(...h)},setPipeline(h){o=h},setIndexBuffer:(h,p,f,m)=>{$n(h)?i.setIndexBuffer(this.unwrap(h),p,f,m):i.setIndexBuffer(h,p,f,m)},setVertexBuffer(h,p,f,m){a.set(h,{buffer:p,offset:f,size:m})},setBindGroup(h,p){s.set(h,p)},draw(h,p,f,m){u(),i.draw(h,p,f,m)},drawIndexed(...h){u(),i.drawIndexed(...h)},drawIndirect(...h){u(),i.drawIndirect(...h)},drawIndexedIndirect(...h){u(),i.drawIndexedIndirect(...h)}}),i.end(),this.device.queue.submit([n.finish()])}flush(){console.warn("flush() has been deprecated, and has no effect.")}};async function cw(e){let{adapter:t,device:r,unstable_names:n="strict",unstable_logOptions:i}=e??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let s=await navigator.gpu.requestAdapter(t);if(!s)throw new Error("Could not find a compatible GPU");let a=[];for(let u of r?.requiredFeatures??[]){if(!s.features.has(u))throw new Error(`Requested feature "${u}" is not supported by the adapter.`);a.push(u)}for(let u of r?.optionalFeatures??[])s.features.has(u)?a.push(u):console.warn(`Optional feature "${u}" is not supported by the adapter.`);let o=await s.requestDevice({...r,requiredFeatures:a});return new il(o,n,!0,i??{},e?.shaderGenerator)}function pw(e){let{device:t,unstable_names:r="strict",unstable_logOptions:n}=e??{};return new il(t,r,!1,n??{},e?.shaderGenerator)}function dw(e,t){return new fw(e,t)}var fw=class{constructor(e,t=void 0){this.schema=e,this.defaultValue=t,this.slot=vi(t),this[ae]=this.slot}[l]=!0;[ae];resourceType="accessor";slot;get[F](){return new Proxy({[l]:!0,[ke]:this.#e(),[_]:e=>e.resolve(this),toString:()=>`accessor:${v(this)??"<unnamed>"}.$`},We)}#e(){let e=Ae(),t=Li(e.unwrap(this.slot));if(fh(t))return t[l].gpuImpl();let r=Ei(t);if(r)return r;e.pushMode(new kn);try{let n=Xt(this.schema,t);return y(n,this.schema,"constant")}finally{e.popMode("normal")}}$name(e){return this.slot.$name(e),this}toString(){return`accessor:${v(this)??"<unnamed>"}`}get value(){if(nt())return this[F];throw new Error("`tgpu.accessor` relies on GPU resources and cannot be accessed outside of a compute dispatch or draw call")}get $(){return this.value}[_](e){let t=this.#e();return y(e.resolve(t.value,t.dataType).value,t.dataType,t.origin)}};function mw(e){return gw(e)}function yw([e,t]){return`${v(e)??"<unnamed>"}=${t}`}function gw(e){if(Ae())throw new Error("Cannot create tgpu.derived objects at the resolution stage.");return{[l]:!0,resourceType:"derived","~compute":e,get[F](){let t=Ae();if(!t)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return Li(t.unwrap(this))},get value(){return this[F]},get $(){return this.value},with(t,r){return sl(this,[[t,r]])},toString(){return"derived"}}}function sl(e,t){return{[l]:!0,resourceType:"derived","~compute"(){throw new Error("'~compute' should never be read on bound derived items.")},[ar]:{inner:e,pairs:t},get[F](){let r=Ae();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return Li(r.unwrap(this))},get value(){return this[F]},get $(){return this.value},with(r,n){return sl(e,[...t,[r,n]])},toString(){return`derived[${t.map(yw).join(", ")}]`}}}var ww={fn:C,bindGroupLayout:Vh,vertexLayout:lo,slot:vi,init:cw,initFromDevice:pw,resolve:Fg,resolveWithContext:Ts,privateVar:$i,workgroupVar:so,const:ws,"~unstable":{fn:C,fragmentFn:Ty,vertexFn:vp,computeFn:dh,comptime:Yt,vertexLayout:lo,namespace:en,derived:mw,slot:vi,accessor:dw,privateVar:$i,workgroupVar:so,const:ws,declare:yy,rawCodeSnippet:$y,simulate:Lg}},al=ww,xw=Yt(((e,t)=>t===void 0?r=>co(e,r):co(e,t))).$name("disarrayOf");function co(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Disarray schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>Xt(e,n?.[s]))};if(Object.setPrototypeOf(r,vw),r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create disarray schema with invalid element count: ${t}.`);return r.elementCount=t,r}var vw={[l]:!0,type:"disarray",toString(){return`disarrayOf(${this.elementType}, ${this.elementCount})`}};function $w(e){let t=r=>Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Xt(i,r?.[n])]));return Object.setPrototypeOf(t,bw),t.propTypes=e,t}var bw={[l]:!0,type:"unstruct",$name(e){return L(this,e),this},toString(){return`unstruct:${v(this)??"<unnamed>"}`}};function Ar(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if(me(e)&&me(t)||et(e)&&et(t)){let r=e.propTypes,n=t.propTypes,i=Object.keys(r),s=Object.keys(n);if(i.length!==s.length)return!1;for(let a=0;a<i.length;a++){let o=i[a],u=s[a];if(o!==u||!o||!u||!Ar(r[o],n[u]))return!1}return!0}if(ze(e)&&ze(t)||Ut(e)&&Ut(t))return e.elementCount===t.elementCount&&Ar(e.elementType,t.elementType);if(Je(e)&&Je(t))return e.addressSpace===t.addressSpace&&e.access===t.access&&Ar(e.inner,t.inner);if(li(e)&&li(t))return Ar(e.inner,t.inner);if(Ke(e)&&Ke(t)||tt(e)&&tt(t)){if(!Ar(e.inner,t.inner)||e.attribs.length!==t.attribs.length)return!1;let r=s=>{let a=s;return`${a.type}(${(a.params??[]).join(",")})`},n=e.attribs.map(r),i=t.attribs.map(r);for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1}return!0}function yr(e,t){let r=e.prototype,n=fs[t][l].jsImpl;r[t]=function(i){return n(this,i)}}yr(cr,"add");yr(cr,"sub");yr(cr,"mul");yr(cr,"div");yr(Qr,"add");yr(Qr,"sub");yr(Qr,"mul");const Tw=Object.freeze(Object.defineProperty({__proto__:null,Void:te,align:rp,alignmentOf:Zc,arrayOf:Tn,atomic:ju,bool:G,builtin:wu,comparisonSampler:la,deepEqual:Ar,disarrayOf:xw,f16:oe,f32:g,float16:Mc,float16x2:kc,float16x4:Uc,float32:Vc,float32x2:Pc,float32x3:Ac,float32x4:Oc,formatToWGSLType:Vt,i32:V,interpolate:ip,invariant:sp,isAlignAttrib:ks,isAtomic:li,isBuiltin:Pt,isBuiltinAttrib:Vs,isData:Xr,isDecorated:Ke,isDisarray:Ut,isInterpolateAttrib:xl,isLocationAttrib:ko,isLooseData:Yr,isLooseDecorated:tt,isPackedData:mu,isPtr:Je,isSizeAttrib:Us,isUnstruct:et,isWgslArray:ze,isWgslData:Qt,isWgslStruct:me,location:yi,mat2x2f:Ot,mat3x3f:Bt,mat4x4f:Y,matToArray:Mp,packedFormats:ta,ptrFn:Bs,ptrHandle:Ol,ptrPrivate:Ul,ptrStorage:Pl,ptrUniform:Al,ptrWorkgroup:Vl,ref:Rl,sampler:ha,sint16:vc,sint16x2:$c,sint16x4:bc,sint32:Gc,sint32x2:Lc,sint32x3:Rc,sint32x4:Dc,sint8:uc,sint8x2:hc,sint8x4:lc,size:np,sizeOf:tp,snorm16:Ic,snorm16x2:Sc,snorm16x4:Ec,snorm8:fc,snorm8x2:mc,snorm8x4:yc,struct:ki,texture1d:Eu,texture2d:aa,texture2dArray:ku,texture3d:Pu,textureCube:Uu,textureCubeArray:Vu,textureDepth2d:Dp,textureDepth2dArray:Wp,textureDepthCube:qp,textureDepthCubeArray:Hp,textureDepthMultisampled2d:Np,textureExternal:Cu,textureMultisampled2d:Mu,textureStorage1d:Au,textureStorage2d:oa,textureStorage2dArray:Ou,textureStorage3d:Bu,u16:Zl,u32:b,uint16:gc,uint16x2:wc,uint16x4:xc,uint32:Bc,uint32x2:Cc,uint32x3:Fc,uint32x4:jc,uint8:sc,uint8x2:ac,uint8x4:oc,unorm10_10_10_2:Nc,unorm16:Tc,unorm16x2:_c,unorm16x4:zc,unorm8:cc,unorm8x2:pc,unorm8x4:dc,unorm8x4_bgra:Wc,unstruct:$w,vec2b:pr,vec2f:D,vec2h:yt,vec2i:q,vec2u:Me,vec3b:dr,vec3f:ue,vec3h:gt,vec3i:Oe,vec3u:ie,vec4b:fr,vec4f:I,vec4h:wt,vec4i:pe,vec4u:ve},Symbol.toStringTag,{value:"Module"}));var _w=d({name:"discard",normalImpl:"`discard` relies on GPU resources and cannot be executed outside of a draw call",signature:{argTypes:[],returnType:te},codegenImpl:()=>"discard;"}),Rn=Fn[l].jsImpl,zw=Vi[l].jsImpl,Iw=Vi[l].gpuImpl,Sw=Pi[l].jsImpl,Ew=Pi[l].gpuImpl,Mw=Ai[l].jsImpl,kw=Ai[l].gpuImpl,Uw=Oi[l].jsImpl,Vw=Oi[l].gpuImpl,Pw=Bi[l].jsImpl,Aw=Bi[l].gpuImpl,Ow=d({name:"translate4",normalImpl:(e,t)=>Rn(zw(t),e),signature:{argTypes:[Y,ue],returnType:Y},codegenImpl:(e,t)=>c`(${Iw(t)} * ${e})`}),Bw=d({name:"scale4",normalImpl:(e,t)=>Rn(Sw(t),e),signature:{argTypes:[Y,ue],returnType:Y},codegenImpl:(e,t)=>c`(${Ew(t)} * ${e})`}),wa={argTypes:[Y,g],returnType:Y},Cw=d({name:"rotateX4",normalImpl:(e,t)=>Rn(Mw(t),e),signature:wa,codegenImpl:(e,t)=>c`(${kw(t)} * ${e})`}),Fw=d({name:"rotateY4",normalImpl:(e,t)=>Rn(Uw(t),e),signature:wa,codegenImpl:(e,t)=>c`(${Vw(t)} * ${e})`}),jw=d({name:"rotateZ4",normalImpl:(e,t)=>Rn(Pw(t),e),signature:wa,codegenImpl:(e,t)=>c`(${Aw(t)} * ${e})`}),Gw=d({name:"workgroupBarrier",normalImpl:"workgroupBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:te},codegenImpl:()=>"workgroupBarrier()"}),Lw=d({name:"storageBarrier",normalImpl:"storageBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:te},codegenImpl:()=>"storageBarrier()"}),Rw=d({name:"textureBarrier",normalImpl:"textureBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:te},codegenImpl:()=>"textureBarrier()"}),Ft="Atomic operations are not supported outside of CODEGEN mode.",Dw=d({name:"atomicLoad",normalImpl:Ft,signature:e=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Zt(e)}`);return{argTypes:[e],returnType:e.inner}},codegenImpl:e=>c`atomicLoad(&${e})`}),Nw=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Zt(e)}`);return{argTypes:[e,e.inner.type==="u32"?b:V],returnType:te}},gr=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Zt(e)}`);let r=e.inner.type==="u32"?b:V;return{argTypes:[e,r],returnType:r}},Ww=d({name:"atomicStore",normalImpl:Ft,signature:Nw,codegenImpl:(e,t)=>c`atomicStore(&${e}, ${t})`}),qw=d({name:"atomicAdd",normalImpl:Ft,signature:gr,codegenImpl:(e,t)=>c`atomicAdd(&${e}, ${t})`}),Hw=d({name:"atomicSub",normalImpl:Ft,signature:gr,codegenImpl:(e,t)=>c`atomicSub(&${e}, ${t})`}),Yw=d({name:"atomicMax",normalImpl:Ft,signature:gr,codegenImpl:(e,t)=>c`atomicMax(&${e}, ${t})`}),Xw=d({name:"atomicMin",normalImpl:Ft,signature:gr,codegenImpl:(e,t)=>c`atomicMin(&${e}, ${t})`}),Zw=d({name:"atomicAnd",normalImpl:Ft,signature:gr,codegenImpl:(e,t)=>c`atomicAnd(&${e}, ${t})`}),Qw=d({name:"atomicOr",normalImpl:Ft,signature:gr,codegenImpl:(e,t)=>c`atomicOr(&${e}, ${t})`}),Jw=d({name:"atomicXor",normalImpl:Ft,signature:gr,codegenImpl:(e,t)=>c`atomicXor(&${e}, ${t})`}),jt="Derivative builtins are not allowed on the CPU",Kw=d({name:"dpdx",normalImpl:jt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdx(${e})`}),ex=d({name:"dpdxCoarse",normalImpl:jt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxCoarse(${e})`}),tx=d({name:"dpdxFine",normalImpl:jt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxFine(${e})`}),rx=d({name:"dpdy",normalImpl:jt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdy(${e})`}),nx=d({name:"dpdyCoarse",normalImpl:jt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyCoarse(${e})`}),ix=d({name:"dpdyFine",normalImpl:jt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyFine(${e})`}),sx=d({name:"fwidth",normalImpl:jt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidth(${e})`}),ax=d({name:"fwidthCoarse",normalImpl:jt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthCoarse(${e})`}),ox=d({name:"fwidthFine",normalImpl:jt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthFine(${e})`}),po=e=>Je(e)&&ze(e.inner)?e.inner.elementCount:0,ux=d({name:"arrayLength",signature:e=>{let t=Je(e)?e:Bs(e);return{argTypes:[t],returnType:po(t)>0?Un:b}},normalImpl:e=>Qo(e)?e.$.length:e.length,codegenImpl(e){let t=po(e.dataType);return t>0?String(t):c`arrayLength(${e})`}});function hx(e,t,r,n,i){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var lx=d({name:"textureSample",normalImpl:hx,codegenImpl:(...e)=>c`textureSample(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?g:I}}});function cx(e,t,r,n,i,s){throw new Error("Texture sampling with bias relies on GPU resources and cannot be executed outside of a draw call")}var px=d({name:"textureSampleBias",normalImpl:cx,codegenImpl:(...e)=>c`textureSampleBias(${e})`,signature:(...e)=>({argTypes:e,returnType:I})});function dx(e,t,r,n,i,s){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var fx=d({name:"textureSampleLevel",normalImpl:dx,codegenImpl:(...e)=>c`textureSampleLevel(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?g:I}}});function mx(e,t,r){throw new Error("`textureLoad` relies on GPU resources and cannot be executed outside of a draw call")}var Tt=d({name:"textureLoad",normalImpl:mx,codegenImpl:(...e)=>c`textureLoad(${e})`,signature:(...e)=>{let t=e[0];if(Fu(t)){let i=t.type.startsWith("texture_depth"),s=t.sampleType;return{argTypes:e,returnType:i?g:s.type==="f32"?I:s.type==="u32"?ve:pe}}let r=t.format,n=Ln(r).vectorType;return{argTypes:e,returnType:n}}});function yx(e,t,r,n){throw new Error("`textureStore` relies on GPU resources and cannot be executed outside of a draw call")}var oi=d({name:"textureStore",normalImpl:yx,codegenImpl:(...e)=>c`textureStore(${e})`,signature:(...e)=>({argTypes:e,returnType:te})});function gx(e,t){throw new Error("`textureDimensions` relies on GPU resources and cannot be executed outside of a draw call")}var wx=d({name:"textureDimensions",normalImpl:gx,codegenImpl:(...e)=>c`textureDimensions(${e})`,signature:(...e)=>{let t=e[0].dimension;return t==="1d"?{argTypes:e,returnType:b}:t==="3d"?{argTypes:e,returnType:ie}:{argTypes:e,returnType:Me}}});function xx(e,t,r,n,i,s){throw new Error("Texture comparison sampling relies on GPU resources and cannot be executed outside of a draw call")}var vx=d({name:"textureSampleCompare",normalImpl:xx,codegenImpl:(...e)=>c`textureSampleCompare(${e})`,signature:(...e)=>({argTypes:e,returnType:g})});function $x(e,t,r){throw new Error("Texture sampling with base clamp to edge is not supported outside of GPU mode.")}var bx=d({name:"textureSampleBaseClampToEdge",normalImpl:$x,codegenImpl:(...e)=>c`textureSampleBaseClampToEdge(${e})`,signature:(...e)=>({argTypes:e,returnType:I})}),he="Subgroup operations can only be used in the GPU context.",Tx=d({name:"subgroupAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupAdd(${e})`}),_x=d({name:"subgroupExclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupExclusiveAdd(${e})`}),zx=d({name:"subgroupInclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupInclusiveAdd(${e})`}),Ix=d({name:"subgroupAll",signature:{argTypes:[G],returnType:G},normalImpl:he,codegenImpl:e=>c`subgroupAll(${e})`}),Sx=d({name:"subgroupAnd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupAnd(${e})`}),Ex=d({name:"subgroupAny",signature:{argTypes:[G],returnType:G},normalImpl:he,codegenImpl:e=>c`subgroupAny(${e})`}),Mx=d({name:"subgroupBallot",signature:{argTypes:[G],returnType:ve},normalImpl:he,codegenImpl:e=>c`subgroupBallot(${e})`}),kx=d({name:"subgroupBroadcast",signature:(...e)=>{let t=ye([e[1]],[V,b]);if(!t)throw new Error(`subgroupBroadcast's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:he,codegenImpl:(e,t)=>c`subgroupBroadcast(${e}, ${t})`}),Ux=d({name:"subgroupBroadcastFirst",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupBroadcastFirst(${e})`}),Vx=d({name:"subgroupElect",signature:{argTypes:[],returnType:G},normalImpl:he,codegenImpl:()=>c`subgroupElect()`}),Px=d({name:"subgroupMax",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupMax(${e})`}),Ax=d({name:"subgroupMin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupMin(${e})`}),Ox=d({name:"subgroupMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupMul(${e})`}),Bx=d({name:"subgroupExclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupExclusiveMul(${e})`}),Cx=d({name:"subgroupInclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupInclusiveMul(${e})`}),Fx=d({name:"subgroupOr",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupOr(${e})`}),jx=d({name:"subgroupShuffle",signature:(...e)=>{let t=ye([e[1]],[V,b]);if(!t)throw new Error(`subgroupShuffle's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:he,codegenImpl:(e,t)=>c`subgroupShuffle(${e}, ${t})`}),Gx=d({name:"subgroupShuffleDown",signature:(...e)=>{let t=ye([e[1]],[b]);if(!t)throw new Error(`subgroupShuffleDown's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:he,codegenImpl:(e,t)=>c`subgroupShuffleDown(${e}, ${t})`}),Lx=d({name:"subgroupShuffleUp",signature:(...e)=>{let t=ye([e[1]],[b]);if(!t)throw new Error(`subgroupShuffleUp's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:he,codegenImpl:(e,t)=>c`subgroupShuffleUp(${e}, ${t})`}),Rx=d({name:"subgroupShuffleXor",signature:(...e)=>{let t=ye([e[1]],[b]);if(!t)throw new Error(`subgroupShuffleXor's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:he,codegenImpl:(e,t)=>c`subgroupShuffleXor(${e}, ${t})`}),Dx=d({name:"subgroupXor",signature:e=>({argTypes:[e],returnType:e}),normalImpl:he,codegenImpl:e=>c`subgroupXor(${e})`}),Nx=Yt(e=>{let t=Ae();if(!t)throw new Error("Functions using `extensionEnabled` cannot be called directly. Either generate WGSL from them, or use tgpu['~unstable'].simulate(...)");if(typeof e!="string"||!ma.includes(e))throw new Error(`extensionEnabled has to be called with a string literal representing a valid WGSL extension name. Got: '${e}'`);return(t.enableExtensions??[]).includes(e)});const Wx=Object.freeze(Object.defineProperty({__proto__:null,abs:rf,acos:sf,acosh:of,add:ia,all:Xm,allEq:hh,and:Ym,any:Zm,arrayLength:ux,asin:hf,asinh:cf,atan:Ku,atan2:yf,atanh:ff,atomicAdd:qw,atomicAnd:Zw,atomicLoad:Dw,atomicMax:Yw,atomicMin:Xw,atomicOr:Qw,atomicStore:Ww,atomicSub:Hw,atomicXor:Jw,bitcastU32toF32:ah,bitcastU32toI32:oh,ceil:eh,clamp:bt,cos:ms,cosh:$f,countLeadingZeros:bf,countOneBits:Tf,countTrailingZeros:_f,cross:zf,degrees:Sf,determinant:Ef,discard:_w,distance:kf,div:sa,dot:th,dot4I8Packed:Vf,dot4U8Packed:Uf,dpdx:Kw,dpdxCoarse:ex,dpdxFine:tx,dpdy:rx,dpdyCoarse:nx,dpdyFine:ix,eq:Gm,exp:Af,exp2:Bf,extensionEnabled:Nx,extractBits:Cf,faceForward:Ff,firstLeadingBit:jf,firstTrailingBit:Gf,floor:dn,fma:Df,fract:Wf,frexp:Hf,fwidth:sx,fwidthCoarse:ax,fwidthFine:ox,ge:Wm,gt:Nm,identity2:bu,identity3:Tu,identity4:_u,insertBits:Yf,inverseSqrt:Zf,isCloseTo:Qm,ldexp:Qf,le:Dm,length:rh,log:em,log2:rm,lt:Rm,max:nh,min:sm,mix:ir,mod:Lp,modf:um,mul:Fn,ne:Lm,neg:Su,normalize:hm,not:qm,or:Hm,pack2x16float:Cm,pack4x8unorm:jm,pow:ih,quantizeToF16:cm,radians:dm,reflect:fm,refract:mm,reverseBits:ym,rotateX4:Cw,rotateY4:Fw,rotateZ4:jw,rotationX4:Ai,rotationY4:Oi,rotationZ4:Bi,round:wm,saturate:vm,scale4:Bw,scaling4:Pi,select:Km,sign:bm,sin:ys,sinh:zm,smoothstep:Sm,sqrt:sh,step:km,storageBarrier:Lw,sub:Jr,subgroupAdd:Tx,subgroupAll:Ix,subgroupAnd:Sx,subgroupAny:Ex,subgroupBallot:Mx,subgroupBroadcast:kx,subgroupBroadcastFirst:Ux,subgroupElect:Vx,subgroupExclusiveAdd:_x,subgroupExclusiveMul:Bx,subgroupInclusiveAdd:zx,subgroupInclusiveMul:Cx,subgroupMax:Px,subgroupMin:Ax,subgroupMul:Ox,subgroupOr:Fx,subgroupShuffle:jx,subgroupShuffleDown:Gx,subgroupShuffleUp:Lx,subgroupShuffleXor:Rx,subgroupXor:Dx,tan:Vm,tanh:Am,textureBarrier:Rw,textureDimensions:wx,textureLoad:Tt,textureSample:lx,textureSampleBaseClampToEdge:bx,textureSampleBias:px,textureSampleCompare:vx,textureSampleLevel:fx,textureStore:oi,translate4:Ow,translation4:Vi,transpose:Om,trunc:Bm,unpack2x16float:uh,unpack4x8unorm:Fm,workgroupBarrier:Gw},Symbol.toStringTag,{value:"Module"})),ol=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(ki({fx:g,fy:g,cx:g,cy:g,k1:g,k2:g,k3:g,k4:g,newFx:g,newFy:g,newCx:g,newCy:g,outputWidth:g,outputHeight:g,inputWidth:g,inputHeight:g,projection:g,_pad1:g,_pad2:g,_pad3:g}),"FisheyeUniforms"),Ee=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(al.bindGroupLayout({inputTexture:{texture:aa()},outputTexture:{storageTexture:oa("rgba8unorm")},uniforms:{uniform:ol}}),"fisheyeLayout");class qx{config;root=null;uniformBuffer=null;inputTexture=null;outputTexture=null;bindGroup=null;pipeline=null;readbackBuffers=null;readbackIndex=0;readbackHasData=[!1,!1];readbackBytesPerRow=0;readbackActualBytesPerRow=0;pixelBuffer=null;inputTextureSize=[0,0];outputTextureSize=[0,0];uniformInputWidth=0;uniformInputHeight=0;cachedNewCameraMatrix=null;constructor(t={}){this.config=this.applyDefaults(t)}applyDefaults(t){const r=t.width??300,n=t.height??150;return{k1:t.k1??0,k2:t.k2??0,k3:t.k3??0,k4:t.k4??0,width:r,height:n,balance:Math.max(0,Math.min(1,t.balance??0)),fovScale:t.fovScale??1,projection:t.projection??"rectilinear",mount:t.mount??"ceiling",fx:t.fx,fy:t.fy,cx:t.cx,cy:t.cy}}undistortPointNormalized(t,r,n,i,s,a){const o=Math.sqrt(t*t+r*r),u=Math.min(Math.max(-Math.PI/2,o),Math.PI/2);if(Math.abs(u)<1e-8)return[t,r];let h=u;for(let f=0;f<20;f++){const m=h*h,x=m*m,$=x*m,z=x*x,B=h*(1+n*m+i*x+s*$+a*z)-u,A=1+3*n*m+5*i*x+7*s*$+9*a*z,ne=B/A;if(h=h-ne,Math.abs(ne)<1e-10)break}const p=Math.tan(h)/u;return[t*p,r*p]}undistortPixelToNormalized(t,r,n,i,s,a){const o=(t-s)/n,u=(r-a)/i;return this.undistortPointNormalized(o,u,this.config.k1,this.config.k2,this.config.k3,this.config.k4)}computeNewCameraMatrix(t,r){const n=t,i=r,s=this.config.fx??t,a=this.config.fy??t,o=this.config.cx??t/2,u=this.config.cy??r/2,h=this.config.balance,p=this.config.fovScale,f=[[n/2,0],[n,i/2],[n/2,i],[0,i/2]].map(([be,xe])=>this.undistortPixelToNormalized(be,xe,s,a,o,u));let m=0,x=0;for(const[be,xe]of f)m+=be,x+=xe;m/=f.length,x/=f.length;const $=s/a,z=[m,x*$],B=f.map(([be,xe])=>[be,xe*$]);let A=Number.MAX_VALUE,ne=-Number.MAX_VALUE,qe=Number.MAX_VALUE,xt=-Number.MAX_VALUE;for(const[be,xe]of B)A=Math.min(A,be),ne=Math.max(ne,be),qe=Math.min(qe,xe),xt=Math.max(xt,xe);const Be=n*.5/(z[0]-A),vt=n*.5/(ne-z[0]),$t=i*.5*$/(z[1]-qe),Gt=i*.5*$/(xt-z[1]),tn=Math.min(Be,vt,$t,Gt),wr=Math.max(Be,vt,$t,Gt);let it=h*tn+(1-h)*wr;p>0&&(it*=1/p);const He=-z[0]*it+n*.5,Ye=-z[1]*it/$+i*.5,Ce=this.config.width/n,st=this.config.height/i;return{newFx:it*Ce,newFy:it/$*st,newCx:He*Ce,newCy:Ye*st}}async initialize(){this.root||(this.root=await al.init(),this.uniformBuffer=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(this.root.createBuffer(ol,this.getUniformData()).$usage("uniform"),"uniformBuffer"),this.pipeline=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(this.root["~unstable"].createGuardedComputePipeline((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=((r,n)=>{"use gpu";const i=Ee.$.uniforms,s=i.outputWidth,a=i.outputHeight,o=i.inputWidth,u=i.inputHeight,h=q(r,n),p=g(h.x),f=g(h.y);if(p>=s||f>=a)return;if(i.projection>=1.5){const He=p/s*o,Ye=f/a*u,Ce=dn(He),st=dn(Ye),be=He-Ce,xe=Ye-st,rn=o-1,nn=u-1,sn=V(bt(Ce,0,rn)),an=V(bt(st,0,nn)),Nn=V(bt(Ce+1,0,rn)),Wn=V(bt(st+1,0,nn)),Hi=Tt(Ee.$.inputTexture,q(sn,an),0),Yi=Tt(Ee.$.inputTexture,q(Nn,an),0),Xi=Tt(Ee.$.inputTexture,q(sn,Wn),0),Zi=Tt(Ee.$.inputTexture,q(Nn,Wn),0),Qi=ir(Hi,Yi,be),ml=ir(Xi,Zi,be),yl=ir(Qi,ml,xe);oi(Ee.$.outputTexture,h,yl);return}let m=(p-i.newCx)/i.newFx,x=(f-i.newCy)/i.newFy,$=!0;if(i.projection>=.5){const He=(p/s-.5)*Math.PI*2,Ye=(f/a-.5)*Math.PI,Ce=ms(Ye),st=ys(He)*Ce,be=ys(Ye),xe=ms(He)*Ce;xe<=.001?($=!1,m=0,x=0):(m=st/xe,x=be/xe)}const z=sh(m*m+x*x),B=Ku(z),A=B*B,ne=A*A,qe=ne*A,xt=ne*ne,Be=B*(1+i.k1*A+i.k2*ne+i.k3*qe+i.k4*xt),vt=nh(z,1e-8),$t=Be/vt,Gt=m*$t,tn=x*$t,wr=i.fx*Gt+i.cx,it=i.fy*tn+i.cy;if($&&wr>=0&&wr<=o-1&&it>=0&&it<=u-1){const He=dn(wr),Ye=dn(it),Ce=wr-He,st=it-Ye,be=o-1,xe=u-1,rn=V(bt(He,0,be)),nn=V(bt(Ye,0,xe)),sn=V(bt(He+1,0,be)),an=V(bt(Ye+1,0,xe)),Nn=Tt(Ee.$.inputTexture,q(rn,nn),0),Wn=Tt(Ee.$.inputTexture,q(sn,nn),0),Hi=Tt(Ee.$.inputTexture,q(rn,an),0),Yi=Tt(Ee.$.inputTexture,q(sn,an),0),Xi=ir(Nn,Wn,Ce),Zi=ir(Hi,Yi,Ce),Qi=ir(Xi,Zi,st);oi(Ee.$.outputTexture,h,Qi)}else oi(Ee.$.outputTexture,h,I(0,0,0,1))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"x"},{type:"i",name:"y"}],body:[0,[[13,"p",[7,[7,"fisheyeLayout","$"],"uniforms"]],[13,"outputW",[7,"p","outputWidth"]],[13,"outputH",[7,"p","outputHeight"]],[13,"inputW",[7,"p","inputWidth"]],[13,"inputH",[7,"p","inputHeight"]],[13,"coord",[6,[7,"d","vec2i"],["x","y"]]],[13,"coordXf",[6,[7,"d","f32"],[[7,"coord","x"]]]],[13,"coordYf",[6,[7,"d","f32"],[[7,"coord","y"]]]],[11,[3,[1,"coordXf",">=","outputW"],"||",[1,"coordYf",">=","outputH"]],[0,[[10]]]],[11,[1,[7,"p","projection"],">=",[5,"1.5"]],[0,[[13,"srcX",[1,[1,"coordXf","/","outputW"],"*","inputW"]],[13,"srcY",[1,[1,"coordYf","/","outputH"],"*","inputH"]],[13,"x0",[6,[7,"std","floor"],["srcX"]]],[13,"y0",[6,[7,"std","floor"],["srcY"]]],[13,"fx",[1,"srcX","-","x0"]],[13,"fy",[1,"srcY","-","y0"]],[13,"maxX",[1,"inputW","-",[5,"1"]]],[13,"maxY",[1,"inputH","-",[5,"1"]]],[13,"ix0",[6,[7,"d","i32"],[[6,[7,"std","clamp"],["x0",[5,"0"],"maxX"]]]]],[13,"iy0",[6,[7,"d","i32"],[[6,[7,"std","clamp"],["y0",[5,"0"],"maxY"]]]]],[13,"ix1",[6,[7,"d","i32"],[[6,[7,"std","clamp"],[[1,"x0","+",[5,"1"]],[5,"0"],"maxX"]]]]],[13,"iy1",[6,[7,"d","i32"],[[6,[7,"std","clamp"],[[1,"y0","+",[5,"1"]],[5,"0"],"maxY"]]]]],[13,"c00",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix0","iy0"]],[5,"0"]]]],[13,"c10",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix1","iy0"]],[5,"0"]]]],[13,"c01",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix0","iy1"]],[5,"0"]]]],[13,"c11",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix1","iy1"]],[5,"0"]]]],[13,"c0",[6,[7,"std","mix"],["c00","c10","fx"]]],[13,"c1",[6,[7,"std","mix"],["c01","c11","fx"]]],[13,"color",[6,[7,"std","mix"],["c0","c1","fy"]]],[6,[7,"std","textureStore"],[[7,[7,"fisheyeLayout","$"],"outputTexture"],"coord","color"]],[10]]]],[12,"normX",[1,[1,"coordXf","-",[7,"p","newCx"]],"/",[7,"p","newFx"]]],[12,"normY",[1,[1,"coordYf","-",[7,"p","newCy"]],"/",[7,"p","newFy"]]],[12,"validProjection",!0],[11,[1,[7,"p","projection"],">=",[5,"0.5"]],[0,[[13,"lon",[1,[1,[1,[1,"coordXf","/","outputW"],"-",[5,"0.5"]],"*",[7,"Math","PI"]],"*",[5,"2"]]],[13,"lat",[1,[1,[1,"coordYf","/","outputH"],"-",[5,"0.5"]],"*",[7,"Math","PI"]]],[13,"cosLat",[6,[7,"std","cos"],["lat"]]],[13,"dirX",[1,[6,[7,"std","sin"],["lon"]],"*","cosLat"]],[13,"dirY",[6,[7,"std","sin"],["lat"]]],[13,"dirZ",[1,[6,[7,"std","cos"],["lon"]],"*","cosLat"]],[11,[1,"dirZ","<=",[5,"0.001"]],[0,[[2,"validProjection","=",!1],[2,"normX","=",[5,"0"]],[2,"normY","=",[5,"0"]]]],[0,[[2,"normX","=",[1,"dirX","/","dirZ"]],[2,"normY","=",[1,"dirY","/","dirZ"]]]]]]]],[13,"r",[6,[7,"std","sqrt"],[[1,[1,"normX","*","normX"],"+",[1,"normY","*","normY"]]]]],[13,"theta",[6,[7,"std","atan"],["r"]]],[13,"theta2",[1,"theta","*","theta"]],[13,"theta4",[1,"theta2","*","theta2"]],[13,"theta6",[1,"theta4","*","theta2"]],[13,"theta8",[1,"theta4","*","theta4"]],[13,"thetaD",[1,"theta","*",[1,[1,[1,[1,[5,"1"],"+",[1,[7,"p","k1"],"*","theta2"]],"+",[1,[7,"p","k2"],"*","theta4"]],"+",[1,[7,"p","k3"],"*","theta6"]],"+",[1,[7,"p","k4"],"*","theta8"]]]],[13,"safeR",[6,[7,"std","max"],["r",[5,"1e-8"]]]],[13,"scale",[1,"thetaD","/","safeR"]],[13,"distortedX",[1,"normX","*","scale"]],[13,"distortedY",[1,"normY","*","scale"]],[13,"u",[1,[1,[7,"p","fx"],"*","distortedX"],"+",[7,"p","cx"]]],[13,"v",[1,[1,[7,"p","fy"],"*","distortedY"],"+",[7,"p","cy"]]],[13,"inBounds",[3,[3,[3,[3,"validProjection","&&",[1,"u",">=",[5,"0"]]],"&&",[1,"u","<=",[1,"inputW","-",[5,"1"]]]],"&&",[1,"v",">=",[5,"0"]]],"&&",[1,"v","<=",[1,"inputH","-",[5,"1"]]]]],[11,"inBounds",[0,[[13,"x0",[6,[7,"std","floor"],["u"]]],[13,"y0",[6,[7,"std","floor"],["v"]]],[13,"fx",[1,"u","-","x0"]],[13,"fy",[1,"v","-","y0"]],[13,"maxX",[1,"inputW","-",[5,"1"]]],[13,"maxY",[1,"inputH","-",[5,"1"]]],[13,"ix0",[6,[7,"d","i32"],[[6,[7,"std","clamp"],["x0",[5,"0"],"maxX"]]]]],[13,"iy0",[6,[7,"d","i32"],[[6,[7,"std","clamp"],["y0",[5,"0"],"maxY"]]]]],[13,"ix1",[6,[7,"d","i32"],[[6,[7,"std","clamp"],[[1,"x0","+",[5,"1"]],[5,"0"],"maxX"]]]]],[13,"iy1",[6,[7,"d","i32"],[[6,[7,"std","clamp"],[[1,"y0","+",[5,"1"]],[5,"0"],"maxY"]]]]],[13,"c00",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix0","iy0"]],[5,"0"]]]],[13,"c10",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix1","iy0"]],[5,"0"]]]],[13,"c01",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix0","iy1"]],[5,"0"]]]],[13,"c11",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix1","iy1"]],[5,"0"]]]],[13,"c0",[6,[7,"std","mix"],["c00","c10","fx"]]],[13,"c1",[6,[7,"std","mix"],["c01","c11","fx"]]],[13,"color",[6,[7,"std","mix"],["c0","c1","fy"]]],[6,[7,"std","textureStore"],[[7,[7,"fisheyeLayout","$"],"outputTexture"],"coord","color"]]]],[0,[[6,[7,"std","textureStore"],[[7,[7,"fisheyeLayout","$"],"outputTexture"],"coord",[6,[7,"d","vec4f"],[[5,"0"],[5,"0"],[5,"0"],[5,"1"]]]]]]]]]],externalNames:["fisheyeLayout","d","std","Math"]},externals:()=>({fisheyeLayout:Ee,d:Tw,std:Wx,Math})})&&t.f)({})),"pipeline"))}getUniformData(){const t=this.uniformInputWidth||this.config.width,r=this.uniformInputHeight||this.config.height,n=this.config.fx??t,i=this.config.fy??t,s=this.config.cx??t/2,a=this.config.cy??r/2;(!this.cachedNewCameraMatrix||this.uniformInputWidth!==t||this.uniformInputHeight!==r)&&(this.cachedNewCameraMatrix=this.computeNewCameraMatrix(t,r));const o=this.cachedNewCameraMatrix;let u=0;return this.config.projection==="equirectangular"?u=1:this.config.projection==="original"&&(u=2),{fx:n,fy:i,cx:s,cy:a,k1:this.config.k1,k2:this.config.k2,k3:this.config.k3,k4:this.config.k4,newFx:o.newFx,newFy:o.newFy,newCx:o.newCx,newCy:o.newCy,outputWidth:this.config.width,outputHeight:this.config.height,inputWidth:t,inputHeight:r,projection:u,_pad1:0,_pad2:0,_pad3:0}}updateUniforms(){this.uniformBuffer&&this.uniformBuffer.write(this.getUniformData())}async readbackToVideoFrame(t,r,n){const i=this.readbackBuffers;if(!i)throw new Error("Readback buffer not initialized");const s=this.readbackIndex,a=1-s,o=i[s],u=i[a];if(!o||!u)throw new Error("Readback buffer not initialized");const h=t.createCommandEncoder();h.copyTextureToBuffer({texture:r},{buffer:o,bytesPerRow:this.readbackBytesPerRow},[this.config.width,this.config.height]),t.queue.submit([h.finish()]),await t.queue.onSubmittedWorkDone(),this.readbackHasData[s]=!0,this.readbackIndex=a;const p=this.readbackHasData[a]?u:o;await p.mapAsync(GPUMapMode.READ);const f=p.getMappedRange(),m=this.pixelBuffer??new Uint8Array(this.config.width*this.config.height*4),x=new Uint8Array(f);for(let $=0;$<this.config.height;$++){const z=$*this.readbackBytesPerRow,B=$*this.readbackActualBytesPerRow;m.set(x.subarray(z,z+this.readbackActualBytesPerRow),B)}return p.unmap(),new VideoFrame(m,{format:"RGBA",codedWidth:this.config.width,codedHeight:this.config.height,timestamp:n})}createInputTexture(t,r,n){const i=[r,n];return t["~unstable"].createTexture({size:i,format:"rgba8unorm"}).$usage("sampled","render")}createOutputTexture(t,r,n){const i=[r,n];return t["~unstable"].createTexture({size:i,format:"rgba8unorm"}).$usage("storage")}calculateBytesPerRow(t){const r=t*4;return Math.ceil(r/256)*256}createReadbackBuffer(t,r,n){const i=this.calculateBytesPerRow(r)*n;return t.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}async undistort(t){if(await this.initialize(),!this.root||!this.uniformBuffer)throw new Error("GPU resources not initialized");const r=this.root,n=r.device;(!this.inputTexture||this.inputTextureSize[0]!==t.displayWidth||this.inputTextureSize[1]!==t.displayHeight)&&(this.inputTexture?.destroy(),this.inputTexture=this.createInputTexture(r,t.displayWidth,t.displayHeight),this.inputTextureSize=[t.displayWidth,t.displayHeight],this.bindGroup=null),(!this.outputTexture||this.outputTextureSize[0]!==this.config.width||this.outputTextureSize[1]!==this.config.height)&&(this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.outputTexture=this.createOutputTexture(r,this.config.width,this.config.height),this.readbackBytesPerRow=this.calculateBytesPerRow(this.config.width),this.readbackActualBytesPerRow=this.config.width*4,this.pixelBuffer=new Uint8Array(this.config.width*this.config.height*4),this.readbackBuffers=[this.createReadbackBuffer(n,this.config.width,this.config.height),this.createReadbackBuffer(n,this.config.width,this.config.height)],this.readbackIndex=0,this.readbackHasData=[!1,!1],this.outputTextureSize=[this.config.width,this.config.height],this.bindGroup=null);const i=this.inputTexture,s=this.outputTexture;if(!i||!s)throw new Error("Textures not initialized");i.write(t),(this.uniformInputWidth!==t.displayWidth||this.uniformInputHeight!==t.displayHeight)&&(this.uniformInputWidth=t.displayWidth,this.uniformInputHeight=t.displayHeight,this.cachedNewCameraMatrix=null),this.updateUniforms(),this.bindGroup||(this.bindGroup=r.createBindGroup(Ee,{inputTexture:i,outputTexture:s,uniforms:this.uniformBuffer}));const a=this.bindGroup;if(!this.pipeline||!s)throw new Error("Compute pipeline or output texture not initialized");this.pipeline.with(a).dispatchThreads(this.config.width,this.config.height);const o=r.unwrap(s);return this.readbackToVideoFrame(n,o,t.timestamp)}updateConfig(t){const r=this.config.width,n=this.config.height;this.config=this.applyDefaults({...this.config,...t}),this.cachedNewCameraMatrix=null,this.updateUniforms(),(this.config.width!==r||this.config.height!==n)&&(this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.outputTexture=null,this.readbackBuffers=null,this.readbackIndex=0,this.readbackHasData=[!1,!1],this.outputTextureSize=[0,0],this.readbackBytesPerRow=0,this.readbackActualBytesPerRow=0,this.pixelBuffer=null)}destroy(){this.inputTexture?.destroy(),this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.root?.destroy(),this.inputTexture=null,this.outputTexture=null,this.readbackBuffers=null,this.readbackIndex=0,this.readbackHasData=[!1,!1],this.uniformBuffer=null,this.root=null,this.bindGroup=null,this.pipeline=null,this.readbackBytesPerRow=0,this.readbackActualBytesPerRow=0,this.pixelBuffer=null,this.inputTextureSize=[0,0],this.outputTextureSize=[0,0],this.cachedNewCameraMatrix=null}}const ui=globalThis,xa=ui.ShadowRoot&&(ui.ShadyCSS===void 0||ui.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,va=Symbol(),fo=new WeakMap;let ul=class{constructor(t,r,n){if(this._$cssResult$=!0,n!==va)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=r}get styleSheet(){let t=this.o;const r=this.t;if(xa&&t===void 0){const n=r!==void 0&&r.length===1;n&&(t=fo.get(r)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&fo.set(r,t))}return t}toString(){return this.cssText}};const Hx=e=>new ul(typeof e=="string"?e:e+"",void 0,va),$a=(e,...t)=>{const r=e.length===1?e[0]:t.reduce((n,i,s)=>n+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[s+1],e[0]);return new ul(r,e,va)},Yx=(e,t)=>{if(xa)e.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet);else for(const r of t){const n=document.createElement("style"),i=ui.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=r.cssText,e.appendChild(n)}},mo=xa?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let r="";for(const n of t.cssRules)r+=n.cssText;return Hx(r)})(e):e;const{is:Xx,defineProperty:Zx,getOwnPropertyDescriptor:Qx,getOwnPropertyNames:Jx,getOwnPropertySymbols:Kx,getPrototypeOf:ev}=Object,Ni=globalThis,yo=Ni.trustedTypes,tv=yo?yo.emptyScript:"",rv=Ni.reactiveElementPolyfillSupport,bn=(e,t)=>e,bi={toAttribute(e,t){switch(t){case Boolean:e=e?tv:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=e!==null;break;case Number:r=e===null?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch{r=null}}return r}},ba=(e,t)=>!Xx(e,t),go={attribute:!0,type:String,converter:bi,reflect:!1,useDefault:!1,hasChanged:ba};Symbol.metadata??=Symbol("metadata"),Ni.litPropertyMetadata??=new WeakMap;let Or=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,r=go){if(r.state&&(r.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((r=Object.create(r)).wrapped=!0),this.elementProperties.set(t,r),!r.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(t,n,r);i!==void 0&&Zx(this.prototype,t,i)}}static getPropertyDescriptor(t,r,n){const{get:i,set:s}=Qx(this.prototype,t)??{get(){return this[r]},set(a){this[r]=a}};return{get:i,set(a){const o=i?.call(this);s?.call(this,a),this.requestUpdate(t,o,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??go}static _$Ei(){if(this.hasOwnProperty(bn("elementProperties")))return;const t=ev(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(bn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(bn("properties"))){const r=this.properties,n=[...Jx(r),...Kx(r)];for(const i of n)this.createProperty(i,r[i])}const t=this[Symbol.metadata];if(t!==null){const r=litPropertyMetadata.get(t);if(r!==void 0)for(const[n,i]of r)this.elementProperties.set(n,i)}this._$Eh=new Map;for(const[r,n]of this.elementProperties){const i=this._$Eu(r,n);i!==void 0&&this._$Eh.set(i,r)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const r=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const i of n)r.unshift(mo(i))}else t!==void 0&&r.push(mo(t));return r}static _$Eu(t,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,r=this.constructor.elementProperties;for(const n of r.keys())this.hasOwnProperty(n)&&(t.set(n,this[n]),delete this[n]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Yx(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,r,n){this._$AK(t,n)}_$ET(t,r){const n=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,n);if(i!==void 0&&n.reflect===!0){const s=(n.converter?.toAttribute!==void 0?n.converter:bi).toAttribute(r,n.type);this._$Em=t,s==null?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(t,r){const n=this.constructor,i=n._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const s=n.getPropertyOptions(i),a=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:bi;this._$Em=i;const o=a.fromAttribute(r,s.type);this[i]=o??this._$Ej?.get(i)??o,this._$Em=null}}requestUpdate(t,r,n,i=!1,s){if(t!==void 0){const a=this.constructor;if(i===!1&&(s=this[t]),n??=a.getPropertyOptions(t),!((n.hasChanged??ba)(s,r)||n.useDefault&&n.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(a._$Eu(t,n))))return;this.C(t,r,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,r,{useDefault:n,reflect:i,wrapped:s},a){n&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,a??r??this[t]),s!==!0||a!==void 0)||(this._$AL.has(t)||(this.hasUpdated||n||(r=void 0),this._$AL.set(t,r)),i===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(r){Promise.reject(r)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,s]of this._$Ep)this[i]=s;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[i,s]of n){const{wrapped:a}=s,o=this[i];a!==!0||this._$AL.has(i)||o===void 0||this.C(i,void 0,s,o)}}let t=!1;const r=this._$AL;try{t=this.shouldUpdate(r),t?(this.willUpdate(r),this._$EO?.forEach(n=>n.hostUpdate?.()),this.update(r)):this._$EM()}catch(n){throw t=!1,this._$EM(),n}t&&this._$AE(r)}willUpdate(t){}_$AE(t){this._$EO?.forEach(r=>r.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(r=>this._$ET(r,this[r])),this._$EM()}updated(t){}firstUpdated(t){}};Or.elementStyles=[],Or.shadowRootOptions={mode:"open"},Or[bn("elementProperties")]=new Map,Or[bn("finalized")]=new Map,rv?.({ReactiveElement:Or}),(Ni.reactiveElementVersions??=[]).push("2.1.2");const Ta=globalThis,wo=e=>e,Ti=Ta.trustedTypes,xo=Ti?Ti.createPolicy("lit-html",{createHTML:e=>e}):void 0,hl="$lit$",Dt=`lit$${Math.random().toFixed(9).slice(2)}$`,ll="?"+Dt,nv=`<${ll}>`,hr=document,In=()=>hr.createComment(""),Sn=e=>e===null||typeof e!="object"&&typeof e!="function",_a=Array.isArray,iv=e=>_a(e)||typeof e?.[Symbol.iterator]=="function",ts=`[ 	
\f\r]`,cn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,vo=/-->/g,$o=/>/g,tr=RegExp(`>|${ts}(?:([^\\s"'>=/]+)(${ts}*=${ts}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),bo=/'/g,To=/"/g,cl=/^(?:script|style|textarea|title)$/i,sv=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),zt=sv(1),Wr=Symbol.for("lit-noChange"),fe=Symbol.for("lit-nothing"),_o=new WeakMap,or=hr.createTreeWalker(hr,129);function pl(e,t){if(!_a(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return xo!==void 0?xo.createHTML(t):t}const av=(e,t)=>{const r=e.length-1,n=[];let i,s=t===2?"<svg>":t===3?"<math>":"",a=cn;for(let o=0;o<r;o++){const u=e[o];let h,p,f=-1,m=0;for(;m<u.length&&(a.lastIndex=m,p=a.exec(u),p!==null);)m=a.lastIndex,a===cn?p[1]==="!--"?a=vo:p[1]!==void 0?a=$o:p[2]!==void 0?(cl.test(p[2])&&(i=RegExp("</"+p[2],"g")),a=tr):p[3]!==void 0&&(a=tr):a===tr?p[0]===">"?(a=i??cn,f=-1):p[1]===void 0?f=-2:(f=a.lastIndex-p[2].length,h=p[1],a=p[3]===void 0?tr:p[3]==='"'?To:bo):a===To||a===bo?a=tr:a===vo||a===$o?a=cn:(a=tr,i=void 0);const x=a===tr&&e[o+1].startsWith("/>")?" ":"";s+=a===cn?u+nv:f>=0?(n.push(h),u.slice(0,f)+hl+u.slice(f)+Dt+x):u+Dt+(f===-2?o:x)}return[pl(e,s+(e[r]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),n]};class En{constructor({strings:t,_$litType$:r},n){let i;this.parts=[];let s=0,a=0;const o=t.length-1,u=this.parts,[h,p]=av(t,r);if(this.el=En.createElement(h,n),or.currentNode=this.el.content,r===2||r===3){const f=this.el.content.firstChild;f.replaceWith(...f.childNodes)}for(;(i=or.nextNode())!==null&&u.length<o;){if(i.nodeType===1){if(i.hasAttributes())for(const f of i.getAttributeNames())if(f.endsWith(hl)){const m=p[a++],x=i.getAttribute(f).split(Dt),$=/([.?@])?(.*)/.exec(m);u.push({type:1,index:s,name:$[2],strings:x,ctor:$[1]==="."?uv:$[1]==="?"?hv:$[1]==="@"?lv:Wi}),i.removeAttribute(f)}else f.startsWith(Dt)&&(u.push({type:6,index:s}),i.removeAttribute(f));if(cl.test(i.tagName)){const f=i.textContent.split(Dt),m=f.length-1;if(m>0){i.textContent=Ti?Ti.emptyScript:"";for(let x=0;x<m;x++)i.append(f[x],In()),or.nextNode(),u.push({type:2,index:++s});i.append(f[m],In())}}}else if(i.nodeType===8)if(i.data===ll)u.push({type:2,index:s});else{let f=-1;for(;(f=i.data.indexOf(Dt,f+1))!==-1;)u.push({type:7,index:s}),f+=Dt.length-1}s++}}static createElement(t,r){const n=hr.createElement("template");return n.innerHTML=t,n}}function qr(e,t,r=e,n){if(t===Wr)return t;let i=n!==void 0?r._$Co?.[n]:r._$Cl;const s=Sn(t)?void 0:t._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(e),i._$AT(e,r,n)),n!==void 0?(r._$Co??=[])[n]=i:r._$Cl=i),i!==void 0&&(t=qr(e,i._$AS(e,t.values),i,n)),t}class ov{constructor(t,r){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:r},parts:n}=this._$AD,i=(t?.creationScope??hr).importNode(r,!0);or.currentNode=i;let s=or.nextNode(),a=0,o=0,u=n[0];for(;u!==void 0;){if(a===u.index){let h;u.type===2?h=new Dn(s,s.nextSibling,this,t):u.type===1?h=new u.ctor(s,u.name,u.strings,this,t):u.type===6&&(h=new cv(s,this,t)),this._$AV.push(h),u=n[++o]}a!==u?.index&&(s=or.nextNode(),a++)}return or.currentNode=hr,i}p(t){let r=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(t,n,r),r+=n.strings.length-2):n._$AI(t[r])),r++}}class Dn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,r,n,i){this.type=2,this._$AH=fe,this._$AN=void 0,this._$AA=t,this._$AB=r,this._$AM=n,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&t?.nodeType===11&&(t=r.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,r=this){t=qr(this,t,r),Sn(t)?t===fe||t==null||t===""?(this._$AH!==fe&&this._$AR(),this._$AH=fe):t!==this._$AH&&t!==Wr&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):iv(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==fe&&Sn(this._$AH)?this._$AA.nextSibling.data=t:this.T(hr.createTextNode(t)),this._$AH=t}$(t){const{values:r,_$litType$:n}=t,i=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=En.createElement(pl(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===i)this._$AH.p(r);else{const s=new ov(i,this),a=s.u(this.options);s.p(r),this.T(a),this._$AH=s}}_$AC(t){let r=_o.get(t.strings);return r===void 0&&_o.set(t.strings,r=new En(t)),r}k(t){_a(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let n,i=0;for(const s of t)i===r.length?r.push(n=new Dn(this.O(In()),this.O(In()),this,this.options)):n=r[i],n._$AI(s),i++;i<r.length&&(this._$AR(n&&n._$AB.nextSibling,i),r.length=i)}_$AR(t=this._$AA.nextSibling,r){for(this._$AP?.(!1,!0,r);t!==this._$AB;){const n=wo(t).nextSibling;wo(t).remove(),t=n}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class Wi{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,r,n,i,s){this.type=1,this._$AH=fe,this._$AN=void 0,this.element=t,this.name=r,this._$AM=i,this.options=s,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=fe}_$AI(t,r=this,n,i){const s=this.strings;let a=!1;if(s===void 0)t=qr(this,t,r,0),a=!Sn(t)||t!==this._$AH&&t!==Wr,a&&(this._$AH=t);else{const o=t;let u,h;for(t=s[0],u=0;u<s.length-1;u++)h=qr(this,o[n+u],r,u),h===Wr&&(h=this._$AH[u]),a||=!Sn(h)||h!==this._$AH[u],h===fe?t=fe:t!==fe&&(t+=(h??"")+s[u+1]),this._$AH[u]=h}a&&!i&&this.j(t)}j(t){t===fe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class uv extends Wi{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===fe?void 0:t}}class hv extends Wi{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==fe)}}class lv extends Wi{constructor(t,r,n,i,s){super(t,r,n,i,s),this.type=5}_$AI(t,r=this){if((t=qr(this,t,r,0)??fe)===Wr)return;const n=this._$AH,i=t===fe&&n!==fe||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,s=t!==fe&&(n===fe||i);i&&this.element.removeEventListener(this.name,this,n),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class cv{constructor(t,r,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=r,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){qr(this,t)}}const pv=Ta.litHtmlPolyfillSupport;pv?.(En,Dn),(Ta.litHtmlVersions??=[]).push("3.3.2");const dv=(e,t,r)=>{const n=r?.renderBefore??t;let i=n._$litPart$;if(i===void 0){const s=r?.renderBefore??null;n._$litPart$=i=new Dn(t.insertBefore(In(),s),s,void 0,r??{})}return i._$AI(e),i};const za=globalThis;class ur extends Or{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=dv(r,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Wr}}ur._$litElement$=!0,ur.finalized=!0,za.litElementHydrateSupport?.({LitElement:ur});const fv=za.litElementPolyfillSupport;fv?.({LitElement:ur});(za.litElementVersions??=[]).push("4.2.2");const Ia=e=>(t,r)=>{r!==void 0?r.addInitializer(()=>{customElements.define(e,t)}):customElements.define(e,t)};const mv={attribute:!0,type:String,converter:bi,reflect:!1,hasChanged:ba},yv=(e=mv,t,r)=>{const{kind:n,metadata:i}=r;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),n==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(r.name,e),n==="accessor"){const{name:a}=r;return{set(o){const u=t.get.call(this);t.set.call(this,o),this.requestUpdate(a,u,e,!0,o)},init(o){return o!==void 0&&this.C(a,void 0,e,o),o}}}if(n==="setter"){const{name:a}=r;return function(o){const u=this[a];t.call(this,o),this.requestUpdate(a,u,e,!0,o)}}throw Error("Unsupported decorator location: "+n)};function qi(e){return(t,r)=>typeof r=="object"?yv(e,t,r):((n,i,s)=>{const a=i.hasOwnProperty(s);return i.constructor.createProperty(s,n),a?Object.getOwnPropertyDescriptor(i,s):void 0})(e,t,r)}function Se(e){return qi({...e,state:!0,attribute:!1})}const gv=(e,t,r)=>(r.configurable=!0,r.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(e,t,r),r);function dl(e,t){return(r,n,i)=>{const s=a=>a.renderRoot?.querySelector(e)??null;return gv(r,n,{get(){return s(this)}})}}const wv=$a`
  :host {
    display: block;
    font-family: system-ui, -apple-system, sans-serif;
    color: #e0e0e0;
    background: #1a1a2e;
    min-height: 100vh;
  }

  .container {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  .main {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  .sidebar-container {
    display: flex;
    flex-shrink: 0;
    background: #16213e;
    border-right: 1px solid #0f3460;
  }

  .sidebar-form {
    width: 320px;
    padding: 1.5rem;
    overflow-y: auto;
    overflow-x: hidden;
    transition: width 0.25s ease, padding 0.25s ease, opacity 0.2s ease;
  }

  .sidebar-form.closed {
    width: 0;
    padding: 0;
    min-width: 0;
    opacity: 0;
    overflow: hidden;
    pointer-events: none;
  }

  .sidebar-form .control-group {
    margin-bottom: 1.5rem;
  }

  .sidebar-form .control-group h3 {
    margin: 0 0 0.75rem;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #00d9ff;
  }

  .sidebar-form .control-hint {
    margin: 0 0 0.5rem;
    font-size: 0.7rem;
    color: #666;
    line-height: 1.3;
  }

  .sidebar-form .control-item {
    margin-bottom: 1rem;
  }

  .sidebar-form .control-item label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
    color: #a0a0a0;
  }

  .sidebar-form .control-item label span {
    font-family: monospace;
    color: #00ff88;
  }

  .sidebar-form input[type="range"] {
    width: 100%;
    height: 6px;
    background: #0f3460;
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
  }

  .sidebar-form input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    background: #00d9ff;
    border-radius: 50%;
    cursor: pointer;
  }

  .sidebar-form .file-input-wrapper {
    position: relative;
  }

  .sidebar-form .file-input-wrapper input[type="file"] {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
  }

  .sidebar-form .file-input-label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #0f3460, #16213e);
    border: 2px dashed #0f3460;
    border-radius: 8px;
    color: #8892b0;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .sidebar-form .file-input-wrapper:hover .file-input-label {
    border-color: #00d9ff;
    color: #00d9ff;
  }

  .sidebar-form .preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .sidebar-form .preset-btn {
    padding: 0.5rem 0.75rem;
    background: #0f3460;
    border: 1px solid #1a3a5c;
    border-radius: 6px;
    color: #a0a0a0;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .sidebar-form .preset-btn:hover {
    border-color: #00d9ff;
    color: #00d9ff;
  }

  .sidebar-form .preset-btn.active {
    background: #00d9ff;
    border-color: #00d9ff;
    color: #1a1a2e;
  }

  .sidebar-form .btn {
    width: 100%;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #00d9ff, #00ff88);
    border: none;
    border-radius: 8px;
    color: #1a1a2e;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .sidebar-form .btn-secondary {
    background: #0f3460;
    color: #e0e0e0;
  }

  .canvas-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    gap: 1rem;
    overflow: auto;
  }

  .canvas-container {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  .canvas-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .canvas-wrapper h4 {
    margin: 0;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #8892b0;
  }

  canvas {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  #input-canvas {
    max-width: 400px;
    background: #0a0a14;
  }

  #output-canvas {
    max-width: 600px;
    background: #0a0a14;
  }

  .error {
    padding: 1rem;
    background: rgba(255, 82, 82, 0.1);
    border: 1px solid #ff5252;
    border-radius: 8px;
    color: #ff5252;
    font-size: 0.875rem;
  }

  .processing {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #00d9ff;
    font-size: 0.875rem;
  }

  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid #0f3460;
    border-top-color: #00d9ff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Tablet and mobile: stack layout */
  @media (max-width: 900px) {
    .main {
      flex-direction: column;
    }

    .sidebar-container {
      flex-direction: column;
      border-right: none;
      border-bottom: 1px solid #0f3460;
      max-height: 50vh;
      overflow: hidden;
    }

    .sidebar-form.closed {
      max-height: 0;
    }

    .canvas-container {
      flex-direction: column;
      align-items: center;
    }
  }

  /* Small mobile screens */
  @media (max-width: 600px) {
    .canvas-area {
      padding: 1rem;
      gap: 0.75rem;
    }

    .canvas-container {
      gap: 1rem;
      width: 100%;
    }

    .canvas-wrapper {
      width: 100%;
    }

    .canvas-wrapper h4 {
      font-size: 0.7rem;
    }

    #input-canvas,
    #output-canvas {
      max-width: 100%;
      width: 100%;
    }

    #input-canvas {
      max-width: 100%;
    }

    #output-canvas {
      max-width: 100%;
    }
  }

  @media (max-width: 400px) {
    .sidebar-form .control-item label {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }

    .sidebar-form .control-item label span {
      font-size: 0.75rem;
    }
  }

  /* Landscape mobile optimization */
  @media (max-height: 500px) and (orientation: landscape) {
    .container {
      height: auto;
      min-height: 100vh;
    }

    .main {
      flex-direction: row;
    }

    .canvas-area {
      padding: 0.5rem;
    }

    .canvas-container {
      flex-direction: row;
      gap: 0.5rem;
    }
  }
`,Rr=class Rr{constructor(t){this.ctx=null,this.format=null,this.device=null,this.pipeline=null,this.sampler=null,this.currentWidth=0,this.currentHeight=0,this.canvas=t,this.started=this.start()}async start(){const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("WebGPU adapter not found");this.device=await t.requestDevice(),this.format=navigator.gpu.getPreferredCanvasFormat(),this.ctx=this.canvas.getContext("webgpu"),this.ctx.configure({device:this.device,format:this.format,alphaMode:"opaque",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),this.pipeline=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.device.createShaderModule({code:Rr.vertexShaderSource}),entryPoint:"vert_main"},fragment:{module:this.device.createShaderModule({code:Rr.fragmentShaderSource}),entryPoint:"frag_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"}}),this.sampler=this.device.createSampler({})}async draw(t){if(await this.started,!this.device||!this.pipeline||!this.sampler||!this.ctx)throw new Error("WebGPU not initialized");if(this.currentWidth!==t.displayWidth||this.currentHeight!==t.displayHeight){this.canvas.width=t.displayWidth,this.canvas.height=t.displayHeight,this.currentWidth=t.displayWidth,this.currentHeight=t.displayHeight;const a=this.format;if(!a)throw new Error("WebGPU not initialized");this.ctx.configure({device:this.device,format:a,alphaMode:"opaque",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT})}const r=this.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:1,resource:this.sampler},{binding:2,resource:this.device.importExternalTexture({source:t})}]}),n=this.device.createCommandEncoder(),s={colorAttachments:[{view:this.ctx.getCurrentTexture().createView(),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}]};try{const a=n.beginRenderPass(s);a.setPipeline(this.pipeline),a.setBindGroup(0,r),a.draw(6,1,0,0),a.end(),this.device.queue.submit([n.finish()])}finally{t.close()}}destroy(){this.device?.destroy(),this.device=null,this.ctx=null,this.pipeline=null,this.sampler=null}};Rr.vertexShaderSource=`
    struct VertexOutput {
      @builtin(position) Position: vec4<f32>,
      @location(0) uv: vec2<f32>,
    }

    @vertex
    fn vert_main(@builtin(vertex_index) VertexIndex: u32) -> VertexOutput {
      var pos = array<vec2<f32>, 6>(
        vec2<f32>( 1.0,  1.0),
        vec2<f32>( 1.0, -1.0),
        vec2<f32>(-1.0, -1.0),
        vec2<f32>( 1.0,  1.0),
        vec2<f32>(-1.0, -1.0),
        vec2<f32>(-1.0,  1.0)
      );

      var uv = array<vec2<f32>, 6>(
        vec2<f32>(1.0, 0.0),
        vec2<f32>(1.0, 1.0),
        vec2<f32>(0.0, 1.0),
        vec2<f32>(1.0, 0.0),
        vec2<f32>(0.0, 1.0),
        vec2<f32>(0.0, 0.0)
      );

      var output : VertexOutput;
      output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);
      output.uv = uv[VertexIndex];
      return output;
    }
  `,Rr.fragmentShaderSource=`
    @group(0) @binding(1) var mySampler: sampler;
    @group(0) @binding(2) var myTexture: texture_external;
    
    @fragment
    fn frag_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {
      return textureSampleBaseClampToEdge(myTexture, mySampler, uv);
    }
  `;let Ms=Rr;var xv=Object.defineProperty,vv=Object.getOwnPropertyDescriptor,fl=(e,t,r,n)=>{for(var i=n>1?void 0:n?vv(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&xv(t,r,i),i};const zo=48;let _i=class extends ur{constructor(){super(...arguments),this.open=!0}toggle(){this.dispatchEvent(new CustomEvent("toggle",{bubbles:!0,composed:!0}))}render(){return zt`
      <button
        type="button"
        class="sidebar-toggle"
        @click=${this.toggle}
        aria-expanded=${this.open}
        aria-label=${this.open?"Close sidebar":"Open sidebar"}
      >
        <span class="icon" aria-hidden="true"></span>
      </button>
    `}};_i.styles=$a`
    :host {
      display: block;
      flex-shrink: 0;
      width: ${zo}px;
    }

    .sidebar-toggle {
      width: 100%;
      min-height: 3rem;
      padding: 0;
      background: #0f3460;
      border: none;
      border-right: 1px solid #1a3a5c;
      color: #00d9ff;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s;
    }

    .sidebar-toggle:hover {
      background: #1a3a5c;
    }

    .sidebar-toggle .icon {
      transition: transform 0.25s ease;
    }

    .sidebar-toggle[aria-expanded="true"] .icon {
      transform: rotate(180deg);
    }

    @media (max-width: 900px) {
      :host {
        width: 100%;
      }

      .sidebar-toggle {
        width: 100%;
        height: ${zo}px;
        border-right: none;
        border-bottom: 1px solid #1a3a5c;
      }

      .sidebar-toggle[aria-expanded="true"] .icon {
        transform: rotate(0deg);
      }

      .sidebar-toggle[aria-expanded="false"] .icon {
        transform: rotate(180deg);
      }
    }
  `;fl([qi({type:Boolean})],_i.prototype,"open",2);_i=fl([Ia("demo-sidebar")],_i);var $v=Object.defineProperty,bv=Object.getOwnPropertyDescriptor,Sa=(e,t,r,n)=>{for(var i=n>1?void 0:n?bv(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&$v(t,r,i),i};let Mn=class extends ur{constructor(){super(...arguments),this.title="fisheye.js",this.subtitle="GPU-accelerated fisheye dewarping using WebGPU"}render(){return zt`
      <header>
        <h1>${this.title}</h1>
        <p>${this.subtitle}</p>
      </header>
    `}};Mn.styles=$a`
    :host {
      display: block;
    }

    header {
      padding: 1rem 2rem;
      background: #16213e;
      border-bottom: 1px solid #0f3460;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      background: linear-gradient(90deg, #00d9ff, #00ff88);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    header p {
      margin: 0.25rem 0 0;
      font-size: 0.875rem;
      color: #8892b0;
    }

    @media (max-width: 600px) {
      header {
        padding: 0.75rem 1rem;
      }

      header h1 {
        font-size: 1.25rem;
      }

      header p {
        font-size: 0.75rem;
      }
    }

    @media (max-height: 500px) and (orientation: landscape) {
      header {
        padding: 0.5rem 1rem;
      }

      header h1 {
        font-size: 1rem;
      }

      header p {
        display: none;
      }
    }
  `;Sa([qi()],Mn.prototype,"title",2);Sa([qi()],Mn.prototype,"subtitle",2);Mn=Sa([Ia("page-header")],Mn);var Tv=Object.defineProperty,_v=Object.getOwnPropertyDescriptor,we=(e,t,r,n)=>{for(var i=n>1?void 0:n?_v(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&Tv(t,r,i),i};const le={k1:-.0014613319981768,k2:-.00329861110580401,k3:.00605760088590183,k4:-.00374209380722371,centerX:-.0306,centerY:-.0452,balance:0,fovScale:.66,projection:"rectilinear",mount:"ceiling"},Io=[{id:"normal",label:"Normal (90)",projection:"rectilinear",mount:"ceiling"},{id:"panoramic180",label:"Panoramic 180",projection:"equirectangular",mount:"ceiling"},{id:"panoramic360",label:"360 Panorama",projection:"equirectangular",mount:"ceiling"}];let re=class extends ur{constructor(){super(...arguments),this.k1=le.k1,this.k2=le.k2,this.k3=le.k3,this.k4=le.k4,this.balance=le.balance,this.fovScale=le.fovScale,this.centerX=le.centerX,this.centerY=le.centerY,this.presetId=null,this.projection=le.projection,this.mount=le.mount,this.isProcessing=!1,this.errorMessage="",this.hasWebGPU=!0,this.sidebarOpen=!0,this.fisheye=null,this.renderer=null,this.currentImageBitmap=null,this.processImagePromise=Promise.resolve(),this.processImageDebounceTimer=null}connectedCallback(){super.connectedCallback(),this.checkWebGPU(),this.loadDefaultImage()}disconnectedCallback(){super.disconnectedCallback(),this.processImageDebounceTimer!==null&&(clearTimeout(this.processImageDebounceTimer),this.processImageDebounceTimer=null),this.fisheye?.destroy(),this.renderer?.destroy(),this.currentImageBitmap?.close()}async checkWebGPU(){navigator.gpu||(this.hasWebGPU=!1,this.errorMessage="WebGPU is not supported in this browser. Please use Chrome 113+ or Edge 113+.")}async loadDefaultImage(){try{const t=await(await fetch(`/fisheye.js/test.jpg?t=${Date.now()}`)).blob();await this.loadImage(t)}catch(e){console.warn("Failed to load default image:",e)}}async loadImage(e){try{this.currentImageBitmap?.close(),this.currentImageBitmap=await createImageBitmap(e),await this.updateComplete;const t=this.inputCanvas.getContext("2d");t&&(this.inputCanvas.width=this.currentImageBitmap.width,this.inputCanvas.height=this.currentImageBitmap.height,t.drawImage(this.currentImageBitmap,0,0)),await this.enqueueProcessImage()}catch(t){this.errorMessage=`Failed to load image: ${t}`}}async handleFileUpload(e){const r=e.target.files?.[0];r&&await this.loadImage(r)}async processImage(){if(!(!this.currentImageBitmap||!this.hasWebGPU)){this.isProcessing=!0,this.errorMessage="";try{await this.updateComplete;const e=this.currentImageBitmap.width,t=this.currentImageBitmap.height,r={k1:this.k1,k2:this.k2,k3:this.k3,k4:this.k4,width:e,height:t,balance:this.balance,fovScale:this.fovScale,projection:this.projection,mount:this.mount,cx:e*(.5+this.centerX),cy:t*(.5+this.centerY)};this.fisheye?this.fisheye.updateConfig(r):this.fisheye=new qx(r),this.renderer||(this.renderer=new Ms(this.outputCanvas));const n=new VideoFrame(this.currentImageBitmap,{timestamp:0});let i=null,s=!1;try{i=await this.fisheye.undistort(n),n.close(),s=!0,await this.renderer.draw(i),i=null}finally{s||n.close(),i?.close(),this.isProcessing=!1}}catch(e){this.errorMessage=`Processing error: ${e}`,console.error(e)}}}enqueueProcessImage(){const e=this.processImagePromise;return this.processImagePromise=e.then(()=>this.processImage()).catch(()=>{}),this.processImagePromise}scheduleProcessImageDebounced(){this.processImageDebounceTimer!==null&&clearTimeout(this.processImageDebounceTimer),this.processImageDebounceTimer=setTimeout(()=>{this.processImageDebounceTimer=null,this.enqueueProcessImage()},re.PROCESS_IMAGE_DEBOUNCE_MS)}cancelProcessImageDebounce(){this.processImageDebounceTimer!==null&&(clearTimeout(this.processImageDebounceTimer),this.processImageDebounceTimer=null)}handleParamChange(e,t){this[e]=t,this.scheduleProcessImageDebounced()}async handlePresetChange(e){const t=Io.find(r=>r.id===e);t&&(this.cancelProcessImageDebounce(),this.presetId=t.id,this.projection=t.projection,this.mount=t.mount,this.fisheye=null,await this.enqueueProcessImage())}handleSidebarToggle(){this.sidebarOpen=!this.sidebarOpen}resetToDefaults(){this.presetId=null,this.projection=le.projection,this.mount=le.mount,this.balance=le.balance,this.fovScale=le.fovScale,this.k1=le.k1,this.k2=le.k2,this.k3=le.k3,this.k4=le.k4,this.centerX=le.centerX,this.centerY=le.centerY,this.fisheye=null,this.loadDefaultImage()}render(){return zt`
      <div class="container">
        <page-header></page-header>

        <div class="main">
          <div class="sidebar-container">
            <demo-sidebar
              .open=${this.sidebarOpen}
              @toggle=${this.handleSidebarToggle}
            ></demo-sidebar>
            <div class="sidebar-form ${this.sidebarOpen?"open":"closed"}">
              ${this.errorMessage&&!this.hasWebGPU?zt`<div class="error">${this.errorMessage}</div>`:zt`
                    <div class="control-group">
                      <h3>Image</h3>
                      <div class="file-input-wrapper">
                        <input
                          type="file"
                          accept="image/*"
                          @change=${this.handleFileUpload}
                        />
                        <div class="file-input-label">
                          <span></span>
                          Upload Image
                        </div>
                      </div>
                    </div>

                    <div class="control-group">
                      <h3>View preset</h3>
                      <p class="control-hint">Mount + projection (see src/types.ts)</p>
                      <div class="preset-buttons">
                        ${Io.map(e=>zt`
                            <button
                              class="preset-btn ${this.presetId!==null&&this.presetId===e.id?"active":""}"
                              @click=${()=>this.handlePresetChange(e.id)}
                            >
                              ${e.label}
                            </button>
                          `)}
                      </div>
                    </div>

                    <div class="control-group">
                      <h3>Distortion Coefficients</h3>
                      <p class="control-hint">OpenCV fisheye: _d = (1 + k1 + k2 + k3 + k4). Typical |k| &lt; 0.1.</p>
                      ${this.renderSlider("k1",this.k1,-.1,.1,1e-4)}
                      ${this.renderSlider("k2",this.k2,-.1,.1,1e-4)}
                      ${this.renderSlider("k3",this.k3,-.1,.1,1e-4)}
                      ${this.renderSlider("k4",this.k4,-.1,.1,1e-4)}
                    </div>

                    <div class="control-group">
                      <h3>Camera Parameters</h3>
                      <p class="control-hint">balance: 0 = all pixels, 1 = original FOV. fovScale: &gt;1 = zoom out, &lt;1 = zoom in.</p>
                      ${this.renderSlider("balance",this.balance,0,1,.01)}
                      ${this.renderSlider("fovScale",this.fovScale,.1,3,.01)}
                      ${this.renderSlider("centerX",this.centerX,-.5,.5,.001)}
                      ${this.renderSlider("centerY",this.centerY,-.5,.5,.001)}
                    </div>

                    <div class="control-group">
                      <button class="btn btn-secondary" @click=${this.resetToDefaults}>
                        Reset to Defaults
                      </button>
                    </div>
                  `}
            </div>
          </div>

          <div class="canvas-area">
            ${this.errorMessage&&this.hasWebGPU?zt`<div class="error">${this.errorMessage}</div>`:""}
            ${this.isProcessing?zt`
                  <div class="processing">
                    <div class="spinner"></div>
                    Processing...
                  </div>
                `:""}

            <div class="canvas-container">
              <div class="canvas-wrapper">
                <h4>Input (Fisheye)</h4>
                <canvas id="input-canvas" width="640" height="480"></canvas>
              </div>
              <div class="canvas-wrapper">
                <h4>Output (Dewarped)</h4>
                <canvas id="output-canvas" width="640" height="480"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    `}renderSlider(e,t,r,n,i){return zt`
      <div class="control-item">
        <label>
          ${e}
          <span>${t.toFixed(i<=1e-4?4:i<1?3:0)}</span>
        </label>
        <input
          type="range"
          min=${r}
          max=${n}
          step=${i}
          .value=${String(t)}
          @input=${s=>this.handleParamChange(e,Number(s.target.value))}
        />
      </div>
    `}};re.PROCESS_IMAGE_DEBOUNCE_MS=200;re.styles=wv;we([Se()],re.prototype,"k1",2);we([Se()],re.prototype,"k2",2);we([Se()],re.prototype,"k3",2);we([Se()],re.prototype,"k4",2);we([Se()],re.prototype,"balance",2);we([Se()],re.prototype,"fovScale",2);we([Se()],re.prototype,"centerX",2);we([Se()],re.prototype,"centerY",2);we([Se()],re.prototype,"presetId",2);we([Se()],re.prototype,"projection",2);we([Se()],re.prototype,"mount",2);we([Se()],re.prototype,"isProcessing",2);we([Se()],re.prototype,"errorMessage",2);we([Se()],re.prototype,"hasWebGPU",2);we([Se()],re.prototype,"sidebarOpen",2);we([dl("#output-canvas")],re.prototype,"outputCanvas",2);we([dl("#input-canvas")],re.prototype,"inputCanvas",2);re=we([Ia("fisheye-demo")],re);
