(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var ir="0.9.0",l=Symbol(`typegpu:${ir}:$internal`),F=Symbol(`typegpu:${ir}:$gpuValueOf`),ie=Symbol(`typegpu:${ir}:$getNameForward`),er=Symbol(`typegpu:${ir}:$providing`),ke=Symbol(`typegpu:${ir}:$ownSnippet`),z=Symbol(`typegpu:${ir}:$resolve`),Lr=Symbol(`typegpu:${ir}:$repr`);function C(e){return!!e?.[l]}var te={[l]:!0,type:"void",toString(){return"void"}},El=["bool","f32","f16","i32","u32","u16","vec2f","vec2h","vec2i","vec2u","vec2<bool>","vec3f","vec3h","vec3i","vec3u","vec3<bool>","vec4f","vec4h","vec4i","vec4u","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","struct","array","ptr","atomic","decorated","abstractInt","abstractFloat","void","texture_1d","texture_storage_1d","texture_2d","texture_storage_2d","texture_multisampled_2d","texture_depth_2d","texture_depth_multisampled_2d","texture_2d_array","texture_storage_2d_array","texture_depth_2d_array","texture_cube","texture_depth_cube","texture_cube_array","texture_depth_cube_array","texture_3d","texture_storage_3d","texture_external","sampler","sampler_comparison"];function Q(e){let t=e;return C(t)&&typeof t.kind=="string"&&t.kind.startsWith("vec")}function ns(e){let t=e;return C(t)&&typeof t.type=="string"&&t.type.startsWith("vec2")}function is(e){let t=e;return C(t)&&typeof t.type=="string"&&t.type.startsWith("vec3")}function Ao(e){let t=e;return C(t)&&typeof t.type=="string"&&t.type.startsWith("vec4")}function ct(e){return ns(e)||is(e)||Ao(e)}function ht(e){let t=e;return C(t)&&typeof t.kind?.startsWith=="function"&&t.kind.startsWith("mat")}function Co(e){return C(e)&&e?.type==="mat2x2f"}function Oo(e){return C(e)&&e?.type==="mat3x3f"}function kl(e){return C(e)&&e?.type==="mat4x4f"}function ui(e){return Co(e)||Oo(e)||kl(e)}function Va(e){return Q(e)&&["vec2f","vec3f","vec4f"].includes(e.kind)}function Nt(e){return C(e)&&El.includes(e?.type)}function Te(e){return C(e)&&e?.type==="array"}function fe(e){return C(e)&&e?.type==="struct"}function Ye(e){return C(e)&&e?.type==="ptr"}function hi(e){return C(e)&&e?.type==="atomic"}function Ps(e){return C(e)&&e?.type==="@align"}function Vs(e){return C(e)&&e?.type==="@size"}function Bo(e){return C(e)&&e?.type==="@location"}function Ml(e){return C(e)&&e?.type==="@interpolate"}function As(e){return C(e)&&e?.type==="@builtin"}function Xe(e){return C(e)&&e?.type==="decorated"}function Fo(e){return C(e)&&e.type==="void"}function jt(e){let t=e?.type;return C(e)&&(t==="abstractInt"||t==="abstractFloat"||t==="f32"||t==="f16"||t==="i32"||t==="u32")}function Cs(e){let t=e?.type;return C(e)&&(t==="f16"||t==="vec2h"||t==="vec3h"||t==="vec4h")}var Ul=["abstractInt","abstractFloat","f32","f16","i32","u32","bool"];function $e(e){return!C(e)||Ul.includes(e?.type)}function Pl(e){return e.schema}Object.assign(globalThis,{__TYPEGPU_AUTONAME__:(e,t)=>(Ti(e)&&C(e)&&!v(e)&&e.$name(t),e)});var ss=globalThis;function jo(e){return!!e?.[ie]}function v(e){return jo(e)?v(e[ie]):zi(e)?.name}function L(e,t){jo(e)&&L(e[ie],t),Vl(e,{name:t})}function Ti(e){return!!e?.$name}function ln(e){return!!zi(e)?.ast}function zi(e){return ss.__TYPEGPU_META__.get(e)}function Vl(e,t){ss.__TYPEGPU_META__??=new WeakMap;let r=ss.__TYPEGPU_META__;r.set(e,{...r.get(e),...t})}var Go=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],Al={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"};function Tt(e){return e.type==="decorated"||e.type==="loose-decorated"?e.inner:e}function Nn(e){return e.type==="ptr"?e.inner:e}var Cl=["unstruct","disarray","loose-decorated",...Go];function Rr(e){return C(e)&&Cl.includes(e?.type)}function zt(e){return C(e)&&e?.type==="disarray"}function Ze(e){return C(e)&&e?.type==="unstruct"}function Qe(e){return C(e)&&e?.type==="loose-decorated"}function cn(e){return e.attribs?.find(Ps)?.params[0]}function Ol(e){return e.attribs?.find(Vs)?.params[0]}function Gt(e){return e.attribs?.find(Bo)?.params[0]}function Dr(e){return Nt(e)||Rr(e)}var He={type:"unknown",toString(){return"unknown"}},Lo=class{constructor(t,r,n){this.name=t,this.lhs=r,this.operator=n}},Ro=class{constructor(t){this.matrix=t}},Aa=class{constructor(t){this.op=t,L(this,"consoleLog")}[l]=!0},Bl="Invariant failed";function lt(e,t){if(!e)throw new Error(Bl)}var Mr=class as extends Error{constructor(t,r){let n=r.map(i=>`- ${ln(i)?`fn*:${v(i)}`:i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Resolution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,as.prototype)}appendToTrace(t){let r=[t,...this.trace];return new as(this.cause,r)}},Ca=class os extends Error{constructor(t,r){let n=r.map(i=>`- ${i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Execution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,os.prototype)}appendToTrace(t){let r=[t,...this.trace];return new os(this.cause,r)}},Fl=class Do extends Error{constructor(t){super(`Missing value for '${t}'`),this.slot=t,Object.setPrototypeOf(this,Do.prototype)}},jl=class No extends Error{constructor(t){super(`Buffer '${v(t)??"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,No.prototype)}},Gl=class Wo extends Error{constructor(t,r){super(`The function '${t??"<unnamed>"}' is missing links to the following external values: ${r}.`),Object.setPrototypeOf(this,Wo.prototype)}},Os=class qo extends Error{constructor(t){super(`Missing bind groups for layouts: '${[...t].map(r=>v(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(bindGroup).(...)`),Object.setPrototypeOf(this,qo.prototype)}},Ho=class Yo extends Error{constructor(t){super(`Missing vertex buffers for layouts: '${[...t].map(r=>v(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(layout, buffer).(...)`),Object.setPrototypeOf(this,Yo.prototype)}},Oa=class Xo extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Xo.prototype)}},Ba=class Zo extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Zo.prototype)}},j=class Qo extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Qo.prototype)}};function us(e){return e?.resourceType==="slot"}function hs(e){return e?.resourceType==="derived"}function ls(e){return e?.[er]!==void 0}function Ii(e){return e?.resourceType==="accessor"}function Jo(e){return e==="runtime"||e==="constant"||e==="argument"}function Ur(e){return Jo(e.origin)}var Ll={uniform:{space:"uniform",access:"read"},readonly:{space:"storage",access:"read"},mutable:{space:"storage",access:"read-write"},workgroup:{space:"workgroup",access:"read-write"},private:{space:"private",access:"read-write"},function:{space:"function",access:"read-write"},"this-function":{space:"function",access:"read-write"}},Ko=class{constructor(t,r,n){this.value=t,this.dataType=r,this.origin=n}};function Bs(e){return e instanceof Ko}function Wn(e){return jt(e.dataType)}function y(e,t,r){return new Ko(e,Tt(t),r)}function Fs(e){return Et("function",e,"read-write")}function Rl(e){return Et("private",e,"read-write")}function Dl(e){return Et("workgroup",e,"read-write")}function Nl(e,t="read"){return Et("storage",e,t)}function Wl(e){return Et("uniform",e,"read")}function ql(e){return Et("handle",e,"read")}function Et(e,t,r,n=!1){return{[l]:!0,type:"ptr",addressSpace:e,inner:t,access:r,implicit:n,toString:()=>`ptr<${e}, ${t}, ${r}>`}}function eu(e,t){let r=Ll[e];if(r)return Et(r.space,t,r.access)}function Hl(e){return Et(e.addressSpace,e.inner,e.access,!0)}function Yl(e){return Et(e.addressSpace,e.inner,e.access,!1)}var zn=class{type="normal"},Xl=class{type="codegen"},Zl=class{constructor(t,r){this.buffers=t,this.vars=r}type="simulate"};function tu(e){return!!e?.[z]}function Si(e){return e?.[ke]}function Ue(e){return(typeof e.value!="string"||e.dataType.type==="unknown")&&Si(e.value)===void 0}function Ql(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||tu(e)||Nt(e)||us(e)||hs(e)||ls(e)}function cs(e){return!!e&&typeof e=="object"&&"getMappedRange"in e&&"mapAsync"in e}var Kn=!1;function Jl(e){if(Kn)return e();try{return Kn=!0,e()}finally{Kn=!1}}function li(){return Kn}var At;function ru(e,t){if(lt(At===void 0||At===e),At===e)return t();At=e;try{return t()}finally{At=void 0}}function Ve(){return At}var nu=new zn;function ci(){return At?.mode??nu}function Ke(){return At?.mode.type==="codegen"}function c(e,...t){let r=Ve();function n(s){return Bs(s)?r.resolve(s.value,s.dataType).value:s}let i="";for(let s=0;s<e.length;++s){i+=e[s];let a=t[s];Array.isArray(a)?i+=a.filter(o=>o!==void 0).map(n).join(", "):a&&(i+=n(a))}return i}var Kl=(()=>{let e=n=>{if(n.origin==="argument")throw new j(c`d.ref(${n}) is illegal, cannot take a reference of an argument. Copy the value locally first, and take a reference of the copy.`);if(n.dataType.type==="ptr")return y(n.value,Yl(n.dataType),n.origin);let i=eu(n.origin,n.dataType);return y(new bt(n,i),i??He,"runtime")},t=n=>new su(n),r=n=>Ke()?e(n):t(n);return L(r,"ref"),r.toString=()=>"ref",Object.defineProperty(r,l,{value:{jsImpl:t,gpuImpl:e,strictSignature:void 0,argConversionHint:"keep"}}),r})();function iu(e){return e instanceof su}var su=class{[l];type;#e;constructor(t){this[l]=!0,this.type="ref",this.#e=t}get $(){return this.#e}set $(t){if(t&&typeof t=="object")for(let r of Object.keys(t))this.#e[r]=t[r];else this.#e=t}},bt=class{[l];snippet;#e;constructor(t,r){this[l]=!0,this.snippet=t,this.#e=r}get[ke](){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return y(this,this.#e,this.snippet.origin)}[z](t){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return y(c`(&${this.snippet})`,this.#e,this.snippet.origin)}};function js(e){if(!Ye(e.dataType))return e;let t=e.dataType.inner,r=$e(t)?"runtime":e.origin;return e.value instanceof bt?y(c`${e.value.snippet}`,t,r):y(c`(*${e})`,t,r)}function Fr(e,t){throw new Error(`Failed to handle ${e} at ${t}`)}var Gs={rank:Number.POSITIVE_INFINITY,action:"none"};function pi(e,t){let r=Tt(e),n=Tt(t);if(r.type===n.type)return{rank:0,action:"none"};if(r.type==="abstractFloat"){if(n.type==="f32")return{rank:1,action:"none"};if(n.type==="f16")return{rank:2,action:"none"}}if(r.type==="abstractInt"){if(n.type==="i32")return{rank:3,action:"none"};if(n.type==="u32")return{rank:4,action:"none"};if(n.type==="abstractFloat")return{rank:5,action:"none"};if(n.type==="f32")return{rank:6,action:"none"};if(n.type==="f16")return{rank:7,action:"none"}}return ct(r)&&ct(n)?pi(r.primitive,n.primitive):ui(r)&&ui(n)?{rank:0,action:"none"}:Gs}function ec(e,t){let r=Tt(e),n=Tt(t);if(r.type==="ptr"&&r.implicit&&pi(r.inner,n).rank<Number.POSITIVE_INFINITY)return{rank:0,action:"deref"};if(n.type==="ptr"&&pi(r,n.inner).rank<Number.POSITIVE_INFINITY)return{rank:1,action:"ref"};let i={f32:0,f16:1,i32:2,u32:3,bool:4};if(r.type in i&&n.type in i){let s=r.type,a=n.type;if(s!==a){let o=i[s];return{rank:i[a]<o?10:20,action:"cast",targetType:n}}}if(r.type==="abstractFloat"){if(n.type==="u32")return{rank:2,action:"cast",targetType:n};if(n.type==="i32")return{rank:1,action:"cast",targetType:n}}return Gs}function tc(e,t,r){let n=pi(e,t);return n.rank<Number.POSITIVE_INFINITY?n:r?ec(e,t):Gs}function Fa(e,t,r){let n;for(let s of t){let a=[],o=0;for(let u of e){let h=tc(u,s,r);if(o+=h.rank,h.rank===Number.POSITIVE_INFINITY)break;a.push(h)}o<(n?.sum??Number.POSITIVE_INFINITY)&&(n={type:s,details:a,sum:o})}if(!n)return;let i=n.details.map((s,a)=>({sourceIndex:a,action:s.action,...s.action==="cast"&&{targetType:s.targetType}}));return{targetType:n.type,actions:i,hasImplicitConversions:i.some(s=>s.action==="cast")}}function Ls(e,t){if(e.length===0)return;let r=[...new Set((t||e).map(Tt))],n=Fa(e,r,!1);if(n)return n;let i=Fa(e,r,!0);if(i)return i}function rc(e,t,r){if(t.action==="none")return y(e.value,r,e.origin);switch(t.action){case"ref":return y(new bt(e,r),r,e.origin);case"deref":return js(e);case"cast":return r(e);default:Fr(t.action,"applyActionToSnippet")}}function me(e,t){if(e.some(n=>n.type==="unknown"))return;let r=Ls(e,t);if(r)return e.map(()=>r.targetType)}function Pr(e,t,r=!0){let n=e.map(s=>s.dataType);if(n.some(s=>s.type==="unknown"))return;let i=Ls(n,t);if(i)return e.map((s,a)=>{let o=i.actions[a];return lt(o),rc(s,o,i.targetType)})}function Qt(e,t,r=!0){if(t===e.dataType)return y(e.value,t,e.origin);if(e.dataType.type==="unknown")return y(c`${y(e.value,t,e.origin)}`,t,e.origin);let n=Pr([e],[t],r);if(!n)throw new j(`Cannot convert value of type '${String(e.dataType)}' to type '${t.type}'`);return n[0]}function nc(e,t){return Object.keys(e.propTypes).map(r=>{let n=t[r];if(!n)throw new Error(`Missing property ${r}`);let i=e.propTypes[r];return Pr([n],[i])?.[0]??n})}var Je=class extends Error{constructor(t){super(t),this.name=this.constructor.name}};function d(e){let t=(...n)=>{let i=Ve(),{argTypes:s,returnType:a}=typeof e.signature=="function"?e.signature(...n.map(u=>u.dataType.type==="ptr"&&u.dataType.implicit?u.dataType.inner:u.dataType)):e.signature,o=n.map((u,h)=>{let p=s[h];if(!p)throw new Error("Function called with invalid arguments");return Qt(u,p,!e.ignoreImplicitCastWarning)});if(!e.noComptime&&o.every(u=>Ue(u))&&typeof e.normalImpl=="function"){i.pushMode(new zn);try{return y(e.normalImpl(...o.map(u=>u.value)),a,"constant")}catch(u){if(!(u instanceof Je))throw u}finally{i.popMode("normal")}}return y(e.codegenImpl(...o),a,"runtime")},r=((...n)=>{if(Ke())return t(...n);if(typeof e.normalImpl=="string")throw new Je(e.normalImpl);return e.normalImpl(...n)});return L(r,e.name),r.toString=()=>e.name,Object.defineProperty(r,l,{value:{jsImpl:e.normalImpl,gpuImpl:t,get strictSignature(){return typeof e.signature!="function"?e.signature:void 0},argConversionHint:"keep"}}),r}var In={[l]:!0,type:"abstractInt",toString(){return"abstractInt"}},pt={[l]:!0,type:"abstractFloat",toString(){return"abstractFloat"}},ic=d({name:"bool",signature:e=>({argTypes:e?[e]:[],returnType:G}),normalImpl(e){return e===void 0?!1:typeof e=="boolean"?e:!!e},codegenImpl:e=>e.dataType.type==="bool"?c`${e}`:c`bool(${e})`}),G=Object.assign(ic,{type:"bool"}),sc=d({name:"u32",signature:e=>({argTypes:e?[e]:[],returnType:b}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:(e&4294967295)>>>0},codegenImpl:e=>e.dataType.type==="u32"?c`${e}`:c`u32(${e})`}),b=Object.assign(sc,{type:"u32"}),ac=d({name:"i32",signature:e=>({argTypes:e?[e]:[],returnType:B}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:e|0},codegenImpl:e=>e.dataType.type==="i32"?c`${e}`:c`i32(${e})`}),oc={[l]:!0,type:"u16"},B=Object.assign(ac,{type:"i32"}),uc=d({name:"f32",signature:e=>({argTypes:e?[e]:[],returnType:w}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Math.fround(e)},codegenImpl:e=>e.dataType.type==="f32"?c`${e}`:c`f32(${e})`}),w=Object.assign(uc,{type:"f32"}),au=new ArrayBuffer(4),hc=new Float32Array(au),lc=new Uint32Array(au);function cc(e){hc[0]=e;let t=lc[0],r=t>>>31&1,n=t>>>23&255,i=t&8388607;return n===255?r<<15|31744|(i?512:0):(n=n-127+15,n<=0?n<-10?r<<15:(i=(i|8388608)>>1-n,i=i+4096>>13,r<<15|i):n>=31||(i=i+4096,i&8388608&&(i=0,++n,n>=31))?r<<15|31744:r<<15|n<<10|i>>13)}function pc(e){let t=e&32768?-1:1,r=e>>10&31,n=e&1023;return r===0?n?t*n*2**-24:t*0:r===31?n?Number.NaN:t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t*(1+n/1024)*2**(r-15)}function dc(e){return pc(cc(e))}var fc=d({name:"f16",signature:e=>({argTypes:e?[e]:[],returnType:se}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:dc(e)},codegenImpl:e=>e.dataType.type==="f16"?c`${e}`:c`f16(${e})`}),se=Object.assign(fc,{type:"f16"}),sr=class extends Array{castElement(){return this[l].elementSchema[l].jsImpl}[z](){let t=this[l].elementSchema;return this.every(r=>!r)?y(`${this.kind}()`,t,"constant"):this.every(r=>this[0]===r)?y(`${this.kind}(${this[0]})`,t,"runtime"):y(`${this.kind}(${this.join(", ")})`,t,"runtime")}toString(){return this[z]().value}get xx(){return new this._Vec2(this[0],this[0])}get xy(){return new this._Vec2(this[0],this[1])}get xz(){return new this._Vec2(this[0],this[2])}get xw(){return new this._Vec2(this[0],this[3])}get yx(){return new this._Vec2(this[1],this[0])}get yy(){return new this._Vec2(this[1],this[1])}get yz(){return new this._Vec2(this[1],this[2])}get yw(){return new this._Vec2(this[1],this[3])}get zx(){return new this._Vec2(this[2],this[0])}get zy(){return new this._Vec2(this[2],this[1])}get zz(){return new this._Vec2(this[2],this[2])}get zw(){return new this._Vec2(this[2],this[3])}get wx(){return new this._Vec2(this[3],this[0])}get wy(){return new this._Vec2(this[3],this[1])}get wz(){return new this._Vec2(this[3],this[2])}get ww(){return new this._Vec2(this[3],this[3])}get xxx(){return new this._Vec3(this[0],this[0],this[0])}get xxy(){return new this._Vec3(this[0],this[0],this[1])}get xxz(){return new this._Vec3(this[0],this[0],this[2])}get xxw(){return new this._Vec3(this[0],this[0],this[3])}get xyx(){return new this._Vec3(this[0],this[1],this[0])}get xyy(){return new this._Vec3(this[0],this[1],this[1])}get xyz(){return new this._Vec3(this[0],this[1],this[2])}get xyw(){return new this._Vec3(this[0],this[1],this[3])}get xzx(){return new this._Vec3(this[0],this[2],this[0])}get xzy(){return new this._Vec3(this[0],this[2],this[1])}get xzz(){return new this._Vec3(this[0],this[2],this[2])}get xzw(){return new this._Vec3(this[0],this[2],this[3])}get xwx(){return new this._Vec3(this[0],this[3],this[0])}get xwy(){return new this._Vec3(this[0],this[3],this[1])}get xwz(){return new this._Vec3(this[0],this[3],this[2])}get xww(){return new this._Vec3(this[0],this[3],this[3])}get yxx(){return new this._Vec3(this[1],this[0],this[0])}get yxy(){return new this._Vec3(this[1],this[0],this[1])}get yxz(){return new this._Vec3(this[1],this[0],this[2])}get yxw(){return new this._Vec3(this[1],this[0],this[3])}get yyx(){return new this._Vec3(this[1],this[1],this[0])}get yyy(){return new this._Vec3(this[1],this[1],this[1])}get yyz(){return new this._Vec3(this[1],this[1],this[2])}get yyw(){return new this._Vec3(this[1],this[1],this[3])}get yzx(){return new this._Vec3(this[1],this[2],this[0])}get yzy(){return new this._Vec3(this[1],this[2],this[1])}get yzz(){return new this._Vec3(this[1],this[2],this[2])}get yzw(){return new this._Vec3(this[1],this[2],this[3])}get ywx(){return new this._Vec3(this[1],this[3],this[0])}get ywy(){return new this._Vec3(this[1],this[3],this[1])}get ywz(){return new this._Vec3(this[1],this[3],this[2])}get yww(){return new this._Vec3(this[1],this[3],this[3])}get zxx(){return new this._Vec3(this[2],this[0],this[0])}get zxy(){return new this._Vec3(this[2],this[0],this[1])}get zxz(){return new this._Vec3(this[2],this[0],this[2])}get zxw(){return new this._Vec3(this[2],this[0],this[3])}get zyx(){return new this._Vec3(this[2],this[1],this[0])}get zyy(){return new this._Vec3(this[2],this[1],this[1])}get zyz(){return new this._Vec3(this[2],this[1],this[2])}get zyw(){return new this._Vec3(this[2],this[1],this[3])}get zzx(){return new this._Vec3(this[2],this[2],this[0])}get zzy(){return new this._Vec3(this[2],this[2],this[1])}get zzz(){return new this._Vec3(this[2],this[2],this[2])}get zzw(){return new this._Vec3(this[2],this[2],this[3])}get zwx(){return new this._Vec3(this[2],this[3],this[0])}get zwy(){return new this._Vec3(this[2],this[3],this[1])}get zwz(){return new this._Vec3(this[2],this[3],this[2])}get zww(){return new this._Vec3(this[2],this[3],this[3])}get wxx(){return new this._Vec3(this[3],this[0],this[0])}get wxy(){return new this._Vec3(this[3],this[0],this[1])}get wxz(){return new this._Vec3(this[3],this[0],this[2])}get wxw(){return new this._Vec3(this[3],this[0],this[3])}get wyx(){return new this._Vec3(this[3],this[1],this[0])}get wyy(){return new this._Vec3(this[3],this[1],this[1])}get wyz(){return new this._Vec3(this[3],this[1],this[2])}get wyw(){return new this._Vec3(this[3],this[1],this[3])}get wzx(){return new this._Vec3(this[3],this[2],this[0])}get wzy(){return new this._Vec3(this[3],this[2],this[1])}get wzz(){return new this._Vec3(this[3],this[2],this[2])}get wzw(){return new this._Vec3(this[3],this[2],this[3])}get wwx(){return new this._Vec3(this[3],this[3],this[0])}get wwy(){return new this._Vec3(this[3],this[3],this[1])}get wwz(){return new this._Vec3(this[3],this[3],this[2])}get www(){return new this._Vec3(this[3],this[3],this[3])}get xxxx(){return new this._Vec4(this[0],this[0],this[0],this[0])}get xxxy(){return new this._Vec4(this[0],this[0],this[0],this[1])}get xxxz(){return new this._Vec4(this[0],this[0],this[0],this[2])}get xxxw(){return new this._Vec4(this[0],this[0],this[0],this[3])}get xxyx(){return new this._Vec4(this[0],this[0],this[1],this[0])}get xxyy(){return new this._Vec4(this[0],this[0],this[1],this[1])}get xxyz(){return new this._Vec4(this[0],this[0],this[1],this[2])}get xxyw(){return new this._Vec4(this[0],this[0],this[1],this[3])}get xxzx(){return new this._Vec4(this[0],this[0],this[2],this[0])}get xxzy(){return new this._Vec4(this[0],this[0],this[2],this[1])}get xxzz(){return new this._Vec4(this[0],this[0],this[2],this[2])}get xxzw(){return new this._Vec4(this[0],this[0],this[2],this[3])}get xxwx(){return new this._Vec4(this[0],this[0],this[3],this[0])}get xxwy(){return new this._Vec4(this[0],this[0],this[3],this[1])}get xxwz(){return new this._Vec4(this[0],this[0],this[3],this[2])}get xxww(){return new this._Vec4(this[0],this[0],this[3],this[3])}get xyxx(){return new this._Vec4(this[0],this[1],this[0],this[0])}get xyxy(){return new this._Vec4(this[0],this[1],this[0],this[1])}get xyxz(){return new this._Vec4(this[0],this[1],this[0],this[2])}get xyxw(){return new this._Vec4(this[0],this[1],this[0],this[3])}get xyyx(){return new this._Vec4(this[0],this[1],this[1],this[0])}get xyyy(){return new this._Vec4(this[0],this[1],this[1],this[1])}get xyyz(){return new this._Vec4(this[0],this[1],this[1],this[2])}get xyyw(){return new this._Vec4(this[0],this[1],this[1],this[3])}get xyzx(){return new this._Vec4(this[0],this[1],this[2],this[0])}get xyzy(){return new this._Vec4(this[0],this[1],this[2],this[1])}get xyzz(){return new this._Vec4(this[0],this[1],this[2],this[2])}get xyzw(){return new this._Vec4(this[0],this[1],this[2],this[3])}get xywx(){return new this._Vec4(this[0],this[1],this[3],this[0])}get xywy(){return new this._Vec4(this[0],this[1],this[3],this[1])}get xywz(){return new this._Vec4(this[0],this[1],this[3],this[2])}get xyww(){return new this._Vec4(this[0],this[1],this[3],this[3])}get xzxx(){return new this._Vec4(this[0],this[2],this[0],this[0])}get xzxy(){return new this._Vec4(this[0],this[2],this[0],this[1])}get xzxz(){return new this._Vec4(this[0],this[2],this[0],this[2])}get xzxw(){return new this._Vec4(this[0],this[2],this[0],this[3])}get xzyx(){return new this._Vec4(this[0],this[2],this[1],this[0])}get xzyy(){return new this._Vec4(this[0],this[2],this[1],this[1])}get xzyz(){return new this._Vec4(this[0],this[2],this[1],this[2])}get xzyw(){return new this._Vec4(this[0],this[2],this[1],this[3])}get xzzx(){return new this._Vec4(this[0],this[2],this[2],this[0])}get xzzy(){return new this._Vec4(this[0],this[2],this[2],this[1])}get xzzz(){return new this._Vec4(this[0],this[2],this[2],this[2])}get xzzw(){return new this._Vec4(this[0],this[2],this[2],this[3])}get xzwx(){return new this._Vec4(this[0],this[2],this[3],this[0])}get xzwy(){return new this._Vec4(this[0],this[2],this[3],this[1])}get xzwz(){return new this._Vec4(this[0],this[2],this[3],this[2])}get xzww(){return new this._Vec4(this[0],this[2],this[3],this[3])}get xwxx(){return new this._Vec4(this[0],this[3],this[0],this[0])}get xwxy(){return new this._Vec4(this[0],this[3],this[0],this[1])}get xwxz(){return new this._Vec4(this[0],this[3],this[0],this[2])}get xwxw(){return new this._Vec4(this[0],this[3],this[0],this[3])}get xwyx(){return new this._Vec4(this[0],this[3],this[1],this[0])}get xwyy(){return new this._Vec4(this[0],this[3],this[1],this[1])}get xwyz(){return new this._Vec4(this[0],this[3],this[1],this[2])}get xwyw(){return new this._Vec4(this[0],this[3],this[1],this[3])}get xwzx(){return new this._Vec4(this[0],this[3],this[2],this[0])}get xwzy(){return new this._Vec4(this[0],this[3],this[2],this[1])}get xwzz(){return new this._Vec4(this[0],this[3],this[2],this[2])}get xwzw(){return new this._Vec4(this[0],this[3],this[2],this[3])}get xwwx(){return new this._Vec4(this[0],this[3],this[3],this[0])}get xwwy(){return new this._Vec4(this[0],this[3],this[3],this[1])}get xwwz(){return new this._Vec4(this[0],this[3],this[3],this[2])}get xwww(){return new this._Vec4(this[0],this[3],this[3],this[3])}get yxxx(){return new this._Vec4(this[1],this[0],this[0],this[0])}get yxxy(){return new this._Vec4(this[1],this[0],this[0],this[1])}get yxxz(){return new this._Vec4(this[1],this[0],this[0],this[2])}get yxxw(){return new this._Vec4(this[1],this[0],this[0],this[3])}get yxyx(){return new this._Vec4(this[1],this[0],this[1],this[0])}get yxyy(){return new this._Vec4(this[1],this[0],this[1],this[1])}get yxyz(){return new this._Vec4(this[1],this[0],this[1],this[2])}get yxyw(){return new this._Vec4(this[1],this[0],this[1],this[3])}get yxzx(){return new this._Vec4(this[1],this[0],this[2],this[0])}get yxzy(){return new this._Vec4(this[1],this[0],this[2],this[1])}get yxzz(){return new this._Vec4(this[1],this[0],this[2],this[2])}get yxzw(){return new this._Vec4(this[1],this[0],this[2],this[3])}get yxwx(){return new this._Vec4(this[1],this[0],this[3],this[0])}get yxwy(){return new this._Vec4(this[1],this[0],this[3],this[1])}get yxwz(){return new this._Vec4(this[1],this[0],this[3],this[2])}get yxww(){return new this._Vec4(this[1],this[0],this[3],this[3])}get yyxx(){return new this._Vec4(this[1],this[1],this[0],this[0])}get yyxy(){return new this._Vec4(this[1],this[1],this[0],this[1])}get yyxz(){return new this._Vec4(this[1],this[1],this[0],this[2])}get yyxw(){return new this._Vec4(this[1],this[1],this[0],this[3])}get yyyx(){return new this._Vec4(this[1],this[1],this[1],this[0])}get yyyy(){return new this._Vec4(this[1],this[1],this[1],this[1])}get yyyz(){return new this._Vec4(this[1],this[1],this[1],this[2])}get yyyw(){return new this._Vec4(this[1],this[1],this[1],this[3])}get yyzx(){return new this._Vec4(this[1],this[1],this[2],this[0])}get yyzy(){return new this._Vec4(this[1],this[1],this[2],this[1])}get yyzz(){return new this._Vec4(this[1],this[1],this[2],this[2])}get yyzw(){return new this._Vec4(this[1],this[1],this[2],this[3])}get yywx(){return new this._Vec4(this[1],this[1],this[3],this[0])}get yywy(){return new this._Vec4(this[1],this[1],this[3],this[1])}get yywz(){return new this._Vec4(this[1],this[1],this[3],this[2])}get yyww(){return new this._Vec4(this[1],this[1],this[3],this[3])}get yzxx(){return new this._Vec4(this[1],this[2],this[0],this[0])}get yzxy(){return new this._Vec4(this[1],this[2],this[0],this[1])}get yzxz(){return new this._Vec4(this[1],this[2],this[0],this[2])}get yzxw(){return new this._Vec4(this[1],this[2],this[0],this[3])}get yzyx(){return new this._Vec4(this[1],this[2],this[1],this[0])}get yzyy(){return new this._Vec4(this[1],this[2],this[1],this[1])}get yzyz(){return new this._Vec4(this[1],this[2],this[1],this[2])}get yzyw(){return new this._Vec4(this[1],this[2],this[1],this[3])}get yzzx(){return new this._Vec4(this[1],this[2],this[2],this[0])}get yzzy(){return new this._Vec4(this[1],this[2],this[2],this[1])}get yzzz(){return new this._Vec4(this[1],this[2],this[2],this[2])}get yzzw(){return new this._Vec4(this[1],this[2],this[2],this[3])}get yzwx(){return new this._Vec4(this[1],this[2],this[3],this[0])}get yzwy(){return new this._Vec4(this[1],this[2],this[3],this[1])}get yzwz(){return new this._Vec4(this[1],this[2],this[3],this[2])}get yzww(){return new this._Vec4(this[1],this[2],this[3],this[3])}get ywxx(){return new this._Vec4(this[1],this[3],this[0],this[0])}get ywxy(){return new this._Vec4(this[1],this[3],this[0],this[1])}get ywxz(){return new this._Vec4(this[1],this[3],this[0],this[2])}get ywxw(){return new this._Vec4(this[1],this[3],this[0],this[3])}get ywyx(){return new this._Vec4(this[1],this[3],this[1],this[0])}get ywyy(){return new this._Vec4(this[1],this[3],this[1],this[1])}get ywyz(){return new this._Vec4(this[1],this[3],this[1],this[2])}get ywyw(){return new this._Vec4(this[1],this[3],this[1],this[3])}get ywzx(){return new this._Vec4(this[1],this[3],this[2],this[0])}get ywzy(){return new this._Vec4(this[1],this[3],this[2],this[1])}get ywzz(){return new this._Vec4(this[1],this[3],this[2],this[2])}get ywzw(){return new this._Vec4(this[1],this[3],this[2],this[3])}get ywwx(){return new this._Vec4(this[1],this[3],this[3],this[0])}get ywwy(){return new this._Vec4(this[1],this[3],this[3],this[1])}get ywwz(){return new this._Vec4(this[1],this[3],this[3],this[2])}get ywww(){return new this._Vec4(this[1],this[3],this[3],this[3])}get zxxx(){return new this._Vec4(this[2],this[0],this[0],this[0])}get zxxy(){return new this._Vec4(this[2],this[0],this[0],this[1])}get zxxz(){return new this._Vec4(this[2],this[0],this[0],this[2])}get zxxw(){return new this._Vec4(this[2],this[0],this[0],this[3])}get zxyx(){return new this._Vec4(this[2],this[0],this[1],this[0])}get zxyy(){return new this._Vec4(this[2],this[0],this[1],this[1])}get zxyz(){return new this._Vec4(this[2],this[0],this[1],this[2])}get zxyw(){return new this._Vec4(this[2],this[0],this[1],this[3])}get zxzx(){return new this._Vec4(this[2],this[0],this[2],this[0])}get zxzy(){return new this._Vec4(this[2],this[0],this[2],this[1])}get zxzz(){return new this._Vec4(this[2],this[0],this[2],this[2])}get zxzw(){return new this._Vec4(this[2],this[0],this[2],this[3])}get zxwx(){return new this._Vec4(this[2],this[0],this[3],this[0])}get zxwy(){return new this._Vec4(this[2],this[0],this[3],this[1])}get zxwz(){return new this._Vec4(this[2],this[0],this[3],this[2])}get zxww(){return new this._Vec4(this[2],this[0],this[3],this[3])}get zyxx(){return new this._Vec4(this[2],this[1],this[0],this[0])}get zyxy(){return new this._Vec4(this[2],this[1],this[0],this[1])}get zyxz(){return new this._Vec4(this[2],this[1],this[0],this[2])}get zyxw(){return new this._Vec4(this[2],this[1],this[0],this[3])}get zyyx(){return new this._Vec4(this[2],this[1],this[1],this[0])}get zyyy(){return new this._Vec4(this[2],this[1],this[1],this[1])}get zyyz(){return new this._Vec4(this[2],this[1],this[1],this[2])}get zyyw(){return new this._Vec4(this[2],this[1],this[1],this[3])}get zyzx(){return new this._Vec4(this[2],this[1],this[2],this[0])}get zyzy(){return new this._Vec4(this[2],this[1],this[2],this[1])}get zyzz(){return new this._Vec4(this[2],this[1],this[2],this[2])}get zyzw(){return new this._Vec4(this[2],this[1],this[2],this[3])}get zywx(){return new this._Vec4(this[2],this[1],this[3],this[0])}get zywy(){return new this._Vec4(this[2],this[1],this[3],this[1])}get zywz(){return new this._Vec4(this[2],this[1],this[3],this[2])}get zyww(){return new this._Vec4(this[2],this[1],this[3],this[3])}get zzxx(){return new this._Vec4(this[2],this[2],this[0],this[0])}get zzxy(){return new this._Vec4(this[2],this[2],this[0],this[1])}get zzxz(){return new this._Vec4(this[2],this[2],this[0],this[2])}get zzxw(){return new this._Vec4(this[2],this[2],this[0],this[3])}get zzyx(){return new this._Vec4(this[2],this[2],this[1],this[0])}get zzyy(){return new this._Vec4(this[2],this[2],this[1],this[1])}get zzyz(){return new this._Vec4(this[2],this[2],this[1],this[2])}get zzyw(){return new this._Vec4(this[2],this[2],this[1],this[3])}get zzzx(){return new this._Vec4(this[2],this[2],this[2],this[0])}get zzzy(){return new this._Vec4(this[2],this[2],this[2],this[1])}get zzzz(){return new this._Vec4(this[2],this[2],this[2],this[2])}get zzzw(){return new this._Vec4(this[2],this[2],this[2],this[3])}get zzwx(){return new this._Vec4(this[2],this[2],this[3],this[0])}get zzwy(){return new this._Vec4(this[2],this[2],this[3],this[1])}get zzwz(){return new this._Vec4(this[2],this[2],this[3],this[2])}get zzww(){return new this._Vec4(this[2],this[2],this[3],this[3])}get zwxx(){return new this._Vec4(this[2],this[3],this[0],this[0])}get zwxy(){return new this._Vec4(this[2],this[3],this[0],this[1])}get zwxz(){return new this._Vec4(this[2],this[3],this[0],this[2])}get zwxw(){return new this._Vec4(this[2],this[3],this[0],this[3])}get zwyx(){return new this._Vec4(this[2],this[3],this[1],this[0])}get zwyy(){return new this._Vec4(this[2],this[3],this[1],this[1])}get zwyz(){return new this._Vec4(this[2],this[3],this[1],this[2])}get zwyw(){return new this._Vec4(this[2],this[3],this[1],this[3])}get zwzx(){return new this._Vec4(this[2],this[3],this[2],this[0])}get zwzy(){return new this._Vec4(this[2],this[3],this[2],this[1])}get zwzz(){return new this._Vec4(this[2],this[3],this[2],this[2])}get zwzw(){return new this._Vec4(this[2],this[3],this[2],this[3])}get zwwx(){return new this._Vec4(this[2],this[3],this[3],this[0])}get zwwy(){return new this._Vec4(this[2],this[3],this[3],this[1])}get zwwz(){return new this._Vec4(this[2],this[3],this[3],this[2])}get zwww(){return new this._Vec4(this[2],this[3],this[3],this[3])}get wxxx(){return new this._Vec4(this[3],this[0],this[0],this[0])}get wxxy(){return new this._Vec4(this[3],this[0],this[0],this[1])}get wxxz(){return new this._Vec4(this[3],this[0],this[0],this[2])}get wxxw(){return new this._Vec4(this[3],this[0],this[0],this[3])}get wxyx(){return new this._Vec4(this[3],this[0],this[1],this[0])}get wxyy(){return new this._Vec4(this[3],this[0],this[1],this[1])}get wxyz(){return new this._Vec4(this[3],this[0],this[1],this[2])}get wxyw(){return new this._Vec4(this[3],this[0],this[1],this[3])}get wxzx(){return new this._Vec4(this[3],this[0],this[2],this[0])}get wxzy(){return new this._Vec4(this[3],this[0],this[2],this[1])}get wxzz(){return new this._Vec4(this[3],this[0],this[2],this[2])}get wxzw(){return new this._Vec4(this[3],this[0],this[2],this[3])}get wxwx(){return new this._Vec4(this[3],this[0],this[3],this[0])}get wxwy(){return new this._Vec4(this[3],this[0],this[3],this[1])}get wxwz(){return new this._Vec4(this[3],this[0],this[3],this[2])}get wxww(){return new this._Vec4(this[3],this[0],this[3],this[3])}get wyxx(){return new this._Vec4(this[3],this[1],this[0],this[0])}get wyxy(){return new this._Vec4(this[3],this[1],this[0],this[1])}get wyxz(){return new this._Vec4(this[3],this[1],this[0],this[2])}get wyxw(){return new this._Vec4(this[3],this[1],this[0],this[3])}get wyyx(){return new this._Vec4(this[3],this[1],this[1],this[0])}get wyyy(){return new this._Vec4(this[3],this[1],this[1],this[1])}get wyyz(){return new this._Vec4(this[3],this[1],this[1],this[2])}get wyyw(){return new this._Vec4(this[3],this[1],this[1],this[3])}get wyzx(){return new this._Vec4(this[3],this[1],this[2],this[0])}get wyzy(){return new this._Vec4(this[3],this[1],this[2],this[1])}get wyzz(){return new this._Vec4(this[3],this[1],this[2],this[2])}get wyzw(){return new this._Vec4(this[3],this[1],this[2],this[3])}get wywx(){return new this._Vec4(this[3],this[1],this[3],this[0])}get wywy(){return new this._Vec4(this[3],this[1],this[3],this[1])}get wywz(){return new this._Vec4(this[3],this[1],this[3],this[2])}get wyww(){return new this._Vec4(this[3],this[1],this[3],this[3])}get wzxx(){return new this._Vec4(this[3],this[2],this[0],this[0])}get wzxy(){return new this._Vec4(this[3],this[2],this[0],this[1])}get wzxz(){return new this._Vec4(this[3],this[2],this[0],this[2])}get wzxw(){return new this._Vec4(this[3],this[2],this[0],this[3])}get wzyx(){return new this._Vec4(this[3],this[2],this[1],this[0])}get wzyy(){return new this._Vec4(this[3],this[2],this[1],this[1])}get wzyz(){return new this._Vec4(this[3],this[2],this[1],this[2])}get wzyw(){return new this._Vec4(this[3],this[2],this[1],this[3])}get wzzx(){return new this._Vec4(this[3],this[2],this[2],this[0])}get wzzy(){return new this._Vec4(this[3],this[2],this[2],this[1])}get wzzz(){return new this._Vec4(this[3],this[2],this[2],this[2])}get wzzw(){return new this._Vec4(this[3],this[2],this[2],this[3])}get wzwx(){return new this._Vec4(this[3],this[2],this[3],this[0])}get wzwy(){return new this._Vec4(this[3],this[2],this[3],this[1])}get wzwz(){return new this._Vec4(this[3],this[2],this[3],this[2])}get wzww(){return new this._Vec4(this[3],this[2],this[3],this[3])}get wwxx(){return new this._Vec4(this[3],this[3],this[0],this[0])}get wwxy(){return new this._Vec4(this[3],this[3],this[0],this[1])}get wwxz(){return new this._Vec4(this[3],this[3],this[0],this[2])}get wwxw(){return new this._Vec4(this[3],this[3],this[0],this[3])}get wwyx(){return new this._Vec4(this[3],this[3],this[1],this[0])}get wwyy(){return new this._Vec4(this[3],this[3],this[1],this[1])}get wwyz(){return new this._Vec4(this[3],this[3],this[1],this[2])}get wwyw(){return new this._Vec4(this[3],this[3],this[1],this[3])}get wwzx(){return new this._Vec4(this[3],this[3],this[2],this[0])}get wwzy(){return new this._Vec4(this[3],this[3],this[2],this[1])}get wwzz(){return new this._Vec4(this[3],this[3],this[2],this[2])}get wwzw(){return new this._Vec4(this[3],this[3],this[2],this[3])}get wwwx(){return new this._Vec4(this[3],this[3],this[3],this[0])}get wwwy(){return new this._Vec4(this[3],this[3],this[3],this[1])}get wwwz(){return new this._Vec4(this[3],this[3],this[3],this[2])}get wwww(){return new this._Vec4(this[3],this[3],this[3],this[3])}},Sn=class extends sr{e0;e1;constructor(t,r){super(2),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t)}get 0(){return this.e0}get 1(){return this.e1}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}},En=class extends sr{e0;e1;e2;constructor(t,r,n){super(3),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}set z(t){this[2]=this.castElement()(t)}},kn=class extends sr{e0;e1;e2;e3;constructor(t,r,n,i){super(4),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t),this.e3=this.castElement()(i??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}get 3(){return this.e3}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}set 3(t){this.e3=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set w(t){this[3]=t}},Rs=class ou extends Sn{get[l](){return{elementSchema:w}}get kind(){return"vec2f"}get _Vec2(){return ou}get _Vec3(){return Hs}get _Vec4(){return Js}},Ds=class uu extends Sn{get[l](){return{elementSchema:se}}get kind(){return"vec2h"}get _Vec2(){return uu}get _Vec3(){return Ys}get _Vec4(){return Ks}},Ns=class hu extends Sn{get[l](){return{elementSchema:B}}get kind(){return"vec2i"}get _Vec2(){return hu}get _Vec3(){return Xs}get _Vec4(){return ea}},Ws=class lu extends Sn{get[l](){return{elementSchema:b}}get kind(){return"vec2u"}get _Vec2(){return lu}get _Vec3(){return Zs}get _Vec4(){return ta}},qs=class cu extends Sn{get[l](){return{elementSchema:G}}get kind(){return"vec2<bool>"}get _Vec2(){return cu}get _Vec3(){return Qs}get _Vec4(){return ra}},Hs=class pu extends En{get[l](){return{elementSchema:w}}get kind(){return"vec3f"}get _Vec2(){return Rs}get _Vec3(){return pu}get _Vec4(){return Js}},Ys=class du extends En{get[l](){return{elementSchema:se}}get kind(){return"vec3h"}get _Vec2(){return Ds}get _Vec3(){return du}get _Vec4(){return Ks}},Xs=class fu extends En{get[l](){return{elementSchema:B}}get kind(){return"vec3i"}get _Vec2(){return Ns}get _Vec3(){return fu}get _Vec4(){return ea}},Zs=class mu extends En{get[l](){return{elementSchema:b}}get kind(){return"vec3u"}get _Vec2(){return Ws}get _Vec3(){return mu}get _Vec4(){return ta}},Qs=class yu extends En{get[l](){return{elementSchema:G}}get kind(){return"vec3<bool>"}get _Vec2(){return qs}get _Vec3(){return yu}get _Vec4(){return ra}},Js=class gu extends kn{get[l](){return{elementSchema:w}}get kind(){return"vec4f"}get _Vec2(){return Rs}get _Vec3(){return Hs}get _Vec4(){return gu}},Ks=class wu extends kn{get[l](){return{elementSchema:se}}get kind(){return"vec4h"}get _Vec2(){return Ds}get _Vec3(){return Ys}get _Vec4(){return wu}},ea=class xu extends kn{get[l](){return{elementSchema:B}}get kind(){return"vec4i"}get _Vec2(){return Ns}get _Vec3(){return Xs}get _Vec4(){return xu}},ta=class vu extends kn{get[l](){return{elementSchema:b}}get kind(){return"vec4u"}get _Vec2(){return Ws}get _Vec3(){return Zs}get _Vec4(){return vu}},ra=class $u extends kn{get[l](){return{elementSchema:G}}get kind(){return"vec4<bool>"}get _Vec2(){return qs}get _Vec3(){return Qs}get _Vec4(){return $u}},D=ze(Rs,w),dt=ze(Ds,se),ee=ze(Ns,B),Ee=ze(Ws,b),ar=ze(qs,G),ae=ze(Hs,w),ft=ze(Ys,se),Ae=ze(Xs,B),re=ze(Zs,b),or=ze(Qs,G),I=ze(Js,w),mt=ze(Ks,se),ce=ze(ea,B),ge=ze(ta,b),ur=ze(ra,G),di={vec2f:D,vec2h:dt,vec2i:ee,vec2u:Ee,"vec2<bool>":ar,vec3f:ae,vec3h:ft,vec3i:Ae,vec3u:re,"vec3<bool>":or,vec4f:I,vec4h:mt,vec4i:ce,vec4u:ge,"vec4<bool>":ur};function ze(e,t){let{kind:r,length:n}=new e,i=d({name:r,signature:(...a)=>({argTypes:a.map(o=>ct(o)?o:t),returnType:s}),normalImpl:(...a)=>{let o=new Array(a.length),u=0;for(let h of a)if(typeof h=="number"||typeof h=="boolean")o[u++]=h;else for(let p=0;p<h.length;++p)o[u++]=h[p];if(o.length<=1||o.length===n)return new e(...o);throw new Error(`'${r}' constructor called with invalid number of arguments.`)},ignoreImplicitCastWarning:!0,codegenImpl:(...a)=>a.length===1&&a[0]?.dataType===s?c`${a[0]}`:c`${r}(${a})`}),s=Object.assign(i,{type:r,primitive:t,[Lr]:void 0});return e.prototype.schema=s,s}function fi(e){return e>=2**63||e<-9223372036854776e3?y(e,pt,"constant"):Number.isInteger(e)?(Number.isSafeInteger(e)||console.warn(`The integer ${e} exceeds the safe integer range and may have lost precision.`),y(e,In,"constant")):y(e,pt,"constant")}function Ct(e){return e.type==="abstractFloat"?w:e.type==="abstractInt"?B:e}function mc(e){return e.map(t=>y(t.value,Ct(t.dataType),t.origin))}function Ei(e){if(Bs(e))return e;if(iu(e))throw new Error("Cannot use refs (d.ref(...)) from the outer scope.");return Si(e)||(Q(e)||ht(e)?y(e,Pl(e),"constant"):typeof e=="string"||typeof e=="function"||typeof e=="object"||typeof e=="symbol"||typeof e>"u"||e===null?y(e,He,"constant"):typeof e=="number"?fi(e):typeof e=="boolean"?y(e,G,"constant"):y(e,He,"constant"))}function Lt(e){let t=(...n)=>{let i=n;if(!i.every(s=>Ue(s)))throw new j(`Called comptime function with runtime-known values: ${i.filter(s=>!Ue(s)).map(s=>`'${s.value}'`).join(", ")}`);return Ei(e(...i.map(s=>s.value)))},r=((...n)=>{let i=Ve();if(i?.mode.type==="codegen"){i.pushMode(new zn);try{return t(...n)}finally{i.popMode("normal")}}return e(...n)});return r.toString=()=>"comptime",r[ie]=e,r.$name=n=>(L(e,n),r),Object.defineProperty(r,l,{value:{jsImpl:e,gpuImpl:t,argConversionHint:"keep"}}),r}var S=class{constructor(t){this.type=t}[l]=!0},It={uint8:b,uint8x2:Ee,uint8x4:ge,sint8:B,sint8x2:ee,sint8x4:ce,unorm8:w,unorm8x2:D,unorm8x4:I,snorm8:w,snorm8x2:D,snorm8x4:I,uint16:b,uint16x2:Ee,uint16x4:ge,sint16:B,sint16x2:ee,sint16x4:ce,unorm16:w,unorm16x2:D,unorm16x4:I,snorm16:w,snorm16x2:D,snorm16x4:I,float16:w,float16x2:D,float16x4:I,float32:w,float32x2:D,float32x3:ae,float32x4:I,uint32:b,uint32x2:Ee,uint32x3:re,uint32x4:ge,sint32:B,sint32x2:ee,sint32x3:Ae,sint32x4:ce,"unorm10-10-10-2":I,"unorm8x4-bgra":I},na=new Set(Object.keys(It)),yc=new S("uint8"),gc=new S("uint8x2"),wc=new S("uint8x4"),xc=new S("sint8"),vc=new S("sint8x2"),$c=new S("sint8x4"),bc=new S("unorm8"),_c=new S("unorm8x2"),Tc=new S("unorm8x4"),zc=new S("snorm8"),Ic=new S("snorm8x2"),Sc=new S("snorm8x4"),Ec=new S("uint16"),kc=new S("uint16x2"),Mc=new S("uint16x4"),Uc=new S("sint16"),Pc=new S("sint16x2"),Vc=new S("sint16x4"),Ac=new S("unorm16"),Cc=new S("unorm16x2"),Oc=new S("unorm16x4"),Bc=new S("snorm16"),Fc=new S("snorm16x2"),jc=new S("snorm16x4"),Gc=new S("float16"),Lc=new S("float16x2"),Rc=new S("float16x4"),Dc=new S("float32"),Nc=new S("float32x2"),Wc=new S("float32x3"),qc=new S("float32x4"),Hc=new S("uint32"),Yc=new S("uint32x2"),Xc=new S("uint32x3"),Zc=new S("uint32x4"),Qc=new S("sint32"),Jc=new S("sint32x2"),Kc=new S("sint32x3"),ep=new S("sint32x4"),tp=new S("unorm10-10-10-2"),rp=new S("unorm8x4-bgra");function bu(e){return C(e)&&na.has(e?.type)}function Rt(e,t){let r=e?.type,n=r in It?It[r]:e;return typeof n!="function"?t:t===void 0?n():n(t)}function ki(e){return _u(e,!1)}function pe(e){return _u(e,!0)}function _u(e,t){let r=n=>Object.fromEntries(Object.entries(e).map(([i,s])=>[i,Rt(s,n?.[i])]));return Object.setPrototypeOf(r,np),r.propTypes=e,Object.defineProperty(r,l,{value:{isAbstruct:t}}),r}var np={type:"struct",$name(e){return L(this,e),this},toString(){return`struct:${v(this)??"<unnamed>"}`}};function Dt(e){let t=String(e);if(t!=="[object Object]")return t;try{return JSON.stringify(e)}catch(r){return console.error("Error parsing JSON:",r),"<invalid json>"}}function ps(e){return Q(e)||ht(e)?e.toString():Array.isArray(e)?`[${e.map(ps).join(", ")}]`:e&&typeof e=="object"?`{ ${Object.entries(e).map(([t,r])=>`${t}: ${ps(r)}`).join(", ")} }`:String(e)}var ip={f32:4,f16:2,i32:4,u32:4,bool:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec2b:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec3b:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,vec4b:16,mat2x2f:8,mat3x3f:16,mat4x4f:16,atomic:4};function sp(e){let t=e?.type,r=ip[t];if(r!==void 0)return r;if(fe(e))return Object.values(e.propTypes).map(J).reduce((n,i)=>n>i?n:i);if(Te(e))return J(e.elementType);if(Ze(e)){let n=Object.values(e.propTypes)[0];return n?cn(n)??1:1}if(zt(e))return cn(e.elementType)??1;if(Xe(e)||Qe(e))return cn(e)??J(e.inner);if(na.has(t))return 1;throw new Error(`Cannot determine alignment of data: ${Dt(e)}`)}function ap(e){if(Ze(e)){let t=Object.values(e.propTypes)[0];return t?Le(t):1}return zt(e)?Le(e.elementType):Qe(e)?cn(e)??Le(e.inner):cn(e)??1}var ja=new WeakMap,Ga=new WeakMap;function J(e){let t=ja.get(e);return t===void 0&&(t=sp(e),ja.set(e,t)),t}function Le(e){let t=Ga.get(e);return t===void 0&&(t=ap(e),Ga.set(e,t)),t}function op(e){return J(e)}var Pe=(e,t)=>{let r=t-1,n=~r;return(e&r)===0?e:(e&n)+t},up={bool:4,f32:4,f16:2,i32:4,u32:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,"vec2<bool>":8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,"vec3<bool>":12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,"vec4<bool>":16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4,atomic:4};function hp(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){if(Number.isNaN(t))throw new Error("Only the last property of a struct can be unbounded");if(t=Pe(t,J(n)),t+=A(n),Number.isNaN(t)&&n.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return Pe(t,J(e))}function lp(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){let i=Le(n);t=Pe(t,i),t+=A(n)}return t}function cp(e){let t=up[e?.type];if(t!==void 0)return t;if(fe(e))return hp(e);if(Ze(e))return lp(e);if(Te(e)){if(e.elementCount===0)return Number.NaN;let r=J(e.elementType);return Pe(A(e.elementType),r)*e.elementCount}if(zt(e)){let r=Le(e.elementType);return Pe(A(e.elementType),r)*e.elementCount}if(Xe(e)||Qe(e))return Ol(e)??A(e.inner);throw new Error(`Cannot determine size of data: ${e}`)}var La=new WeakMap;function A(e){let t=La.get(e);return t===void 0&&(t=cp(e),La.set(e,t)),t}function pp(e){return A(e)}function Nr(e,t){return Xe(e)?new Ra(e.inner,[t,...e.attribs]):Qe(e)?new Da(e.inner,[t,...e.attribs]):Rr(e)?new Da(e,[t]):new Ra(e,[t])}function dp(e,t){return Nr(t,{[l]:!0,type:"@align",params:[e]})}function fp(e,t){return Nr(t,{[l]:!0,type:"@size",params:[e]})}function mi(e,t){return Nr(t,{[l]:!0,type:"@location",params:[e]})}function mp(e,t){return Nr(t,{[l]:!0,type:"@interpolate",params:[e]})}function yp(e){if(!St(e))throw new Error("The @invariant attribute must only be applied to the position built-in value.");let t=Xe(e)||Qe(e)?e.attribs.find(As):void 0;if(!t||t.params[0]!=="position")throw new Error("The @invariant attribute must only be applied to the position built-in value.");return Nr(e,{[l]:!0,type:"@invariant",params:[]})}function St(e){return(Xe(e)||Qe(e))&&e.attribs.find(As)!==void 0}function ia(e){return!Xe(e)&&!Qe(e)?"":e.attribs.map(t=>t.params.length===0?`${t.type} `:`${t.type}(${t.params.join(", ")}) `).join("")}var Tu=class{constructor(t,r){this.inner=t,this.attribs=r;let n=r.find(Ps)?.params[0],i=r.find(Vs)?.params[0];if(n!==void 0){if(n<=0)throw new Error(`Custom data alignment must be a positive number, got: ${n}.`);if(Math.log2(n)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${n}.`);if(Nt(this.inner)&&n%J(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${n}, expected multiple of: ${J(this.inner)}.`)}if(i!==void 0){if(i<A(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${i}, expected at least: ${A(this.inner)}.`);if(i<=0)throw new Error(`Custom data size must be a positive number. Got: ${i}.`)}}[l]=!0},Ra=class extends Tu{[l]=!0;type="decorated"},Da=class extends Tu{[l]=!0;type="loose-decorated"},wn=Lt(((e,t)=>t===void 0?Lt(r=>Na(e,r)):Na(e,t))).$name("arrayOf");function Na(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Array schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>Rt(e,n?.[s]))};if(Object.setPrototypeOf(r,gp),Number.isNaN(A(e)))throw new Error("Cannot nest runtime sized arrays.");if(r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create array schema with invalid element count: ${t}.`);return r.elementCount=t,r}var gp={[l]:!0,type:"array",toString(){return`arrayOf(${this.elementType}, ${this.elementCount})`}};function _e(e,t){return Nr(e,{[l]:!0,type:"@builtin",params:[t]})}var zu={vertexIndex:_e(b,"vertex_index"),instanceIndex:_e(b,"instance_index"),position:_e(I,"position"),clipDistances:_e(wn(b,8),"clip_distances"),frontFacing:_e(G,"front_facing"),fragDepth:_e(w,"frag_depth"),sampleIndex:_e(b,"sample_index"),sampleMask:_e(b,"sample_mask"),localInvocationId:_e(re,"local_invocation_id"),localInvocationIndex:_e(b,"local_invocation_index"),globalInvocationId:_e(re,"global_invocation_id"),workgroupId:_e(re,"workgroup_id"),numWorkgroups:_e(re,"num_workgroups"),subgroupInvocationId:_e(b,"subgroup_invocation_id"),subgroupSize:_e(b,"subgroup_size")};function Br(e,t){for(let[r,n]of Object.entries(t))e[r]=n,n&&(typeof n=="object"||typeof n=="function")&&v(n)===void 0&&L(n,r)}function wp(e,t,r){let n=[...e.matchAll(/:\s*(?<arg>.*?)\s*[,)]/g)].map(i=>i?i[1]:void 0);r(Object.fromEntries(t.flatMap((i,s)=>{let a=n?n[s]:void 0;return fe(i)&&a!==void 0?[[a,i]]:[]})))}function Iu(e,t,r){let n=e.match(/->\s(?<output>[\w\d_]+)\s{/),i=n?n[1]?.trim():void 0;fe(t)&&i&&!/\s/g.test(i)&&r({[i]:t})}function xp(e){return new RegExp(`(?<![\\w\\$_.])${e.replaceAll(".","\\.").replaceAll("$","\\$")}(?![\\w\\$_])`,"g")}function Mn(e,t,r){return Object.entries(t).reduce((n,[i,s])=>{let a=xp(i);if(r&&i!=="Out"&&i!=="In"&&!a.test(r)&&console.warn(`The external '${i}' wasn't used in the resolved template.`),Ql(s)||Rr(s)||ln(s))return n.replaceAll(a,e.resolve(s).value);if(s!==null&&typeof s=="object"){let o=[...r.matchAll(new RegExp(`${i.replaceAll(".","\\.").replaceAll("$","\\$")}\\.(?<prop>.*?)(?![\\w\\$_])`,"g"))].map(u=>u[1]);return[...new Set(o)].reduce((u,h)=>h&&h in s?Mn(e,{[`${i}.${h}`]:s[h]},u):u,n)}return console.warn(`During resolution, the external '${i}' has been omitted. Only TGPU resources, 'use gpu' functions, primitives, and plain JS objects can be used as externals.`),n},r)}function vp(e){let{strippedCode:t,argRange:r}=$p(e),n=new Su(t);n.consume("(");let i=[];for(;!n.isAt(")");){let a=[];for(;n.isAt("@");)n.parseUntil(Wa,qa),n.consume(")"),a.push(n.lastParsed);n.parseUntil(_p);let o=n.lastParsed,u;n.isAt(":")&&(n.consume(":"),n.parseUntil(Tp,Ip),u=n.lastParsed),i.push({identifier:o,attributes:a,type:u}),n.isAt(",")&&n.consume(",")}n.consume(")");let s;if(n.isAt("->")){n.consume("->");let a=[];for(;n.isAt("@");)n.parseUntil(Wa,qa),n.consume(")"),a.push(n.lastParsed);s={type:n.str.slice(n.pos),attributes:a}}return{args:i,ret:s,range:{begin:r[0],end:r[1]}}}function $p(e){let t=new Su(e),r="",n;for(;!t.isFinished();){if(t.isAt(bp)){t.advanceBy(1);continue}if(t.isAt("//")){t.consume("//"),t.parseUntil(Eu),t.advanceBy(1);continue}if(t.isAt("/*")){t.parseUntil(zp,Sp),t.consume("*/");continue}if(t.isAt("{"))return{strippedCode:r,argRange:[n,t.pos]};t.isAt("(")&&n===void 0&&(n=t.pos),n!==void 0&&(r+=t.str[t.pos]),t.advanceBy(1)}throw new Error("Invalid wgsl code!")}var Su=class{constructor(t){this.str=t,this.#t=0}#e;#t;get pos(){return this.#t}get lastParsed(){if(this.#e===void 0)throw new Error("Parse was not called yet!");return this.str.slice(this.#e,this.pos)}isFinished(){return this.#t>=this.str.length}isAt(t){if(typeof t=="string"){for(let r=0;r<t.length;r++)if(this.str[this.#t+r]!==t[r])return!1;return!0}for(let r of t)if(this.isAt(r))return!0;return!1}parseUntil(t,r){this.#e=this.#t;let n=0;for(;this.#t<this.str.length;){if(r&&this.isAt(r[0])&&(n+=1),r&&this.isAt(r[1])&&(n-=1),n===0&&this.isAt(t))return this.#t;this.#t+=1}throw new Error("Reached the end of the string without finding a match!")}advanceBy(t){this.#t+=t}consume(t){if(!this.isAt(t))throw new Error(`Expected '${t}' at position ${this.#t}, but found '${this.str.slice(this.#t,this.#t+t.length)}'`);this.advanceBy(t.length)}},Eu=new Set([`
`,"\v","\f","\r","","\u2028","\u2029"]),bp=new Set([...Eu," ","	","",""]),Wa=new Set([")"]),_p=new Set([":",",",")"]),Tp=new Set([",",")"]),zp=new Set(["*/"]),qa=["(",")"],Ip=["<",">"],Sp=["/*","*/"];function Un(e,t=""){let r=[],n={applyExternals(s){r.push(s)},resolve(s,a,o){let u={};for(let he of r)Br(u,he);let h=s.getUniqueName(this);if(typeof e=="string"){if(!o)throw new Error("Explicit return type is required for string implementation");let he=Mn(s,u,e),Ne="",et="";if(t!==""){let Ie=fe(a[0])?`(in: ${s.resolve(a[0]).value})`:"()",tt=Nt(o)?ia(o):"",yt=o!==te?fe(o)?`-> ${s.resolve(o).value}`:`-> ${tt!==""?tt:"@location(0)"} ${s.resolve(o).value}`:"";Ne=`${Ie} ${yt} `,et=he}else{let Ie=vp(he);if(Ie.args.length!==a.length)throw new Error(`WGSL implementation has ${Ie.args.length} arguments, while the shell has ${a.length} arguments.`);let tt=Ie.args.map((gt,Wt)=>`${gt.identifier}: ${Ha(s,`parameter ${gt.identifier}`,gt.type,a[Wt])}`).join(", "),yt=o===te?"":`-> ${Ha(s,"return type",Ie.ret?.type,o)}`;Ne=`(${tt}) ${yt}`,et=he.slice(Ie.range.end)}return s.addDeclaration(`${t}fn ${h}${Ne}${et}`),y(h,o,"runtime")}let p=zi(e),f=typeof p?.externals=="function"?p.externals():p?.externals;if(f){let he=Object.fromEntries(Object.entries(f).filter(([Ne])=>!(Ne in u)));Br(u,he)}let m=p?.ast;if(!m)throw new Error("Missing metadata for tgpu.fn function body (either missing 'use gpu' directive, or misconfigured `unplugin-typegpu`)");let g=m.externalNames.filter(he=>!(he in u));if(g.length>0)throw new Gl(v(this),g);let $=m.params[1];$&&$.type==="i"&&t!==""&&Br(u,{[$.name]:Tt(o)});let{head:T,body:k,returnType:M}=s.fnToWgsl({functionType:t.includes("@compute")?"compute":t.includes("@vertex")?"vertex":t.includes("@fragment")?"fragment":"normal",argTypes:a,params:m.params,returnType:o,body:m.body,externalMap:u});return s.addDeclaration(`${t}fn ${h}${s.resolve(T).value}${s.resolve(k).value}`),y(h,M,"runtime")}},i=v(e);return i!==void 0&&L(n,i),n}function Ha(e,t,r,n){let i=e.resolve(n).value.replace(/\s/g,"");if(!r)return i;let s=r.replace(/\s/g,"");if(s!==i)throw new Error(`Type mismatch between TGPU shell and WGSL code string: ${t}, JS type "${i}", WGSL type "${s}".`);return r}function Ep(e,t={}){let r=0,n=new Set;return Object.fromEntries(Object.entries(e??{}).map(([i,s])=>{let a=Gt(s);if(a!==void 0){if(n.has(a))throw new Error("Duplicate custom location attributes found");n.add(a)}return[i,s]}).map(([i,s])=>{if(St(s))return[i,s];if(Gt(s)!==void 0)return[i,s];if(t[i])return[i,mi(t[i],s)];for(;n.has(r);)r++;return[i,mi(r++,s)]}))}function Pn(e,t={}){return Dr(e)?Fo(e)||St(e)||Gt(e)!==void 0?e:mi(0,e):ki(Ep(e,t))}function Mi(e,...t){return kp(e)?Mp(e,...t):e}function kp(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)&&e.raw.every(t=>typeof t=="string")}function Mp(e,...t){return e.slice(1).reduce((r,n,i)=>`${r}${t[i]}${n}`,e[0])}function Up(e){if(Object.keys(e.out).length===0)throw new Error("A vertexFn output cannot be empty since it must include the 'position' builtin.");let t={in:e.in,out:e.out,argTypes:e.in&&Object.keys(e.in).length!==0?[Pn(e.in)]:[],isEntry:!0};return Object.assign((r,...n)=>Pp(t,Mi(r,...n)),t)}function Pp(e,t){let r=Un(t,"@vertex "),n=e.argTypes[0];return{shell:e,$uses(i){return r.applyExternals(i),this},[l]:!0,[ie]:r,$name(i){return L(r,i),Ti(n)&&n.$name(`${i}_Input`),this},[z](i){let s=Pn(e.out,i.varyingLocations).$name(`${v(this)??""}_Output`);return typeof t=="string"&&(n&&r.applyExternals({In:n}),r.applyExternals({Out:s})),r.resolve(i,e.argTypes,s)},toString(){return`vertexFn:${v(r)??"<unnamed>"}`}}}var Wr=class{};function sa(e){let t=d({name:e.type,normalImpl:(...n)=>{let i=[];for(let s of n)if(typeof s=="number")i.push(s);else for(let a=0;a<s.length;++a)i.push(s[a]);if(i.length!==0&&i.length!==e.columns*e.rows)throw new Error(`'${e.type}' constructor called with invalid number of arguments.`);for(let s=i.length;s<e.columns*e.rows;++s)i.push(0);return new e.MatImpl(...i)},ignoreImplicitCastWarning:!0,signature:(...n)=>({argTypes:n.map(i=>ct(i)?i:w),returnType:r}),codegenImpl:(...n)=>c`${e.type}(${n})`}),r=Object.assign(t,{type:e.type,identity:jp[e.columns],translation:e.columns===4?Ui:void 0,scaling:e.columns===4?Pi:void 0,rotationX:e.columns===4?Vi:void 0,rotationY:e.columns===4?Ai:void 0,rotationZ:e.columns===4?Ci:void 0});return e.MatImpl.prototype.schema=r,r}var Vp=class extends Wr{[l]=!0;columns;length=4;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1]),this.makeColumn(t[2],t[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[1].x=t}set 3(t){this.columns[1].y=t}*[Symbol.iterator](){yield this[0],yield this[1],yield this[2],yield this[3]}[z](){return y(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,kt,"runtime")}toString(){return this[z]().value}},Ap=class extends Vp{kind="mat2x2f";makeColumn(t,r){return D(t,r)}},Cp=class extends Wr{[l]=!0;columns;length=12;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2]),this.makeColumn(t[3],t[4],t[5]),this.makeColumn(t[6],t[7],t[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){}*[Symbol.iterator](){for(let t=0;t<12;t++)yield this[t]}[z](){return y(`${this.kind}(${this[0]}, ${this[1]}, ${this[2]}, ${this[4]}, ${this[5]}, ${this[6]}, ${this[8]}, ${this[9]}, ${this[10]})`,Mt,"runtime")}toString(){return this[z]().value}},Op=class extends Cp{kind="mat3x3f";makeColumn(t,r,n){return ae(t,r,n)}},Bp=class extends Wr{[l]=!0;columns;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2],t[3]),this.makeColumn(t[4],t[5],t[6],t[7]),this.makeColumn(t[8],t[9],t[10],t[11]),this.makeColumn(t[12],t[13],t[14],t[15])]}length=16;get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){this.columns[0].w=t}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){this.columns[1].w=t}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){this.columns[2].w=t}set 12(t){this.columns[3].x=t}set 13(t){this.columns[3].y=t}set 14(t){this.columns[3].z=t}set 15(t){this.columns[3].w=t}*[Symbol.iterator](){for(let t=0;t<16;t++)yield this[t]}[z](){return y(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,H,"runtime")}toString(){return this[z]().value}},Fp=class extends Bp{kind="mat4x4f";makeColumn(t,r,n,i){return I(t,r,n,i)}},ku=Lt(()=>kt(1,0,0,1)).$name("identity2"),Mu=Lt(()=>Mt(1,0,0,0,1,0,0,0,1)).$name("identity3"),Uu=Lt(()=>H(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)).$name("identity4"),jp={2:ku,3:Mu,4:Uu},Ui=d({name:"translation4",normalImpl:e=>H(1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1),get signature(){return{argTypes:[ae],returnType:H}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, ${e}.x, ${e}.y, ${e}.z, 1)`}),Pi=d({name:"scaling4",normalImpl:e=>H(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),get signature(){return{argTypes:[ae],returnType:H}},codegenImpl:e=>c`mat4x4f(${e}.x, 0, 0, 0, 0, ${e}.y, 0, 0, 0, 0, ${e}.z, 0, 0, 0, 0, 1)`}),Vi=d({name:"rotationX4",normalImpl:e=>H(1,0,0,0,0,Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[w],returnType:H}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1)`}),Ai=d({name:"rotationY4",normalImpl:e=>H(Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[w],returnType:H}},codegenImpl:e=>c`mat4x4f(cos(${e}), 0, -sin(${e}), 0, 0, 1, 0, 0, sin(${e}), 0, cos(${e}), 0, 0, 0, 0, 1)`}),Ci=d({name:"rotationZ4",normalImpl:e=>H(Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1),get signature(){return{argTypes:[w],returnType:H}},codegenImpl:e=>c`mat4x4f(cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)`}),kt=sa({type:"mat2x2f",rows:2,columns:2,MatImpl:Ap}),Mt=sa({type:"mat3x3f",rows:3,columns:3,MatImpl:Op}),H=sa({type:"mat4x4f",rows:4,columns:4,MatImpl:Fp});function Gp(e){return e.kind==="mat3x3f"?[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]:Array.from({length:e.length}).map((t,r)=>e[r])}var Jt=(e,t,r)=>{if(e===t)return 0;let n=U((r-e)/(t-e),0,1);return n*n*(3-2*n)},U=(e,t,r)=>Math.min(Math.max(t,e),r),dr=(e,t)=>t===0?e:Math.trunc(e/t);function nt(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getFloat32(0,!0)}function it(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getInt32(0,!0)}var Oe=ar[l].jsImpl,je=D[l].jsImpl,vt=dt[l].jsImpl,Vr=ee[l].jsImpl,pn=Ee[l].jsImpl,Be=or[l].jsImpl,Me=ae[l].jsImpl,at=ft[l].jsImpl,Ar=Ae[l].jsImpl,dn=re[l].jsImpl,Fe=ur[l].jsImpl,Ge=I[l].jsImpl,$t=mt[l].jsImpl,Cr=ce[l].jsImpl,fn=ge[l].jsImpl,fr=e=>Math.sqrt(e.x**2+e.y**2),mr=e=>Math.sqrt(e.x**2+e.y**2+e.z**2),yr=e=>Math.sqrt(e.x**2+e.y**2+e.z**2+e.w**2),qn=(e,t)=>e.x*t.x+e.y*t.y,Hn=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z,Yn=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,q=e=>t=>je(e(t.x),e(t.y)),Y=e=>t=>vt(e(t.x),e(t.y)),gr=e=>t=>Vr(e(t.x),e(t.y)),Jr=e=>t=>pn(e(t.x),e(t.y)),W=e=>t=>Me(e(t.x),e(t.y),e(t.z)),X=e=>t=>at(e(t.x),e(t.y),e(t.z)),wr=e=>t=>Ar(e(t.x),e(t.y),e(t.z)),Kr=e=>t=>dn(e(t.x),e(t.y),e(t.z)),N=e=>t=>Ge(e(t.x),e(t.y),e(t.z),e(t.w)),Z=e=>t=>$t(e(t.x),e(t.y),e(t.z),e(t.w)),xr=e=>t=>Cr(e(t.x),e(t.y),e(t.z),e(t.w)),en=e=>t=>fn(e(t.x),e(t.y),e(t.z),e(t.w)),Ya=e=>t=>{let r=t.columns;return kt(q(e)(r[0]),q(e)(r[1]))},Xa=e=>t=>{let r=t.columns;return Mt(W(e)(r[0]),W(e)(r[1]),W(e)(r[2]))},Za=e=>t=>{let r=t.columns;return H(N(e)(r[0]),N(e)(r[1]),N(e)(r[2]),N(e)(r[3]))},xt=e=>(t,r)=>je(e(t.x,r.x),e(t.y,r.y)),Ht=e=>(t,r)=>vt(e(t.x,r.x),e(t.y,r.y)),vr=e=>(t,r)=>Vr(e(t.x,r.x),e(t.y,r.y)),$r=e=>(t,r)=>pn(e(t.x,r.x),e(t.y,r.y)),ot=e=>(t,r)=>Me(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Yt=e=>(t,r)=>at(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),br=e=>(t,r)=>Ar(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),_r=e=>(t,r)=>dn(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),qe=e=>(t,r)=>Ge(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),Xt=e=>(t,r)=>$t(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),Tr=e=>(t,r)=>Cr(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),zr=e=>(t,r)=>fn(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),Lp=e=>(t,r)=>{let n=t.columns,i=r.columns;return kt(xt(e)(n[0],i[0]),xt(e)(n[1],i[1]))},Rp=e=>(t,r)=>{let n=t.columns,i=r.columns;return Mt(ot(e)(n[0],i[0]),ot(e)(n[1],i[1]),ot(e)(n[2],i[2]))},Dp=e=>(t,r)=>{let n=t.columns,i=r.columns;return H(qe(e)(n[0],i[0]),qe(e)(n[1],i[1]),qe(e)(n[2],i[2]),qe(e)(n[3],i[3]))},Np=e=>(t,r,n)=>je(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),Wp=e=>(t,r,n)=>vt(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),qp=e=>(t,r,n)=>Me(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),Hp=e=>(t,r,n)=>at(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),Yp=e=>(t,r,n)=>Ge(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),Xp=e=>(t,r,n)=>$t(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),_={eq:{vec2f:(e,t)=>Oe(e.x===t.x,e.y===t.y),vec2h:(e,t)=>Oe(e.x===t.x,e.y===t.y),vec2i:(e,t)=>Oe(e.x===t.x,e.y===t.y),vec2u:(e,t)=>Oe(e.x===t.x,e.y===t.y),"vec2<bool>":(e,t)=>Oe(e.x===t.x,e.y===t.y),vec3f:(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z),vec3h:(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z),vec3i:(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z),vec3u:(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z),"vec3<bool>":(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z),vec4f:(e,t)=>Fe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4h:(e,t)=>Fe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4i:(e,t)=>Fe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4u:(e,t)=>Fe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),"vec4<bool>":(e,t)=>Fe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w)},lt:{vec2f:(e,t)=>Oe(e.x<t.x,e.y<t.y),vec2h:(e,t)=>Oe(e.x<t.x,e.y<t.y),vec2i:(e,t)=>Oe(e.x<t.x,e.y<t.y),vec2u:(e,t)=>Oe(e.x<t.x,e.y<t.y),vec3f:(e,t)=>Be(e.x<t.x,e.y<t.y,e.z<t.z),vec3h:(e,t)=>Be(e.x<t.x,e.y<t.y,e.z<t.z),vec3i:(e,t)=>Be(e.x<t.x,e.y<t.y,e.z<t.z),vec3u:(e,t)=>Be(e.x<t.x,e.y<t.y,e.z<t.z),vec4f:(e,t)=>Fe(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4h:(e,t)=>Fe(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4i:(e,t)=>Fe(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4u:(e,t)=>Fe(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w)},or:{"vec2<bool>":(e,t)=>Oe(e.x||t.x,e.y||t.y),"vec3<bool>":(e,t)=>Be(e.x||t.x,e.y||t.y,e.z||t.z),"vec4<bool>":(e,t)=>Fe(e.x||t.x,e.y||t.y,e.z||t.z,e.w||t.w)},all:{"vec2<bool>":e=>e.x&&e.y,"vec3<bool>":e=>e.x&&e.y&&e.z,"vec4<bool>":e=>e.x&&e.y&&e.z&&e.w},abs:{vec2f:q(Math.abs),vec2h:Y(Math.abs),vec2i:gr(Math.abs),vec2u:Jr(Math.abs),vec3f:W(Math.abs),vec3h:X(Math.abs),vec3i:wr(Math.abs),vec3u:Kr(Math.abs),vec4f:N(Math.abs),vec4h:Z(Math.abs),vec4i:xr(Math.abs),vec4u:en(Math.abs)},atan2:{vec2f:xt(Math.atan2),vec2h:Ht(Math.atan2),vec3f:ot(Math.atan2),vec3h:Yt(Math.atan2),vec4f:qe(Math.atan2),vec4h:Xt(Math.atan2)},acos:{vec2f:q(Math.acos),vec2h:Y(Math.acos),vec2i:gr(Math.acos),vec2u:Jr(Math.acos),vec3f:W(Math.acos),vec3h:X(Math.acos),vec3i:wr(Math.acos),vec3u:Kr(Math.acos),vec4f:N(Math.acos),vec4h:Z(Math.acos),vec4i:xr(Math.acos),vec4u:en(Math.acos)},acosh:{vec2f:q(Math.acosh),vec2h:Y(Math.acosh),vec3f:W(Math.acosh),vec3h:X(Math.acosh),vec4f:N(Math.acosh),vec4h:Z(Math.acosh)},asin:{vec2f:q(Math.asin),vec2h:Y(Math.asin),vec3f:W(Math.asin),vec3h:X(Math.asin),vec4f:N(Math.asin),vec4h:Z(Math.asin)},asinh:{vec2f:q(Math.asinh),vec2h:Y(Math.asinh),vec3f:W(Math.asinh),vec3h:X(Math.asinh),vec4f:N(Math.asinh),vec4h:Z(Math.asinh)},atan:{vec2f:q(Math.atan),vec2h:Y(Math.atan),vec3f:W(Math.atan),vec3h:X(Math.atan),vec4f:N(Math.atan),vec4h:Z(Math.atan)},atanh:{vec2f:q(Math.atanh),vec2h:Y(Math.atanh),vec3f:W(Math.atanh),vec3h:X(Math.atanh),vec4f:N(Math.atanh),vec4h:Z(Math.atanh)},ceil:{vec2f:q(Math.ceil),vec2h:Y(Math.ceil),vec3f:W(Math.ceil),vec3h:X(Math.ceil),vec4f:N(Math.ceil),vec4h:Z(Math.ceil)},clamp:{vec2f:(e,t,r)=>je(U(e.x,t.x,r.x),U(e.y,t.y,r.y)),vec2h:(e,t,r)=>vt(U(e.x,t.x,r.x),U(e.y,t.y,r.y)),vec2i:(e,t,r)=>Vr(U(e.x,t.x,r.x),U(e.y,t.y,r.y)),vec2u:(e,t,r)=>pn(U(e.x,t.x,r.x),U(e.y,t.y,r.y)),vec3f:(e,t,r)=>Me(U(e.x,t.x,r.x),U(e.y,t.y,r.y),U(e.z,t.z,r.z)),vec3h:(e,t,r)=>at(U(e.x,t.x,r.x),U(e.y,t.y,r.y),U(e.z,t.z,r.z)),vec3i:(e,t,r)=>Ar(U(e.x,t.x,r.x),U(e.y,t.y,r.y),U(e.z,t.z,r.z)),vec3u:(e,t,r)=>dn(U(e.x,t.x,r.x),U(e.y,t.y,r.y),U(e.z,t.z,r.z)),vec4f:(e,t,r)=>Ge(U(e.x,t.x,r.x),U(e.y,t.y,r.y),U(e.z,t.z,r.z),U(e.w,t.w,r.w)),vec4h:(e,t,r)=>$t(U(e.x,t.x,r.x),U(e.y,t.y,r.y),U(e.z,t.z,r.z),U(e.w,t.w,r.w)),vec4i:(e,t,r)=>Cr(U(e.x,t.x,r.x),U(e.y,t.y,r.y),U(e.z,t.z,r.z),U(e.w,t.w,r.w)),vec4u:(e,t,r)=>fn(U(e.x,t.x,r.x),U(e.y,t.y,r.y),U(e.z,t.z,r.z),U(e.w,t.w,r.w))},length:{vec2f:fr,vec2h:fr,vec3f:mr,vec3h:mr,vec4f:yr,vec4h:yr},add:{vec2f:xt((e,t)=>e+t),vec2h:Ht((e,t)=>e+t),vec2i:vr((e,t)=>e+t),vec2u:$r((e,t)=>e+t),vec3f:ot((e,t)=>e+t),vec3h:Yt((e,t)=>e+t),vec3i:br((e,t)=>e+t),vec3u:_r((e,t)=>e+t),vec4f:qe((e,t)=>e+t),vec4h:Xt((e,t)=>e+t),vec4i:Tr((e,t)=>e+t),vec4u:zr((e,t)=>e+t),mat2x2f:Lp((e,t)=>e+t),mat3x3f:Rp((e,t)=>e+t),mat4x4f:Dp((e,t)=>e+t)},smoothstep:{vec2f:Np(Jt),vec2h:Wp(Jt),vec3f:qp(Jt),vec3h:Hp(Jt),vec4f:Yp(Jt),vec4h:Xp(Jt)},addMixed:{vec2f:(e,t)=>q(r=>r+t)(e),vec2h:(e,t)=>Y(r=>r+t)(e),vec2i:(e,t)=>gr(r=>r+t)(e),vec2u:(e,t)=>Jr(r=>r+t)(e),vec3f:(e,t)=>W(r=>r+t)(e),vec3h:(e,t)=>X(r=>r+t)(e),vec3i:(e,t)=>wr(r=>r+t)(e),vec3u:(e,t)=>Kr(r=>r+t)(e),vec4f:(e,t)=>N(r=>r+t)(e),vec4h:(e,t)=>Z(r=>r+t)(e),vec4i:(e,t)=>xr(r=>r+t)(e),vec4u:(e,t)=>en(r=>r+t)(e),mat2x2f:(e,t)=>Ya(r=>r+t)(e),mat3x3f:(e,t)=>Xa(r=>r+t)(e),mat4x4f:(e,t)=>Za(r=>r+t)(e)},mulSxV:{vec2f:(e,t)=>q(r=>e*r)(t),vec2h:(e,t)=>Y(r=>e*r)(t),vec2i:(e,t)=>gr(r=>e*r)(t),vec2u:(e,t)=>Jr(r=>e*r)(t),vec3f:(e,t)=>W(r=>e*r)(t),vec3h:(e,t)=>X(r=>e*r)(t),vec3i:(e,t)=>wr(r=>e*r)(t),vec3u:(e,t)=>Kr(r=>e*r)(t),vec4f:(e,t)=>N(r=>e*r)(t),vec4h:(e,t)=>Z(r=>e*r)(t),vec4i:(e,t)=>xr(r=>e*r)(t),vec4u:(e,t)=>en(r=>e*r)(t),mat2x2f:(e,t)=>Ya(r=>e*r)(t),mat3x3f:(e,t)=>Xa(r=>e*r)(t),mat4x4f:(e,t)=>Za(r=>e*r)(t)},mulVxV:{vec2f:xt((e,t)=>e*t),vec2h:Ht((e,t)=>e*t),vec2i:vr((e,t)=>e*t),vec2u:$r((e,t)=>e*t),vec3f:ot((e,t)=>e*t),vec3h:Yt((e,t)=>e*t),vec3i:br((e,t)=>e*t),vec3u:_r((e,t)=>e*t),vec4f:qe((e,t)=>e*t),vec4h:Xt((e,t)=>e*t),vec4i:Tr((e,t)=>e*t),vec4u:zr((e,t)=>e*t),mat2x2f:(e,t)=>{let r=e.columns,n=t.columns;return kt(r[0].x*n[0].x+r[1].x*n[0].y,r[0].y*n[0].x+r[1].y*n[0].y,r[0].x*n[1].x+r[1].x*n[1].y,r[0].y*n[1].x+r[1].y*n[1].y)},mat3x3f:(e,t)=>{let r=e.columns,n=t.columns;return Mt(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z)},mat4x4f:(e,t)=>{let r=e.columns,n=t.columns;return H(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z+r[3].x*n[0].w,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z+r[3].y*n[0].w,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z+r[3].z*n[0].w,r[0].w*n[0].x+r[1].w*n[0].y+r[2].w*n[0].z+r[3].w*n[0].w,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z+r[3].x*n[1].w,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z+r[3].y*n[1].w,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z+r[3].z*n[1].w,r[0].w*n[1].x+r[1].w*n[1].y+r[2].w*n[1].z+r[3].w*n[1].w,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z+r[3].x*n[2].w,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z+r[3].y*n[2].w,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z+r[3].z*n[2].w,r[0].w*n[2].x+r[1].w*n[2].y+r[2].w*n[2].z+r[3].w*n[2].w,r[0].x*n[3].x+r[1].x*n[3].y+r[2].x*n[3].z+r[3].x*n[3].w,r[0].y*n[3].x+r[1].y*n[3].y+r[2].y*n[3].z+r[3].y*n[3].w,r[0].z*n[3].x+r[1].z*n[3].y+r[2].z*n[3].z+r[3].z*n[3].w,r[0].w*n[3].x+r[1].w*n[3].y+r[2].w*n[3].z+r[3].w*n[3].w)}},mulMxV:{mat2x2f:(e,t)=>{let r=e.columns;return je(r[0].x*t.x+r[1].x*t.y,r[0].y*t.x+r[1].y*t.y)},mat3x3f:(e,t)=>{let r=e.columns;return Me(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z)},mat4x4f:(e,t)=>{let r=e.columns;return Ge(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z+r[3].x*t.w,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z+r[3].y*t.w,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z+r[3].z*t.w,r[0].w*t.x+r[1].w*t.y+r[2].w*t.z+r[3].w*t.w)}},mulVxM:{mat2x2f:(e,t)=>{let r=t.columns;return je(e.x*r[0].x+e.y*r[0].y,e.x*r[1].x+e.y*r[1].y)},mat3x3f:(e,t)=>{let r=t.columns;return Me(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z)},mat4x4f:(e,t)=>{let r=t.columns;return Ge(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z+e.w*r[0].w,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z+e.w*r[1].w,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z+e.w*r[2].w,e.x*r[3].x+e.y*r[3].y+e.z*r[3].z+e.w*r[3].w)}},div:{vec2f:xt((e,t)=>e/t),vec2h:Ht((e,t)=>e/t),vec2i:vr(dr),vec2u:$r(dr),vec3f:ot((e,t)=>e/t),vec3h:Yt((e,t)=>e/t),vec3i:br(dr),vec3u:_r(dr),vec4f:qe((e,t)=>e/t),vec4h:Xt((e,t)=>e/t),vec4i:Tr(dr),vec4u:zr(dr)},dot:{vec2f:qn,vec2h:qn,vec2i:qn,vec2u:qn,vec3f:Hn,vec3h:Hn,vec3i:Hn,vec3u:Hn,vec4f:Yn,vec4h:Yn,vec4i:Yn,vec4u:Yn},normalize:{vec2f:e=>{let t=fr(e);return je(e.x/t,e.y/t)},vec2h:e=>{let t=fr(e);return vt(e.x/t,e.y/t)},vec2i:e=>{let t=fr(e);return Vr(e.x/t,e.y/t)},vec2u:e=>{let t=fr(e);return pn(e.x/t,e.y/t)},vec3f:e=>{let t=mr(e);return Me(e.x/t,e.y/t,e.z/t)},vec3h:e=>{let t=mr(e);return at(e.x/t,e.y/t,e.z/t)},vec3i:e=>{let t=mr(e);return Ar(e.x/t,e.y/t,e.z/t)},vec3u:e=>{let t=mr(e);return dn(e.x/t,e.y/t,e.z/t)},vec4f:e=>{let t=yr(e);return Ge(e.x/t,e.y/t,e.z/t,e.w/t)},vec4h:e=>{let t=yr(e);return $t(e.x/t,e.y/t,e.z/t,e.w/t)},vec4i:e=>{let t=yr(e);return Cr(e.x/t,e.y/t,e.z/t,e.w/t)},vec4u:e=>{let t=yr(e);return fn(e.x/t,e.y/t,e.z/t,e.w/t)}},cross:{vec3f:(e,t)=>Me(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x),vec3h:(e,t)=>at(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},mod:{vec2f:xt((e,t)=>e%t),vec2h:Ht((e,t)=>e%t),vec2i:vr((e,t)=>e%t),vec2u:$r((e,t)=>e%t),vec3f:ot((e,t)=>e%t),vec3h:Yt((e,t)=>e%t),vec3i:br((e,t)=>e%t),vec3u:_r((e,t)=>e%t),vec4f:qe((e,t)=>e%t),vec4h:Xt((e,t)=>e%t),vec4i:Tr((e,t)=>e%t),vec4u:zr((e,t)=>e%t)},floor:{vec2f:q(Math.floor),vec2h:Y(Math.floor),vec3f:W(Math.floor),vec3h:X(Math.floor),vec4f:N(Math.floor),vec4h:Z(Math.floor)},max:{vec2f:xt(Math.max),vec2h:Ht(Math.max),vec2i:vr(Math.max),vec2u:$r(Math.max),vec3f:ot(Math.max),vec3h:Yt(Math.max),vec3i:br(Math.max),vec3u:_r(Math.max),vec4f:qe(Math.max),vec4h:Xt(Math.max),vec4i:Tr(Math.max),vec4u:zr(Math.max)},min:{vec2f:xt(Math.min),vec2h:Ht(Math.min),vec2i:vr(Math.min),vec2u:$r(Math.min),vec3f:ot(Math.min),vec3h:Yt(Math.min),vec3i:br(Math.min),vec3u:_r(Math.min),vec4f:qe(Math.min),vec4h:Xt(Math.min),vec4i:Tr(Math.min),vec4u:zr(Math.min)},pow:{vec2f:(e,t)=>je(e.x**t.x,e.y**t.y),vec2h:(e,t)=>vt(e.x**t.x,e.y**t.y),vec3f:(e,t)=>Me(e.x**t.x,e.y**t.y,e.z**t.z),vec3h:(e,t)=>at(e.x**t.x,e.y**t.y,e.z**t.z),vec4f:(e,t)=>Ge(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w),vec4h:(e,t)=>$t(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w)},sign:{vec2f:q(Math.sign),vec2h:Y(Math.sign),vec2i:gr(Math.sign),vec3f:W(Math.sign),vec3h:X(Math.sign),vec3i:wr(Math.sign),vec4f:N(Math.sign),vec4h:Z(Math.sign),vec4i:xr(Math.sign)},sqrt:{vec2f:q(Math.sqrt),vec2h:Y(Math.sqrt),vec3f:W(Math.sqrt),vec3h:X(Math.sqrt),vec4f:N(Math.sqrt),vec4h:Z(Math.sqrt)},mix:{vec2f:(e,t,r)=>typeof r=="number"?je(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):je(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec2h:(e,t,r)=>typeof r=="number"?vt(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):vt(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec3f:(e,t,r)=>typeof r=="number"?Me(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):Me(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec3h:(e,t,r)=>typeof r=="number"?at(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):at(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec4f:(e,t,r)=>typeof r=="number"?Ge(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):Ge(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w),vec4h:(e,t,r)=>typeof r=="number"?$t(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):$t(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w)},sin:{vec2f:q(Math.sin),vec2h:Y(Math.sin),vec3f:W(Math.sin),vec3h:X(Math.sin),vec4f:N(Math.sin),vec4h:Z(Math.sin)},cos:{vec2f:q(Math.cos),vec2h:Y(Math.cos),vec3f:W(Math.cos),vec3h:X(Math.cos),vec4f:N(Math.cos),vec4h:Z(Math.cos)},cosh:{vec2f:q(Math.cosh),vec2h:Y(Math.cosh),vec3f:W(Math.cosh),vec3h:X(Math.cosh),vec4f:N(Math.cosh),vec4h:Z(Math.cosh)},exp:{vec2f:q(Math.exp),vec2h:Y(Math.exp),vec3f:W(Math.exp),vec3h:X(Math.exp),vec4f:N(Math.exp),vec4h:Z(Math.exp)},exp2:{vec2f:q(e=>2**e),vec2h:Y(e=>2**e),vec3f:W(e=>2**e),vec3h:X(e=>2**e),vec4f:N(e=>2**e),vec4h:Z(e=>2**e)},log:{vec2f:q(Math.log),vec2h:Y(Math.log),vec3f:W(Math.log),vec3h:X(Math.log),vec4f:N(Math.log),vec4h:Z(Math.log)},log2:{vec2f:q(Math.log2),vec2h:Y(Math.log2),vec3f:W(Math.log2),vec3h:X(Math.log2),vec4f:N(Math.log2),vec4h:Z(Math.log2)},fract:{vec2f:q(e=>e-Math.floor(e)),vec2h:Y(e=>e-Math.floor(e)),vec3f:W(e=>e-Math.floor(e)),vec3h:X(e=>e-Math.floor(e)),vec4f:N(e=>e-Math.floor(e)),vec4h:Z(e=>e-Math.floor(e))},isCloseToZero:{vec2f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec2h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec3f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec3h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec4f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t,vec4h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t},neg:{vec2f:q(e=>-e),vec2h:Y(e=>-e),vec2i:gr(e=>-e),vec2u:Jr(e=>-e),"vec2<bool>":e=>Oe(!e.x,!e.y),vec3f:W(e=>-e),vec3h:X(e=>-e),vec3i:wr(e=>-e),vec3u:Kr(e=>-e),"vec3<bool>":e=>Be(!e.x,!e.y,!e.z),vec4f:N(e=>-e),vec4h:Z(e=>-e),vec4i:xr(e=>-e),vec4u:en(e=>-e),"vec4<bool>":e=>Fe(!e.x,!e.y,!e.z,!e.w)},select:{vec2f:(e,t,r)=>je(r.x?t.x:e.x,r.y?t.y:e.y),vec2h:(e,t,r)=>vt(r.x?t.x:e.x,r.y?t.y:e.y),vec2i:(e,t,r)=>Vr(r.x?t.x:e.x,r.y?t.y:e.y),vec2u:(e,t,r)=>pn(r.x?t.x:e.x,r.y?t.y:e.y),"vec2<bool>":(e,t,r)=>Oe(r.x?t.x:e.x,r.y?t.y:e.y),vec3f:(e,t,r)=>Me(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3h:(e,t,r)=>at(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3i:(e,t,r)=>Ar(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3u:(e,t,r)=>dn(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),"vec3<bool>":(e,t,r)=>Be(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec4f:(e,t,r)=>Ge(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4h:(e,t,r)=>$t(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4i:(e,t,r)=>Cr(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4u:(e,t,r)=>fn(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),"vec4<bool>":(e,t,r)=>Fe(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w)},tanh:{vec2f:q(Math.tanh),vec2h:Y(Math.tanh),vec3f:W(Math.tanh),vec3h:X(Math.tanh),vec4f:N(Math.tanh),vec4h:Z(Math.tanh)},bitcastU32toF32:{vec2u:e=>je(nt(e.x),nt(e.y)),vec3u:e=>Me(nt(e.x),nt(e.y),nt(e.z)),vec4u:e=>Ge(nt(e.x),nt(e.y),nt(e.z),nt(e.w))},bitcastU32toI32:{vec2u:e=>Vr(it(e.x),it(e.y)),vec3u:e=>Ar(it(e.x),it(e.y),it(e.z)),vec4u:e=>Cr(it(e.x),it(e.y),it(e.z),it(e.w))}};function Pu(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="number"&&Q(t))return _.addMixed[t.kind](t,e);if(Q(e)&&typeof t=="number")return _.addMixed[e.kind](e,t);if(Q(e)&&Q(t)||ht(e)&&ht(t))return _.add[e.kind](e,t);throw new Error("Add/Sub called with invalid arguments.")}var aa=d({name:"add",signature:(...e)=>{let t=me(e)??e;return{argTypes:t,returnType:jt(t[0])?t[1]:t[0]}},normalImpl:Pu,codegenImpl:(e,t)=>c`(${e} + ${t})`});function Zp(e,t){return Pu(e,Vu(-1,t))}var qr=d({name:"sub",signature:(...e)=>{let t=me(e)??e;return{argTypes:t,returnType:jt(t[0])?t[1]:t[0]}},normalImpl:Zp,codegenImpl:(e,t)=>c`(${e} - ${t})`});function Vu(e,t){if(typeof e=="number"&&typeof t=="number")return e*t;if(typeof e=="number"&&(Q(t)||ht(t)))return _.mulSxV[t.kind](e,t);if((Q(e)||ht(e))&&typeof t=="number")return _.mulSxV[e.kind](t,e);if(Q(e)&&Q(t))return _.mulVxV[e.kind](e,t);if(Va(e)&&ht(t))return _.mulVxM[t.kind](e,t);if(ht(e)&&Va(t))return _.mulMxV[e.kind](e,t);if(ht(e)&&ht(t))return _.mulVxV[e.kind](e,t);throw new Error("Mul called with invalid arguments.")}var Vn=d({name:"mul",signature:(...e)=>{let t=me(e)??e,r=jt(t[0])?t[1]:jt(t[1])||t[0].type.startsWith("vec")?t[0]:t[1].type.startsWith("vec")?t[1]:t[0];return{argTypes:t,returnType:r}},normalImpl:Vu,codegenImpl:(e,t)=>c`(${e} * ${t})`});function Qp(e,t){if(typeof e=="number"&&typeof t=="number")return e/t;if(typeof e=="number"&&Q(t)){let r=di[t.kind][l].jsImpl;return _.div[t.kind](r(e),t)}if(Q(e)&&typeof t=="number"){let r=di[e.kind][l].jsImpl;return _.div[e.kind](e,r(t))}if(Q(e)&&Q(t))return _.div[e.kind](e,t);throw new Error("Div called with invalid arguments.")}var oa=d({name:"div",signature:(...e)=>{let t=me(e,[w,se,pt])??e;return{argTypes:t,returnType:jt(t[0])?t[1]:t[0]}},normalImpl:Qp,codegenImpl:(e,t)=>c`(${e} / ${t})`,ignoreImplicitCastWarning:!0}),Jp=d({name:"mod",signature:(...e)=>{let t=me(e)??e;return{argTypes:t,returnType:jt(t[0])?t[1]:t[0]}},normalImpl(e,t){if(typeof e=="number"&&typeof t=="number")return e%t;if(typeof e=="number"&&Q(t)){let r=di[t.kind];return _.mod[t.kind](r(e),t)}if(Q(e)&&typeof t=="number"){let r=di[e.kind];return _.mod[e.kind](e,r(t))}if(Q(e)&&Q(t))return _.mod[e.kind](e,t);throw new Error("Mod called with invalid arguments, expected types: number or vector.")},codegenImpl:(e,t)=>c`(${e} % ${t})`});function Kp(e){return typeof e=="number"?-e:_.neg[e.kind](e)}var Au=d({name:"neg",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Kp,codegenImpl:e=>c`-(${e})`});function ds(e){if("multisampled"in e){if(e.multisampled){if(e.dimension==="2d")return Ou(e.sampleType);throw new Error(`Multisampled textures only support '2d' dimension, got '${e.dimension}'`)}switch(e.dimension){case"1d":return Cu(e.sampleType);case"2d":return ua(e.sampleType);case"2d-array":return Bu(e.sampleType);case"3d":return Gu(e.sampleType);case"cube":return Fu(e.sampleType);case"cube-array":return ju(e.sampleType);default:throw new Error(`Unsupported texture dimension: '${e.dimension}'`)}}if(!("access"in e))throw new Error("Descriptor is neither a sampled nor a storage texture");switch(e.dimension){case"1d":return Lu(e.format,e.access);case"2d":return ha(e.format,e.access);case"2d-array":return Ru(e.format,e.access);case"3d":return Du(e.format,e.access);default:throw new Error(`Unsupported storage texture dimension: '${e.dimension}'`)}}function Re(e,t){let r=e.startsWith("texture_depth")?["depth","float","unfilterable-float"]:t.sampleType.type==="i32"?["sint"]:t.sampleType.type==="u32"?["uint"]:["float","unfilterable-float"];return{[l]:!0,[Lr]:void 0,type:e,bindingSampleType:r,...t}}function Oi(e,t){return{[l]:!0,[Lr]:void 0,type:e,...t}}var Qa=new Map,An={"write-only":"write","read-only":"read","read-write":"read_write"};function we(e,t){let r=Qa.get(e);return r||(r=t(),Qa.set(e,r)),r}function Cu(e){let t=e||w,r=`texture_1d<${t.type}>`;return we(r,()=>Re("texture_1d",{dimension:"1d",sampleType:t,multisampled:!1}))}function ua(e){let t=e||w,r=`texture_2d<${t.type}>`;return we(r,()=>Re("texture_2d",{dimension:"2d",sampleType:t,multisampled:!1}))}function Ou(e){let t=e||w,r=`texture_multisampled_2d<${t.type}>`;return we(r,()=>Re("texture_multisampled_2d",{dimension:"2d",sampleType:t,multisampled:!0}))}function Bu(e){let t=e||w,r=`texture_2d_array<${t.type}>`;return we(r,()=>Re("texture_2d_array",{dimension:"2d-array",sampleType:t,multisampled:!1}))}function Fu(e){let t=e||w,r=`texture_cube<${t.type}>`;return we(r,()=>Re("texture_cube",{dimension:"cube",sampleType:t,multisampled:!1}))}function ju(e){let t=e||w,r=`texture_cube_array<${t.type}>`;return we(r,()=>Re("texture_cube_array",{dimension:"cube-array",sampleType:t,multisampled:!1}))}function Gu(e){let t=e||w,r=`texture_3d<${t.type}>`;return we(r,()=>Re("texture_3d",{dimension:"3d",sampleType:t,multisampled:!1}))}function Lu(e,t){let r=t||"write-only",n=`texture_storage_1d<${e}, ${An[r]}>`;return we(n,()=>Oi("texture_storage_1d",{dimension:"1d",format:e,access:r}))}function ha(e,t){let r=t||"write-only",n=`texture_storage_2d<${e}, ${An[r]}>`;return we(n,()=>Oi("texture_storage_2d",{dimension:"2d",format:e,access:r}))}function Ru(e,t){let r=t||"write-only",n=`texture_storage_2d_array<${e}, ${An[r]}>`;return we(n,()=>Oi("texture_storage_2d_array",{dimension:"2d-array",format:e,access:r}))}function Du(e,t){let r=t||"write-only",n=`texture_storage_3d<${e}, ${An[r]}>`;return we(n,()=>Oi("texture_storage_3d",{dimension:"3d",format:e,access:r}))}function ed(){return we("texture_depth_2d",()=>Re("texture_depth_2d",{dimension:"2d",sampleType:w,multisampled:!1}))}function td(){return we("texture_depth_multisampled_2d",()=>Re("texture_depth_multisampled_2d",{dimension:"2d",sampleType:w,multisampled:!0}))}function rd(){return we("texture_depth_2d_array",()=>Re("texture_depth_2d_array",{dimension:"2d-array",sampleType:w,multisampled:!1}))}function nd(){return we("texture_depth_cube",()=>Re("texture_depth_cube",{dimension:"cube",sampleType:w,multisampled:!1}))}function id(){return we("texture_depth_cube_array",()=>Re("texture_depth_cube_array",{dimension:"cube-array",sampleType:w,multisampled:!1}))}function Nu(){return we("texture_external",()=>({[l]:!0,[Lr]:void 0,type:"texture_external",dimension:"2d"}))}function Wu(e){return!!e[l]&&typeof e.multisampled=="boolean"}function fs(e){return!!e[l]&&typeof e.format=="string"&&typeof e.access=="string"}var sd=["vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"],ms={add:aa,sub:qr,mul:Vn,div:oa},ad={f:{1:w,2:D,3:ae,4:I},h:{1:se,2:dt,3:ft,4:mt},i:{1:B,2:ee,3:Ae,4:ce},u:{1:b,2:Ee,3:re,4:ge},b:{1:G,2:ar,3:or,4:ur}};function la(e,t){if(sd.includes(e.dataType.type)&&t in ms)return y(new Lo(t,e,ms[t][l].gpuImpl),He,e.origin);if(Te(e.dataType)&&t==="length")return e.dataType.elementCount===0?y(c`arrayLength(&${e})`,b,"runtime"):y(e.dataType.elementCount,In,"constant");if(ui(e.dataType)&&t==="columns")return y(new Ro(e),He,e.origin);if(fe(e.dataType)||Ze(e.dataType)){let n=e.dataType.propTypes[t];return n?(n=Tt(n),y(c`${e}.${t}`,n,e.origin==="argument"?"argument":!Ur(e)&&!$e(n)?e.origin:e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime")):void 0}if(Ye(e.dataType)){let n=js(e);return t==="$"?n:la(n,t)}if(ct(e.dataType)&&t==="kind")return y(e.dataType.type,He,"constant");let r=t.length;if(ct(e.dataType)&&r>=1&&r<=4){let n=e.dataType.type.includes("bool")?"b":e.dataType.type[4],i=ad[n][r];return i?y(Ue(e)?e.value[t]:c`${e}.${t}`,i,e.origin==="argument"&&r===1?"argument":e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime"):void 0}if(Ue(e)||e.dataType.type==="unknown")return Ei(e.value[t])}function ca(){return{[l]:!0,type:"sampler",[Lr]:void 0}}function pa(){return{[l]:!0,type:"sampler_comparison",[Lr]:void 0}}function od(e){return!!e[l]&&e.type==="sampler"}function ud(e){return!!e[l]&&e.type==="sampler_comparison"}function qu(e){return new hd(e)}var hd=class{constructor(t){this.inner=t}[l]=!0;type="atomic"},Hu=Object.defineProperty,ld=(e,t,r)=>t in e?Hu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cd=(e,t)=>{for(var r in t)Hu(e,r,{get:t[r],enumerable:!0})},P=(e,t,r)=>ld(e,typeof t!="symbol"?t+"":t,r),pd={};cd(pd,{BufferReader:()=>Ft,BufferWriter:()=>hr,MaxValue:()=>ne,Measurer:()=>K,UnresolvedReferenceError:()=>Kt,ValidationError:()=>Bi,arrayOf:()=>gd,bool:()=>xd,byte:()=>zd,chars:()=>jd,concat:()=>Dd,dynamicArrayOf:()=>Wd,f16:()=>Cd,f32:()=>Bd,f32Array:()=>uf,f64Array:()=>hf,generic:()=>Ld,genericEnum:()=>Rd,i16:()=>Sd,i16Array:()=>af,i32:()=>Ud,i32Array:()=>of,i8:()=>_d,i8Array:()=>sf,keyed:()=>Yd,object:()=>Gd,optional:()=>Zd,string:()=>$d,tupleOf:()=>Kd,u16:()=>kd,u16Array:()=>rf,u32:()=>Vd,u32Array:()=>nf,u8:()=>Ju,u8Array:()=>ef,u8ClampedArray:()=>tf});var Kt=class Yu extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Yu.prototype)}},Bi=class Xu extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Xu.prototype)}},dd=class{constructor(){P(this,"size",Number.NaN),P(this,"unbounded",this),P(this,"isUnbounded",!0)}add(){return this}fork(){return this}},fd=new dd,K=class Zu{constructor(){P(this,"size",0),P(this,"unbounded",fd),P(this,"isUnbounded",!1)}add(t){return this.size+=t,this}fork(){const t=new Zu;return t.size=this.size,t}},ne=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),ye=class{constructor(){P(this,"__unwrapped")}resolveReferences(e){}seekProperty(e,t){return null}},md=class{constructor(e){this.key=e}},mn={STRING:"string",ENUM:"enum"},yd=class extends ye{constructor(e,t){super(),this._unstableElementSchema=e,this.length=t,P(this,"elementSchema"),this.elementSchema=e}resolveReferences(e){this.elementSchema=e.resolve(this._unstableElementSchema)}write(e,t){if(t.length!==this.length)throw new Bi(`Expected array of length ${this.length}, got ${t.length}`);for(const r of t)this.elementSchema.write(e,r)}read(e){const t=[];for(let r=0;r<this.length;++r)t.push(this.elementSchema.read(e));return t}get maxSize(){return this.elementSchema.measure(ne).size*this.length}measure(e,t=new K){for(let r=0;r<this.length;++r)this.elementSchema.measure(e===ne?ne:e[r],t);return t}};function gd(e,t){return new yd(e,t)}var wd=class extends ye{constructor(){super(...arguments),P(this,"maxSize",1)}read(e){return e.readBool()}write(e,t){e.writeBool(t)}measure(e,t=new K){return t.add(1)}},xd=new wd,Qu=class nn extends ye{static get _encoder(){return nn._cachedEncoder||(nn._cachedEncoder=new TextEncoder),nn._cachedEncoder}read(t){return t.readString()}write(t,r){t.writeString(r)}measure(t,r=new K){if(t===ne)return r.unbounded;const n=nn._encoder.encode(t);return r.add(n.byteLength+1)}};P(Qu,"_cachedEncoder");var vd=Qu,$d=new vd,bd=class extends ye{constructor(){super(...arguments),P(this,"maxSize",1)}read(e){return e.readInt8()}write(e,t){e.writeInt8(t)}measure(e,t=new K){return t.add(1)}},_d=new bd,Td=class extends ye{constructor(){super(...arguments),P(this,"maxSize",1)}read(e){return e.readUint8()}write(e,t){e.writeUint8(t)}measure(e,t=new K){return t.add(1)}},Ju=new Td,zd=Ju,Id=class extends ye{constructor(){super(...arguments),P(this,"maxSize",2)}read(e){return e.readInt16()}write(e,t){e.writeInt16(t)}measure(e,t=new K){return t.add(2)}},Sd=new Id,Ed=class extends ye{constructor(){super(...arguments),P(this,"maxSize",2)}read(e){return e.readUint16()}write(e,t){e.writeUint16(t)}measure(e,t=new K){return t.add(2)}},kd=new Ed,Md=class extends ye{constructor(){super(...arguments),P(this,"maxSize",4)}read(e){return e.readInt32()}write(e,t){e.writeInt32(t)}measure(e,t=new K){return t.add(4)}},Ud=new Md,Pd=class extends ye{constructor(){super(...arguments),P(this,"maxSize",4)}read(e){return e.readUint32()}write(e,t){e.writeUint32(t)}measure(e,t=new K){return t.add(4)}},Vd=new Pd,Ad=class extends ye{constructor(){super(...arguments),P(this,"maxSize",2)}read(e){return e.readFloat16()}write(e,t){e.writeFloat16(t)}measure(e,t=new K){return t.add(2)}},Cd=new Ad,Od=class extends ye{constructor(){super(...arguments),P(this,"maxSize",4)}read(e){return e.readFloat32()}write(e,t){e.writeFloat32(t)}measure(e,t=new K){return t.add(4)}},Bd=new Od,Fd=class extends ye{constructor(e){super(),this.length=e}write(e,t){if(t.length!==this.length)throw new Bi(`Expected char-string of length ${this.length}, got ${t.length}`);for(let r=0;r<t.length;++r)e.writeUint8(t.charCodeAt(r))}read(e){let t="";for(let r=0;r<this.length;++r)t+=String.fromCharCode(e.readByte());return t}measure(e,t=new K){return t.add(this.length)}};function jd(e){return new Fd(e)}function Bt(e){return Object.entries(e)}function Ku(e,t){const r={};for(const[n,i]of Bt(t))r[n]=e.resolve(i);return r}var da=class extends ye{constructor(e){super(),this._properties=e,P(this,"properties"),this.properties=e}resolveReferences(e){this.properties=Ku(e,this._properties)}write(e,t){for(const[r,n]of Bt(this.properties))n.write(e,t[r])}read(e){const t={};for(const[r,n]of Bt(this.properties))t[r]=n.read(e);return t}get maxSize(){const e=new K;for(const t of Object.values(this.properties))t.measure(ne,e);return e.size}measure(e,t=new K){for(const[r,n]of Bt(this.properties))n.measure(e===ne?ne:e[r],t);return t}seekProperty(e,t){let r=0;for(const[n,i]of Bt(this.properties)){if(n===t)return{bufferOffset:r,schema:i};r+=i.measure(e).size}return null}};function Gd(e){return new da(e)}var eh=class extends ye{constructor(e,t,r){super(),this.keyedBy=e,this._subTypeMap=r,P(this,"_baseObject"),P(this,"subTypeMap"),this._baseObject=new da(t),this.subTypeMap=r}resolveReferences(e){this._baseObject.resolveReferences(e),this.subTypeMap=Ku(e,this._subTypeMap)}write(e,t){const r=t.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===mn.ENUM?e.writeUint8(t.type):e.writeString(t.type),this._baseObject.write(e,t);for(const[i,s]of Bt(n.properties))s.write(e,t[i])}read(e){const t=this.keyedBy===mn.ENUM?e.readByte():e.readString(),r=this.subTypeMap[t]||null;if(r===null)throw new Error(`Unknown sub-type '${t}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const n=this._baseObject.read(e);if(n.type=t,r!==null)for(const[i,s]of Bt(r.properties))n[i]=s.read(e);return n}measure(e,t=new K){if(this._baseObject.measure(e,t),this.keyedBy===mn.ENUM)t.add(1);else if(e!==ne)t.add(e.type.length+1);else return t.unbounded;if(e===ne){const r=Object.values(this.subTypeMap).map(n=>{const i=t.fork();for(const s of Object.values(n.properties))s.measure(ne,i);return[n,i.size]}).reduce((n,i)=>n[1]>i[1]?n:i)[0];for(const n of Object.values(r.properties))n.measure(ne,t)}else{const r=e.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[i,s]of Bt(n.properties))s.measure(e[i],t)}return t}};function Ld(e,t){return new eh(mn.STRING,e,t)}function Rd(e,t){return new eh(mn.ENUM,e,t)}function Dd(e){return new da(Object.fromEntries(e.flatMap(({properties:t})=>Object.entries(t))))}var Nd=class extends ye{constructor(e){super(),this._unstableElementType=e,P(this,"elementType"),this.elementType=e}resolveReferences(e){this.elementType=e.resolve(this._unstableElementType)}write(e,t){e.writeUint32(t.length);for(const r of t)this.elementType.write(e,r)}read(e){const t=[],r=e.readUint32();for(let n=0;n<r;++n)t.push(this.elementType.read(e));return t}get maxSize(){return this.measure(ne).size}measure(e,t=new K){if(e===ne)return t.unbounded;t.add(4);for(const r of e)this.elementType.measure(r,t);return t}seekProperty(e,t){if(typeof t=="symbol")return null;const r=Number.parseInt(String(t),10);if(Number.isNaN(r))return null;if(e===ne)return{bufferOffset:this.elementType.measure(ne).size*r,schema:this.elementType};if(r>=e.length)return null;const n=new K;for(let i=0;i<r;++i)this.elementType.measure(e[i],n);return{bufferOffset:n.size,schema:this.elementType}}};function Wd(e){return new Nd(e)}var th=class{constructor(e){P(this,"__unwrapped"),P(this,"ref"),this.ref=new md(e)}resolveReferences(){throw new Kt("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new Kt("Tried to read a reference directly. Resolve it instead.")}write(){throw new Kt("Tried to write a reference directly. Resolve it instead.")}measure(){throw new Kt("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new Kt("Tried to seek property of a reference directly. Resolve it instead.")}},qd=class{constructor(){P(this,"registry",{})}hasKey(e){return this.registry[e]!==void 0}register(e,t){this.registry[e]=t}resolve(e){if(e instanceof th){const r=e.ref.key;if(this.registry[r]!==void 0)return this.registry[r];throw new Kt(`Couldn't resolve reference to ${r}. Unknown key.`)}return e.resolveReferences(this),e}},Hd=class{constructor(e,t){this.key=e,P(this,"__unwrapped"),P(this,"__keyDefinition"),P(this,"innerType"),this.innerType=t(new th(e)),this.resolveReferences(new qd)}resolveReferences(e){e.hasKey(this.key)||(e.register(this.key,this.innerType),this.innerType.resolveReferences(e))}read(e){return this.innerType.read(e)}write(e,t){this.innerType.write(e,t)}get maxSize(){return this.measure(ne).size}measure(e,t=new K){return this.innerType.measure(e,t)}seekProperty(e,t){return this.innerType.seekProperty(e,t)}};function Yd(e,t){return new Hd(e,t)}var Xd=class extends ye{constructor(e){super(),this._innerUnstableSchema=e,P(this,"innerSchema"),this.innerSchema=e}resolveReferences(e){this.innerSchema=e.resolve(this._innerUnstableSchema)}write(e,t){t!=null?(e.writeBool(!0),this.innerSchema.write(e,t)):e.writeBool(!1)}read(e){if(e.readBool())return this.innerSchema.read(e)}get maxSize(){return this.measure(ne).size}measure(e,t=new K){return e!==void 0&&this.innerSchema.measure(e,t),t.add(1)}};function Zd(e){return new Xd(e)}function Qd(e,t){return t.map(r=>e.resolve(r))}var Jd=class extends ye{constructor(e){super(),this._unstableSchemas=e,P(this,"schemas"),this.schemas=e}resolveReferences(e){this.schemas=Qd(e,this._unstableSchemas)}write(e,t){if(t.length!==this.schemas.length)throw new Bi(`Expected tuple of length ${this.schemas.length}, got ${t.length}`);for(let r=0;r<this.schemas.length;++r)this.schemas[r].write(e,t[r])}read(e){const t=[];for(let r=0;r<this.schemas.length;++r)t.push(this.schemas[r].read(e));return t}get maxSize(){return this.measure(ne).size}measure(e,t=new K){for(let r=0;r<this.schemas.length;++r)this.schemas[r].measure(e===ne?ne:e[r],t);return t}};function Kd(e){return new Jd(e)}var Ut=class extends ye{constructor(e,t){super(),this.length=e,this._arrayConstructor=t,P(this,"byteLength"),this.byteLength=e*t.BYTES_PER_ELEMENT}write(e,t){e.writeSlice(t)}read(e){const t=new ArrayBuffer(this.byteLength),r=new this._arrayConstructor(t,0,this.length);return e.readSlice(r,0,this.byteLength),r}measure(e,t=new K){return t.add(this.byteLength)}},ef=e=>new Ut(e,Uint8Array),tf=e=>new Ut(e,Uint8ClampedArray),rf=e=>new Ut(e,Uint16Array),nf=e=>new Ut(e,Uint32Array),sf=e=>new Ut(e,Int8Array),af=e=>new Ut(e,Int16Array),of=e=>new Ut(e,Int32Array),uf=e=>new Ut(e,Float32Array),hf=e=>new Ut(e,Float64Array);function lf(){const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return t[0]=1,e[0]===0}function rh(){return lf()?"big":"little"}function fa(e){let t=0,r=e;return r&&"buffer"in r&&"byteOffset"in r&&(t+=r.byteOffset,r=r.buffer),{buffer:r,byteOffset:t,byteLength:e.byteLength}}var nh=class{constructor(e,t){P(this,"dataView"),P(this,"littleEndian"),P(this,"byteOffset",0),P(this,"endianness");const{byteOffset:r=0,endianness:n="system"}=t??{};this.byteOffset=r;const i=rh();this.endianness=n==="system"?i:n,this.littleEndian=this.endianness==="little";const s=fa(e);this.byteOffset+=s.byteOffset,this.dataView=new DataView(s.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(e){this.byteOffset=e}skipBytes(e){this.byteOffset+=e}};function cf(e){if(e===0)return 0;if(Number.isNaN(e))return 32256;if(!Number.isFinite(e))return e>0?31744:64512;const t=e<0?1:0,r=Math.abs(e),n=Math.floor(Math.log2(r)),i=r/2**n-1,s=n+15,a=Math.floor(i*1024);return t<<15|s<<10|a}function pf(e){const t=(e&32768)>>15,r=(e&31744)>>10,n=e&1023;return r===0?t===0?n/1024:-n/1024:r===31?n===0?t===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(t===0?1:-1)*(1+n/1024)*2**(r-15)}var Ft=class extends nh{constructor(){super(...arguments),P(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const e=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readUint16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readInt32(){const e=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readUint32(){const e=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readFloat16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,pf(e)}readFloat32(){const e=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readString(){let e=0;for(;this.byteOffset+e<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+e++)!==0;);const t=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,e-1));return this.byteOffset+=e,t}readSlice(e,t,r){const n=fa(e),i=new Uint8Array(n.buffer,n.byteOffset+t);for(let s=0;s<r;++s)i[s]=this.dataView.getUint8(this.byteOffset++)}},hr=class extends nh{constructor(){super(...arguments),P(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(e){this.dataView.setUint8(this.byteOffset++,e?1:0)}writeByte(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt8(e){this.dataView.setInt8(this.byteOffset++,e)}writeUint8(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt16(e){this.dataView.setInt16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeUint16(e){this.dataView.setUint16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeInt32(e){this.dataView.setInt32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeUint32(e){this.dataView.setUint32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeFloat16(e){this.dataView.setUint16(this.byteOffset,cf(e),this.littleEndian),this.byteOffset+=2}writeFloat32(e){this.dataView.setFloat32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeString(e){const t=this._textEncoder.encodeInto(e,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=t.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(e){const t=fa(e),r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(const n of r)this.dataView.setUint8(this.byteOffset++,n)}},V=e=>({argTypes:[e],returnType:e}),Fi=(...e)=>{let t=me(e)??e;return{argTypes:t,returnType:t[0]}};function ih(e){return(t,...r)=>{let n=t;for(let i of r)n=e(n,i);return n}}function sh(e){return(t,...r)=>{let n=c`${t}`;for(let i of r)n=c`${e}(${n}, ${i})`;return n}}function df(e){return typeof e=="number"?Math.abs(e):_.abs[e.kind](e)}var ff=d({name:"abs",signature:V,normalImpl:df,codegenImpl:e=>c`abs(${e})`});function mf(e){return typeof e=="number"?Math.acos(e):_.acos[e.kind](e)}var yf=d({name:"acos",signature:V,normalImpl:mf,codegenImpl:e=>c`acos(${e})`});function gf(e){return typeof e=="number"?Math.acosh(e):_.acosh[e.kind](e)}var wf=d({name:"acosh",signature:V,normalImpl:gf,codegenImpl:e=>c`acosh(${e})`});function xf(e){return typeof e=="number"?Math.asin(e):_.asin[e.kind](e)}var vf=d({name:"asin",signature:V,normalImpl:xf,codegenImpl:e=>c`asin(${e})`});function $f(e){return typeof e=="number"?Math.asinh(e):_.asinh[e.kind](e)}var bf=d({name:"asinh",signature:V,normalImpl:$f,codegenImpl:e=>c`asinh(${e})`});function _f(e){return typeof e=="number"?Math.atan(e):_.atan[e.kind](e)}var ys=d({name:"atan",signature:V,normalImpl:_f,codegenImpl:e=>c`atan(${e})`});function Tf(e){return typeof e=="number"?Math.atanh(e):_.atanh[e.kind](e)}var zf=d({name:"atanh",signature:V,normalImpl:Tf,codegenImpl:e=>c`atanh(${e})`});function If(e,t){return typeof e=="number"&&typeof t=="number"?Math.atan2(e,t):_.atan2[e.kind](e,t)}var Sf=d({name:"atan2",signature:(...e)=>{let t=me(e,[w,se,pt])??e;return{argTypes:t,returnType:t[0]}},normalImpl:If,codegenImpl:(e,t)=>c`atan2(${e}, ${t})`});function Ef(e){return typeof e=="number"?Math.ceil(e):_.ceil[e.kind](e)}var ah=d({name:"ceil",signature:V,normalImpl:Ef,codegenImpl:e=>c`ceil(${e})`});function kf(e,t,r){return typeof e=="number"?Math.min(Math.max(t,e),r):_.clamp[e.kind](e,t,r)}var sn=d({name:"clamp",signature:Fi,normalImpl:kf,codegenImpl:(e,t,r)=>c`clamp(${e}, ${t}, ${r})`});function Mf(e){return typeof e=="number"?Math.cos(e):_.cos[e.kind](e)}var an=d({name:"cos",signature:V,normalImpl:Mf,codegenImpl:e=>c`cos(${e})`});function Uf(e){return typeof e=="number"?Math.cosh(e):_.cosh[e.kind](e)}var Pf=d({name:"cosh",signature:V,normalImpl:Uf,codegenImpl:e=>c`cosh(${e})`}),Vf=d({name:"countLeadingZeros",signature:V,normalImpl:"CPU implementation for countLeadingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countLeadingZeros(${e})`}),Af=d({name:"countOneBits",signature:V,normalImpl:"CPU implementation for countOneBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countOneBits(${e})`}),Cf=d({name:"countTrailingZeros",signature:V,normalImpl:"CPU implementation for countTrailingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countTrailingZeros(${e})`}),Of=d({name:"cross",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>_.cross[e.kind](e,t),codegenImpl:(e,t)=>c`cross(${e}, ${t})`});function Bf(e){if(typeof e=="number")return e*180/Math.PI;throw new Je("CPU implementation for degrees on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Ff=d({name:"degrees",signature:V,normalImpl:Bf,codegenImpl:e=>c`degrees(${e})`}),jf=d({name:"determinant",signature:V,normalImpl:"CPU implementation for determinant not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`determinant(${e})`});function Gf(e,t){return typeof e=="number"&&typeof t=="number"?Math.abs(e-t):uh(qr(e,t))}var Lf=d({name:"distance",signature:(...e)=>({argTypes:e,returnType:Cs(e[0])?se:w}),normalImpl:Gf,codegenImpl:(e,t)=>c`distance(${e}, ${t})`}),oh=d({name:"dot",signature:(...e)=>({argTypes:e,returnType:e[0].primitive}),normalImpl:(e,t)=>_.dot[e.kind](e,t),codegenImpl:(e,t)=>c`dot(${e}, ${t})`}),Rf=d({name:"dot4U8Packed",signature:{argTypes:[b,b],returnType:b},normalImpl:"CPU implementation for dot4U8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4U8Packed(${e}, ${t})`}),Df=d({name:"dot4I8Packed",signature:{argTypes:[b,b],returnType:B},normalImpl:"CPU implementation for dot4I8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4I8Packed(${e}, ${t})`});function Nf(e){return typeof e=="number"?Math.exp(e):_.exp[e.kind](e)}var Wf=d({name:"exp",signature:V,normalImpl:Nf,codegenImpl:e=>c`exp(${e})`});function qf(e){return typeof e=="number"?2**e:_.exp2[e.kind](e)}var Hf=d({name:"exp2",signature:V,normalImpl:qf,codegenImpl:e=>c`exp2(${e})`}),Yf=d({name:"extractBits",signature:(e,t,r)=>({argTypes:[e,b,b],returnType:e}),normalImpl:"CPU implementation for extractBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`extractBits(${e}, ${t}, ${r})`}),Xf=d({name:"faceForward",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:"CPU implementation for faceForward not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`faceForward(${e}, ${t}, ${r})`}),Zf=d({name:"firstLeadingBit",signature:V,normalImpl:"CPU implementation for firstLeadingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstLeadingBit(${e})`}),Qf=d({name:"firstTrailingBit",signature:V,normalImpl:"CPU implementation for firstTrailingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstTrailingBit(${e})`});function Jf(e){return typeof e=="number"?Math.floor(e):_.floor[e.kind](e)}var gs=d({name:"floor",signature:V,normalImpl:Jf,codegenImpl:e=>c`floor(${e})`});function Kf(e,t,r){if(typeof e=="number")return e*t+r;throw new Je("CPU implementation for fma on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var em=d({name:"fma",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Kf,codegenImpl:(e,t,r)=>c`fma(${e}, ${t}, ${r})`});function tm(e){return typeof e=="number"?e-Math.floor(e):_.fract[e.kind](e)}var rm=d({name:"fract",signature:V,normalImpl:tm,codegenImpl:e=>c`fract(${e})`}),nm={f32:pe({fract:w,exp:B}),f16:pe({fract:se,exp:B}),abstractFloat:pe({fract:pt,exp:In}),vec2f:pe({fract:D,exp:ee}),vec3f:pe({fract:ae,exp:Ae}),vec4f:pe({fract:I,exp:ce}),vec2h:pe({fract:dt,exp:ee}),vec3h:pe({fract:ft,exp:Ae}),vec4h:pe({fract:mt,exp:ce})},im=d({name:"frexp",normalImpl:"CPU implementation for frexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",signature:e=>{let t=nm[e.type];if(!t)throw new Error(`Unsupported data type for frexp: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},codegenImpl:e=>c`frexp(${e})`}),sm=d({name:"insertBits",signature:(e,t,r,n)=>({argTypes:[e,t,b,b],returnType:e}),normalImpl:"CPU implementation for insertBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r,n)=>c`insertBits(${e}, ${t}, ${r}, ${n})`});function am(e){if(typeof e=="number")return 1/Math.sqrt(e);throw new Je("CPU implementation for inverseSqrt on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var om=d({name:"inverseSqrt",signature:V,normalImpl:am,codegenImpl:e=>c`inverseSqrt(${e})`}),um=d({name:"ldexp",signature:(e,t)=>{switch(e.type){case"abstractFloat":return{argTypes:[e,In],returnType:e};case"f32":case"f16":return{argTypes:[e,B],returnType:e};case"vec2f":case"vec2h":return{argTypes:[e,ee],returnType:e};case"vec3f":case"vec3h":return{argTypes:[e,Ae],returnType:e};case"vec4f":case"vec4h":return{argTypes:[e,ce],returnType:e};default:throw new Error(`Unsupported data type for ldexp: ${e.type}. Supported types are abstractFloat, f32, f16, vec2f, vec2h, vec3f, vec3h, vec4f, vec4h.`)}},normalImpl:"CPU implementation for ldexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`ldexp(${e}, ${t})`});function hm(e){return typeof e=="number"?Math.abs(e):_.length[e.kind](e)}var uh=d({name:"length",signature:e=>({argTypes:[e],returnType:Cs(e)?se:w}),normalImpl:hm,codegenImpl:e=>c`length(${e})`});function lm(e){return typeof e=="number"?Math.log(e):_.log[e.kind](e)}var cm=d({name:"log",signature:V,normalImpl:lm,codegenImpl:e=>c`log(${e})`});function pm(e){return typeof e=="number"?Math.log2(e):_.log2[e.kind](e)}var dm=d({name:"log2",signature:V,normalImpl:pm,codegenImpl:e=>c`log2(${e})`});function fm(e,t){return typeof e=="number"?Math.max(e,t):_.max[e.kind](e,t)}var hh=d({name:"max",signature:Fi,normalImpl:ih(fm),codegenImpl:sh("max")});function mm(e,t){return typeof e=="number"?Math.min(e,t):_.min[e.kind](e,t)}var ym=d({name:"min",signature:Fi,normalImpl:ih(mm),codegenImpl:sh("min")});function gm(e,t,r){if(typeof e=="number"){if(typeof r!="number"||typeof t!="number")throw new Error("When e1 and e2 are numbers, the blend factor must be a number.");return e*(1-r)+t*r}if(typeof e=="number"||typeof t=="number")throw new Error("e1 and e2 need to both be vectors of the same kind.");return _.mix[e.kind](e,t,r)}var ei=d({name:"mix",signature:Fi,normalImpl:gm,codegenImpl:(e,t,r)=>c`mix(${e}, ${t}, ${r})`}),wm={f32:pe({fract:w,whole:w}),f16:pe({fract:se,whole:se}),abstractFloat:pe({fract:pt,whole:pt}),vec2f:pe({fract:D,whole:D}),vec3f:pe({fract:ae,whole:ae}),vec4f:pe({fract:I,whole:I}),vec2h:pe({fract:dt,whole:dt}),vec3h:pe({fract:ft,whole:ft}),vec4h:pe({fract:mt,whole:mt})},xm=d({name:"modf",signature:e=>{let t=wm[e.type];if(!t)throw new Error(`Unsupported data type for modf: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},normalImpl:"CPU implementation for modf not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`modf(${e})`}),vm=d({name:"normalize",signature:V,normalImpl:e=>_.normalize[e.kind](e),codegenImpl:e=>c`normalize(${e})`});function $m(e,t){if(typeof e=="number"&&typeof t=="number")return e**t;if(Q(e)&&Q(t))return _.pow[e.kind](e,t);throw new Error("Invalid arguments to pow()")}var lh=d({name:"pow",signature:(...e)=>{let t=me(e,[w,se,pt])??e;return{argTypes:t,returnType:jt(t[0])?t[1]:t[0]}},normalImpl:$m,codegenImpl:(e,t)=>c`pow(${e}, ${t})`}),bm=d({name:"quantizeToF16",signature:V,normalImpl:"CPU implementation for quantizeToF16 not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`quantizeToF16(${e})`});function _m(e){if(typeof e=="number")return e*Math.PI/180;throw new Je("CPU implementation for radians on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Tm=d({name:"radians",signature:(...e)=>{let t=me(e,[w,se,pt])??e;return{argTypes:t,returnType:t[0]}},normalImpl:_m,codegenImpl:e=>c`radians(${e})`}),zm=d({name:"reflect",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>qr(e,Vn(2*oh(t,e),t)),codegenImpl:(e,t)=>c`reflect(${e}, ${t})`}),Im=d({name:"refract",normalImpl:"CPU implementation for refract not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`refract(${e}, ${t}, ${r})`,signature:(e,t,r)=>({argTypes:[e,t,Cs(e)?se:w],returnType:e})}),Sm=d({name:"reverseBits",signature:V,normalImpl:"CPU implementation for reverseBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`reverseBits(${e})`});function Em(e){if(typeof e=="number")return Math.round(e);throw new Je("CPU implementation for round on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var km=d({name:"round",signature:V,normalImpl:Em,codegenImpl:e=>c`round(${e})`});function Mm(e){if(typeof e=="number")return Math.max(0,Math.min(1,e));throw new Je("CPU implementation for saturate on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Um=d({name:"saturate",signature:V,normalImpl:Mm,codegenImpl:e=>c`saturate(${e})`});function Pm(e){return typeof e=="number"?Math.sign(e):_.sign[e.kind](e)}var Vm=d({name:"sign",signature:V,normalImpl:Pm,codegenImpl:e=>c`sign(${e})`});function Am(e){return typeof e=="number"?Math.sin(e):_.sin[e.kind](e)}var on=d({name:"sin",signature:V,normalImpl:Am,codegenImpl:e=>c`sin(${e})`});function Cm(e){if(typeof e=="number")return Math.sinh(e);throw new Je("CPU implementation for sinh on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Om=d({name:"sinh",signature:V,normalImpl:Cm,codegenImpl:e=>c`sinh(${e})`});function Bm(e,t,r){return typeof r=="number"?Jt(e,t,r):_.smoothstep[r.kind](e,t,r)}var Fm=d({name:"smoothstep",signature:(...e)=>({argTypes:e,returnType:e[2]}),normalImpl:Bm,codegenImpl:(e,t,r)=>c`smoothstep(${e}, ${t}, ${r})`});function jm(e){return typeof e=="number"?Math.sqrt(e):_.sqrt[e.kind](e)}var ch=d({name:"sqrt",signature:V,normalImpl:jm,codegenImpl:e=>c`sqrt(${e})`});function Gm(e,t){if(typeof e=="number")return e<=t?1:0;throw new Je("CPU implementation for step on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Lm=d({name:"step",signature:(...e)=>{let t=me(e,[w,se,pt])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Gm,codegenImpl:(e,t)=>c`step(${e}, ${t})`});function Rm(e){if(typeof e=="number")return Math.tan(e);throw new Je("CPU implementation for tan on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Dm=d({name:"tan",signature:V,normalImpl:Rm,codegenImpl:e=>c`tan(${e})`});function Nm(e){return typeof e=="number"?Math.tanh(e):_.tanh[e.kind](e)}var Wm=d({name:"tanh",signature:V,normalImpl:Nm,codegenImpl:e=>c`tanh(${e})`}),qm=d({name:"transpose",signature:V,normalImpl:"CPU implementation for transpose not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`transpose(${e})`}),Hm=d({name:"trunc",signature:V,normalImpl:"CPU implementation for trunc not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`trunc(${e})`}),ph=d({name:"bitcastU32toF32",normalImpl:(e=>typeof e=="number"?nt(e):_.bitcastU32toF32[e.kind](e)),codegenImpl:e=>c`bitcast<f32>(${e})`,signature:(...e)=>{let t=me(e,[b])??e;return{argTypes:t,returnType:ct(t[0])?t[0].type==="vec2u"?D:t[0].type==="vec3u"?ae:I:w}}}),dh=d({name:"bitcastU32toI32",normalImpl:(e=>typeof e=="number"?it(e):_.bitcastU32toI32[e.kind](e)),codegenImpl:e=>c`bitcast<i32>(${e})`,signature:(...e)=>{let t=me(e,[b])??e;return{argTypes:t,returnType:ct(t[0])?t[0].type==="vec2u"?ee:t[0].type==="vec3u"?Ae:ce:B}}}),fh=d({name:"unpack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4);new hr(t).writeUint32(e);let r=new Ft(t);return D(r.readFloat16(),r.readFloat16())},signature:{argTypes:[b],returnType:D},codegenImpl:e=>c`unpack2x16float(${e})`}),Ym=d({name:"pack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4),r=new hr(t);r.writeFloat16(e.x),r.writeFloat16(e.y);let n=new Ft(t);return b(n.readUint32())},signature:{argTypes:[D],returnType:b},codegenImpl:e=>c`pack2x16float(${e})`}),Xm=d({name:"unpack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4);new hr(t).writeUint32(e);let r=new Ft(t);return I(r.readUint8()/255,r.readUint8()/255,r.readUint8()/255,r.readUint8()/255)},signature:{argTypes:[b],returnType:I},codegenImpl:e=>c`unpack4x8unorm(${e})`}),Zm=d({name:"pack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4),r=new hr(t);r.writeUint8(e.x*255),r.writeUint8(e.y*255),r.writeUint8(e.z*255),r.writeUint8(e.w*255);let n=new Ft(t);return b(n.readUint32())},signature:{argTypes:[I],returnType:b},codegenImpl:e=>c`pack4x8unorm(${e})`});function Hr(e){return e.type.includes("2")?ar:e.type.includes("3")?or:ur}var mh=d({name:"allEq",signature:(...e)=>({argTypes:e,returnType:G}),normalImpl:(e,t)=>ya(Cn(e,t)),codegenImpl:(e,t)=>c`all(${e} == ${t})`}),Cn=(e,t)=>_.eq[e.kind](e,t),Qm=d({name:"eq",signature:(...e)=>({argTypes:e,returnType:Hr(e[0])}),normalImpl:Cn,codegenImpl:(e,t)=>c`(${e} == ${t})`}),Jm=d({name:"ne",signature:(...e)=>({argTypes:e,returnType:Hr(e[0])}),normalImpl:(e,t)=>_t(Cn(e,t)),codegenImpl:(e,t)=>c`(${e} != ${t})`}),ji=(e,t)=>_.lt[e.kind](e,t),Km=d({name:"lt",signature:(...e)=>({argTypes:e,returnType:Hr(e[0])}),normalImpl:ji,codegenImpl:(e,t)=>c`(${e} < ${t})`}),ey=d({name:"le",signature:(...e)=>({argTypes:e,returnType:Hr(e[0])}),normalImpl:(e,t)=>ma(ji(e,t),Cn(e,t)),codegenImpl:(e,t)=>c`(${e} <= ${t})`}),ty=d({name:"gt",signature:(...e)=>({argTypes:e,returnType:Hr(e[0])}),normalImpl:(e,t)=>yh(_t(ji(e,t)),_t(Cn(e,t))),codegenImpl:(e,t)=>c`(${e} > ${t})`}),ry=d({name:"ge",signature:(...e)=>({argTypes:e,returnType:Hr(e[0])}),normalImpl:(e,t)=>_t(ji(e,t)),codegenImpl:(e,t)=>c`(${e} >= ${t})`}),_t=e=>_.neg[e.kind](e),ny=d({name:"not",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:_t,codegenImpl:e=>c`!(${e})`}),ma=(e,t)=>_.or[e.kind](e,t),iy=d({name:"or",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:ma,codegenImpl:(e,t)=>c`(${e} | ${t})`}),yh=(e,t)=>_t(ma(_t(e),_t(t))),sy=d({name:"and",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:yh,codegenImpl:(e,t)=>c`(${e} & ${t})`}),ya=e=>_.all[e.kind](e),ay=d({name:"all",signature:(...e)=>({argTypes:e,returnType:G}),normalImpl:ya,codegenImpl:e=>c`all(${e})`}),oy=d({name:"any",signature:(...e)=>({argTypes:e,returnType:G}),normalImpl:e=>!ya(_t(e)),codegenImpl:e=>c`any(${e})`}),uy=d({name:"isCloseTo",signature:(...e)=>({argTypes:e,returnType:G}),normalImpl:(e,t,r=.01)=>typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<r:Q(e)&&Q(t)?_.isCloseToZero[e.kind](qr[l].jsImpl(e,t),r):!1,codegenImpl:(e,t,r=y(.01,w,"constant"))=>Wn(e)&&Wn(t)?c`(abs(f32(${e}) - f32(${t})) <= ${r})`:!Wn(e)&&!Wn(t)?c`all(abs(${e} - ${t}) <= (${e} - ${e}) + ${r})`:"false"});function hy(e,t,r){return typeof r=="boolean"?r?t:e:_.select[e.kind](e,t,r)}var ly=d({name:"select",signature:(e,t,r)=>{let[n,i]=me([e,t])??[e,t];return{argTypes:[n,i,r],returnType:n}},normalImpl:hy,codegenImpl:(e,t,r)=>c`select(${e}, ${t}, ${r})`}),cy={channelType:w,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:"non-copyable"},py={channelType:w,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:2},dy={channelType:w,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:4},fy={channelType:b,vectorType:ge,sampleTypes:["uint"],texelSize:1},Ja=new Map;function On(e){let t=Ja.get(e);return t===void 0&&(t=my(e),Ja.set(e,t)),t}function my(e){let t=wy(e),r=yy(e),n=e.includes("stencil");return{channelType:t,vectorType:t===b?ge:t===B?ce:I,texelSize:xy(e),sampleTypes:vy(e),canRenderAttachment:gy(e),...r&&{depthAspect:r},...n&&{stencilAspect:fy}}}function yy(e){if(e==="depth16unorm")return py;if(e==="depth32float"||e==="depth32float-stencil8")return dy;if(e==="depth24plus"||e==="depth24plus-stencil8")return cy}function gy(e){return!(e.startsWith("bc")||e.startsWith("etc2")||e.startsWith("eac")||e.startsWith("astc")||e==="rgb9e5ufloat")}function wy(e){return e==="stencil8"||e.includes("uint")?b:e.includes("sint")?B:w}function xy(e){let[,t,r]=e.match(/^(rgba|bgra|rg|r)(8|16|32)/)??[];return t&&r?t.length*Number(r)/8:e==="stencil8"?1:e==="depth16unorm"?2:e==="depth32float"?4:e==="depth32float-stencil8"?5:e==="depth24plus"||e==="depth24plus-stencil8"?"non-copyable":/^(bc[14]-|etc2-rgb8|eac-r11)/.test(e)?8:/^(bc|astc-|etc2-rgba|eac-rg)/.test(e)?16:4}function vy(e){return e==="stencil8"?["uint"]:e.includes("uint")?["uint"]:e.includes("sint")?["sint"]:e.includes("depth")?["depth","unfilterable-float"]:/^(r|rg|rgba)16(u|s)norm$/.test(e)?["unfilterable-float"]:["float","unfilterable-float"]}var $y=new Set(["r32float","rg32float","rgba32float"]);function by(e,t){return $y.has(t)&&!e.features.has("float32-filterable")?["unfilterable-float"]:On(t).sampleTypes}var ga=["f16","clip_distances","dual_source_blending","subgroups","primitive_index"],gh={f16:"shader-f16",clip_distances:"clip-distances",dual_source_blending:"dual-source-blending",subgroups:"subgroups",primitive_index:"primitive-index"},_y={block:0,binaryExpr:1,assignmentExpr:2,logicalExpr:3,unaryExpr:4,numericLiteral:5,call:6,memberAccess:7,indexAccess:8,return:10,if:11,let:12,const:13,for:14,while:15,continue:16,break:17,arrayExpr:100,preUpdate:101,postUpdate:102,stringLiteral:103,objectExpr:104},ws={identifier:"i",destructuredObject:"d"};const Ty=Object.freeze(Object.defineProperty({__proto__:null,FuncParameterType:ws,NodeTypeCatalog:_y},Symbol.toStringTag,{value:"Module"}));function zy(e){return e?.[F]}var De={get(e,t){if(t in e)return Reflect.get(e,t);if(t==="toString"||t===Symbol.toStringTag||t===Symbol.toPrimitive)return()=>e.toString();if(typeof t=="symbol")return;let r=Si(e),n=la(r,String(t));if(n)return new Proxy({[l]:!0,[z]:i=>i.resolve(n.value,n.dataType),[ke]:n,toString:()=>`${String(e)}.${t}`},De)}};function Gi(e){let t=e;for(;;){let r=zy(t);if(!r)break;t=r}return t}function xs(e,t){return new Iy(e,t)}function wh(e){let t=Reflect.ownKeys(e);for(let r of t){let n=e[r];(n&&typeof n=="object"||typeof n=="function")&&wh(n)}return Object.freeze(e)}var Iy=class{constructor(t,r){this.dataType=t,this.#e=r&&typeof r=="object"?wh(r):r}[l]={};#e;$name(t){return L(this,t),this}[z](t){let r=t.getUniqueName(this),n=t.resolve(this.dataType).value,i=t.resolve(this.#e,this.dataType).value;return t.addDeclaration(`const ${r}: ${n} = ${i};`),y(r,this.dataType,$e(this.dataType)?"constant":"constant-tgpu-const-ref")}toString(){return`const:${v(this)??"<unnamed>"}`}get[F](){let t=this.dataType;return new Proxy({[l]:!0,get[ke](){return y(this,t,$e(t)?"constant":"constant-tgpu-const-ref")},[z]:r=>r.resolve(this),toString:()=>`const:${v(this)??"<unnamed>"}.$`},De)}get $(){return Ke()?this[F]:this.#e}get value(){return this.$}};function Sy(e){return new Ey(e)}var Ey=class{constructor(t){this.declaration=t}[l]=!0;externalsToApply=[];$uses(t){return this.externalsToApply.push(t),this}[z](t){let r={};for(let i of this.externalsToApply)Br(r,i);let n=Mn(t,r,this.declaration);return t.addDeclaration(n),y("",te,"constant")}toString(){return`declare: ${this.declaration}`}};function xh(e){let t={argTypes:e.in&&Object.keys(e.in).length!==0?[Pn(e.in)]:[],returnType:te,workgroupSize:[e.workgroupSize[0]??1,e.workgroupSize[1]??1,e.workgroupSize[2]??1],isEntry:!0};return Object.assign((r,...n)=>ky(t,e.workgroupSize,Mi(r,...n)),t)}function ky(e,t,r){let n=Un(r,`@compute @workgroup_size(${t.join(", ")}) `),i=e.argTypes[0];return{shell:e,$uses(s){return n.applyExternals(s),this},[l]:!0,[ie]:n,$name(s){return L(n,s),Ti(i)&&i.$name(`${s}_Input`),this},[z](s){return n.resolve(s,e.argTypes,e.returnType)},toString(){return`computeFn:${v(n)??"<unnamed>"}`}}}function O(e,t){let r={[l]:!0,argTypes:e,returnType:t??te,isEntry:!1};return Object.assign((n,...i)=>Uy(r,Mi(n,...i)),r)}function vh(e){return C(e)&&e?.resourceType==="function"}function My([e,t]){return`${v(e)??"<unnamed>"}=${t}`}function Uy(e,t){let r=Un(t,""),n={shell:e,resourceType:"function",$uses(a){return r.applyExternals(a),this},[ie]:r,$name(a){return L(r,a),this},with(a,o){return $h(s,[[Ii(a)?a.slot:a,o]])},[z](a){return typeof t=="string"&&(wp(t,e.argTypes,r.applyExternals),Iu(t,e.returnType,r.applyExternals)),r.resolve(a,e.argTypes,e.returnType)}},i=d({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.argTypes,returnType:e.returnType},normalImpl:(...a)=>Jl(()=>{try{if(typeof t=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");let o=a.map((h,p)=>Rt(e.argTypes[p],h)),u=t(...o);return Rt(e.returnType,u)}catch(o){throw o instanceof Ca?o.appendToTrace(s):new Ca(o,[s])}}),codegenImpl:(...a)=>{let o=Ve();return o.withResetIndentLevel(()=>c`${o.resolve(s).value}(${a})`)}}),s=Object.assign(i,n);return s[l].implementation=t,Object.defineProperty(s,"toString",{value(){return`fn:${v(r)??"<unnamed>"}`}}),s}function $h(e,t){let r={resourceType:"function",shell:e.shell,[er]:{inner:e,pairs:t},$uses(s){return e.$uses(s),this},[ie]:e,$name(s){return e.$name(s),this},with(s,a){return $h(i,[...t,[Ii(s)?s.slot:s,a]])}},n=d({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.shell.argTypes,returnType:e.shell.returnType},normalImpl:e,codegenImpl:(...s)=>{let a=Ve();return a.withResetIndentLevel(()=>c`${a.resolve(i).value}(${s})`)}}),i=Object.assign(n,r);return i[l].implementation=e[l].implementation,Object.defineProperty(i,"toString",{value(){return`fn:${v(e)??"<unnamed>"}[${t.map(My).join(", ")}]`}}),i}function Py(e,t,r="runtime"){return new Vy(e,t,r)}var Vy=class{[l];dataType;origin;#e;#t;constructor(t,r,n){this[l]=!0,this.dataType=r,this.origin=n,this.#e=t,this.#t=[]}$uses(t){return this.#t.push(t),this}[z](t){let r={};for(let i of this.#t)Br(r,i);let n=Mn(t,r,this.#e);return y(n,this.dataType,this.origin)}toString(){return`raw(${String(this.dataType)}): "${this.#e}"`}get[F](){let t=this.dataType,r=this.origin;return new Proxy({[l]:!0,get[ke](){return y(this,t,r)},[z]:n=>n.resolve(this),toString:()=>`raw(${String(this.dataType)}): "${this.#e}".$`},De)}get $(){if(!Ke())throw new Error("Raw code snippets can only be used on the GPU.");return this[F]}get value(){return this.$}};function Ay(e){let t={in:e.in,out:e.out,returnType:Pn(e.out),isEntry:!0};return Object.assign((r,...n)=>Cy(t,Mi(r,...n)),t)}function Cy(e,t){let r=Un(t,"@fragment "),n=e.returnType;return typeof t=="string"&&Iu(t,n,i=>r.applyExternals(i)),{shell:e,outputType:n,$uses(i){return r.applyExternals(i),this},[l]:!0,[ie]:r,$name(i){return L(r,i),Ti(n)&&n.$name(`${i}_Output`),this},[z](i){let s=e.in?Pn(e.in,i.varyingLocations).$name(`${v(this)??""}_Input`):void 0;return s&&r.applyExternals({In:s}),r.applyExternals({Out:n}),r.resolve(i,s?[s]:[],e.returnType)},toString(){return`fragmentFn:${v(r)??"<unnamed>"}`}}}var bh=new Set(["alias","break","case","const","const_assert","continue","continuing","default","diagnostic","discard","else","enable","false","fn","for","if","let","loop","override","requires","return","struct","switch","true","var","while","NULL","Self","abstract","active","alignas","alignof","as","asm","asm_fragment","async","attribute","auto","await","become","cast","catch","class","co_await","co_return","co_yield","coherent","column_major","common","compile","compile_fragment","concept","const_cast","consteval","constexpr","constinit","crate","debugger","decltype","delete","demote","demote_to_helper","do","dynamic_cast","enum","explicit","export","extends","extern","external","fallthrough","filter","final","finally","friend","from","fxgroup","get","goto","groupshared","highp","impl","implements","import","inline","instanceof","interface","layout","lowp","macro","macro_rules","match","mediump","meta","mod","module","move","mut","mutable","namespace","new","nil","noexcept","noinline","nointerpolation","non_coherent","noncoherent","noperspective","null","nullptr","of","operator","package","packoffset","partition","pass","patch","pixelfragment","precise","precision","premerge","priv","protected","pub","public","readonly","ref","regardless","register","reinterpret_cast","require","resource","restrict","self","set","shared","sizeof","smooth","snorm","static","static_assert","static_cast","std","subroutine","super","target","template","this","thread_local","throw","trait","try","type","typedef","typeid","typename","typeof","union","unless","unorm","unsafe","unsized","use","using","varying","virtual","volatile","wgsl","where","with","writeonly","yield","sampler"]);function Oy(e){return e?e.replaceAll(/\s/g,"_").replaceAll(/[^\w\d]/g,""):"item"}function _h(e){if(e==="_"||e.startsWith("__")||/\s/.test(e))throw new Error(`Invalid identifier '${e}'. Choose an identifier without whitespaces or leading underscores.`);let t=e.split("_")[0];return!bh.has(t)}var Th=class{#e;#t;constructor(){this.#e=new Set(bh),this.#t=[]}get usedFunctionScopeNames(){return this.#t[this.#t.length-1]}makeUnique(t,r){let n=Oy(t),i=this.getUniqueVariant(n);return r?this.#e.add(i):this.usedFunctionScopeNames?.add(i),i}makeValid(t){return _h(t)&&!this.#e.has(t)?(this.usedFunctionScopeNames?.add(t),t):this.makeUnique(t,!1)}isUsed(t){return this.#e.has(t)||!!this.usedFunctionScopeNames?.has(t)}pushFunctionScope(){this.#t.push(new Set)}popFunctionScope(){this.#t.pop()}},By=class extends Th{#e=0;getUniqueVariant(t){let r=`${t}_${this.#e++}`;for(;this.isUsed(r);)r=`${t}_${this.#e++}`;return r}},Fy=class extends Th{getUniqueVariant(t){let r=0,n=t;for(;this.isUsed(n);)r++,n=`${t}_${r}`;return n}};function jy(e,t){let r=Un(t,"");return{[l]:!0,[ie]:r,resourceType:"shellless-impl",argTypes:e,[z](n){return r.resolve(n,e,void 0)},toString(){return`fn*:${v(r)??"<unnamed>"}(${e.map(n=>n.toString()).join(", ")})`}}}function vs(e,t){return e.type!==t.type?!1:e.type==="ptr"&&t.type==="ptr"?e.access===t.access&&e.addressSpace===t.addressSpace&&e.implicit===t.implicit&&vs(e.inner,t.inner):e.type==="array"&&t.type==="array"?e.elementCount===t.elementCount&&vs(e.elementType,t.elementType):e.type==="struct"&&t.type==="struct"?e===t:!0}var Gy=class{cache=new Map;get(t,r){let n=zi(t);if(!n?.ast)return;if(!r&&n.ast.params.length>0)throw new Error(`Cannot resolve '${v(t)}' directly, because it expects arguments. Either call it from another function, or wrap it in a shell`);let i=(r??[]).map((o,u)=>{if(o.value instanceof bt){if(o.dataType.type==="unknown")throw new j("d.ref() created with primitive types must be stored in a variable before use");return o.dataType}if(o.dataType.type==="unknown")throw new Error(`Passed illegal value ${o.value} as the #${u} argument to ${n.name}(...)`);let h=Ct(o.dataType);if(o.origin==="constant-tgpu-const-ref"||o.origin==="runtime-tgpu-const-ref"){let p=Ve();throw new Error(`Cannot pass constant references as function arguments. Explicitly copy them by wrapping them in a schema: '${p.resolve(h).value}(...)'`)}return Ye(h)&&h.implicit&&(h=h.inner),h}),s=this.cache.get(t);if(s){let o=s.find(u=>u.argTypes.length===i.length&&u.argTypes.every((h,p)=>vs(h,i[p])));if(o)return o}else s=[],this.cache.set(t,s);let a=jy(i,t);return s.push(a),a}},Ly=class{[l];constructor(t){this[l]={nameRegistry:t,shelllessRepo:new Gy,memoizedResolves:new WeakMap,memoizedDerived:new WeakMap,listeners:{name:new Set}}}on(t,r){if(t==="name"){let n=this[l].listeners.name;return n.add(r),()=>n.delete(r)}throw new Error(`Unsupported event: ${t}`)}};function Ry(e,t){let r=e.nameRegistry.makeUnique(v(t),!0);for(let n of e.listeners.name)n({target:t,name:r});return r}function Yr(e){let{names:t="strict"}=e??{};return new Ly(t==="strict"?new Fy:new By)}function Li(e){return typeof e?.format=="string"}function Dy(e,t){let r=[];if(Dr(e)){if(!Li(t))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return r.push(t._layout),{usedVertexLayouts:r,bufferDefinitions:[{arrayStride:t._layout.stride,stepMode:t._layout.stepMode,attributes:[{format:t.format,offset:t.offset,shaderLocation:Gt(e)??0}]}]}}let n=[],i=new WeakMap,s=0;for(let[a,o]of Object.entries(e)){if(St(o))continue;let u=t[a];if(!u)throw new Error(`An attribute by the name of '${a}' was not provided to the shader.`);let h=u._layout,p=i.get(h);p||(r.push(h),p=[],n.push({arrayStride:h.stride,stepMode:h.stepMode,attributes:p}),i.set(h,p)),s=Gt(o)??s,p.push({format:u.format,offset:u.offset,shaderLocation:s++})}return{usedVertexLayouts:r,bufferDefinitions:n}}var Ny=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","vec2<bool>","vec3<bool>","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","texture_external"];function Wy(e){return Ny.includes(e.type)}function $s(e,[t,r]){if(!_h(t))throw new Error(`Property key '${t}' is a reserved WGSL word. Choose a different name.`);return`  ${ia(r)}${t}: ${e.resolve(r).value},
`}function qy(e,t){if(t[l].isAbstruct)throw new Error("Cannot resolve abstract struct types to WGSL.");let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>$s(e,n)).join("")}}`),r}function Hy(e,t){let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>Li(n[1])?$s(e,[n[0],It[n[1].format]]):$s(e,n)).join("")}
}`),r}function Yy(e,t){let r=e.resolve(t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function Xy(e,t){let r=e.resolve(Li(t.elementType)?It[t.elementType.format]:t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function zh(e,t){if(Rr(t))return t.type==="unstruct"?Hy(e,t):t.type==="disarray"?Xy(e,t):t.type==="loose-decorated"?e.resolve(Li(t.inner)?It[t.inner.format]:t.inner).value:e.resolve(It[t.type]).value;if(Wy(t))return t.type;if(t.type==="struct")return qy(e,t);if(t.type==="array")return Yy(e,t);if(t.type==="atomic")return`atomic<${zh(e,t.inner)}>`;if(t.type==="decorated")return e.resolve(t.inner).value;if(t.type==="ptr")return t.addressSpace==="storage"?`ptr<storage, ${e.resolve(t.inner).value}, ${t.access==="read-write"?"read_write":t.access}>`:`ptr<${t.addressSpace}, ${e.resolve(t.inner).value}>`;if(t.type==="abstractInt"||t.type==="abstractFloat"||t.type==="void"||t.type==="u16")throw new Error(`${t.type} has no representation in WGSL`);if(fs(t))return`${t.type}<${t.format}, ${An[t.access]}>`;if(Wu(t))return t.type.startsWith("texture_depth")?t.type:`${t.type}<${t.sampleType.type}>`;if(ud(t)||od(t))return t.type;Fr(t,"resolveData")}var Ih=class bs{constructor(t){this.bindings=t}with(t,r){return new bs([...this.bindings,[Ii(t)?t.slot:t,r]])}pipe(t){let r=t(this);return new bs([...this.bindings,...r.bindings])}};function*Zy(e){let t=0;for(;;)e.has(t)||(yield t),t++}function Qy(e,t){let r="size"in e?e.size:e.currentByteOffset,n=t-1,i=r&n;"skipBytes"in e?e.skipBytes(t-i&n):e.add(t-i&n)}var le=Qy,Ka=new WeakMap;function Sh(e){let t=Ka.get(e);if(t)return t;let r=new K,n={},i;for(let s in e.propTypes){let a=e.propTypes[s];if(a===void 0)throw new Error(`Property ${s} is undefined in struct`);let o=r.size;le(r,Ze(e)?Le(a):J(a)),i&&(i.padding=r.size-o);let u=A(a);n[s]={offset:r.size,size:u},i=n[s],r.add(u)}return i&&(i.padding=Pe(A(e),J(e))-r.size),Ka.set(e,n),n}var Jy=(()=>{try{return new Function("return true"),!0}catch{return!1}})(),Ji=new WeakMap,Xn={u32:"u32",vec2u:"u32",vec3u:"u32",vec4u:"u32",u16:"u16",i32:"i32",vec2i:"i32",vec3i:"i32",vec4i:"i32",f32:"f32",vec2f:"f32",vec3f:"f32",vec4f:"f32",f16:"f16",vec2h:"f16",vec3h:"f16",vec4h:"f16",mat2x2f:"f32",mat3x3f:"f32",mat4x4f:"f32"},Ky={uint8:"u8",uint8x2:"u8",uint8x4:"u8",sint8:"i8",sint8x2:"i8",sint8x4:"i8",unorm8:"u8",unorm8x2:"u8",unorm8x4:"u8",snorm8:"i8",snorm8x2:"i8",snorm8x4:"i8",uint16:"u16",uint16x2:"u16",uint16x4:"u16",sint16:"i16",sint16x2:"i16",sint16x4:"i16",unorm16:"u16",unorm16x2:"u16",unorm16x4:"u16",snorm16:"i16",snorm16x2:"i16",snorm16x4:"i16",float16:"f16",float16x2:"f16",float16x4:"f16",float32:"f32",float32x2:"f32",float32x3:"f32",float32x4:"f32",uint32:"u32",uint32x2:"u32",uint32x3:"u32",uint32x4:"u32",sint32:"i32",sint32x2:"i32",sint32x3:"i32",sint32x4:"i32"},Zn={u32:"setUint32",i32:"setInt32",f32:"setFloat32",u16:"setUint16",i16:"setInt16",f16:"setFloat16",u8:"setUint8",i8:"setInt8"},eg={unorm8:e=>`Math.round(${e} * 255)`,unorm8x2:e=>`Math.round(${e} * 255)`,unorm8x4:e=>`Math.round(${e} * 255)`,snorm8:e=>`Math.round(${e} * 127)`,snorm8x2:e=>`Math.round(${e} * 127)`,snorm8x4:e=>`Math.round(${e} * 127)`,unorm16:e=>`Math.round(${e} * 65535)`,unorm16x2:e=>`Math.round(${e} * 65535)`,unorm16x4:e=>`Math.round(${e} * 65535)`,snorm16:e=>`Math.round(${e} * 32767)`,snorm16x2:e=>`Math.round(${e} * 32767)`,snorm16x4:e=>`Math.round(${e} * 32767)`},eo={"unorm10-10-10-2":{writeFunction:"setUint32",generator:(e,t)=>`output.setUint32(${e}, ((${t}.x*1023&0x3FF)<<22)|((${t}.y*1023&0x3FF)<<12)|((${t}.z*1023&0x3FF)<<2)|(${t}.w*3&3), littleEndian);
`},"unorm8x4-bgra":{writeFunction:"setUint8",generator:(e,t)=>{let r=["z","y","x","w"],n="";for(let i=0;i<4;i++)n+=`output.setUint8((${e} + ${i}), Math.round(${t}.${r[i]} * 255), littleEndian);
`;return n}}};function ti(e,t,r,n=0){let i=["i","j","k"][n]||`i${n}`;if(hi(e)||Xe(e))return ti(e.inner,t,r,n);if(fe(e)||Ze(e)){let a=Sh(e),o="";for(let[u,h]of Object.entries(a)){let p=e.propTypes[u];p&&(o+=ti(p,`(${t} + ${h.offset})`,`${r}.${u}`,n))}return o}if(Te(e)||zt(e)){let a=Pe(A(e.elementType),J(e)),o="";return o+=`for (let ${i} = 0; ${i} < ${e.elementCount}; ${i}++) {
`,o+=ti(e.elementType,`(${t} + ${i} * ${a})`,`${r}[${i}]`,n+1),o+=`}
`,o}if(ct(e)){let a=Xn[e.type],o="",u=Zn[a],h=["x","y","z","w"],p=ns(e)?2:is(e)?3:4;for(let f=0;f<p;f++)o+=`output.${u}((${t} + ${f*4}), ${r}.${h[f]}, littleEndian);
`;return o}if(ui(e)){let a=Xn[e.type],o=Zn[a],u=Co(e)?2:Oo(e)?3:4,h=u*u,p=Pe(u*4,8),f="";for(let m=0;m<h;m++){let g=Math.floor(m/u),$=m%u,T=g*p+$*4;f+=`output.${o}((${t} + ${T}), ${r}.columns[${g}].${["x","y","z","w"][$]}, littleEndian);
`}return f}if(bu(e)){let a=e.type;if(a in eo)return eo[a].generator(t,r);let o=Ky[a],u=Zn[o],h=It[a],p=Ao(h)?4:is(h)?3:ns(h)?2:1,f=o==="u8"||o==="i8"?1:o==="u16"||o==="i16"||o==="f16"?2:4,m=["x","y","z","w"],g=eg[a],$="";for(let T=0;T<p;T++){let k=p===1?r:`${r}.${m[T]}`,M=g?g(k):k;$+=`output.${u}((${t} + ${T*f}), ${M}, littleEndian);
`}return $}if(!Object.hasOwn(Xn,e.type))throw new Error(`Primitive ${e.type} is unsupported by compiled writer`);let s=Xn[e.type];return`output.${Zn[s]}(${t}, ${r}, littleEndian);
`}function to(e){if(!Jy){console.warn("This environment does not allow eval - using default writer as fallback");return}if(Ji.has(e))return Ji.get(e);try{let t=ti(e,"offset","value",0),r=new Function("output","offset","value","littleEndian=true",t);return Ji.set(e,r),r}catch(t){console.warn(`Failed to compile writer for schema: ${e}
Reason: ${t instanceof Error?t.message:String(t)}
Falling back to default writer`)}}var Sr={bool(){throw new Error("Booleans are not host-shareable")},f32(e,t,r){e.writeFloat32(r)},f16(e,t,r){e.writeFloat16(r)},i32(e,t,r){e.writeInt32(r)},u32(e,t,r){e.writeUint32(r)},u16(e,t,r){e.writeUint16(r)},vec2f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},vec2h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},vec2i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},vec2u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},vec3f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},vec3h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z)},vec3i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},vec3u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},vec4f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},vec4h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},vec4i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},vec4u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat3x3f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat4x4f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},struct(e,t,r){let n=J(t);le(e,n);for(let[i,s]of Object.entries(t.propTypes))le(e,J(s)),yi(e,s,r[i]);le(e,n)},array(e,t,r){if(t.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let n=J(t);le(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)le(e,n),yi(e,t.elementType,r[s]);e.seekTo(i+A(t))},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t,r){Sr[t.inner.type]?.(e,t,r)},decorated(e,t,r){let n=Le(t);le(e,n);let i=e.currentByteOffset;Sr[t.inner?.type]?.(e,t.inner,r),e.seekTo(i+A(t))},uint8(e,t,r){e.writeUint8(r)},uint8x2(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y)},uint8x4(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y),e.writeUint8(r.z),e.writeUint8(r.w)},sint8(e,t,r){e.writeInt8(r)},sint8x2(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y)},sint8x4(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y),e.writeInt8(r.z),e.writeInt8(r.w)},unorm8(e,t,r){e.writeUint8(Math.round(r*255))},unorm8x2(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255))},unorm8x4(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255)),e.writeUint8(Math.round(r.z*255)),e.writeUint8(Math.round(r.w*255))},snorm8(e,t,r){e.writeInt8(Math.round(r*127))},snorm8x2(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127))},snorm8x4(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127)),e.writeInt8(Math.round(r.z*127)),e.writeInt8(Math.round(r.w*127))},uint16(e,t,r){e.writeUint16(r)},uint16x2(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y)},uint16x4(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y),e.writeUint16(r.z),e.writeUint16(r.w)},sint16(e,t,r){e.writeInt16(r)},sint16x2(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y)},sint16x4(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y),e.writeInt16(r.z),e.writeInt16(r.w)},unorm16(e,t,r){e.writeUint16(r*65535)},unorm16x2(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535)},unorm16x4(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535),e.writeUint16(r.z*65535),e.writeUint16(r.w*65535)},snorm16(e,t,r){e.writeInt16(Math.round(r*32767))},snorm16x2(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767))},snorm16x4(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767)),e.writeInt16(Math.round(r.z*32767)),e.writeInt16(Math.round(r.w*32767))},float16(e,t,r){e.writeFloat16(r)},float16x2(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},float16x4(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},float32(e,t,r){e.writeFloat32(r)},float32x2(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},float32x3(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},float32x4(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},uint32(e,t,r){e.writeUint32(r)},uint32x2(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},uint32x3(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},uint32x4(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},sint32(e,t,r){e.writeInt32(r)},sint32x2(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},sint32x3(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},sint32x4(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},"unorm10-10-10-2"(e,t,r){let n=0;n|=(r.x*1023&1023)<<22,n|=(r.y*1023&1023)<<12,n|=(r.z*1023&1023)<<2,n|=r.w*3&3,e.writeUint32(n)},"unorm8x4-bgra"(e,t,r){e.writeUint8(r.z*255),e.writeUint8(r.y*255),e.writeUint8(r.x*255),e.writeUint8(r.w*255)},disarray(e,t,r){let n=J(t);le(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)le(e,n),Sr[t.elementType?.type]?.(e,t.elementType,r[s]);e.seekTo(i+A(t))},unstruct(e,t,r){let n=t.propTypes;for(let[i,s]of Object.entries(n))Sr[s.type]?.(e,s,r[i])},"loose-decorated"(e,t,r){let n=Le(t);le(e,n);let i=e.currentByteOffset,s=Sr[t.inner?.type];return s?.(e,t.inner,r),e.seekTo(i+A(t)),r}};function yi(e,t,r){let n=Sr[t.type];if(!n)throw new Error(`Cannot write data of type '${t.type}'.`);n(e,t,r)}var tg={bool(){throw new Error("Booleans are not host-shareable")},f32(e){return e.readFloat32()},f16(e){return e.readFloat16()},i32(e){return e.readInt32()},u32(e){return e.readUint32()},u16(e){return e.readUint16()},vec2f(e){return D(e.readFloat32(),e.readFloat32())},vec3f(e){return ae(e.readFloat32(),e.readFloat32(),e.readFloat32())},vec4f(e){return I(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},vec2h(e){return dt(e.readFloat16(),e.readFloat16())},vec3h(e){return ft(e.readFloat16(),e.readFloat16(),e.readFloat16())},vec4h(e){return mt(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16())},vec2i(e){return ee(e.readInt32(),e.readInt32())},vec3i(e){return Ae(e.readInt32(),e.readInt32(),e.readInt32())},vec4i(e){return ce(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32())},vec2u(e){return Ee(e.readUint32(),e.readUint32())},vec3u(e){return re(e.readUint32(),e.readUint32(),e.readUint32())},vec4u(e){return ge(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32())},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e){return kt(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},mat3x3f(e){let t=()=>{let r=e.readFloat32();return e.readFloat32(),r};return Mt(e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t())},mat4x4f(e){return H(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},struct(e,t){let r=J(t);le(e,r);let n={},i=t.propTypes;for(let[s,a]of Object.entries(i))le(e,J(a)),n[s]=ut(e,a);return le(e,r),n},array(e,t){if(t.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let r=J(t),n=[];for(let i=0;i<t.elementCount;i++){le(e,r);let s=t.elementType,a=ut(e,s);n.push(a)}return le(e,r),n},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t){return ut(e,t.inner)},decorated(e,t){let r=Le(t);le(e,r);let n=e.currentByteOffset,i=ut(e,t.inner);return e.seekTo(n+A(t)),i},uint8:e=>e.readUint8(),uint8x2:e=>Ee(e.readUint8(),e.readUint8()),uint8x4:e=>ge(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),sint8:e=>e.readInt8(),sint8x2:e=>ee(e.readInt8(),e.readInt8()),sint8x4:e=>ce(e.readInt8(),e.readInt8(),e.readInt8(),e.readInt8()),unorm8:e=>e.readUint8()/255,unorm8x2:e=>D(e.readUint8()/255,e.readUint8()/255),unorm8x4:e=>I(e.readUint8()/255,e.readUint8()/255,e.readUint8()/255,e.readUint8()/255),snorm8:e=>e.readInt8()/127,snorm8x2:e=>D(e.readInt8()/127,e.readInt8()/127),snorm8x4:e=>I(e.readInt8()/127,e.readInt8()/127,e.readInt8()/127,e.readInt8()/127),uint16:e=>e.readUint16(),uint16x2:e=>Ee(e.readUint16(),e.readUint16()),uint16x4:e=>ge(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16()),sint16:e=>e.readInt16(),sint16x2:e=>ee(e.readInt16(),e.readInt16()),sint16x4:e=>ce(e.readInt16(),e.readInt16(),e.readInt16(),e.readInt16()),unorm16:e=>e.readUint16()/65535,unorm16x2:e=>D(e.readUint16()/65535,e.readUint16()/65535),unorm16x4:e=>I(e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535),snorm16:e=>e.readInt16()/32767,snorm16x2:e=>D(e.readInt16()/32767,e.readInt16()/32767),snorm16x4:e=>I(e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767),float16(e){return e.readFloat16()},float16x2:e=>D(e.readFloat16(),e.readFloat16()),float16x4:e=>I(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16()),float32:e=>e.readFloat32(),float32x2:e=>D(e.readFloat32(),e.readFloat32()),float32x3:e=>ae(e.readFloat32(),e.readFloat32(),e.readFloat32()),float32x4:e=>I(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()),uint32:e=>e.readUint32(),uint32x2:e=>Ee(e.readUint32(),e.readUint32()),uint32x3:e=>re(e.readUint32(),e.readUint32(),e.readUint32()),uint32x4:e=>ge(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32()),sint32:e=>e.readInt32(),sint32x2:e=>ee(e.readInt32(),e.readInt32()),sint32x3:e=>Ae(e.readInt32(),e.readInt32(),e.readInt32()),sint32x4:e=>ce(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32()),"unorm10-10-10-2"(e){let t=e.readUint32(),r=(t>>22)/1023,n=(t>>12&1023)/1023,i=(t>>2&1023)/1023,s=(t&3)/3;return I(r,n,i,s)},"unorm8x4-bgra"(e){let t=e.readByte()/255,r=e.readByte()/255,n=e.readByte()/255,i=e.readByte()/255;return I(n,r,t,i)},unstruct(e,t){let r={},n=t.propTypes;for(let[i,s]of Object.entries(n))r[i]=ut(e,s);return r},disarray(e,t){let r=J(t),n=[];for(let i=0;i<t.elementCount;i++)le(e,r),n.push(ut(e,t.elementType));return le(e,r),n},"loose-decorated"(e,t){le(e,Le(t));let r=e.currentByteOffset,n=ut(e,t.inner);return e.seekTo(r+A(t)),n}};function ut(e,t){let r=tg[t.type];if(!r)throw new Error(`Cannot read data of type '${t.type}'.`);return r(e,t)}function rg(e,t){let r=A(e);if(r===0||t===void 0||t===null)return[];let n=new ArrayBuffer(r),i=new hr(n),s=[];function a(h,p,f,m){if(p!=null){if(fe(h)||Ze(h)){let g=Sh(h);for(let[$,T]of Object.entries(g)){let k=h.propTypes[$];if(!k)continue;let M=p[$];M!==void 0&&a(k,M,f+T.offset,T.padding??m)}return}if(Te(h)||zt(h)){let g=h,$=Pe(A(g.elementType),J(g.elementType));if(!Array.isArray(p))throw new Error("Partial value for array must be an array");let T=p??[];T.sort((k,M)=>k.idx-M.idx);for(let{idx:k,value:M}of T)a(g.elementType,M,f+k*$,$-A(g.elementType))}else{let g=A(h);i.seekTo(f),yi(i,h,p),s.push({start:f,end:f+g,padding:m})}}}if(a(e,t,0),s.length===0)return[];let o=[],u=s[0];for(let h=1;h<s.length;h++){let p=s[h];if(!p||!u)throw new Error("Internal error: missing segment");p.start===u.end+(u.padding??0)?(u.end=p.end,u.padding=p.padding):(o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),u=p)}if(!u)throw new Error("Internal error: missing segment");return o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),o}function gi(e){return!!e?.usableAsStorage}var ro=class Eh extends Error{constructor(t){super(`Resource '${v(t)??"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,Eh.prototype)}};function kh(e){return!!e.usableAsUniform}var Mh={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},wa=class{constructor(e,t){this.usage=e,this.buffer=t,this[l]={dataType:t.dataType},this[ie]=t}resourceType="buffer-usage";[l];[ie];$name(e){return this.buffer.$name(e),this}[z](e){let t=this.buffer.dataType,r=e.getUniqueName(this),{group:n,binding:i}=e.allocateFixedEntry(this.usage==="uniform"?{uniform:t}:{storage:t,access:this.usage},this.buffer),s=Mh[this.usage];return e.addDeclaration(`@group(${n}) @binding(${i}) var<${s}> ${r}: ${e.resolve(t).value};`),y(r,t,$e(t)?"runtime":this.usage)}toString(){return`${this.usage}:${v(this)??"<unnamed>"}`}get[F](){let e=this.buffer.dataType,t=this.usage;return new Proxy({[l]:!0,get[ke](){return y(this,e,$e(e)?"runtime":t)},[z]:r=>r.resolve(this),toString:()=>`${this.usage}:${v(this)??"<unnamed>"}.$`},De)}get $(){let e=ci(),t=li();if(e.type==="normal")throw new Ba(t?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.read()`");return e.type==="codegen"?this[F]:e.type==="simulate"?(e.buffers.has(this.buffer)||e.buffers.set(this.buffer,Rt(this.buffer.dataType,this.buffer.initial)),e.buffers.get(this.buffer)):Fr(e,"bufferUsage.ts#TgpuFixedBufferImpl/$")}get value(){return this.$}set $(e){let t=ci(),r=li();if(t.type==="normal")throw new Ba(r?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.write()`");if(t.type==="codegen")throw new Error("Unreachable bufferUsage.ts#TgpuFixedBufferImpl/$");if(t.type==="simulate"){t.buffers.set(this.buffer,e);return}Fr(t,"bufferUsage.ts#TgpuFixedBufferImpl/$")}set value(e){this.$=e}},no=class{constructor(e,t,r){this.usage=e,this.dataType=t,this[l]={dataType:t},this.#e=r,L(this,r.key)}[l];resourceType="buffer-usage";#e;[z](e){let t=this.dataType,r=e.getUniqueName(this),n=e.allocateLayoutEntry(this.#e.layout),i=Mh[this.usage];return e.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var<${i}> ${r}: ${e.resolve(t).value};`),y(r,t,$e(t)?"runtime":this.usage)}toString(){return`${this.usage}:${v(this)??"<unnamed>"}`}get[F](){let e=this.dataType,t=this.usage;return new Proxy({[l]:!0,get[ke](){return y(this,e,$e(e)?"runtime":t)},[z]:r=>r.resolve(this),toString:()=>`${this.usage}:${v(this)??"<unnamed>"}.$`},De)}get $(){if(Ke())return this[F];throw new Error("Direct access to buffer values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},io=new WeakMap;function ng(e){if(!gi(e))throw new Error(`Cannot pass ${e} to asMutable, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=io.get(e);return t||(t=new wa("mutable",e),io.set(e,t)),t}var so=new WeakMap;function ig(e){if(!gi(e))throw new Error(`Cannot pass ${e} to asReadonly, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=so.get(e);return t||(t=new wa("readonly",e),so.set(e,t)),t}var ao=new WeakMap;function sg(e){if(!kh(e))throw new Error(`Cannot pass ${e} to asUniform, as it is not allowed to be used as a uniform. To allow it, call .$usage('uniform') when creating the buffer.`);let t=ao.get(e);return t||(t=new wa("uniform",e),ao.set(e,t)),t}var ag={uniform:sg,mutable:ng,readonly:ig};function Qn(e,t,r){return Nt(t)?new oo(e,t,r):new oo(e,t,r,["storage","uniform"])}function yn(e){return e.resourceType==="buffer"}var og=rh(),oo=class{constructor(t,r,n,i){this.dataType=r,this.initialOrBuffer=n,this._disallowedUsages=i,this.#e=t.device,cs(n)?(this._ownBuffer=!1,this._buffer=n):(this._ownBuffer=!0,this.initial=n)}[l]=!0;resourceType="buffer";flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;#e;_buffer=null;_ownBuffer;_destroyed=!1;_hostBuffer;initial;usableAsUniform=!1;usableAsStorage=!1;usableAsVertex=!1;usableAsIndex=!1;get buffer(){if(this._destroyed)throw new Error("This buffer has been destroyed");return this._buffer||(this._buffer=this.#e.createBuffer({size:A(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:v(this)??"<unnamed>"}),this.initial&&(this._writeToTarget(this._buffer.getMappedRange(),this.initial),this._buffer.unmap())),this._buffer}get destroyed(){return this._destroyed}$name(t){return L(this,t),this._buffer&&(this._buffer.label=t),this}$usage(...t){for(let r of t){if(this._disallowedUsages?.includes(r))throw new Error(`Buffer of type ${this.dataType.type} cannot be used as ${r}`);this.flags|=r==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=r==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=r==="vertex"?GPUBufferUsage.VERTEX:0,this.flags|=r==="index"?GPUBufferUsage.INDEX:0,this.usableAsUniform=this.usableAsUniform||r==="uniform",this.usableAsStorage=this.usableAsStorage||r==="storage",this.usableAsVertex=this.usableAsVertex||r==="vertex",this.usableAsIndex=this.usableAsIndex||r==="index"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}compileWriter(){to(this.dataType)}_writeToTarget(t,r){let n=to(this.dataType);if(n)try{n(new DataView(t),0,r,og==="little");return}catch(i){console.error(`Error when using compiled writer for buffer ${v(this)??"<unnamed>"} - this is likely a bug, please submit an issue at https://github.com/software-mansion/TypeGPU/issues
Using fallback writer instead.`,i)}yi(new hr(t),this.dataType,r)}write(t){let r=this.buffer;if(r.mapState==="mapped"){let i=r.getMappedRange();this._writeToTarget(i,t);return}let n=A(this.dataType);this._hostBuffer||(this._hostBuffer=new ArrayBuffer(n)),this._writeToTarget(this._hostBuffer,t),this.#e.queue.writeBuffer(r,0,this._hostBuffer,0,n)}writePartial(t){let r=this.buffer,n=rg(this.dataType,t);if(r.mapState==="mapped"){let i=r.getMappedRange(),s=new Uint8Array(i);for(let a of n)s.set(a.data,a.data.byteOffset)}else for(let i of n)this.#e.queue.writeBuffer(r,i.data.byteOffset,i.data,0,i.data.byteLength)}clear(){let t=this.buffer;if(t.mapState==="mapped"){new Uint8Array(t.getMappedRange()).fill(0);return}let r=this.#e.createCommandEncoder();r.clearBuffer(t),this.#e.queue.submit([r.finish()])}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let r=A(this.dataType),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t.buffer,0,this.buffer,0,r),this.#e.queue.submit([n.finish()])}async read(){let t=this.buffer;if(t.mapState==="mapped"){let s=t.getMappedRange();return ut(new Ft(s),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let s=t.getMappedRange(),a=ut(new Ft(s),this.dataType);return t.unmap(),a}let r=this.#e.createBuffer({size:A(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t,0,r,0,A(this.dataType)),this.#e.queue.submit([n.finish()]),await r.mapAsync(GPUMapMode.READ,0,A(this.dataType));let i=ut(new Ft(r.getMappedRange()),this.dataType);return r.unmap(),r.destroy(),i}as(t){return ag[t]?.(this)}destroy(){this._destroyed||(this._destroyed=!0,this._ownBuffer&&this._buffer?.destroy())}toString(){return`buffer:${v(this)??"<unnamed>"}`}};function ug(e,t){return new Vh(ca(),e,t)}function hg(e,t){return new Vh(pa(),e,t)}function Uh(e){let t=e;return t?.resourceType==="sampler"&&!!t[l]}function Ph(e){let t=e;return t?.resourceType==="sampler-comparison"&&!!t[l]}var lg=class{constructor(t,r){this.schema=t,this.#e=r,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",L(this,r.key)}[l]={unwrap:void 0};resourceType;#e;[z](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},De)}get $(){if(Ke())return this[F];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}toString(){return`${this.resourceType}:${v(this)??"<unnamed>"}`}},Vh=class{constructor(t,r,n){this.schema=t,this.#r=r,this.#n=n,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",this[l]={unwrap:()=>(this.#t||(this.#t=this.#n.device.createSampler({...this.#r,label:v(this)??"<unnamed>"})),this.#t)},this.#e=r.minFilter==="linear"||r.magFilter==="linear"||r.mipmapFilter==="linear"}[l];resourceType;#e;#t=null;#r;#n;[z](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(this.schema.type==="sampler_comparison"?{sampler:"comparison"}:{sampler:this.#e?"filtering":"non-filtering"},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},De)}get $(){if(Ke())return this[F];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}$name(t){return L(this,t),this}toString(){return`${this.resourceType}:${v(this)??"<unnamed>"}`}},cg=class{constructor(t,r){this.schema=t,this.#e=r,L(this,r.key)}resourceType="external-texture";[l]=!0;#e;[z](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),y(r,Nu(),"handle")}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`textureExternal:${v(this)??"<unnamed>"}.$`},De)}get $(){if(Ke())return this[F];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureExternal:${v(this)??"<unnamed>"}`}};function Ah(e){let{videoWidth:t,videoHeight:r}=e;if(t&&r)return{width:t,height:r};let{naturalWidth:n,naturalHeight:i}=e;if(n&&i)return{width:n,height:i};let{codedWidth:s,codedHeight:a}=e;if(s&&a)return{width:s,height:a};let{width:o,height:u}=e;if(o&&u)return{width:o,height:u};throw new Error("Cannot determine dimensions of the provided image source.")}var pg=`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) i: u32) -> VertexOutput {
  const pos = array(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  const uv = array(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));
  return VertexOutput(vec4f(pos[i], 0, 1), uv[i]);
}`,dg=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  return textureSample(src, samp, uv);
}`,fg=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  let r = textureGather(0, src, samp, uv);
  let g = textureGather(1, src, samp, uv);
  let b = textureGather(2, src, samp, uv);
  let a = textureGather(3, src, samp, uv);
  return vec4f(dot(r, vec4f(0.25)), dot(g, vec4f(0.25)), dot(b, vec4f(0.25)), dot(a, vec4f(0.25)));
}`,_s=new WeakMap;function mg(e){let t=_s.get(e);return t||(t={vertexModule:e.createShaderModule({code:pg}),filterableResources:new Map,layoutResources:new Map},_s.set(e,t)),t}function yg(e,t,r){let n=mg(e),i=n.filterableResources.get(t);i||(i={fragmentModule:e.createShaderModule({code:t?dg:fg}),sampler:e.createSampler(t?{magFilter:"linear",minFilter:"linear"}:{})},n.filterableResources.set(t,i));let s=`${t}:${r}`,a=n.layoutResources.get(s);if(!a){let o=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:r}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:t?"filtering":"non-filtering"}}]});a={bindGroupLayout:o,pipelineLayout:e.createPipelineLayout({bindGroupLayouts:[o]})},n.layoutResources.set(s,a)}return{vertexModule:n.vertexModule,...i,...a}}function Ch(e){let{device:t,source:r,destination:n,format:i,filterable:s,sampleType:a}=e,o=yg(t,s,a),u=t.createRenderPipeline({layout:o.pipelineLayout,vertex:{module:o.vertexModule},fragment:{module:o.fragmentModule,targets:[{format:i}]},primitive:{topology:"triangle-list"}}),h=t.createBindGroup({layout:o.bindGroupLayout,entries:[{binding:0,resource:r},{binding:1,resource:o.sampler}]}),p=!e.encoder,f=e.encoder??t.createCommandEncoder(),m=f.beginRenderPass({colorAttachments:[{view:n,loadOp:"clear",storeOp:"store"}]});m.setPipeline(u),m.setBindGroup(0,h),m.draw(3),m.end(),p&&t.queue.submit([f.finish()])}function gg(e){_s.delete(e)}function Oh(e,t,r){let n=On(t),i=by(e,t),s=i.includes("float"),a=i.includes("unfilterable-float");if(!s&&!a)throw new Error(`Cannot ${r} for format '${t}': only float formats are supported.`);if(!n.canRenderAttachment)throw new Error(`Cannot ${r} for format '${t}': format does not support render attachments.`);return{filterable:s,sampleType:s?"float":"unfilterable-float"}}function wg(e,t,r=0,n){if(t.dimension!=="2d")throw new Error("Mipmap generation only supports 2D textures.");let{filterable:i,sampleType:s}=Oh(e,t.format,"generate mipmaps"),a=n??t.mipLevelCount-r;for(let o=0;o<t.depthOrArrayLayers;o++)for(let u=r;u<r+a-1;u++){let h=p=>({dimension:"2d",baseMipLevel:p,mipLevelCount:1,baseArrayLayer:o,arrayLayerCount:1});Ch({device:e,source:t.createView(h(u)),destination:t.createView(h(u+1)),format:t.format,filterable:i,sampleType:s})}}function xg(e,t,r,n=0){if(t.dimension!=="2d")throw new Error("Resampling only supports 2D textures.");let{filterable:i}=Oh(e,t.format,"resample"),{width:s,height:a}=Ah(r),o=e.createTexture({size:[s,a],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.copyExternalImageToTexture({source:r},{texture:o},[s,a]);let u=e.createTexture({size:[t.width,t.height],format:t.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),h=e.createCommandEncoder();Ch({device:e,source:o.createView(),destination:u.createView(),format:t.format,filterable:i,sampleType:"float",encoder:h}),h.copyTextureToTexture({texture:u},{texture:t,origin:{x:0,y:0,z:n}},{width:t.width,height:t.height,depthOrArrayLayers:1}),e.queue.submit([h.finish()]),o.destroy(),u.destroy()}function vg(e){return{dimension:e.dimension??"2d",sampleType:On(e.format).channelType,multisampled:(e.sampleCount??1)!==1}}function $g(e,t){return new bg(e,t)}function xn(e){return e?.resourceType==="texture"&&!!e[l]}function vn(e){return e?.resourceType==="texture-view"&&!!e[l]}var bg=class{constructor(t,r){this.props=t;let n=t.format;this.#s=r,this.#e=On(n);let i=this.#e.texelSize;this.#t=i==="non-copyable"?"non-copyable":t.size[0]*(t.size[1]??1)*(t.size[2]??1)*i,this[l]={unwrap:()=>{if(this.#r)throw new Error("This texture has been destroyed");return this.#i||(this.#i=r.device.createTexture({label:v(this)??"<unnamed>",format:t.format,size:t.size,usage:this.#n,dimension:t.dimension??"2d",viewFormats:t.viewFormats??[],mipLevelCount:t.mipLevelCount??1,sampleCount:t.sampleCount??1})),this.#i}}}[l];resourceType="texture";usableAsSampled=!1;usableAsStorage=!1;usableAsRender=!1;#e;#t;#r=!1;#n=GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;#i=null;#s;$name(t){return L(this,t),this}$usage(...t){let r=t.includes("storage"),n=t.includes("sampled"),i=t.includes("render");return this.#n|=n?GPUTextureUsage.TEXTURE_BINDING:0,this.#n|=r?GPUTextureUsage.STORAGE_BINDING:0,this.#n|=i?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||=r,this.usableAsSampled||=n,this.usableAsRender||=i,this}createView(t,r){return t==="render"?new Tg(this,r):new _g(t??ds(vg(this.props)),this,r)}#a(t=0){let r=2**t,[n,i,s]=[Math.max(1,Math.floor((this.props.size[0]??1)/r)),Math.max(1,Math.floor((this.props.size[1]??1)/r)),Math.max(1,Math.floor((this.props.size[2]??1)/r))],a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot clear texture with format '${this.props.format}': this format does not support copy operations.`);this.#s.device.queue.writeTexture({texture:this[l].unwrap(),mipLevel:t},new Uint8Array(n*i*s*a),{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}clear(t="all"){if(t==="all"){let r=this.props.mipLevelCount??1;for(let n=0;n<r;n++)this.#a(n)}else this.#a(t)}generateMipmaps(t=0,r){if(this.usableAsRender===!1)throw new Error("generateMipmaps called without specifying 'render' usage. Add it via the $usage('render') method.");let n=r??(this.props.mipLevelCount??1)-t;if(n<=1){console.warn(`generateMipmaps is a no-op: would generate ${n} mip levels (base: ${t}, total: ${this.props.mipLevelCount??1})`);return}if(t>=(this.props.mipLevelCount??1))throw new Error(`Base mip level ${t} is out of range. Texture has ${this.props.mipLevelCount??1} mip levels.`);wg(this.#s.device,this[l].unwrap(),t,n)}write(t,r=0){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){this.#u(t,r);return}let n=this.props.dimension??"2d";if(!Array.isArray(t)){this.#o(t,n==="3d"?0:void 0);return}let i=this.props.size[2]??1;t.length>i&&console.warn(`Too many image sources provided. Expected ${i} layers, got ${t.length}. Extra sources will be ignored.`);for(let s=0;s<Math.min(t.length,i);s++){let a=t[s];a&&this.#o(a,s)}}#u(t,r){let n=Math.max(1,this.props.size[0]>>r),i=Math.max(1,(this.props.size[1]??1)>>r),s=Math.max(1,(this.props.size[2]??1)>>r),a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot write to texture with format '${this.props.format}': this format does not support copy operations.`);let o=n*i*s*a,u=t.byteLength??t.byteLength;if(u!==o)throw new Error(`Buffer size mismatch. Expected ${o} bytes for mip level ${r}, got ${u} bytes.`);this.#s.device.queue.writeTexture({texture:this[l].unwrap(),mipLevel:r},"buffer"in t?t.buffer:t,{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}#o(t,r){let n=this.props.size[0],i=this.props.size[1]??1,{width:s,height:a}=Ah(t);if(s!==n||a!==i){xg(this.#s.device,this[l].unwrap(),t,r);return}this.#s.device.queue.copyExternalImageToTexture({source:t},{texture:this[l].unwrap(),...r!==void 0&&{origin:{x:0,y:0,z:r}}},r!==void 0?[n,i,1]:this.props.size)}copyFrom(t){if(t.props.format!==this.props.format)throw new Error(`Texture format mismatch. Source texture has format ${t.props.format}, target texture has format ${this.props.format}`);if(t.props.size[0]!==this.props.size[0]||(t.props.size[1]??1)!==(this.props.size[1]??1)||(t.props.size[2]??1)!==(this.props.size[2]??1))throw new Error(`Texture size mismatch. Source texture has size ${t.props.size.join("x")}, target texture has size ${this.props.size.join("x")}`);let r=this.#s.device.createCommandEncoder();r.copyTextureToTexture({texture:t[l].unwrap()},{texture:this[l].unwrap()},t.props.size),this.#s.device.queue.submit([r.finish()])}get destroyed(){return this.#r}destroy(){this.#r||(this.#r=!0,this.#i?.destroy())}},_g=class{constructor(t,r,n){this.schema=t,this.#e=r,this.#r=n,this[l]={unwrap:()=>{if(!this.#t){let i=this.schema,s=fs(i)?i.format:this.#e.props.format;this.#t=this.#e[l].unwrap().createView({...this.#r,label:v(this)??"<unnamed>",format:this.#r?.format??s,dimension:i.dimension})}return this.#t}}}[l];resourceType="texture-view";#e;#t;#r;$name(t){return L(this,t),this.#t&&(this.#t.label=t),this}get[F](){let t=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},De)}get $(){if(Ke())return this[F];throw new Error("Direct access to texture view values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureView:${v(this)??"<unnamed>"}`}[z](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(fs(this.schema)?{storageTexture:this.schema}:{texture:this.schema,sampleType:this.#r?.sampleType??this.schema.bindingSampleType[0]},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}},uo=class{constructor(e,t){this.schema=e,this.#e=t,L(this,t.key)}[l]={unwrap:void 0};resourceType="texture-view";#e;toString(){return`textureView:${v(this)??"<unnamed>"}`}[z](e){let t=e.getUniqueName(this),r=e.allocateLayoutEntry(this.#e.layout);return e.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var ${t}: ${e.resolve(this.schema).value};`),y(t,this.schema,"handle")}get[F](){let e=this.schema;return new Proxy({[l]:!0,get[ke](){return y(this,e,"handle")},[z]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},De)}get $(){if(Ke())return this[F];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},Tg=class{constructor(e,t={}){this.descriptor=t,this[l]={unwrap:()=>e[l].unwrap().createView({label:v(this)??"<unnamed>",...this.descriptor})}}[l];resourceType="texture-view"};function zg(e){return!!e?.usableAsSampled}var Ig=class Bh extends Error{constructor(t){super(`Resource '${v(t)??"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,Bh.prototype)}};function Sg(e){let t={};for(let[r,n]of Object.entries(e)){if(n===null){t[r]=null;continue}if("texture"in n&&typeof n.texture=="string"){let i=n.texture;t[r]={...n,texture:ds({dimension:n.viewDimension??"2d",sampleType:i==="sint"?B:i==="uint"?b:w,multisampled:n.multisampled??!1})}}else if("storageTexture"in n&&typeof n.storageTexture=="string"){let i={readonly:"read-only",writeonly:"write-only",mutable:"read-write"};t[r]={...n,storageTexture:ds({access:i[n.access??"writeonly"],format:n.storageTexture,dimension:n.viewDimension??"2d"})}}else"externalTexture"in n&&Object.keys(n.externalTexture).length===0?t[r]={...n,externalTexture:{type:"texture_external",dimension:"2d"}}:t[r]=n}return t}function Fh(e){let t=Sg(e);return new kg(t)}function jh(e){return!!e&&e.resourceType==="bind-group-layout"}function wi(e){return!!e&&e.resourceType==="bind-group"}var Eg=class Gh extends Error{constructor(t,r){super(`Bind group '${t??"<unnamed>"}' is missing a required binding '${r}'`),Object.setPrototypeOf(this,Gh.prototype)}},ho=["compute","fragment"],tn=["compute","vertex","fragment"],kg=class{constructor(e){this.entries=e;let t=0;for(let[r,n]of Object.entries(e)){if(n===null){t++;continue}let i={layout:this,key:r,idx:t};if("uniform"in n&&(this.bound[r]=new no("uniform",n.uniform,i)),"storage"in n){let s="type"in n.storage?n.storage:n.storage(0);this.bound[r]=new no(n.access??"readonly",s,i)}"texture"in n&&(this.bound[r]=new uo(n.texture,i)),"storageTexture"in n&&(this.bound[r]=new uo(n.storageTexture,i)),"externalTexture"in n&&(this.bound[r]=new cg(n.externalTexture,i)),"sampler"in n&&(this.bound[r]=new lg(n.sampler==="comparison"?pa():ca(),i)),Object.defineProperty(this.value,r,{get:()=>this.bound[r].value}),t++}}[l]=!0;_index;resourceType="bind-group-layout";bound={};value={};$=this.value;get[F](){return this.$}toString(){return`bindGroupLayout:${v(this)??"<unnamed>"}`}get index(){return this._index}$name(e){return L(this,e),this}$idx(e){return this._index=e,this}unwrap(e){return e.device.createBindGroupLayout({label:v(this)??"<unnamed>",entries:Object.values(this.entries).map((t,r)=>{if(t===null)return null;let n=t.visibility,i={binding:r,visibility:0};if("uniform"in t)n=n??tn,i.buffer={type:"uniform"};else if("storage"in t)n=n??(t.access==="mutable"?ho:tn),i.buffer={type:t.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in t)n=n??tn,i.sampler={type:t.sampler};else if("texture"in t){n=n??tn;let{multisampled:s,dimension:a,bindingSampleType:o}=t.texture;i.texture={sampleType:t.sampleType??o[0],viewDimension:a,multisampled:s}}else if("storageTexture"in t){n=n??ho;let{dimension:s,access:a,format:o}=t.storageTexture;i.storageTexture={access:a,format:o,viewDimension:s}}else"externalTexture"in t&&(n=n??tn,i.externalTexture={});return n?.includes("compute")&&(i.visibility|=GPUShaderStage.COMPUTE),n?.includes("vertex")&&(i.visibility|=GPUShaderStage.VERTEX),n?.includes("fragment")&&(i.visibility|=GPUShaderStage.FRAGMENT),i}).filter(t=>t!==null)})}},Lh=class{constructor(e,t){this.layout=e,this.entries=t;for(let r of Object.keys(e.entries))if(e.entries[r]!==null&&!(r in t))throw new Eg(v(e),r)}resourceType="bind-group";unwrap(e){return e.device.createBindGroup({label:v(this.layout)??"<unnamed>",layout:e.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([t,r],n)=>{if(r===null)return null;let i=this.entries[t];if(i===void 0)throw new Error(`'${t}' is a resource required to populate bind group layout '${v(this.layout)??"<unnamed>"}'.`);if("uniform"in r){let s;if(yn(i)){if(!kh(i))throw new jl(i);s={buffer:e.unwrap(i)}}else s={buffer:i};return{binding:n,resource:s}}if("storage"in r){let s;if(yn(i)){if(!gi(i))throw new ro(i);s={buffer:e.unwrap(i)}}else s={buffer:i};return{binding:n,resource:s}}if("texture"in r){let s;if(xn(i)){if(!zg(i))throw new Ig(i);s=e.unwrap(i.createView(r.texture))}else vn(i)?s=e.unwrap(i):s=i;return{binding:n,resource:s}}if("storageTexture"in r){let s;if(xn(i)){if(!gi(i))throw new ro(i);s=e.unwrap(i.createView(r.storageTexture))}else vn(i)?s=e.unwrap(i):s=i;return{binding:n,resource:s}}if("sampler"in r)return Ph(i)||Uh(i)?{binding:n,resource:e.unwrap(i)}:{binding:n,resource:i};if("externalTexture"in r)return{binding:n,resource:i};throw new Error(`Malformed bind group entry: ${Dt(i)}`)}).filter(t=>t!==null)})}};function xi(e){return new Mg(e)}var Mg=class{constructor(e=void 0){this.defaultValue=e}[l]=!0;resourceType="slot";$name(e){return L(this,e),this}areEqual(e,t){return Object.is(e,t)}toString(){return`slot:${v(this)??"<unnamed>"}`}get[F](){let e=Ve();if(!e)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return Gi(e.unwrap(this))}get value(){return this[F]}get $(){return this.value}};function vi(e,t){return new Rh("private",e,t)}function lo(e){return new Rh("workgroup",e)}var Rh=class{[l]={};#e;#t;#r;constructor(t,r,n){this.#e=t,this.#t=r,this.#r=n}[z](t){let r=t.getUniqueName(this),n=`var<${this.#e}> ${r}: ${t.resolve(this.#t).value}`;return this.#r?t.addDeclaration(`${n} = ${t.resolve(this.#r,this.#t).value};`):t.addDeclaration(`${n};`),y(r,this.#t,$e(this.#t)?"runtime":this.#e)}$name(t){return L(this,t),this}toString(){return`var:${v(this)??"<unnamed>"}`}get[F](){let t=this.#t,r=$e(t)?"runtime":this.#e;return new Proxy({[l]:!0,get[ke](){return y(this,t,r)},[z]:n=>n.resolve(this),toString:()=>`var:${v(this)??"<unnamed>"}.$`},De)}get $(){let t=ci(),r=li();if(t.type==="normal")throw new Oa(r?`Cannot access variable '${v(this)??"<unnamed>"}'. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");return t.type==="codegen"?this[F]:t.type==="simulate"?(t.vars[this.#e].has(this)||t.vars[this.#e].set(this,this.#r),t.vars[this.#e].get(this)):Fr(t,"tgpuVariable.ts#TgpuVarImpl/$")}set $(t){let r=ci(),n=li();if(r.type==="normal")throw new Oa(n?`Cannot access ${String(this)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");if(r.type==="codegen")throw new Error("Unreachable tgpuVariable.ts#TgpuVarImpl/$");if(r.type==="simulate"){r.vars[this.#e].set(this,t);return}Fr(r,"tgpuVariable.ts#TgpuVarImpl/$")}get value(){return this.$}set value(t){this.$=t}},Dh=vi(b,0).$name("dataBlockIndex"),Nh=vi(b,0).$name("dataByteIndex"),Wh=xi().$name("dataBuffer"),Ug=O([],b)`() {
  let i = dataByteIndex;
  dataByteIndex = dataByteIndex + 1u;
  return i;
}`.$uses({dataByteIndex:Nh}).$name("nextByteIndex"),x="dataBuffer[dataBlockIndex].serializedData[nextByteIndex()]",qh={f32:O([w])`(n) => {
  ${x} = bitcast<u32>(n);
}`,f16:O([se])`(n) => {
  ${x} = pack2x16float(vec2f(f32(n), 0.0));
}`,i32:O([B])`(n) => {
  ${x} = bitcast<u32>(n);
}`,u32:O([b])`(n) => {
  ${x} = n;
}`,bool:O([G])`(b) => {
  ${x} = u32(b);
}`,vec2f:O([D])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
}`,vec3f:O([ae])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
  ${x} = bitcast<u32>(v.z);
}`,vec4f:O([I])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
  ${x} = bitcast<u32>(v.z);
  ${x} = bitcast<u32>(v.w);
}`,vec2h:O([dt])`(v) => {
  ${x} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
}`,vec3h:O([ft])`(v) => {
  ${x} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${x} = pack2x16float(vec2f(f32(v.z), 0.0));
}`,vec4h:O([mt])`(v) => {
  ${x} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${x} = pack2x16float(vec2f(f32(v.z), f32(v.w)));
}`,vec2i:O([ee])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
}`,vec3i:O([Ae])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
  ${x} = bitcast<u32>(v.z);
}`,vec4i:O([ce])`(v) => {
  ${x} = bitcast<u32>(v.x);
  ${x} = bitcast<u32>(v.y);
  ${x} = bitcast<u32>(v.z);
  ${x} = bitcast<u32>(v.w);
}`,vec2u:O([Ee])`(v) => {
  ${x} = v.x;
  ${x} = v.y;
}`,vec3u:O([re])`(v) => {
  ${x} = v.x;
  ${x} = v.y;
  ${x} = v.z;
}`,vec4u:O([ge])`(v) => {
  ${x} = v.x;
  ${x} = v.y;
  ${x} = v.z;
  ${x} = v.w;
}`,"vec2<bool>":O([ar])`(v) => {
  ${x} = u32(v.x);
  ${x} = u32(v.y);
}`,"vec3<bool>":O([or])`(v) => {
  ${x} = u32(v.x);
  ${x} = u32(v.y);
  ${x} = u32(v.z);
}`,"vec4<bool>":O([ur])`(v) => {
  ${x} = u32(v.x);
  ${x} = u32(v.y);
  ${x} = u32(v.z);
  ${x} = u32(v.w);
}`,mat2x2f:O([kt])`(m) => {
  ${x} = bitcast<u32>(m[0][0]);
  ${x} = bitcast<u32>(m[0][1]);
  ${x} = bitcast<u32>(m[1][0]);
  ${x} = bitcast<u32>(m[1][1]);
}`,mat3x3f:O([Mt])`(m) => {
  ${x} = bitcast<u32>(m[0][0]);
  ${x} = bitcast<u32>(m[0][1]);
  ${x} = bitcast<u32>(m[0][2]);
  ${x} = 0u;
  ${x} = bitcast<u32>(m[1][0]);
  ${x} = bitcast<u32>(m[1][1]);
  ${x} = bitcast<u32>(m[1][2]);
  ${x} = 0u;
  ${x} = bitcast<u32>(m[2][0]);
  ${x} = bitcast<u32>(m[2][1]);
  ${x} = bitcast<u32>(m[2][2]);
  ${x} = 0u;
}`,mat4x4f:O([H])`(m) => {
  ${x} = bitcast<u32>(m[0][0]);
  ${x} = bitcast<u32>(m[0][1]);
  ${x} = bitcast<u32>(m[0][2]);
  ${x} = bitcast<u32>(m[0][3]);
  ${x} = bitcast<u32>(m[1][0]);
  ${x} = bitcast<u32>(m[1][1]);
  ${x} = bitcast<u32>(m[1][2]);
  ${x} = bitcast<u32>(m[1][3]);
  ${x} = bitcast<u32>(m[2][0]);
  ${x} = bitcast<u32>(m[2][1]);
  ${x} = bitcast<u32>(m[2][2]);
  ${x} = bitcast<u32>(m[2][3]);
  ${x} = bitcast<u32>(m[3][0]);
  ${x} = bitcast<u32>(m[3][1]);
  ${x} = bitcast<u32>(m[3][2]);
  ${x} = bitcast<u32>(m[3][3]);
}`};for(let[e,t]of Object.entries(qh))t.$name(`serialize${e[0].toLocaleUpperCase()}${e.slice(1)}`).$uses({dataBlockIndex:Dh,nextByteIndex:Ug,dataBuffer:Wh});function Hh(e){return`(${e.map((t,r)=>`_arg_${r}`).join(", ")})`}function Yh(e,t){let r=qh[e.type];if(r)return r.with(Wh,t);if(fe(e)){let n=Object.keys(e.propTypes),i=Object.values(e.propTypes),s=Xh(i,t);return O([e])`(arg) {\n  propsSerializer(${n.map(a=>`arg.${a}`).join(", ")});\n}`.$uses({propsSerializer:s}).$name(`${v(e)??"struct"}Serializer`)}if(Te(e)){let n=e.elementType,i=e.elementCount,s=Yh(n,t);return O([e])`(arg) {\n${Array.from({length:i},(a,o)=>`  elementSerializer(arg[${o}]);`).join(`
`)}\n}`.$uses({elementSerializer:s}).$name("arraySerializer")}throw new Error(`Cannot serialize data of type ${e.type}`)}function Xh(e,t){let r={},n=O(e),i=Hh(e),s=e.map((a,o)=>(r[`serializer${o}`]=Yh(a,t),`  serializer${o}(_arg_${o});`)).join(`
`);return n`${i} {\n${s}\n}`.$uses(r).$name("compoundSerializer")}function Pg(e,t,r,n,i){let s=t.map(A).reduce((u,h)=>u+h,0);if(s>i.logSizeLimit)throw new Error(`Logged data needs to fit in ${i.logSizeLimit} bytes (one of the logs requires ${s} bytes). Consider increasing the limit by passing appropriate options to tgpu.init().`);let a=Xh(t,r).$name(`log${e}serializer`),o=Hh(t);return O(t)`${o} {
  dataBlockIndex = atomicAdd(&indexBuffer, 1);
  if (dataBlockIndex >= ${i.logCountLimit}) {
    return;
  }
  dataBuffer[dataBlockIndex].id = ${e};
  dataByteIndex = 0;

  compoundSerializer${o};
}`.$uses({indexBuffer:n,dataBuffer:r,dataBlockIndex:Dh,dataByteIndex:Nh,compoundSerializer:a}).$name(`log${e}`)}var Vg=["log","debug","info","warn","error","clear"],Ag={logCountLimit:64,logSizeLimit:252,messagePrefix:" GPU "},Zh=y("/* console.log() */",te,"runtime"),Cg=class{get logResources(){}generateLog(){return console.warn("'console.log' is only supported when resolving pipelines."),Zh}},Og=class{#e;#t;#r=1;#n;#i;constructor(t){this.#e={...Ag,...t[l].logOptions},this.#t=new Map;let r=ki({id:b,serializedData:wn(b,Math.ceil(this.#e.logSizeLimit/4))}).$name("SerializedLogData");this.#i=t.createMutable(wn(r,this.#e.logCountLimit)).$name("dataBuffer"),this.#n=t.createMutable(qu(b)).$name("indexBuffer")}generateLog(t,r,n){if(!Vg.includes(r))return console.warn(`Unsupported log method '${r}' was used in TGSL.`),Zh;let i=mc(n),s=this.#r++,a=i.filter(h=>h.dataType!==He),o=Pg(s,a.map(h=>h.dataType),this.#i,this.#n,this.#e),u=i.map(h=>h.dataType===He?h.value:h.dataType);return this.#t.set(s,{op:r,argTypes:u}),y(c`${t.resolve(o).value}(${a})`,te,"runtime")}get logResources(){return this.#r===1?void 0:{dataBuffer:this.#i,indexBuffer:this.#n,options:this.#e,logIdToMeta:this.#t}}},co={mat2x2f:D,mat3x3f:ae,mat4x4f:I};function Qh(e,t){if(Te(e.dataType)||zt(e.dataType)){let r=e.dataType.elementType,n=$e(r),i=Ur(e),s=t.origin==="constant",a;return e.origin==="constant-tgpu-const-ref"?s?a=n?"constant":"constant-tgpu-const-ref":a=n?"runtime":"runtime-tgpu-const-ref":e.origin==="runtime-tgpu-const-ref"?a=n?"runtime":"runtime-tgpu-const-ref":!i&&!n?a=e.origin:s&&e.origin==="constant"?a="constant":a="runtime",y(Ue(e)&&Ue(t)?e.value[t.value]:c`${e}[${t}]`,r,a)}if(ct(e.dataType))return y(Ue(e)&&Ue(t)?e.value[t.value]:c`${e}[${t}]`,e.dataType.primitive,e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime");if(Ye(e.dataType))return Qh(js(e),t);if(e.value instanceof Ro){let r=co[e.value.matrix.dataType.type];return y(c`${e.value.matrix}[${t}]`,r,e.origin)}if(e.dataType.type in co)throw new Error("The only way of accessing matrix elements in TGSL is through the 'columns' property.");if(Ue(e)&&Ue(t)||e.dataType.type==="unknown")return Ei(e.value[t.value])}var{NodeTypeCatalog:R}=Ty,Bg=["==","!=","===","!==","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"],Fg=["&&","||","==","!=","===","!==","<","<=",">",">="],po={"===":"==","!==":"!=",get">>>"(){throw new Error("The `>>>` operator is unsupported in TypeGPU functions.")},get in(){throw new Error("The `in` operator is unsupported in TypeGPU functions.")},get instanceof(){throw new Error("The `instanceof` operator is unsupported in TypeGPU functions.")},get"|>"(){throw new Error("The `|>` operator is unsupported in TypeGPU functions.")},get"??"(){throw new Error("The `??` operator is unsupported in TypeGPU functions.")},get">>>="(){throw new Error("The `>>>=` operator is unsupported in TypeGPU functions.")},get"**="(){throw new Error("The `**=` operator is unsupported in TypeGPU functions.")},get"??="(){throw new Error("The `??=` operator is unsupported in TypeGPU functions.")},get"&&="(){throw new Error("The `&&=` operator is unsupported in TypeGPU functions.")},get"||="(){throw new Error("The `||=` operator is unsupported in TypeGPU functions.")}};function fo(e,t,r){return r?Fg.includes(t)?G:t==="="?r:e:t==="!"||t==="~"?G:e}var jg={"-":Au[l].gpuImpl},Gg={"+":aa[l].gpuImpl,"-":qr[l].gpuImpl,"*":Vn[l].gpuImpl,"/":oa[l].gpuImpl,"**":lh[l].gpuImpl},Lg=class{#e=void 0;initGenerator(e){this.#e=e}get ctx(){if(!this.#e)throw new Error("WGSL Generator has not yet been initialized. Please call initialize(ctx) before using the generator.");return this.#e}block([e,t]){this.ctx.pushBlockScope();try{this.ctx.indent();let r=t.map(n=>this.statement(n)).join(`
`);return this.ctx.dedent(),`{
${r}
${this.ctx.pre}}`}finally{this.ctx.popBlockScope()}}refVariable(e,t){let r=this.ctx.makeNameValid(e),n=Fs(t),i=y(new bt(y(r,t,"function"),n),n,"function");return this.ctx.defineVariable(e,i),r}blockVariable(e,t,r,n){let i=$e(r),s;n==="constant-tgpu-const-ref"||n==="runtime-tgpu-const-ref"?s=n:n==="argument"?i?s="runtime":s="argument":i?n==="constant"&&e==="const"?s="constant":s="runtime":s=Jo(n)?"this-function":n;let a=y(this.ctx.makeNameValid(t),r,s);return this.ctx.defineVariable(t,a),a}identifier(e){if(!e)throw new Error("Cannot resolve an empty identifier");let t=this.ctx.getById(e);if(!t)throw new Error(`Identifier ${e} not found`);return t}typedExpression(e,t){let r=this.ctx.expectedType;this.ctx.expectedType=t;try{let n=this.expression(e);return Qt(n,t)}finally{this.ctx.expectedType=r}}expression(e){if(typeof e=="string")return this.identifier(e);if(typeof e=="boolean")return y(e,G,"constant");if(e[0]===R.logicalExpr||e[0]===R.binaryExpr||e[0]===R.assignmentExpr){let[t,r,n,i]=e,s=this.expression(r),a=this.expression(i);if(a.value instanceof bt)throw new j(c`Cannot assign a ref to an existing variable '${s}', define a new variable instead.`);if(n==="==")throw new Error("Please use the === operator instead of ==");if(n==="==="&&Ue(s)&&Ue(a))return y(s.value===a.value,G,"constant");if(s.dataType.type==="unknown")throw new j(`Left-hand side of '${n}' is of unknown type`);if(a.dataType.type==="unknown")throw new j(`Right-hand side of '${n}' is of unknown type`);let o=Gg[n];if(o)return o(s,a);let u=t===R.assignmentExpr?[s.dataType]:void 0,[h,p]=Pr([s,a],u)??[s,a],f=this.ctx.resolve(h.value,h.dataType).value,m=this.ctx.resolve(p.value,p.dataType).value,g=fo(h.dataType,n,p.dataType);if(t===R.assignmentExpr){if(h.origin==="constant"||h.origin==="constant-tgpu-const-ref"||h.origin==="runtime-tgpu-const-ref")throw new j(`'${f} = ${m}' is invalid, because ${f} is a constant.`);if(s.origin==="argument")throw new j(`'${f} ${n} ${m}' is invalid, because non-pointer arguments cannot be mutated.`);if(a.origin==="argument"&&!$e(a.dataType))throw new j(`'${f} = ${m}' is invalid, because argument references cannot be assigned.
-----
Try '${f} = ${this.ctx.resolve(a.dataType).value}(${m})' to copy the value instead.
-----`);if(!Ur(a))throw new j(`'${f} = ${m}' is invalid, because references cannot be assigned.
-----
Try '${f} = ${this.ctx.resolve(a.dataType).value}(${m})' to copy the value instead.
-----`)}return y(Bg.includes(n)?`(${f} ${po[n]??n} ${m})`:`${f} ${po[n]??n} ${m}`,g,"runtime")}if(e[0]===R.postUpdate){let[t,r,n]=e,i=this.expression(n),s=this.ctx.resolve(i.value,i.dataType).value;return y(`${s}${r}`,i.dataType,"runtime")}if(e[0]===R.unaryExpr){let[t,r,n]=e,i=this.expression(n),s=jg[r];if(s)return s(i);let a=this.ctx.resolve(i.value,i.dataType).value,o=fo(i.dataType,r);return y(`${r}${a}`,o,"runtime")}if(e[0]===R.memberAccess){let[t,r,n]=e,i=this.expression(r);if(i.value===console)return y(new Aa(n),He,"runtime");let s=la(i,n);if(!s)throw new Error(c`Property '${n}' not found on value '${i}' of type ${this.ctx.resolve(i.dataType)}`);return s}if(e[0]===R.indexAccess){let[t,r,n]=e,i=this.expression(r),s=this.expression(n),a=Pr([s],[b,B],!1)?.[0]??s,o=Qh(i,a);if(!o){let u=this.ctx.resolve(i.value,i.dataType).value,h=this.ctx.resolve(a.value,a.dataType).value;throw new Error(`Unable to index value ${u} of unknown type with index ${h}. If the value is an array, to address this, consider one of the following approaches: (1) declare the array using 'tgpu.const', (2) store the array in a buffer, or (3) define the array within the GPU function scope.`)}return o}if(e[0]===R.numericLiteral){let t=typeof e[1]=="string"?fi(Dg(e[1])):fi(e[1]);if(!t)throw new Error(`Invalid numeric literal ${e[1]}`);return t}if(e[0]===R.call){let[t,r,n]=e,i=this.expression(r);if(fe(i.value)||Te(i.value)){if(n.length>1)throw new j("Array and struct schemas should always be called with at most 1 argument");if(!n[0])return y(`${this.ctx.resolve(i.value).value}()`,i.value,"runtime");let o=this.typedExpression(n[0],i.value);return y(this.ctx.resolve(o.value,i.value).value,i.value,"runtime")}if(i.value===xs)throw new Error("Constants cannot be defined within TypeGPU function scope. To address this, move the constant definition outside the function scope.");if(i.value instanceof Lo){if(!n[0])throw new j(`An infix operator '${i.value.name}' was called without any arguments`);let o=this.expression(n[0]);return i.value.operator(i.value.lhs,o)}if(!C(i.value)){let o=n.map(h=>this.expression(h)),u=this.ctx.shelllessRepo.get(i.value,o);if(u){let h=o.map((p,f)=>{let m=u.argTypes[f];return Qt(p,m,!1)});return this.ctx.withResetIndentLevel(()=>{let p=this.ctx.resolve(u);return y(c`${p.value}(${h})`,p.dataType,"runtime")})}throw new Error(`Function '${v(i.value)??String(i.value)}' is not marked with the 'use gpu' directive and cannot be used in a shader`)}let s=i.value[l]?.argConversionHint??"keep",a=i.value[l]?.strictSignature;try{let o;if(a)o=n.map((h,p)=>{let f=a.argTypes[p];if(!f)throw new j(`Function '${v(i.value)}' was called with too many arguments`);return this.typedExpression(h,f)});else if(Array.isArray(s))o=n.map((h,p)=>{let f=s[p];if(!f)throw new j(`Function '${v(i.value)}' was called with too many arguments`);return this.typedExpression(h,f)});else{let h=n.map(p=>this.expression(p));s==="keep"?o=h:s==="unify"?o=Pr(h)??h:o=s(...h).map((p,f)=>[p,h[f]]).map(([p,f])=>Qt(f,p))}if(i.value instanceof Aa)return this.ctx.generateLog(i.value.op,o);let u=i.value(...o);if(!Bs(u))throw new Error("Functions running in codegen mode must return snippets");return u}catch(o){throw o instanceof Mr?o:new Mr(o,[{toString:()=>`fn:${v(i.value)}`}])}}if(e[0]===R.objectExpr){let t=e[1],r=this.ctx.expectedType;if(!r||!fe(r))throw new j(`No target type could be inferred for object with keys [${Object.keys(t).join(", ")}], please wrap the object in the corresponding schema.`);let n=Object.fromEntries(Object.entries(r.propTypes).map(([s,a])=>{let o=t[s];if(o===void 0)throw new j(`Missing property ${s} in object literal for struct ${r}`);let u=this.typedExpression(o,a);return[s,u]})),i=nc(r,n);return y(c`${this.ctx.resolve(r).value}(${i})`,r,"runtime")}if(e[0]===R.arrayExpr){let[t,r]=e,n=this.ctx.expectedType,i,s;if(Te(n)){if(i=n.elementType,s=r.map(o=>this.typedExpression(o,i)),s.length!==n.elementCount)throw new j(`Cannot create value of type '${n}' from an array of length: ${s.length}`)}else{let o=r.map(h=>{let p=this.expression(h);if(p.origin==="argument"&&!$e(p.dataType)||!Ur(p)){let f=this.ctx.resolve(p.value,p.dataType).value,m=this.ctx.resolve(Ct(p.dataType)).value;throw new j(`'${f}' reference cannot be used in an array constructor.
-----
Try '${m}(${f})' or 'arrayOf(${m}, count)([...])' to copy the value instead.
-----`)}return p});if(o.length===0)throw new j("Cannot infer the type of an empty array literal.");let u=Pr(o);if(!u)throw new j("The given values cannot be automatically converted to a common type. Consider wrapping the array in an appropriate schema");s=u,i=Ct(s[0]?.dataType)}let a=`array<${this.ctx.resolve(i).value}, ${s.length}>`;return y(c`${a}(${s})`,wn[l].jsImpl(i,s.length),"runtime")}if(e[0]===R.stringLiteral)return y(e[1],He,"constant");if(e[0]===R.preUpdate)throw new Error("Cannot use pre-updates in TGSL.");Rg(e)}functionDefinition(e){return this.block(e)}statement(e){if(typeof e=="string")return`${this.ctx.pre}${this.ctx.resolve(this.identifier(e).value).value};`;if(typeof e=="boolean")return`${this.ctx.pre}${e?"true":"false"};`;if(e[0]===R.return){let t=e[1];if(t!==void 0){let r=this.ctx.topFunctionReturnType,n=r?this.typedExpression(t,r):this.expression(t);if(n.value instanceof bt)throw new j(c`Cannot return references, returning '${n.value.snippet}'`);if(n.origin==="argument"&&!$e(n.dataType)&&this.ctx.topFunctionScope?.functionType==="normal")throw new j(c`Cannot return references to arguments, returning '${n}'. Copy the argument before returning it.`);if(!r&&!Ur(n)&&n.origin!=="this-function"){let i=this.ctx.resolve(n.value,n.dataType).value,s=this.ctx.resolve(Nn(n.dataType)).value;throw new j(`'return ${i};' is invalid, cannot return references.
-----
Try 'return ${s}(${i});' instead.
-----`)}return n=Qt(n,Nn(n.dataType),!1),lt(n.dataType.type!=="unknown"),this.ctx.reportReturnType(n.dataType),c`${this.ctx.pre}return ${n};`}return`${this.ctx.pre}return;`}if(e[0]===R.if){let[t,r,n,i]=e,s=this.typedExpression(r,G),a=s.value===!1?void 0:this.block(Jn(n)),o=s.value===!0||!i?void 0:this.block(Jn(i));return s.value===!0?`${this.ctx.pre}${a}`:s.value===!1?o?`${this.ctx.pre}${o}`:"":o?c`\
${this.ctx.pre}if (${s}) ${a}
${this.ctx.pre}else ${o}`:c`${this.ctx.pre}if (${s}) ${a}`}if(e[0]===R.let||e[0]===R.const){let t="var",[r,n,i]=e,s=i!==void 0?this.expression(i):void 0;if(!s)throw new Error(`Cannot create variable '${n}' without an initial value.`);let a=Ur(s),o=s.dataType,u=$e(o);if(Rr(s.dataType))throw new Error(`Cannot create variable '${n}' with loose data type.`);if(s.value instanceof bt){if(s.dataType.type!=="unknown")throw new j("Cannot store d.ref() in a variable if it references another value. Copy the value passed into d.ref() instead.");let p=s.value.snippet,f=this.refVariable(n,Ct(p.dataType));return c`${this.ctx.pre}var ${f} = ${Qt(p,p.dataType,!1)};`}if(a){if(r===R.const)s.origin==="argument"?t="let":u&&(t=s.origin==="constant"?"const":"let");else if(s.origin==="argument"&&!u){let p=this.ctx.resolve(s.value).value,f=this.ctx.resolve(Nn(s.dataType)).value;throw new j(`'let ${n} = ${p}' is invalid, because references to arguments cannot be assigned to 'let' variable declarations.
  -----
  - Try 'let ${n} = ${f}(${p})' if you need to reassign '${n}' later
  - Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
  -----`)}}else{if(r===R.let){let p=this.ctx.resolve(s.value).value,f=this.ctx.resolve(Nn(s.dataType)).value;throw new j(`'let ${n} = ${p}' is invalid, because references cannot be assigned to 'let' variable declarations.
-----
- Try 'let ${n} = ${f}(${p})' if you need to reassign '${n}' later
- Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
-----`)}if(s.origin==="constant-tgpu-const-ref")t="const";else if(s.origin==="runtime-tgpu-const-ref")t="let";else{if(t="let",!Ye(o)){let p=eu(s.origin,Ct(o));lt(p!==void 0,`Creating pointer type from origin ${s.origin}`),o=p}s.value instanceof bt||(o=Hl(o))}}let h=this.blockVariable(t,n,Ct(o),s.origin);return c`${this.ctx.pre}${t} ${h.value} = ${Qt(s,o,!1)};`}if(e[0]===R.block)return this.block(e);if(e[0]===R.for){let[t,r,n,i,s]=e,[a,o,u]=this.ctx.withResetIndentLevel(()=>[r?this.statement(r):void 0,n?this.typedExpression(n,G):void 0,i?this.statement(i):void 0]),h=a?a.slice(0,-1):"",p=u?u.slice(0,-1):"",f=this.block(Jn(s));return c`${this.ctx.pre}for (${h}; ${o}; ${p}) ${f}`}if(e[0]===R.while){let[t,r,n]=e,i=this.typedExpression(r,G),s=this.ctx.resolve(i.value).value,a=this.block(Jn(n));return`${this.ctx.pre}while (${s}) ${a}`}return e[0]===R.continue?`${this.ctx.pre}continue;`:e[0]===R.break?`${this.ctx.pre}break;`:`${this.ctx.pre}${this.ctx.resolve(this.expression(e).value).value};`}};function Rg(e){throw new Error(`'${Dt(e)}' was not handled by the WGSL generator.`)}function Dg(e){return/^0x[0-9a-f]+$/i.test(e)?Number.parseInt(e):/^0b[01]+$/i.test(e)?Number.parseInt(e.slice(2),2):Number.parseFloat(e)}function Jn(e){return typeof e!="object"||e[0]!==R.block?[R.block,[e]]:e}var Ng=new Lg,Jh=Ng,Kh="#CATCHALL#",Wg=class{_stack=[];_itemDepth=0;get itemDepth(){return this._itemDepth}get topItem(){let e=this._stack[this._stack.length-1];if(!e||e.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return e}get topFunctionScope(){return this._stack.findLast(e=>e.type==="functionScope")}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}popItem(){this.pop("item")}pushSlotBindings(e){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(e)})}popSlotBindings(){this.pop("slotBinding")}pushFunctionScope(e,t,r,n,i){let s={type:"functionScope",functionType:e,args:t,argAliases:r,returnType:n,externalMap:i,reportedReturnTypes:new Set};return this._stack.push(s),s}popFunctionScope(){this.pop("functionScope")}pushBlockScope(){this._stack.push({type:"blockScope",declarations:new Map})}popBlockScope(){this.pop("blockScope")}pop(e){let t=this._stack[this._stack.length-1];if(!t||e&&t.type!==e)throw new Error(`Internal error, expected a ${e} layer to be on top.`);this._stack.pop(),e==="item"&&this._itemDepth--}readSlot(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="item")r.usedSlots.add(e);else if(r?.type==="slotBinding"){let n=r.bindingMap.get(e);if(n!==void 0)return n}else if(!(r?.type==="functionScope"||r?.type==="blockScope"))throw new Error("Unknown layer type.")}return e.defaultValue}getSnippetById(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="functionScope"){let n=r.args.find(s=>s.value===e);if(n!==void 0)return n;if(r.argAliases[e])return r.argAliases[e];let i=r.externalMap[e];return i!=null?Ei(i):void 0}if(r?.type==="blockScope"){let n=r.declarations.get(e);if(n!==void 0)return n}}}defineBlockVariable(e,t){if(t.dataType.type==="unknown")throw Error(`Tried to define variable '${e}' of unknown type`);for(let r=this._stack.length-1;r>=0;--r){let n=this._stack[r];if(n?.type==="blockScope"){n.declarations.set(e,t);return}}throw new Error("No block scope found to define a variable in.")}},ri=["","  ","    ","      ","        ","          ","            ","              ","                "],Ki=ri.length-1,qg=class{identLevel=0;get pre(){return ri[this.identLevel]??ri[Ki].repeat(this.identLevel/Ki)+ri[this.identLevel%Ki]}indent(){let e=this.pre;return this.identLevel++,e}dedent(){return this.identLevel--,this.pre}withResetLevel(e){let t=this.identLevel;this.identLevel=0;try{return e()}finally{this.identLevel=t}}},el=class{#e;#t;_indentController=new qg;_itemStateStack=new Wg;#r=[];_declarations=[];_varyingLocations;#n=new WeakSet;#i;get varyingLocations(){return this._varyingLocations}[l]={itemStateStack:this._itemStateStack};bindGroupLayoutsToPlaceholderMap=new Map;_nextFreeLayoutPlaceholderIdx=0;fixedBindings=[];enableExtensions;expectedType;constructor(e){this.enableExtensions=e.enableExtensions,this.#t=e.shaderGenerator??Jh,this.#i=e.root?new Og(e.root):new Cg,this.#e=e.namespace[l]}getUniqueName(e){return Ry(this.#e,e)}makeNameValid(e){return this.#e.nameRegistry.makeValid(e)}get pre(){return this._indentController.pre}get topFunctionScope(){return this._itemStateStack.topFunctionScope}get topFunctionReturnType(){let e=this._itemStateStack.topFunctionScope;return lt(e),e.returnType}get shelllessRepo(){return this.#e.shelllessRepo}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}withResetIndentLevel(e){return this._indentController.withResetLevel(e)}getById(e){let t=this._itemStateStack.getSnippetById(e);return t===void 0?null:t}defineVariable(e,t){this._itemStateStack.defineBlockVariable(e,t)}reportReturnType(e){let t=this._itemStateStack.topFunctionScope;lt(t),t.reportedReturnTypes.add(e)}pushBlockScope(){this._itemStateStack.pushBlockScope()}popBlockScope(){this._itemStateStack.popBlockScope()}generateLog(e,t){return this.#i.generateLog(this,e,t)}get logResources(){return this.#i.logResources}fnToWgsl(e){let t=!1;try{this.#e.nameRegistry.pushFunctionScope();let r=[],n=[];for(let[o,u]of e.argTypes.entries()){let h=e.params[o],p=Ye(u)?u.addressSpace==="storage"?u.access==="read"?"readonly":"mutable":u.addressSpace:"argument";switch(h?.type){case ws.identifier:{let f=h.name,m=y(this.makeNameValid(f),u,p);r.push(m),m.value!==f&&n.push([f,m]);break}case ws.destructuredObject:{r.push(y(`_arg_${o}`,u,p)),n.push(...h.props.map(({name:f,alias:m})=>{let g=Tt(e.argTypes[o].propTypes[f]);return[m,y(`_arg_${o}.${f}`,g,"argument")]}));break}case void 0:r.push(y(`_arg_${o}`,u,p))}}let i=this._itemStateStack.pushFunctionScope(e.functionType,r,Object.fromEntries(n),e.returnType,e.externalMap);t=!0,this.#t.initGenerator(this);let s=this.#t.functionDefinition(e.body),a=e.returnType;if(!a){let o=[...i.reportedReturnTypes];if(o.length===0)a=te;else{let u=Ls(o);u&&!u.hasImplicitConversions&&(a=u.targetType)}if(!a)throw new Error(`Expected function to have a single return type, got [${o.join(", ")}]. Cast explicitly to the desired type.`);a=Ct(a)}return{head:Hg(this,r,a),body:s,returnType:a}}finally{t&&this._itemStateStack.popFunctionScope(),this.#e.nameRegistry.popFunctionScope()}}addDeclaration(e){this._declarations.push(e)}allocateLayoutEntry(e){let t=this.bindGroupLayoutsToPlaceholderMap,r=t.get(e);return r||(r=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,t.set(e,r)),r}allocateFixedEntry(e,t){let r=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:e,resource:t}),{group:Kh,binding:r}}readSlot(e){let t=this._itemStateStack.readSlot(e);if(t===void 0)throw new Fl(e);return t}withSlots(e,t){this._itemStateStack.pushSlotBindings(e);try{return t()}finally{this._itemStateStack.popSlotBindings()}}withVaryingLocations(e,t){this._varyingLocations=e;try{return t()}finally{this._varyingLocations=void 0}}unwrap(e){if(ls(e))return this.withSlots(e[er].pairs,()=>this.unwrap(e[er].inner));let t=e;for(;;)if(us(t))t=this.readSlot(t);else if(hs(t))t=this._getOrCompute(t);else break;return t}_getOrCompute(e){let t=this.#e.memoizedDerived.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;this.pushMode(new zn);let r;try{r=e["~compute"]()}finally{this.popMode("normal")}let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedDerived.set(e,t),r}catch(r){throw r instanceof Mr?r.appendToTrace(e):new Mr(r,[e])}finally{this._itemStateStack.popItem()}}_getOrInstantiate(e){let t=this.#e.memoizedResolves.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;let r;if(Dr(e))r=y(zh(this,e),te,"runtime");else if(hs(e)||us(e))r=this.resolve(this.unwrap(e));else if(tu(e))r=e[z](this);else if(ln(e)){let i=this.#e.shelllessRepo.get(e,void 0);if(!i)throw new Error(`Couldn't resolve ${e.name}. Make sure it's a function that accepts no arguments, or call it from another TypeGPU function.`);return this.withResetIndentLevel(()=>this.resolve(i))}else throw new TypeError(`Unresolvable internal value: ${Dt(e)}`);let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedResolves.set(e,t),r}catch(r){throw r instanceof Mr?r.appendToTrace(e):new Mr(r,[e])}finally{this._itemStateStack.popItem()}}resolve(e,t){if(vh(e)||ln(e)){if(this.#n.has(e)&&!this.#e.memoizedResolves.has(e))throw new Error(`Recursive function ${e} detected. Recursion is not allowed on the GPU.`);this.#n.add(e)}if(ls(e))return this.withSlots(e[er].pairs,()=>this.resolve(e[er].inner,t));if(C(e)||ln(e)){if(this._itemStateStack.itemDepth===0)try{this.pushMode(new Xl);let r=ru(this,()=>this._getOrInstantiate(e));return y(`${[...this._declarations].join(`

`)}${r.value}`,te,"runtime")}finally{this.popMode("codegen")}return this._getOrInstantiate(e)}if(typeof e=="number"){let r=t??fi(e).dataType;if(lt(r.type!=="unknown"),r.type==="abstractInt")return y(`${e}`,r,"constant");if(r.type==="u32")return y(`${e}u`,r,"constant");if(r.type==="i32")return y(`${e}i`,r,"constant");let n=e.toExponential(),i=r.type==="abstractFloat"&&Number.isInteger(e)?`${e}.`:`${e}`,s=n.length<i.length?n:i;return r.type==="f32"?y(`${s}f`,r,"constant"):r.type==="f16"?y(`${s}h`,r,"constant"):y(s,r,"constant")}if(typeof e=="boolean")return y(e?"true":"false",G,"constant");if(typeof e=="string")return y(e,te,"runtime");if(t&&Te(t)){if(!Array.isArray(e))throw new j(`Cannot coerce ${e} into value of type '${t}'`);if(t.elementCount!==e.length)throw new j(`Cannot create value of type '${t}' from an array of length: ${e.length}`);let r=this.resolve(t.elementType);return y(c`array<${r}, ${t.elementCount}>(${e.map(n=>y(n,t.elementType,"runtime"))})`,t,"runtime")}if(Array.isArray(e))return y(c`array(${e.map(r=>this.resolve(r))})`,He,"runtime");if(t&&fe(t))return y(c`${this.resolve(t)}(${Object.entries(t.propTypes).map(([r,n])=>y(e[r],n,"runtime"))})`,t,"runtime");throw new j(`Value ${e} (as json: ${Dt(e)}) is not resolvable${t?` to type ${t.type}`:""}`)}pushMode(e){this.#r.push(e)}popMode(e){let t=this.#r.pop();e!==void 0&&lt(t?.type===e)}get mode(){return this.#r[this.#r.length-1]??nu}};function Ri(e,t){let r=new el(t),n=(t.config?r.withSlots(t.config(new Ih([])).bindings,()=>r.resolve(e)):r.resolve(e)).value,i=r.bindGroupLayoutsToPlaceholderMap,s=[],a=new Set([...i.keys()].map(f=>f.index).filter(f=>f!==void 0)),o=Zy(a),u=r.fixedBindings.map((f,m)=>[String(m),f.layoutEntry]),h=()=>{let f=o.next().value,m=Fh(Object.fromEntries(u));return s[f]=m,n=n.replaceAll(Kh,String(f)),[f,new Lh(m,Object.fromEntries(r.fixedBindings.map((g,$)=>[String($),g.resource])))]},p=u.length>0?h():void 0;for(let[f,m]of i.entries()){let g=f.index??o.next().value;s[g]=f,n=n.replaceAll(m,String(g))}return t.enableExtensions&&t.enableExtensions.length>0&&(n=`${t.enableExtensions.map(f=>`enable ${f};`).join(`
`)}

${n}`),{code:n,usedBindGroupLayouts:s,catchall:p,logResources:r.logResources}}function Hg(e,t,r){let n=t.map(i=>`${i.value}: ${e.resolve(i.dataType).value}`).join(", ");return r.type!=="void"?`(${n}) -> ${ia(r)}${e.resolve(r).value} `:`(${n}) `}function tl(e){let t=e;return t?.resourceType==="compute-pipeline"&&!!t[l]}function rl(e){let t=e;return t?.resourceType==="render-pipeline"&&!!t[l]}function Yg(e){return rl(e)||tl(e)}function Ts(e,t){return Array.isArray(e)?Qg(e,t):Zg(e)}function Xg(e,t){return Array.isArray(e)?Ts(e,t).code:Ts(e).code}function Zg(e){let{template:t,externals:r,shaderGenerator:n,names:i="strict",config:s,enableExtensions:a}=e;t||console.warn("Calling resolve with an empty template is deprecated and will soon return an empty string. Consider using the 'tgpu.resolve(resolvableArray, options)' API instead.");let o={};Br(o,r??{});let u={[l]:!0,[z](h){return y(Mn(h,o,t??""),te,"runtime")},toString:()=>"<root>"};return Ri(u,{namespace:typeof i=="string"?Yr({names:i}):i,enableExtensions:a,shaderGenerator:n,config:s,root:nl(Object.values(r))})}function Qg(e,t){let{shaderGenerator:r,names:n="strict",config:i,enableExtensions:s}=t??{},a={[l]:!0,[z](o){return e.forEach(u=>o.resolve(u)),y("",te,"runtime")},toString:()=>"<root>"};return Ri(a,{namespace:typeof n=="string"?Yr({names:n}):n,enableExtensions:s,shaderGenerator:r,config:i,root:nl(e)})}function nl(e){let t=e.filter(Yg);if(t.length>1)throw new Error(`Found ${t.length} pipelines but can only resolve one at a time.`);return t[0]?.[l].branch}function Jg(e){let t=Ve()??new el({namespace:Yr(),shaderGenerator:Jh}),r=[1,1,1],n=[1,1,1],i=[r[0]*n[0],r[1]*n[1],r[2]*n[2]],s=new Map,a=Array.from({length:r[0]},()=>Array.from({length:r[1]},()=>Array.from({length:r[2]},()=>new Map))),o=Array.from({length:i[0]},()=>Array.from({length:i[1]},()=>Array.from({length:i[2]},()=>new Map))),u=Array.from({length:i[0]},(h,p)=>Array.from({length:i[1]},(f,m)=>Array.from({length:i[2]},(g,$)=>{let T=Math.floor(p/n[0]),k=Math.floor(m/n[1]),M=Math.floor($/n[2]);return new Zl(s,{private:o[p][m][$],workgroup:a[T][k][M]})})));t.pushMode(u[0][0][0]);try{return{value:ru(t,e),buffers:s,privateVars:o,workgroupVars:a}}finally{t.popMode("simulate")}}function Kg(e,t,r,n){return new ew(e,t,r,n)}function xa(e){let t=e;return t?.resourceType==="query-set"&&!!t[l]}var ew=class{constructor(e,t,r,n){this.type=t,this.count=r,this.rawQuerySet=n,this.#e=e.device,this._ownQuerySet=!n,this._querySet=n||null}resourceType="query-set";#e;_querySet=null;_ownQuerySet;_destroyed=!1;_available=!0;_readBuffer=null;_resolveBuffer=null;get querySet(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");return this.rawQuerySet?this.rawQuerySet:this._querySet?this._querySet:(this._querySet=this.#e.createQuerySet({type:this.type,count:this.count}),this._querySet)}get destroyed(){return this._destroyed}get available(){return this._available}get[l](){let e=this;return{get readBuffer(){return e._readBuffer||(e._readBuffer=e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})),e._readBuffer},get resolveBuffer(){return e._resolveBuffer||(e._resolveBuffer=e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC})),e._resolveBuffer}}}$name(e){return L(this,e),this._querySet&&(this._querySet.label=e),this}resolve(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");if(!this._available)throw new Error("This QuerySet is busy resolving or reading.");let e=this.#e.createCommandEncoder();e.resolveQuerySet(this.querySet,0,this.count,this[l].resolveBuffer,0),this.#e.queue.submit([e.finish()])}async read(){if(!this._resolveBuffer)throw new Error("QuerySet must be resolved before reading.");this._available=!1;try{let e=this.#e.createCommandEncoder();e.copyBufferToBuffer(this[l].resolveBuffer,0,this[l].readBuffer,0,this.count*BigUint64Array.BYTES_PER_ELEMENT),this.#e.queue.submit([e.finish()]);let t=this[l].readBuffer;await t.mapAsync(GPUMapMode.READ);let r=new BigUint64Array(t.getMappedRange().slice());return t.unmap(),Array.from(r)}finally{this._available=!0}}destroy(){this._destroyed||(this._destroyed=!0,this._querySet&&this._ownQuerySet&&this._querySet.destroy(),this._readBuffer?.destroy(),this._resolveBuffer?.destroy(),this._readBuffer=this._resolveBuffer=null)}},mo=class{constructor(e){this._make=e}_map=new WeakMap;getOrMake(e,...t){if(this._map.has(e))return this._map.get(e);let r=this._make(e,...t);return this._map.set(e,r),r}},es=class{constructor(e,t){this.resourceType=e,this.buffer=t,this[ie]=t,this.#e=this.buffer.as(this.resourceType)}[l]=!0;[ie];#e;$name(e){return L(this[ie],e),this}write(e){this.buffer.write(e)}writePartial(e){this.buffer.writePartial(e)}read(){return this.buffer.read()}get[F](){return this.#e.$}get $(){return this.#e.$}get value(){return this.$}[z](e){return e.resolve(this.#e)}},E=e=>ph(e??0),rt=e=>dh(e??0),Ir=e=>fh(e??0),tw={f32:e=>E(e[0]),f16:e=>Ir(e[0]).x,i32:e=>rt(e[0]),u32:e=>e[0]??0,bool:e=>!!e[0],vec2f:e=>D(E(e[0]),E(e[1])),vec3f:e=>ae(E(e[0]),E(e[1]),E(e[2])),vec4f:e=>I(E(e[0]),E(e[1]),E(e[2]),E(e[3])),vec2h(e){let t=Ir(e[0]);return dt(t.x,t.y)},vec3h(e){let t=Ir(e[0]),r=Ir(e[1]);return ft(t.x,t.y,r.x)},vec4h(e){let t=Ir(e[0]),r=Ir(e[1]);return mt(t.x,t.y,r.x,r.y)},vec2i:e=>ee(rt(e[0]),rt(e[1])),vec3i:e=>Ae(rt(e[0]),rt(e[1]),rt(e[2])),vec4i:e=>ce(rt(e[0]),rt(e[1]),rt(e[2]),rt(e[3])),vec2u:e=>Ee(e[0]??0,e[1]??0),vec3u:e=>re(e[0]??0,e[1]??0,e[2]??0),vec4u:e=>ge(e[0]??0,e[1]??0,e[2]??0,e[3]??0),"vec2<bool>":e=>ar(!!e[0],!!e[1]),"vec3<bool>":e=>or(!!e[0],!!e[1],!!e[2]),"vec4<bool>":e=>ur(!!e[0],!!e[1],!!e[2],!!e[3]),mat2x2f:e=>kt(E(e[0]),E(e[1]),E(e[2]),E(e[3])),mat3x3f:e=>Mt(E(e[0]),E(e[1]),E(e[2]),E(e[4]),E(e[5]),E(e[6]),E(e[8]),E(e[9]),E(e[10])),mat4x4f:e=>H(E(e[0]),E(e[1]),E(e[2]),E(e[3]),E(e[4]),E(e[5]),E(e[6]),E(e[7]),E(e[8]),E(e[9]),E(e[10]),E(e[11]),E(e[12]),E(e[13]),E(e[14]),E(e[15]))};function rw(e,t){let r=tw[t.type];if(r)return r(e);if(fe(t)){let n=Object.keys(t.propTypes),i=Object.values(t.propTypes),s=zs(e,i);return Object.fromEntries(n.map((a,o)=>[a,s[o]]))}if(Te(t)){let n=t.elementType,i=t.elementCount;return zs(e,Array.from({length:i},()=>n))}throw new Error(`Cannot deserialize data of type ${t.type}`)}function zs(e,t){let r=0;return t.map(n=>{if(!Nt(n))return n;let i=Math.ceil(A(n)/4),s=rw(e.subarray(r,r+i),n);return r+=i,s})}function nw(e,t){return zs(e,t).map(ps)}function Is(e){let{indexBuffer:t,dataBuffer:r,logIdToMeta:n,options:i}=e;r.read().then(s=>{s.filter(a=>a.id).forEach(({id:a,serializedData:o})=>{let{argTypes:u,op:h}=n.get(a),p=nw(new Uint32Array(o),u);p.length===0&&p.push(""),console[h](`%c${i.messagePrefix}%c ${p[0]}`,"background: #936ff5; color: white;","color: inherit; background: none",...p.slice(1))})}),t.read().then(s=>{s>i.logCountLimit&&console.warn(`Log count limit per dispatch (${i.logCountLimit}) exceeded by ${s-i.logCountLimit} calls. Consider increasing the limit by passing appropriate options to tgpu.init().`)}),r.buffer.clear(),t.buffer.clear()}function il(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Performance callback requires the "timestamp-query" feature to be enabled on GPU device.');return e.timestampWrites?{...e,performanceCallback:t}:{...e,performanceCallback:t,hasAutoQuerySet:!0,timestampWrites:{querySet:r.createQuerySet("timestamp",2),beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}}function sl(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Timestamp writes require the "timestamp-query" feature to be enabled on GPU device.');e.hasAutoQuerySet&&e.timestampWrites&&e.timestampWrites.querySet.destroy();let n={querySet:t.querySet};return t.beginningOfPassWriteIndex!==void 0&&(n.beginningOfPassWriteIndex=t.beginningOfPassWriteIndex),t.endOfPassWriteIndex!==void 0&&(n.endOfPassWriteIndex=t.endOfPassWriteIndex),{...e,hasAutoQuerySet:!1,timestampWrites:n}}function al(e,t){if(!e.timestampWrites)return{};let{querySet:r,beginningOfPassWriteIndex:n,endOfPassWriteIndex:i}=e.timestampWrites,s={querySet:xa(r)?t.unwrap(r):r};return n!==void 0&&(s.beginningOfPassWriteIndex=n),i!==void 0&&(s.endOfPassWriteIndex=i),{timestampWrites:s}}function Ss({root:e,priors:t}){let r=t.timestampWrites?.querySet,n=t.performanceCallback;if(!r)throw new Error("Cannot dispatch workgroups with performance callback without a query set.");if(!xa(r))throw new Error("Performance callback with raw GPUQuerySet is not supported. Use TgpuQuerySet instead.");let i=e.device.createCommandEncoder();i.resolveQuerySet(e.unwrap(r),0,r.count,r[l].resolveBuffer,0),e.device.queue.submit([i.finish()]),e.device.queue.onSubmittedWorkDone().then(async()=>{if(!r.available)return;let s=await r.read(),a=s[t.timestampWrites?.beginningOfPassWriteIndex??0],o=s[t.timestampWrites?.endOfPassWriteIndex??1];if(a===void 0||o===void 0)throw new Error("QuerySet did not return valid timestamps.");await n(a,o)})}function iw(e,t,r){return new sw(new aw(e,t,r),{})}var sw=class un{constructor(t,r){this._core=t,this._priors=r,this[l]={get rawPipeline(){return t.unwrap().pipeline},get priors(){return r},get branch(){return t.branch}},this[ie]=t}[l];resourceType="compute-pipeline";[ie];[z](t){return t.resolve(this._core)}toString(){return`computePipeline:${v(this)??"<unnamed>"}`}get rawPipeline(){return this._core.unwrap().pipeline}with(t,r){return wi(t)?new un(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t.layout,t]])}):new un(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t,r]])})}withPerformanceCallback(t){let r=il(this._priors,t,this._core.branch);return new un(this._core,r)}withTimestampWrites(t){let r=sl(this._priors,t,this._core.branch);return new un(this._core,r)}dispatchWorkgroups(t,r,n){let i=this._core.unwrap(),{branch:s}=this._core,a={label:v(this._core)??"<unnamed>",...al(this._priors,s)},o=s.device.createCommandEncoder(),u=o.beginComputePass(a);u.setPipeline(i.pipeline);let h=new Set(i.usedBindGroupLayouts);if(i.usedBindGroupLayouts.forEach((p,f)=>{if(i.catchall&&f===i.catchall[0])u.setBindGroup(f,s.unwrap(i.catchall[1])),h.delete(p);else{let m=this._priors.bindGroupLayoutMap?.get(p);m!==void 0&&(h.delete(p),u.setBindGroup(f,s.unwrap(m)))}}),h.size>0)throw new Os(h);u.dispatchWorkgroups(t,r,n),u.end(),s.device.queue.submit([o.finish()]),i.logResources&&Is(i.logResources),this._priors.performanceCallback&&Ss({root:s,priors:this._priors})}$name(t){return L(this._core,t),this}},aw=class{constructor(e,t,r){this.branch=e,this._slotBindings=t,this._entryFn=r}[l]=!0;_memo;[z](e){return e.withSlots(this._slotBindings,()=>(e.resolve(this._entryFn),y("",te,"runtime")))}toString(){return"computePipelineCore"}unwrap(){if(this._memo===void 0){let e=this.branch.device,t=ga.filter(h=>this.branch.enabledFeatures.has(gh[h])),r,n=Yr({names:this.branch.nameRegistrySetting});r=Ri(this,{namespace:n,enableExtensions:t,shaderGenerator:this.branch.shaderGenerator,root:this.branch});let{code:i,usedBindGroupLayouts:s,catchall:a,logResources:o}=r;a!==void 0&&s[a[0]]?.$name(`${v(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let u=e.createShaderModule({label:`${v(this)??"<unnamed>"} - Shader`,code:i});this._memo={pipeline:e.createComputePipeline({label:v(this)??"<unnamed>",layout:e.createPipelineLayout({label:`${v(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:s.map(h=>this.branch.unwrap(h))}),compute:{module:u}}),usedBindGroupLayouts:s,catchall:a,logResources:o}}return this._memo}};function yo(e,t="vertex"){return new ow(e,t)}function ol(e){return e?.resourceType==="vertex-layout"}var Es=Symbol("defaultAttribEntry");function ni(e,t,r,n,i){if(Xe(t)||Qe(t)){let s=Gt(t);return s!==void 0&&(n[i??Es]=s),ni(e,t.inner,Pe(r,Le(t)),n)}if(fe(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Pe(s,J(u));let h=[o,ni(e,u,s,n,o)];return s+=A(u),h}))}if(Ze(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Pe(s,Le(u));let h=[o,ni(e,u,s,n,o)];return s+=A(u),h}))}if("type"in t&&typeof t.type=="string"){if(Go.includes(t.type))return{_layout:e,format:t.type,offset:r};let s=Al[t.type];if(s)return{_layout:e,format:s,offset:r}}throw new Error(`Unsupported data used in vertex layout: ${String(t)}`)}var ow=class{constructor(e,t){this.schemaForCount=e,this.stepMode=t;let r=e(0);this.stride=Pe(A(r.elementType),J(r)),this.attrib=ni(this,r.elementType,0,this._customLocationMap)}[l]=!0;resourceType="vertex-layout";stride;attrib;_customLocationMap={};get vertexLayout(){if(this._customLocationMap[Es]!==void 0){if(typeof this.attrib.format!="string"||typeof this.attrib.offset!="number")throw new Error("Single attribute vertex layouts must have a format and offset.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[{format:this.attrib.format,offset:this.attrib.offset,shaderLocation:this._customLocationMap[Es]}]}}if(!Object.keys(this.attrib).every(e=>this._customLocationMap[e]!==void 0))throw new Error("All attributes must have custom locations in order to unwrap a vertex layout.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[...Object.entries(this.attrib).map(([e,t])=>({format:t.format,offset:t.offset,shaderLocation:this._customLocationMap[e]}))]}}$name(e){return L(this,e),this}};function uw(e){return typeof e?.loadOp=="string"}function hw(e,t){if(Dr(e)){if(St(e))return[];if(!uw(t))throw new Error("Expected a single color attachment, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(St(i))continue;let s=t[n];if(!s)throw new Error(`A color attachment by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function lw(e){return typeof e?.format=="string"}function cw(e,t){if(Dr(e)){if(Fo(e))return[];if(e.type==="decorated")return[];if(!lw(t))throw new Error("Expected a single color target configuration, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(St(i))continue;let s=t[n];if(!s)throw new Error(`A color target by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function ul(e){return new pw(new dw(e),{})}var pw=class We{[l];resourceType="render-pipeline";[ie];hasIndexBuffer=!1;constructor(t,r){this[l]={core:t,priors:r,branch:t.options.branch},this[ie]=t}[z](t){return t.resolve(this[l].core)}toString(){return`renderPipeline:${v(this)??"<unnamed>"}`}$name(t){return L(this[l].core,t),this}with(t,r){let n=this[l];if(wi(t))return new We(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t.layout,t]])});if(jh(t))return new We(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t,r]])});if(ol(t))return new We(n.core,{...n.priors,vertexLayoutMap:new Map([...n.priors.vertexLayoutMap??[],[t,r]])});throw new Error("Unsupported value passed into .with()")}withPerformanceCallback(t){let r=this[l],n=il(r.priors,t,r.core.options.branch);return new We(r.core,n)}withTimestampWrites(t){let r=this[l],n=sl(r.priors,t,r.core.options.branch);return new We(r.core,n)}withColorAttachment(t){let r=this[l];return new We(r.core,{...r.priors,colorAttachment:t})}withDepthStencilAttachment(t){let r=this[l];return new We(r.core,{...r.priors,depthStencilAttachment:t})}withStencilReference(t){let r=this[l];return new We(r.core,{...r.priors,stencilReference:t})}withIndexBuffer(t,r,n,i){let s=this[l];if(cs(t)){if(typeof r!="string")throw new Error("If a GPUBuffer is passed, indexFormat must be provided.");return new We(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:r,offsetBytes:n,sizeBytes:i}})}let a={u32:"uint32",u16:"uint16"},o=t.dataType.elementType;return new We(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:a[o.type],offsetBytes:r!==void 0?r*A(o):void 0,sizeBytes:i!==void 0?i*A(o):void 0}})}setupRenderPass(t){let r=this[l],n=r.core.unwrap(),{branch:i,fragmentFn:s}=r.core.options,a=s?hw(s.shell.out,r.priors.colorAttachment??{}).map(m=>xn(m.view)?{...m,view:i.unwrap(m.view).createView()}:vn(m.view)?{...m,view:i.unwrap(m.view)}:m):[null],o={label:v(r.core)??"<unnamed>",colorAttachments:a,...al(r.priors,i)},u=r.priors.depthStencilAttachment;if(u!==void 0){let m=xn(u.view)?i.unwrap(u.view).createView():vn(u.view)?i.unwrap(u.view):u.view;o.depthStencilAttachment={...u,view:m}}let h=t.beginRenderPass(o);h.setPipeline(n.pipeline),r.priors.stencilReference!==void 0&&h.setStencilReference(r.priors.stencilReference);let p=new Set(n.usedBindGroupLayouts);n.usedBindGroupLayouts.forEach((m,g)=>{if(n.catchall&&g===n.catchall[0])h.setBindGroup(g,i.unwrap(n.catchall[1])),p.delete(m);else{let $=r.priors.bindGroupLayoutMap?.get(m);$!==void 0&&(p.delete(m),h.setBindGroup(g,i.unwrap($)))}});let f=new Set(r.core.usedVertexLayouts);if(r.core.usedVertexLayouts.forEach((m,g)=>{let $=r.priors.vertexLayoutMap?.get(m);$&&(f.delete(m),h.setVertexBuffer(g,i.unwrap($)))}),p.size>0)throw new Os(p);if(f.size>0)throw new Ho(f);return h}draw(t,r,n,i){let s=this[l],{branch:a}=s.core.options,{logResources:o}=s.core.unwrap(),u=a.device.createCommandEncoder(),h=this.setupRenderPass(u);h.draw(t,r,n,i),h.end(),a.device.queue.submit([u.finish()]),o&&Is(o),s.priors.performanceCallback&&Ss({root:a,priors:s.priors})}drawIndexed(t,r,n,i,s){let a=this[l];if(!a.priors.indexBuffer)throw new Error("No index buffer set for this render pipeline.");let{logResources:o}=a.core.unwrap(),{branch:u}=a.core.options,{buffer:h,indexFormat:p,offsetBytes:f,sizeBytes:m}=a.priors.indexBuffer,g=u.device.createCommandEncoder(),$=this.setupRenderPass(g);cs(h)?$.setIndexBuffer(h,p,f,m):$.setIndexBuffer(u.unwrap(h),p,f,m),$.drawIndexed(t,r,n,i,s),$.end(),u.device.queue.submit([g.finish()]),o&&Is(o),a.priors.performanceCallback&&Ss({root:u,priors:a.priors})}},dw=class{constructor(e){this.options=e;let t=Dy(e.vertexFn.shell.in??{},e.vertexAttribs);this._vertexBufferLayouts=t.bufferDefinitions,this.usedVertexLayouts=t.usedVertexLayouts,this._targets=e.fragmentFn&&e.targets?cw(e.fragmentFn.shell.out,e.targets):[null]}[l]=!0;usedVertexLayouts;_memo;_vertexBufferLayouts;_targets;[z](e){let{vertexFn:t,fragmentFn:r,slotBindings:n}=this.options,i=fw(t.shell.out,r?.shell.in,v(t)??"<unnamed>",v(r)??"<unnamed>");return e.withVaryingLocations(i,()=>e.withSlots(n,()=>(e.resolve(t),r&&e.resolve(r),y("",te,"runtime"))))}toString(){return"renderPipelineCore"}unwrap(){if(this._memo===void 0){let{branch:e,primitiveState:t,depthStencilState:r,multisampleState:n}=this.options,i=e.device,s=ga.filter(T=>e.enabledFeatures.has(gh[T])),a,o=Yr({names:e.nameRegistrySetting});a=Ri(this,{namespace:o,enableExtensions:s,shaderGenerator:e.shaderGenerator,root:e});let{code:u,usedBindGroupLayouts:h,catchall:p,logResources:f}=a;p!==void 0&&h[p[0]]?.$name(`${v(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let m=i.createShaderModule({label:`${v(this)??"<unnamed>"} - Shader`,code:u}),g={layout:i.createPipelineLayout({label:`${v(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:h.map(T=>e.unwrap(T))}),vertex:{module:m,buffers:this._vertexBufferLayouts}},$=v(this);$!==void 0&&(g.label=$),this.options.fragmentFn&&(g.fragment={module:m,targets:this._targets}),t&&(Nt(t.stripIndexFormat)?g.primitive={...t,stripIndexFormat:{u32:"uint32",u16:"uint16"}[t.stripIndexFormat.type]}:g.primitive=t),r&&(g.depthStencil=r),n&&(g.multisample=n),this._memo={pipeline:i.createRenderPipeline(g),usedBindGroupLayouts:h,catchall:p,logResources:f}}return this._memo}};function fw(e,t,r,n){let i={},s=new Set;function a(u,h){i[u]=h,s.add(h)}for(let[u,h]of Object.entries(e)){let p=Gt(h);p!==void 0&&a(u,p)}for(let[u,h]of Object.entries(t??{})){let p=Gt(h);p!==void 0&&(i[u]===void 0?a(u,p):i[u]!==p&&console.warn(`Mismatched location between vertexFn (${r}) output (${i[u]}) and fragmentFn (${n}) input (${p}) for the key "${u}", using the location set on vertex output.`))}let o=0;for(let u of Object.keys(e??{}))if(!(St(e[u])||i[u]!==void 0)){for(;s.has(o);)o++;a(u,o)}return i}function mw(e){if(e.includes(0))throw new Error("Size and workgroupSize cannot contain zeroes.");return re(e[0]??1,e[1]??1,e[2]??1)}var yw=[re(1,1,1),re(256,1,1),re(16,16,1),re(8,8,4)],gw=class hl{#e;#t;#r;#n;#i;constructor(t,r,n,i){this.#e=t,this.#t=r,this.#r=n,this.#n=i,this.#i=re()}with(t){return new hl(this.#e,this.#t.with(t),this.#r,this.#n)}dispatchThreads(...t){let r=mw(t),n=ah(ae(r).div(ae(this.#n)));mh(r,this.#i)||(this.#i=r,this.#r.write(r)),this.#t.dispatchWorkgroups(n.x,n.y,n.z)}get pipeline(){return this.#t}get sizeUniform(){return this.#r}},ww=class ks{constructor(t,r){this._getRoot=t,this._slotBindings=r}with(t,r){return new ks(this._getRoot,[...this._slotBindings,[Ii(t)?t.slot:t,r]])}withCompute(t){return new xw(this._getRoot(),this._slotBindings,t)}createGuardedComputePipeline(t){let r=this._getRoot();if(t.length>=4)throw new Error("Guarded compute callback only supports up to three dimensions.");let n=yw[t.length],i=O([b,b,b])(t),s=r.createUniform(re),a=xh({workgroupSize:n,in:{id:zu.globalInvocationId}})`{
  if (any(in.id >= sizeUniform)) {
    return;
  }
  wrappedCallback(in.id.x, in.id.y, in.id.z);
}`.$uses({sizeUniform:s,wrappedCallback:i}),o=this.withCompute(a).createPipeline();return new gw(r,o,s,n)}withVertex(t,r){return new vw({branch:this._getRoot(),primitiveState:void 0,depthStencilState:void 0,slotBindings:this._slotBindings,vertexFn:t,vertexAttribs:r??{},multisampleState:void 0})}pipe(t){let r=t(new Ih([]));return new ks(this._getRoot,[...this._slotBindings,...r.bindings])}},xw=class{constructor(e,t,r){this._root=e,this._slotBindings=t,this._entryFn=r}createPipeline(){return iw(this._root,this._slotBindings,this._entryFn)}},vw=class ii{constructor(t){this._options=t}withFragment(t,r,n){return lt(typeof t!="string"),lt(r===void 0||typeof r!="string"),new $w({...this._options,fragmentFn:t,targets:r??{}})}withPrimitive(t){return new ii({...this._options,primitiveState:t})}withDepthStencil(t){return new ii({...this._options,depthStencilState:t})}withMultisample(t){return new ii({...this._options,multisampleState:t})}createPipeline(){return ul({...this._options,fragmentFn:null,targets:null})}},$w=class si{constructor(t){this._options=t}withPrimitive(t){return new si({...this._options,primitiveState:t})}withDepthStencil(t){return new si({...this._options,depthStencilState:t})}withMultisample(t){return new si({...this._options,multisampleState:t})}createPipeline(){return ul(this._options)}},ll=class extends ww{constructor(t,r,n,i,s){super(()=>this,[]),this.device=t,this.nameRegistrySetting=r,this._ownDevice=n,this.shaderGenerator=s,this["~unstable"]=this,this[l]={logOptions:i}}"~unstable";_unwrappedBindGroupLayouts=new mo(t=>t.unwrap(this));_unwrappedBindGroups=new mo(t=>t.unwrap(this));[l];get enabledFeatures(){return new Set(this.device.features)}createBuffer(t,r){return Qn(this,t,r)}createUniform(t,r){let n=Qn(this,t,r).$usage("uniform");return new es("uniform",n)}createMutable(t,r){let n=Qn(this,t,r).$usage("storage");return new es("mutable",n)}createReadonly(t,r){let n=Qn(this,t,r).$usage("storage");return new es("readonly",n)}createQuerySet(t,r,n){return Kg(this,t,r,n)}createBindGroup(t,r){return new Lh(t,r)}destroy(){gg(this.device),this._ownDevice&&this.device.destroy()}createTexture(t){return $g(t,this)}createSampler(t){return ug(t,this)}createComparisonSampler(t){return hg(t,this)}unwrap(t){if(tl(t))return t[l].rawPipeline;if(rl(t))return t[l].core.unwrap().pipeline;if(jh(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(wi(t))return this._unwrappedBindGroups.getOrMake(t);if(yn(t))return t.buffer;if(xn(t))return t[l].unwrap();if(vn(t)){if(!t[l].unwrap)throw new Error("Cannot unwrap laid-out texture view as it has no underlying resource.");return t[l].unwrap()}if(ol(t))return t.vertexLayout;if(Uh(t)||Ph(t)){if(t[l].unwrap)return t[l].unwrap();throw new Error("Cannot unwrap laid-out sampler.")}if(xa(t))return t.querySet;throw new Error(`Unknown resource type: ${t}`)}beginRenderPass(t,r){let n=this.device.createCommandEncoder(),i=n.beginRenderPass(t),s=new Map,a=new Map,o,u=()=>{if(!o)throw new Error("Cannot draw without a call to pass.setPipeline");let{core:h,priors:p}=o[l],f=h.unwrap();i.setPipeline(f.pipeline);let m=new Set(f.usedBindGroupLayouts);f.usedBindGroupLayouts.forEach(($,T)=>{if(f.catchall&&T===f.catchall[0])i.setBindGroup(T,this.unwrap(f.catchall[1])),m.delete($);else{let k=p.bindGroupLayoutMap?.get($)??s.get($);k!==void 0&&(m.delete($),wi(k)?i.setBindGroup(T,this.unwrap(k)):i.setBindGroup(T,k))}});let g=new Set;if(h.usedVertexLayouts.forEach(($,T)=>{let k=p.vertexLayoutMap?.get($),M=k?{buffer:k,offset:void 0,size:void 0}:a.get($);!M||!M.buffer?g.add($):yn(M.buffer)?i.setVertexBuffer(T,this.unwrap(M.buffer),M.offset,M.size):i.setVertexBuffer(T,M.buffer,M.offset,M.size)}),m.size>0)throw new Os(m);if(g.size>0)throw new Ho(g)};r({setViewport(...h){i.setViewport(...h)},setScissorRect(...h){i.setScissorRect(...h)},setBlendConstant(...h){i.setBlendConstant(...h)},setStencilReference(...h){i.setStencilReference(...h)},beginOcclusionQuery(...h){i.beginOcclusionQuery(...h)},endOcclusionQuery(...h){i.endOcclusionQuery(...h)},executeBundles(...h){i.executeBundles(...h)},setPipeline(h){o=h},setIndexBuffer:(h,p,f,m)=>{yn(h)?i.setIndexBuffer(this.unwrap(h),p,f,m):i.setIndexBuffer(h,p,f,m)},setVertexBuffer(h,p,f,m){a.set(h,{buffer:p,offset:f,size:m})},setBindGroup(h,p){s.set(h,p)},draw(h,p,f,m){u(),i.draw(h,p,f,m)},drawIndexed(...h){u(),i.drawIndexed(...h)},drawIndirect(...h){u(),i.drawIndirect(...h)},drawIndexedIndirect(...h){u(),i.drawIndexedIndirect(...h)}}),i.end(),this.device.queue.submit([n.finish()])}flush(){console.warn("flush() has been deprecated, and has no effect.")}};async function bw(e){let{adapter:t,device:r,unstable_names:n="strict",unstable_logOptions:i}=e??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let s=await navigator.gpu.requestAdapter(t);if(!s)throw new Error("Could not find a compatible GPU");let a=[];for(let u of r?.requiredFeatures??[]){if(!s.features.has(u))throw new Error(`Requested feature "${u}" is not supported by the adapter.`);a.push(u)}for(let u of r?.optionalFeatures??[])s.features.has(u)?a.push(u):console.warn(`Optional feature "${u}" is not supported by the adapter.`);let o=await s.requestDevice({...r,requiredFeatures:a});return new ll(o,n,!0,i??{},e?.shaderGenerator)}function _w(e){let{device:t,unstable_names:r="strict",unstable_logOptions:n}=e??{};return new ll(t,r,!1,n??{},e?.shaderGenerator)}function Tw(e,t){return new zw(e,t)}var zw=class{constructor(e,t=void 0){this.schema=e,this.defaultValue=t,this.slot=xi(t),this[ie]=this.slot}[l]=!0;[ie];resourceType="accessor";slot;get[F](){return new Proxy({[l]:!0,[ke]:this.#e(),[z]:e=>e.resolve(this),toString:()=>`accessor:${v(this)??"<unnamed>"}.$`},De)}#e(){let e=Ve(),t=Gi(e.unwrap(this.slot));if(vh(t))return t[l].gpuImpl();let r=Si(t);if(r)return r;e.pushMode(new zn);try{let n=Rt(this.schema,t);return y(n,this.schema,"constant")}finally{e.popMode("normal")}}$name(e){return this.slot.$name(e),this}toString(){return`accessor:${v(this)??"<unnamed>"}`}get value(){if(Ke())return this[F];throw new Error("`tgpu.accessor` relies on GPU resources and cannot be accessed outside of a compute dispatch or draw call")}get $(){return this.value}[z](e){let t=this.#e();return y(e.resolve(t.value,t.dataType).value,t.dataType,t.origin)}};function Iw(e){return Ew(e)}function Sw([e,t]){return`${v(e)??"<unnamed>"}=${t}`}function Ew(e){if(Ve())throw new Error("Cannot create tgpu.derived objects at the resolution stage.");return{[l]:!0,resourceType:"derived","~compute":e,get[F](){let t=Ve();if(!t)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return Gi(t.unwrap(this))},get value(){return this[F]},get $(){return this.value},with(t,r){return cl(this,[[t,r]])},toString(){return"derived"}}}function cl(e,t){return{[l]:!0,resourceType:"derived","~compute"(){throw new Error("'~compute' should never be read on bound derived items.")},[er]:{inner:e,pairs:t},get[F](){let r=Ve();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return Gi(r.unwrap(this))},get value(){return this[F]},get $(){return this.value},with(r,n){return cl(e,[...t,[r,n]])},toString(){return`derived[${t.map(Sw).join(", ")}]`}}}var kw={fn:O,bindGroupLayout:Fh,vertexLayout:yo,slot:xi,init:bw,initFromDevice:_w,resolve:Xg,resolveWithContext:Ts,privateVar:vi,workgroupVar:lo,const:xs,"~unstable":{fn:O,fragmentFn:Ay,vertexFn:Up,computeFn:xh,comptime:Lt,vertexLayout:yo,namespace:Yr,derived:Iw,slot:xi,accessor:Tw,privateVar:vi,workgroupVar:lo,const:xs,declare:Sy,rawCodeSnippet:Py,simulate:Jg}},pl=kw,Mw=Lt(((e,t)=>t===void 0?r=>go(e,r):go(e,t))).$name("disarrayOf");function go(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Disarray schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>Rt(e,n?.[s]))};if(Object.setPrototypeOf(r,Uw),r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create disarray schema with invalid element count: ${t}.`);return r.elementCount=t,r}var Uw={[l]:!0,type:"disarray",toString(){return`disarrayOf(${this.elementType}, ${this.elementCount})`}};function Pw(e){let t=r=>Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Rt(i,r?.[n])]));return Object.setPrototypeOf(t,Vw),t.propTypes=e,t}var Vw={[l]:!0,type:"unstruct",$name(e){return L(this,e),this},toString(){return`unstruct:${v(this)??"<unnamed>"}`}};function Er(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if(fe(e)&&fe(t)||Ze(e)&&Ze(t)){let r=e.propTypes,n=t.propTypes,i=Object.keys(r),s=Object.keys(n);if(i.length!==s.length)return!1;for(let a=0;a<i.length;a++){let o=i[a],u=s[a];if(o!==u||!o||!u||!Er(r[o],n[u]))return!1}return!0}if(Te(e)&&Te(t)||zt(e)&&zt(t))return e.elementCount===t.elementCount&&Er(e.elementType,t.elementType);if(Ye(e)&&Ye(t))return e.addressSpace===t.addressSpace&&e.access===t.access&&Er(e.inner,t.inner);if(hi(e)&&hi(t))return Er(e.inner,t.inner);if(Xe(e)&&Xe(t)||Qe(e)&&Qe(t)){if(!Er(e.inner,t.inner)||e.attribs.length!==t.attribs.length)return!1;let r=s=>{let a=s;return`${a.type}(${(a.params??[]).join(",")})`},n=e.attribs.map(r),i=t.attribs.map(r);for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1}return!0}function lr(e,t){let r=e.prototype,n=ms[t][l].jsImpl;r[t]=function(i){return n(this,i)}}lr(sr,"add");lr(sr,"sub");lr(sr,"mul");lr(sr,"div");lr(Wr,"add");lr(Wr,"sub");lr(Wr,"mul");const Aw=Object.freeze(Object.defineProperty({__proto__:null,Void:te,align:dp,alignmentOf:op,arrayOf:wn,atomic:qu,bool:G,builtin:zu,comparisonSampler:pa,deepEqual:Er,disarrayOf:Mw,f16:se,f32:w,float16:Gc,float16x2:Lc,float16x4:Rc,float32:Dc,float32x2:Nc,float32x3:Wc,float32x4:qc,formatToWGSLType:It,i32:B,interpolate:mp,invariant:yp,isAlignAttrib:Ps,isAtomic:hi,isBuiltin:St,isBuiltinAttrib:As,isData:Dr,isDecorated:Xe,isDisarray:zt,isInterpolateAttrib:Ml,isLocationAttrib:Bo,isLooseData:Rr,isLooseDecorated:Qe,isPackedData:bu,isPtr:Ye,isSizeAttrib:Vs,isUnstruct:Ze,isWgslArray:Te,isWgslData:Nt,isWgslStruct:fe,location:mi,mat2x2f:kt,mat3x3f:Mt,mat4x4f:H,matToArray:Gp,packedFormats:na,ptrFn:Fs,ptrHandle:ql,ptrPrivate:Rl,ptrStorage:Nl,ptrUniform:Wl,ptrWorkgroup:Dl,ref:Kl,sampler:ca,sint16:Uc,sint16x2:Pc,sint16x4:Vc,sint32:Qc,sint32x2:Jc,sint32x3:Kc,sint32x4:ep,sint8:xc,sint8x2:vc,sint8x4:$c,size:fp,sizeOf:pp,snorm16:Bc,snorm16x2:Fc,snorm16x4:jc,snorm8:zc,snorm8x2:Ic,snorm8x4:Sc,struct:ki,texture1d:Cu,texture2d:ua,texture2dArray:Bu,texture3d:Gu,textureCube:Fu,textureCubeArray:ju,textureDepth2d:ed,textureDepth2dArray:rd,textureDepthCube:nd,textureDepthCubeArray:id,textureDepthMultisampled2d:td,textureExternal:Nu,textureMultisampled2d:Ou,textureStorage1d:Lu,textureStorage2d:ha,textureStorage2dArray:Ru,textureStorage3d:Du,u16:oc,u32:b,uint16:Ec,uint16x2:kc,uint16x4:Mc,uint32:Hc,uint32x2:Yc,uint32x3:Xc,uint32x4:Zc,uint8:yc,uint8x2:gc,uint8x4:wc,unorm10_10_10_2:tp,unorm16:Ac,unorm16x2:Cc,unorm16x4:Oc,unorm8:bc,unorm8x2:_c,unorm8x4:Tc,unorm8x4_bgra:rp,unstruct:Pw,vec2b:ar,vec2f:D,vec2h:dt,vec2i:ee,vec2u:Ee,vec3b:or,vec3f:ae,vec3h:ft,vec3i:Ae,vec3u:re,vec4b:ur,vec4f:I,vec4h:mt,vec4i:ce,vec4u:ge},Symbol.toStringTag,{value:"Module"}));var Cw=d({name:"discard",normalImpl:"`discard` relies on GPU resources and cannot be executed outside of a draw call",signature:{argTypes:[],returnType:te},codegenImpl:()=>"discard;"}),Bn=Vn[l].jsImpl,Ow=Ui[l].jsImpl,Bw=Ui[l].gpuImpl,Fw=Pi[l].jsImpl,jw=Pi[l].gpuImpl,Gw=Vi[l].jsImpl,Lw=Vi[l].gpuImpl,Rw=Ai[l].jsImpl,Dw=Ai[l].gpuImpl,Nw=Ci[l].jsImpl,Ww=Ci[l].gpuImpl,qw=d({name:"translate4",normalImpl:(e,t)=>Bn(Ow(t),e),signature:{argTypes:[H,ae],returnType:H},codegenImpl:(e,t)=>c`(${Bw(t)} * ${e})`}),Hw=d({name:"scale4",normalImpl:(e,t)=>Bn(Fw(t),e),signature:{argTypes:[H,ae],returnType:H},codegenImpl:(e,t)=>c`(${jw(t)} * ${e})`}),va={argTypes:[H,w],returnType:H},Yw=d({name:"rotateX4",normalImpl:(e,t)=>Bn(Gw(t),e),signature:va,codegenImpl:(e,t)=>c`(${Lw(t)} * ${e})`}),Xw=d({name:"rotateY4",normalImpl:(e,t)=>Bn(Rw(t),e),signature:va,codegenImpl:(e,t)=>c`(${Dw(t)} * ${e})`}),Zw=d({name:"rotateZ4",normalImpl:(e,t)=>Bn(Nw(t),e),signature:va,codegenImpl:(e,t)=>c`(${Ww(t)} * ${e})`}),Qw=d({name:"workgroupBarrier",normalImpl:"workgroupBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:te},codegenImpl:()=>"workgroupBarrier()"}),Jw=d({name:"storageBarrier",normalImpl:"storageBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:te},codegenImpl:()=>"storageBarrier()"}),Kw=d({name:"textureBarrier",normalImpl:"textureBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:te},codegenImpl:()=>"textureBarrier()"}),Pt="Atomic operations are not supported outside of CODEGEN mode.",ex=d({name:"atomicLoad",normalImpl:Pt,signature:e=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Dt(e)}`);return{argTypes:[e],returnType:e.inner}},codegenImpl:e=>c`atomicLoad(&${e})`}),tx=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Dt(e)}`);return{argTypes:[e,e.inner.type==="u32"?b:B],returnType:te}},cr=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Dt(e)}`);let r=e.inner.type==="u32"?b:B;return{argTypes:[e,r],returnType:r}},rx=d({name:"atomicStore",normalImpl:Pt,signature:tx,codegenImpl:(e,t)=>c`atomicStore(&${e}, ${t})`}),nx=d({name:"atomicAdd",normalImpl:Pt,signature:cr,codegenImpl:(e,t)=>c`atomicAdd(&${e}, ${t})`}),ix=d({name:"atomicSub",normalImpl:Pt,signature:cr,codegenImpl:(e,t)=>c`atomicSub(&${e}, ${t})`}),sx=d({name:"atomicMax",normalImpl:Pt,signature:cr,codegenImpl:(e,t)=>c`atomicMax(&${e}, ${t})`}),ax=d({name:"atomicMin",normalImpl:Pt,signature:cr,codegenImpl:(e,t)=>c`atomicMin(&${e}, ${t})`}),ox=d({name:"atomicAnd",normalImpl:Pt,signature:cr,codegenImpl:(e,t)=>c`atomicAnd(&${e}, ${t})`}),ux=d({name:"atomicOr",normalImpl:Pt,signature:cr,codegenImpl:(e,t)=>c`atomicOr(&${e}, ${t})`}),hx=d({name:"atomicXor",normalImpl:Pt,signature:cr,codegenImpl:(e,t)=>c`atomicXor(&${e}, ${t})`}),Vt="Derivative builtins are not allowed on the CPU",lx=d({name:"dpdx",normalImpl:Vt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdx(${e})`}),cx=d({name:"dpdxCoarse",normalImpl:Vt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxCoarse(${e})`}),px=d({name:"dpdxFine",normalImpl:Vt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxFine(${e})`}),dx=d({name:"dpdy",normalImpl:Vt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdy(${e})`}),fx=d({name:"dpdyCoarse",normalImpl:Vt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyCoarse(${e})`}),mx=d({name:"dpdyFine",normalImpl:Vt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyFine(${e})`}),yx=d({name:"fwidth",normalImpl:Vt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidth(${e})`}),gx=d({name:"fwidthCoarse",normalImpl:Vt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthCoarse(${e})`}),wx=d({name:"fwidthFine",normalImpl:Vt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthFine(${e})`}),wo=e=>Ye(e)&&Te(e.inner)?e.inner.elementCount:0,xx=d({name:"arrayLength",signature:e=>{let t=Ye(e)?e:Fs(e);return{argTypes:[t],returnType:wo(t)>0?In:b}},normalImpl:e=>iu(e)?e.$.length:e.length,codegenImpl(e){let t=wo(e.dataType);return t>0?String(t):c`arrayLength(${e})`}});function vx(e,t,r,n,i){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var $x=d({name:"textureSample",normalImpl:vx,codegenImpl:(...e)=>c`textureSample(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?w:I}}});function bx(e,t,r,n,i,s){throw new Error("Texture sampling with bias relies on GPU resources and cannot be executed outside of a draw call")}var _x=d({name:"textureSampleBias",normalImpl:bx,codegenImpl:(...e)=>c`textureSampleBias(${e})`,signature:(...e)=>({argTypes:e,returnType:I})});function Tx(e,t,r,n,i,s){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var zx=d({name:"textureSampleLevel",normalImpl:Tx,codegenImpl:(...e)=>c`textureSampleLevel(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?w:I}}});function Ix(e,t,r){throw new Error("`textureLoad` relies on GPU resources and cannot be executed outside of a draw call")}var hn=d({name:"textureLoad",normalImpl:Ix,codegenImpl:(...e)=>c`textureLoad(${e})`,signature:(...e)=>{let t=e[0];if(Wu(t)){let i=t.type.startsWith("texture_depth"),s=t.sampleType;return{argTypes:e,returnType:i?w:s.type==="f32"?I:s.type==="u32"?ge:ce}}let r=t.format,n=On(r).vectorType;return{argTypes:e,returnType:n}}});function Sx(e,t,r,n){throw new Error("`textureStore` relies on GPU resources and cannot be executed outside of a draw call")}var Ms=d({name:"textureStore",normalImpl:Sx,codegenImpl:(...e)=>c`textureStore(${e})`,signature:(...e)=>({argTypes:e,returnType:te})});function Ex(e,t){throw new Error("`textureDimensions` relies on GPU resources and cannot be executed outside of a draw call")}var kx=d({name:"textureDimensions",normalImpl:Ex,codegenImpl:(...e)=>c`textureDimensions(${e})`,signature:(...e)=>{let t=e[0].dimension;return t==="1d"?{argTypes:e,returnType:b}:t==="3d"?{argTypes:e,returnType:re}:{argTypes:e,returnType:Ee}}});function Mx(e,t,r,n,i,s){throw new Error("Texture comparison sampling relies on GPU resources and cannot be executed outside of a draw call")}var Ux=d({name:"textureSampleCompare",normalImpl:Mx,codegenImpl:(...e)=>c`textureSampleCompare(${e})`,signature:(...e)=>({argTypes:e,returnType:w})});function Px(e,t,r){throw new Error("Texture sampling with base clamp to edge is not supported outside of GPU mode.")}var Vx=d({name:"textureSampleBaseClampToEdge",normalImpl:Px,codegenImpl:(...e)=>c`textureSampleBaseClampToEdge(${e})`,signature:(...e)=>({argTypes:e,returnType:I})}),oe="Subgroup operations can only be used in the GPU context.",Ax=d({name:"subgroupAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupAdd(${e})`}),Cx=d({name:"subgroupExclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupExclusiveAdd(${e})`}),Ox=d({name:"subgroupInclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupInclusiveAdd(${e})`}),Bx=d({name:"subgroupAll",signature:{argTypes:[G],returnType:G},normalImpl:oe,codegenImpl:e=>c`subgroupAll(${e})`}),Fx=d({name:"subgroupAnd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupAnd(${e})`}),jx=d({name:"subgroupAny",signature:{argTypes:[G],returnType:G},normalImpl:oe,codegenImpl:e=>c`subgroupAny(${e})`}),Gx=d({name:"subgroupBallot",signature:{argTypes:[G],returnType:ge},normalImpl:oe,codegenImpl:e=>c`subgroupBallot(${e})`}),Lx=d({name:"subgroupBroadcast",signature:(...e)=>{let t=me([e[1]],[B,b]);if(!t)throw new Error(`subgroupBroadcast's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:oe,codegenImpl:(e,t)=>c`subgroupBroadcast(${e}, ${t})`}),Rx=d({name:"subgroupBroadcastFirst",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupBroadcastFirst(${e})`}),Dx=d({name:"subgroupElect",signature:{argTypes:[],returnType:G},normalImpl:oe,codegenImpl:()=>c`subgroupElect()`}),Nx=d({name:"subgroupMax",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupMax(${e})`}),Wx=d({name:"subgroupMin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupMin(${e})`}),qx=d({name:"subgroupMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupMul(${e})`}),Hx=d({name:"subgroupExclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupExclusiveMul(${e})`}),Yx=d({name:"subgroupInclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupInclusiveMul(${e})`}),Xx=d({name:"subgroupOr",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupOr(${e})`}),Zx=d({name:"subgroupShuffle",signature:(...e)=>{let t=me([e[1]],[B,b]);if(!t)throw new Error(`subgroupShuffle's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:oe,codegenImpl:(e,t)=>c`subgroupShuffle(${e}, ${t})`}),Qx=d({name:"subgroupShuffleDown",signature:(...e)=>{let t=me([e[1]],[b]);if(!t)throw new Error(`subgroupShuffleDown's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:oe,codegenImpl:(e,t)=>c`subgroupShuffleDown(${e}, ${t})`}),Jx=d({name:"subgroupShuffleUp",signature:(...e)=>{let t=me([e[1]],[b]);if(!t)throw new Error(`subgroupShuffleUp's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:oe,codegenImpl:(e,t)=>c`subgroupShuffleUp(${e}, ${t})`}),Kx=d({name:"subgroupShuffleXor",signature:(...e)=>{let t=me([e[1]],[b]);if(!t)throw new Error(`subgroupShuffleXor's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:oe,codegenImpl:(e,t)=>c`subgroupShuffleXor(${e}, ${t})`}),ev=d({name:"subgroupXor",signature:e=>({argTypes:[e],returnType:e}),normalImpl:oe,codegenImpl:e=>c`subgroupXor(${e})`}),tv=Lt(e=>{let t=Ve();if(!t)throw new Error("Functions using `extensionEnabled` cannot be called directly. Either generate WGSL from them, or use tgpu['~unstable'].simulate(...)");if(typeof e!="string"||!ga.includes(e))throw new Error(`extensionEnabled has to be called with a string literal representing a valid WGSL extension name. Got: '${e}'`);return(t.enableExtensions??[]).includes(e)});const rv=Object.freeze(Object.defineProperty({__proto__:null,abs:ff,acos:yf,acosh:wf,add:aa,all:ay,allEq:mh,and:sy,any:oy,arrayLength:xx,asin:vf,asinh:bf,atan:ys,atan2:Sf,atanh:zf,atomicAdd:nx,atomicAnd:ox,atomicLoad:ex,atomicMax:sx,atomicMin:ax,atomicOr:ux,atomicStore:rx,atomicSub:ix,atomicXor:hx,bitcastU32toF32:ph,bitcastU32toI32:dh,ceil:ah,clamp:sn,cos:an,cosh:Pf,countLeadingZeros:Vf,countOneBits:Af,countTrailingZeros:Cf,cross:Of,degrees:Ff,determinant:jf,discard:Cw,distance:Lf,div:oa,dot:oh,dot4I8Packed:Df,dot4U8Packed:Rf,dpdx:lx,dpdxCoarse:cx,dpdxFine:px,dpdy:dx,dpdyCoarse:fx,dpdyFine:mx,eq:Qm,exp:Wf,exp2:Hf,extensionEnabled:tv,extractBits:Yf,faceForward:Xf,firstLeadingBit:Zf,firstTrailingBit:Qf,floor:gs,fma:em,fract:rm,frexp:im,fwidth:yx,fwidthCoarse:gx,fwidthFine:wx,ge:ry,gt:ty,identity2:ku,identity3:Mu,identity4:Uu,insertBits:sm,inverseSqrt:om,isCloseTo:uy,ldexp:um,le:ey,length:uh,log:cm,log2:dm,lt:Km,max:hh,min:ym,mix:ei,mod:Jp,modf:xm,mul:Vn,ne:Jm,neg:Au,normalize:vm,not:ny,or:iy,pack2x16float:Ym,pack4x8unorm:Zm,pow:lh,quantizeToF16:bm,radians:Tm,reflect:zm,refract:Im,reverseBits:Sm,rotateX4:Yw,rotateY4:Xw,rotateZ4:Zw,rotationX4:Vi,rotationY4:Ai,rotationZ4:Ci,round:km,saturate:Um,scale4:Hw,scaling4:Pi,select:ly,sign:Vm,sin:on,sinh:Om,smoothstep:Fm,sqrt:ch,step:Lm,storageBarrier:Jw,sub:qr,subgroupAdd:Ax,subgroupAll:Bx,subgroupAnd:Fx,subgroupAny:jx,subgroupBallot:Gx,subgroupBroadcast:Lx,subgroupBroadcastFirst:Rx,subgroupElect:Dx,subgroupExclusiveAdd:Cx,subgroupExclusiveMul:Hx,subgroupInclusiveAdd:Ox,subgroupInclusiveMul:Yx,subgroupMax:Nx,subgroupMin:Wx,subgroupMul:qx,subgroupOr:Xx,subgroupShuffle:Zx,subgroupShuffleDown:Qx,subgroupShuffleUp:Jx,subgroupShuffleXor:Kx,subgroupXor:ev,tan:Dm,tanh:Wm,textureBarrier:Kw,textureDimensions:kx,textureLoad:hn,textureSample:$x,textureSampleBaseClampToEdge:Vx,textureSampleBias:_x,textureSampleCompare:Ux,textureSampleLevel:zx,textureStore:Ms,translate4:qw,translation4:Ui,transpose:qm,trunc:Hm,unpack2x16float:fh,unpack4x8unorm:Xm,workgroupBarrier:Qw},Symbol.toStringTag,{value:"Module"})),nv={kind:"rectilinear"};function iv(e){return e.kind==="rectilinear"&&e.mode==="manual"}const dl=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(ki({fx:w,fy:w,cx:w,cy:w,alpha:w,k1:w,k2:w,k3:w,k4:w,newFx:w,newFy:w,newCx:w,newCy:w,outputWidth:w,outputHeight:w,inputWidth:w,inputHeight:w,projection:w,_pad1:w,_pad2:w}),"FisheyeUniforms"),wt=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(pl.bindGroupLayout({inputTexture:{texture:ua()},outputTexture:{storageTexture:ha("rgba8unorm")},uniforms:{uniform:dl}}),"fisheyeLayout");class sv{config;root=null;uniformBuffer=null;inputTexture=null;outputTexture=null;bindGroup=null;pipeline=null;readbackBuffers=null;readbackIndex=0;readbackHasData=[!1,!1];readbackBytesPerRow=0;readbackActualBytesPerRow=0;pixelBuffer=null;inputTextureSize=[0,0];outputTextureSize=[0,0];uniformInputWidth=0;uniformInputHeight=0;cachedNewCameraMatrix=null;constructor(t={}){this.config=this.applyDefaults(t)}applyDefaults(t){if("D"in t&&"size"in t){const M=t;return{K:M.K,D:M.D,size:M.size,balance:Math.max(0,Math.min(1,M.balance)),fovScale:M.fovScale,projection:M.projection}}const r=t,{fx:n,fy:i,cx:s,cy:a,alpha:o,k1:u,k2:h,k3:p,k4:f,width:m,height:g,balance:$,fovScale:T,projection:k}=r;return{K:n!==void 0&&i!==void 0?{fx:n,fy:i,cx:s,cy:a,alpha:o}:void 0,D:{k1:u??0,k2:h??0,k3:p??0,k4:f??0},size:{width:m??300,height:g??150},balance:Math.max(0,Math.min(1,$??0)),fovScale:T??1,projection:k??nv}}undistortPointNormalized(t,r,n,i,s,a){const o=Math.sqrt(t*t+r*r),u=Math.min(Math.max(-Math.PI/2,o),Math.PI/2);if(Math.abs(u)<1e-8)return[t,r];let h=u;for(let f=0;f<20;f++){const m=h*h,g=m*m,$=g*m,T=g*g,k=h*(1+n*m+i*g+s*$+a*T)-u,M=1+3*n*m+5*i*g+7*s*$+9*a*T,he=k/M;if(h=h-he,Math.abs(he)<1e-10)break}const p=Math.tan(h)/u;return[t*p,r*p]}undistortPixelToNormalized(t,r,n,i,s,a){const o=(t-s)/n,u=(r-a)/i;return this.undistortPointNormalized(o,u,this.config.D.k1,this.config.D.k2,this.config.D.k3,this.config.D.k4)}computeNewCameraMatrix(t,r){const n=t,i=r,s=this.config.K,a=s?.fx??t,o=s?.fy??t,u=s?.cx??t/2,h=s?.cy??r/2,p=this.config.balance,f=this.config.fovScale,m=[[n/2,0],[n,i/2],[n/2,i],[0,i/2]].map(([xe,ve])=>this.undistortPixelToNormalized(xe,ve,a,o,u,h));let g=0,$=0;for(const[xe,ve]of m)g+=xe,$+=ve;g/=m.length,$/=m.length;const T=a/o,k=[g,$*T],M=m.map(([xe,ve])=>[xe,ve*T]);let he=Number.MAX_VALUE,Ne=-Number.MAX_VALUE,et=Number.MAX_VALUE,Ie=-Number.MAX_VALUE;for(const[xe,ve]of M)he=Math.min(he,xe),Ne=Math.max(Ne,xe),et=Math.min(et,ve),Ie=Math.max(Ie,ve);const tt=n*.5/(k[0]-he),yt=n*.5/(Ne-k[0]),gt=i*.5*T/(k[1]-et),Wt=i*.5*T/(Ie-k[1]),qi=Math.min(tt,yt,gt,Wt),Hi=Math.max(tt,yt,gt,Wt);let qt=p*qi+(1-p)*Hi;f>0&&(qt*=1/f);const Yi=-k[0]*qt+n*.5,Xi=-k[1]*qt/T+i*.5,jn=this.config.size.width/n,Gn=this.config.size.height/i;return{newFx:qt*jn,newFy:qt/T*Gn,newCx:Yi*jn,newCy:Xi*Gn}}async initialize(){this.root||(this.root=await pl.init(),this.uniformBuffer=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(this.root.createBuffer(dl,this.getUniformData()).$usage("uniform"),"uniformBuffer"),this.pipeline=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(this.root["~unstable"].createGuardedComputePipeline((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=((r,n)=>{"use gpu";const i=wt.$.uniforms,s=i.outputWidth,a=i.outputHeight,o=i.inputWidth,u=i.inputHeight,h=ee(r,n),p=w(h.x),f=w(h.y);if(p>=s||f>=a)return;const m=i.projection>1.5&&i.projection<2.5;let g=w(0),$=w(0),T=!1;if(m)g=p/s*o,$=f/a*u,T=!0;else{let xe=(p-i.newCx)/i.newFx,ve=(f-i.newCy)/i.newFy,Xr=!0;if(i.projection>.5&&i.projection<1.5){const Dn=(p/s-.5)*Math.PI*2,Zr=(f/a-.5)*Math.PI,Qr=an(Zr),pr=an(Dn)*Qr;Xr=pr>.001,Xr?(xe=on(Dn)*Qr/pr,ve=on(Zr)/pr):(xe=0,ve=0)}if(i.projection>2.5){const Dn=s/(Math.PI*2),Zr=(p/s-.5)*Math.PI*2,Qr=ys((f-a*.5)/Dn),pr=an(Qr),Il=on(Zr)*pr,Sl=on(Qr),Qi=an(Zr)*pr;Xr=Qi>.001,Xr?(xe=Il/Qi,ve=Sl/Qi):(xe=0,ve=0)}const Ma=ch(xe*xe+ve*ve),Zi=ys(Ma),Ln=Zi*Zi,Rn=Ln*Ln,$l=Rn*Ln,bl=Rn*Rn,_l=Zi*(1+i.k1*Ln+i.k2*Rn+i.k3*$l+i.k4*bl),Tl=hh(Ma,1e-8),Ua=_l/Tl,zl=xe*Ua,Pa=ve*Ua;g=i.fx*(zl+i.alpha*Pa)+i.cx,$=i.fy*Pa+i.cy,T=Xr&&g>=0&&g<=o-1&&$>=0&&$<=u-1}if(!T){Ms(wt.$.outputTexture,h,I(0,0,0,1));return}const k=gs(g),M=gs($),he=g-k,Ne=$-M,et=o-1,Ie=u-1,tt=B(sn(k,0,et)),yt=B(sn(M,0,Ie)),gt=B(sn(k+1,0,et)),Wt=B(sn(M+1,0,Ie)),qi=hn(wt.$.inputTexture,ee(tt,yt),0),Hi=hn(wt.$.inputTexture,ee(gt,yt),0),qt=hn(wt.$.inputTexture,ee(tt,Wt),0),Yi=hn(wt.$.inputTexture,ee(gt,Wt),0),Xi=ei(qi,Hi,he),jn=ei(qt,Yi,he),Gn=ei(Xi,jn,Ne);Ms(wt.$.outputTexture,h,Gn)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"x"},{type:"i",name:"y"}],body:[0,[[13,"p",[7,[7,"fisheyeLayout","$"],"uniforms"]],[13,"outputW",[7,"p","outputWidth"]],[13,"outputH",[7,"p","outputHeight"]],[13,"inputW",[7,"p","inputWidth"]],[13,"inputH",[7,"p","inputHeight"]],[13,"coord",[6,[7,"d","vec2i"],["x","y"]]],[13,"coordXf",[6,[7,"d","f32"],[[7,"coord","x"]]]],[13,"coordYf",[6,[7,"d","f32"],[[7,"coord","y"]]]],[11,[3,[1,"coordXf",">=","outputW"],"||",[1,"coordYf",">=","outputH"]],[10]],[13,"isOriginal",[3,[1,[7,"p","projection"],">",[5,"1.5"]],"&&",[1,[7,"p","projection"],"<",[5,"2.5"]]]],[12,"u",[6,[7,"d","f32"],[[5,"0"]]]],[12,"v",[6,[7,"d","f32"],[[5,"0"]]]],[12,"inBounds",!1],[11,"isOriginal",[0,[[2,"u","=",[1,[1,"coordXf","/","outputW"],"*","inputW"]],[2,"v","=",[1,[1,"coordYf","/","outputH"],"*","inputH"]],[2,"inBounds","=",!0]]],[0,[[12,"normX",[1,[1,"coordXf","-",[7,"p","newCx"]],"/",[7,"p","newFx"]]],[12,"normY",[1,[1,"coordYf","-",[7,"p","newCy"]],"/",[7,"p","newFy"]]],[12,"validProjection",!0],[13,"isEquirect",[3,[1,[7,"p","projection"],">",[5,"0.5"]],"&&",[1,[7,"p","projection"],"<",[5,"1.5"]]]],[11,"isEquirect",[0,[[13,"lon",[1,[1,[1,[1,"coordXf","/","outputW"],"-",[5,"0.5"]],"*",[7,"Math","PI"]],"*",[5,"2"]]],[13,"lat",[1,[1,[1,"coordYf","/","outputH"],"-",[5,"0.5"]],"*",[7,"Math","PI"]]],[13,"cosLat",[6,[7,"std","cos"],["lat"]]],[13,"dirZ",[1,[6,[7,"std","cos"],["lon"]],"*","cosLat"]],[2,"validProjection","=",[1,"dirZ",">",[5,"0.001"]]],[11,"validProjection",[0,[[2,"normX","=",[1,[1,[6,[7,"std","sin"],["lon"]],"*","cosLat"],"/","dirZ"]],[2,"normY","=",[1,[6,[7,"std","sin"],["lat"]],"/","dirZ"]]]],[0,[[2,"normX","=",[5,"0"]],[2,"normY","=",[5,"0"]]]]]]]],[13,"isCylindrical",[1,[7,"p","projection"],">",[5,"2.5"]]],[11,"isCylindrical",[0,[[13,"fCyl",[1,"outputW","/",[1,[7,"Math","PI"],"*",[5,"2"]]]],[13,"lon",[1,[1,[1,[1,"coordXf","/","outputW"],"-",[5,"0.5"]],"*",[7,"Math","PI"]],"*",[5,"2"]]],[13,"lat",[6,[7,"std","atan"],[[1,[1,"coordYf","-",[1,"outputH","*",[5,"0.5"]]],"/","fCyl"]]]],[13,"cosLat",[6,[7,"std","cos"],["lat"]]],[13,"dirX",[1,[6,[7,"std","sin"],["lon"]],"*","cosLat"]],[13,"dirY",[6,[7,"std","sin"],["lat"]]],[13,"dirZ",[1,[6,[7,"std","cos"],["lon"]],"*","cosLat"]],[2,"validProjection","=",[1,"dirZ",">",[5,"0.001"]]],[11,"validProjection",[0,[[2,"normX","=",[1,"dirX","/","dirZ"]],[2,"normY","=",[1,"dirY","/","dirZ"]]]],[0,[[2,"normX","=",[5,"0"]],[2,"normY","=",[5,"0"]]]]]]]],[13,"r",[6,[7,"std","sqrt"],[[1,[1,"normX","*","normX"],"+",[1,"normY","*","normY"]]]]],[13,"theta",[6,[7,"std","atan"],["r"]]],[13,"theta2",[1,"theta","*","theta"]],[13,"theta4",[1,"theta2","*","theta2"]],[13,"theta6",[1,"theta4","*","theta2"]],[13,"theta8",[1,"theta4","*","theta4"]],[13,"thetaD",[1,"theta","*",[1,[1,[1,[1,[5,"1"],"+",[1,[7,"p","k1"],"*","theta2"]],"+",[1,[7,"p","k2"],"*","theta4"]],"+",[1,[7,"p","k3"],"*","theta6"]],"+",[1,[7,"p","k4"],"*","theta8"]]]],[13,"safeR",[6,[7,"std","max"],["r",[5,"1e-8"]]]],[13,"scale",[1,"thetaD","/","safeR"]],[13,"distortedX",[1,"normX","*","scale"]],[13,"distortedY",[1,"normY","*","scale"]],[2,"u","=",[1,[1,[7,"p","fx"],"*",[1,"distortedX","+",[1,[7,"p","alpha"],"*","distortedY"]]],"+",[7,"p","cx"]]],[2,"v","=",[1,[1,[7,"p","fy"],"*","distortedY"],"+",[7,"p","cy"]]],[2,"inBounds","=",[3,[3,[3,[3,"validProjection","&&",[1,"u",">=",[5,"0"]]],"&&",[1,"u","<=",[1,"inputW","-",[5,"1"]]]],"&&",[1,"v",">=",[5,"0"]]],"&&",[1,"v","<=",[1,"inputH","-",[5,"1"]]]]]]]],[11,[4,"!","inBounds"],[0,[[6,[7,"std","textureStore"],[[7,[7,"fisheyeLayout","$"],"outputTexture"],"coord",[6,[7,"d","vec4f"],[[5,"0"],[5,"0"],[5,"0"],[5,"1"]]]]],[10]]]],[13,"x0",[6,[7,"std","floor"],["u"]]],[13,"y0",[6,[7,"std","floor"],["v"]]],[13,"fx",[1,"u","-","x0"]],[13,"fy",[1,"v","-","y0"]],[13,"maxX",[1,"inputW","-",[5,"1"]]],[13,"maxY",[1,"inputH","-",[5,"1"]]],[13,"ix0",[6,[7,"d","i32"],[[6,[7,"std","clamp"],["x0",[5,"0"],"maxX"]]]]],[13,"iy0",[6,[7,"d","i32"],[[6,[7,"std","clamp"],["y0",[5,"0"],"maxY"]]]]],[13,"ix1",[6,[7,"d","i32"],[[6,[7,"std","clamp"],[[1,"x0","+",[5,"1"]],[5,"0"],"maxX"]]]]],[13,"iy1",[6,[7,"d","i32"],[[6,[7,"std","clamp"],[[1,"y0","+",[5,"1"]],[5,"0"],"maxY"]]]]],[13,"c00",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix0","iy0"]],[5,"0"]]]],[13,"c10",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix1","iy0"]],[5,"0"]]]],[13,"c01",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix0","iy1"]],[5,"0"]]]],[13,"c11",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],[6,[7,"d","vec2i"],["ix1","iy1"]],[5,"0"]]]],[13,"c0",[6,[7,"std","mix"],["c00","c10","fx"]]],[13,"c1",[6,[7,"std","mix"],["c01","c11","fx"]]],[13,"color",[6,[7,"std","mix"],["c0","c1","fy"]]],[6,[7,"std","textureStore"],[[7,[7,"fisheyeLayout","$"],"outputTexture"],"coord","color"]]]],externalNames:["fisheyeLayout","d","Math","std"]},externals:()=>({fisheyeLayout:wt,d:Aw,Math,std:rv})})&&t.f)({})),"pipeline"))}getUniformData(){const{K:t,D:r,size:n,projection:i}=this.config,s=this.uniformInputWidth||n.width,a=this.uniformInputHeight||n.height,o=t?.fx??s,u=t?.fy??s,h=t?.cx??s/2,p=t?.cy??a/2,f=t?.alpha??0;let m;iv(i)?m={newFx:i.newFx*(n.width/s),newFy:i.newFy*(n.height/a),newCx:i.newCx??n.width/2,newCy:i.newCy??n.height/2}:((!this.cachedNewCameraMatrix||this.uniformInputWidth!==s||this.uniformInputHeight!==a)&&(this.cachedNewCameraMatrix=this.computeNewCameraMatrix(s,a)),m=this.cachedNewCameraMatrix);let g=0;switch(i.kind){case"rectilinear":g=0;break;case"equirectangular":g=1;break;case"original":g=2;break;case"cylindrical":g=3;break}return{fx:o,fy:u,cx:h,cy:p,alpha:f,k1:r.k1,k2:r.k2,k3:r.k3,k4:r.k4,newFx:m.newFx,newFy:m.newFy,newCx:m.newCx,newCy:m.newCy,outputWidth:n.width,outputHeight:n.height,inputWidth:s,inputHeight:a,projection:g,_pad1:0,_pad2:0}}updateUniforms(){this.uniformBuffer&&this.uniformBuffer.write(this.getUniformData())}async readbackToVideoFrame(t,r,n){const i=this.readbackBuffers;if(!i)throw new Error("Readback buffer not initialized");const s=this.readbackIndex,a=1-s,o=i[s],u=i[a];if(!o||!u)throw new Error("Readback buffer not initialized");const h=t.createCommandEncoder();h.copyTextureToBuffer({texture:r},{buffer:o,bytesPerRow:this.readbackBytesPerRow},[this.config.size.width,this.config.size.height]),t.queue.submit([h.finish()]),await t.queue.onSubmittedWorkDone(),this.readbackHasData[s]=!0,this.readbackIndex=a;const p=o;await p.mapAsync(GPUMapMode.READ);const f=p.getMappedRange(),m=this.pixelBuffer??new Uint8Array(this.config.size.width*this.config.size.height*4),g=new Uint8Array(f);for(let $=0;$<this.config.size.height;$++){const T=$*this.readbackBytesPerRow,k=$*this.readbackActualBytesPerRow;m.set(g.subarray(T,T+this.readbackActualBytesPerRow),k)}return p.unmap(),new VideoFrame(m,{format:"RGBA",codedWidth:this.config.size.width,codedHeight:this.config.size.height,timestamp:n})}createInputTexture(t,r,n){const i=[r,n];return t["~unstable"].createTexture({size:i,format:"rgba8unorm"}).$usage("sampled","render")}createOutputTexture(t,r,n){const i=[r,n];return t["~unstable"].createTexture({size:i,format:"rgba8unorm"}).$usage("storage")}calculateBytesPerRow(t){const r=t*4;return Math.ceil(r/256)*256}createReadbackBuffer(t,r,n){const i=this.calculateBytesPerRow(r)*n;return t.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}async undistort(t){if(await this.initialize(),!this.root||!this.uniformBuffer)throw new Error("GPU resources not initialized");const r=this.root,n=r.device;(!this.inputTexture||this.inputTextureSize[0]!==t.displayWidth||this.inputTextureSize[1]!==t.displayHeight)&&(this.inputTexture?.destroy(),this.inputTexture=this.createInputTexture(r,t.displayWidth,t.displayHeight),this.inputTextureSize=[t.displayWidth,t.displayHeight],this.bindGroup=null),(!this.outputTexture||this.outputTextureSize[0]!==this.config.size.width||this.outputTextureSize[1]!==this.config.size.height)&&(this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.outputTexture=this.createOutputTexture(r,this.config.size.width,this.config.size.height),this.readbackBytesPerRow=this.calculateBytesPerRow(this.config.size.width),this.readbackActualBytesPerRow=this.config.size.width*4,this.pixelBuffer=new Uint8Array(this.config.size.width*this.config.size.height*4),this.readbackBuffers=[this.createReadbackBuffer(n,this.config.size.width,this.config.size.height),this.createReadbackBuffer(n,this.config.size.width,this.config.size.height)],this.readbackIndex=0,this.readbackHasData=[!1,!1],this.outputTextureSize=[this.config.size.width,this.config.size.height],this.bindGroup=null);const i=this.inputTexture,s=this.outputTexture;if(!i||!s)throw new Error("Textures not initialized");i.write(t),(this.uniformInputWidth!==t.displayWidth||this.uniformInputHeight!==t.displayHeight)&&(this.uniformInputWidth=t.displayWidth,this.uniformInputHeight=t.displayHeight,this.cachedNewCameraMatrix=null),this.updateUniforms(),this.bindGroup||(this.bindGroup=r.createBindGroup(wt,{inputTexture:i,outputTexture:s,uniforms:this.uniformBuffer}));const a=this.bindGroup;if(!this.pipeline||!s)throw new Error("Compute pipeline or output texture not initialized");this.pipeline.with(a).dispatchThreads(this.config.size.width,this.config.size.height);const o=r.unwrap(s);return this.readbackToVideoFrame(n,o,t.timestamp)}updateConfig(t){const r=this.config.size.width,n=this.config.size.height;this.config=this.applyDefaults({...this.config,...t}),this.cachedNewCameraMatrix=null,this.updateUniforms(),(this.config.size.width!==r||this.config.size.height!==n)&&(this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.outputTexture=null,this.readbackBuffers=null,this.readbackIndex=0,this.readbackHasData=[!1,!1],this.outputTextureSize=[0,0],this.readbackBytesPerRow=0,this.readbackActualBytesPerRow=0,this.pixelBuffer=null)}destroy(){this.inputTexture?.destroy(),this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.root?.destroy(),this.inputTexture=null,this.outputTexture=null,this.readbackBuffers=null,this.readbackIndex=0,this.readbackHasData=[!1,!1],this.uniformBuffer=null,this.root=null,this.bindGroup=null,this.pipeline=null,this.readbackBytesPerRow=0,this.readbackActualBytesPerRow=0,this.pixelBuffer=null,this.inputTextureSize=[0,0],this.outputTextureSize=[0,0],this.cachedNewCameraMatrix=null}}const ai=globalThis,$a=ai.ShadowRoot&&(ai.ShadyCSS===void 0||ai.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ba=Symbol(),xo=new WeakMap;let fl=class{constructor(t,r,n){if(this._$cssResult$=!0,n!==ba)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=r}get styleSheet(){let t=this.o;const r=this.t;if($a&&t===void 0){const n=r!==void 0&&r.length===1;n&&(t=xo.get(r)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&xo.set(r,t))}return t}toString(){return this.cssText}};const av=e=>new fl(typeof e=="string"?e:e+"",void 0,ba),_a=(e,...t)=>{const r=e.length===1?e[0]:t.reduce((n,i,s)=>n+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[s+1],e[0]);return new fl(r,e,ba)},ov=(e,t)=>{if($a)e.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet);else for(const r of t){const n=document.createElement("style"),i=ai.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=r.cssText,e.appendChild(n)}},vo=$a?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let r="";for(const n of t.cssRules)r+=n.cssText;return av(r)})(e):e;const{is:uv,defineProperty:hv,getOwnPropertyDescriptor:lv,getOwnPropertyNames:cv,getOwnPropertySymbols:pv,getPrototypeOf:dv}=Object,Di=globalThis,$o=Di.trustedTypes,fv=$o?$o.emptyScript:"",mv=Di.reactiveElementPolyfillSupport,gn=(e,t)=>e,$i={toAttribute(e,t){switch(t){case Boolean:e=e?fv:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=e!==null;break;case Number:r=e===null?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch{r=null}}return r}},Ta=(e,t)=>!uv(e,t),bo={attribute:!0,type:String,converter:$i,reflect:!1,useDefault:!1,hasChanged:Ta};Symbol.metadata??=Symbol("metadata"),Di.litPropertyMetadata??=new WeakMap;let kr=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,r=bo){if(r.state&&(r.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((r=Object.create(r)).wrapped=!0),this.elementProperties.set(t,r),!r.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(t,n,r);i!==void 0&&hv(this.prototype,t,i)}}static getPropertyDescriptor(t,r,n){const{get:i,set:s}=lv(this.prototype,t)??{get(){return this[r]},set(a){this[r]=a}};return{get:i,set(a){const o=i?.call(this);s?.call(this,a),this.requestUpdate(t,o,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??bo}static _$Ei(){if(this.hasOwnProperty(gn("elementProperties")))return;const t=dv(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(gn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(gn("properties"))){const r=this.properties,n=[...cv(r),...pv(r)];for(const i of n)this.createProperty(i,r[i])}const t=this[Symbol.metadata];if(t!==null){const r=litPropertyMetadata.get(t);if(r!==void 0)for(const[n,i]of r)this.elementProperties.set(n,i)}this._$Eh=new Map;for(const[r,n]of this.elementProperties){const i=this._$Eu(r,n);i!==void 0&&this._$Eh.set(i,r)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const r=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const i of n)r.unshift(vo(i))}else t!==void 0&&r.push(vo(t));return r}static _$Eu(t,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,r=this.constructor.elementProperties;for(const n of r.keys())this.hasOwnProperty(n)&&(t.set(n,this[n]),delete this[n]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return ov(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,r,n){this._$AK(t,n)}_$ET(t,r){const n=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,n);if(i!==void 0&&n.reflect===!0){const s=(n.converter?.toAttribute!==void 0?n.converter:$i).toAttribute(r,n.type);this._$Em=t,s==null?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(t,r){const n=this.constructor,i=n._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const s=n.getPropertyOptions(i),a=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:$i;this._$Em=i;const o=a.fromAttribute(r,s.type);this[i]=o??this._$Ej?.get(i)??o,this._$Em=null}}requestUpdate(t,r,n,i=!1,s){if(t!==void 0){const a=this.constructor;if(i===!1&&(s=this[t]),n??=a.getPropertyOptions(t),!((n.hasChanged??Ta)(s,r)||n.useDefault&&n.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(a._$Eu(t,n))))return;this.C(t,r,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,r,{useDefault:n,reflect:i,wrapped:s},a){n&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,a??r??this[t]),s!==!0||a!==void 0)||(this._$AL.has(t)||(this.hasUpdated||n||(r=void 0),this._$AL.set(t,r)),i===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(r){Promise.reject(r)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,s]of this._$Ep)this[i]=s;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[i,s]of n){const{wrapped:a}=s,o=this[i];a!==!0||this._$AL.has(i)||o===void 0||this.C(i,void 0,s,o)}}let t=!1;const r=this._$AL;try{t=this.shouldUpdate(r),t?(this.willUpdate(r),this._$EO?.forEach(n=>n.hostUpdate?.()),this.update(r)):this._$EM()}catch(n){throw t=!1,this._$EM(),n}t&&this._$AE(r)}willUpdate(t){}_$AE(t){this._$EO?.forEach(r=>r.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(r=>this._$ET(r,this[r])),this._$EM()}updated(t){}firstUpdated(t){}};kr.elementStyles=[],kr.shadowRootOptions={mode:"open"},kr[gn("elementProperties")]=new Map,kr[gn("finalized")]=new Map,mv?.({ReactiveElement:kr}),(Di.reactiveElementVersions??=[]).push("2.1.2");const za=globalThis,_o=e=>e,bi=za.trustedTypes,To=bi?bi.createPolicy("lit-html",{createHTML:e=>e}):void 0,ml="$lit$",Ot=`lit$${Math.random().toFixed(9).slice(2)}$`,yl="?"+Ot,yv=`<${yl}>`,nr=document,$n=()=>nr.createComment(""),bn=e=>e===null||typeof e!="object"&&typeof e!="function",Ia=Array.isArray,gv=e=>Ia(e)||typeof e?.[Symbol.iterator]=="function",ts=`[ 	
\f\r]`,rn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,zo=/-->/g,Io=/>/g,Zt=RegExp(`>|${ts}(?:([^\\s"'>=/]+)(${ts}*=${ts}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),So=/'/g,Eo=/"/g,gl=/^(?:script|style|textarea|title)$/i,wv=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),st=wv(1),jr=Symbol.for("lit-noChange"),de=Symbol.for("lit-nothing"),ko=new WeakMap,tr=nr.createTreeWalker(nr,129);function wl(e,t){if(!Ia(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return To!==void 0?To.createHTML(t):t}const xv=(e,t)=>{const r=e.length-1,n=[];let i,s=t===2?"<svg>":t===3?"<math>":"",a=rn;for(let o=0;o<r;o++){const u=e[o];let h,p,f=-1,m=0;for(;m<u.length&&(a.lastIndex=m,p=a.exec(u),p!==null);)m=a.lastIndex,a===rn?p[1]==="!--"?a=zo:p[1]!==void 0?a=Io:p[2]!==void 0?(gl.test(p[2])&&(i=RegExp("</"+p[2],"g")),a=Zt):p[3]!==void 0&&(a=Zt):a===Zt?p[0]===">"?(a=i??rn,f=-1):p[1]===void 0?f=-2:(f=a.lastIndex-p[2].length,h=p[1],a=p[3]===void 0?Zt:p[3]==='"'?Eo:So):a===Eo||a===So?a=Zt:a===zo||a===Io?a=rn:(a=Zt,i=void 0);const g=a===Zt&&e[o+1].startsWith("/>")?" ":"";s+=a===rn?u+yv:f>=0?(n.push(h),u.slice(0,f)+ml+u.slice(f)+Ot+g):u+Ot+(f===-2?o:g)}return[wl(e,s+(e[r]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),n]};class _n{constructor({strings:t,_$litType$:r},n){let i;this.parts=[];let s=0,a=0;const o=t.length-1,u=this.parts,[h,p]=xv(t,r);if(this.el=_n.createElement(h,n),tr.currentNode=this.el.content,r===2||r===3){const f=this.el.content.firstChild;f.replaceWith(...f.childNodes)}for(;(i=tr.nextNode())!==null&&u.length<o;){if(i.nodeType===1){if(i.hasAttributes())for(const f of i.getAttributeNames())if(f.endsWith(ml)){const m=p[a++],g=i.getAttribute(f).split(Ot),$=/([.?@])?(.*)/.exec(m);u.push({type:1,index:s,name:$[2],strings:g,ctor:$[1]==="."?$v:$[1]==="?"?bv:$[1]==="@"?_v:Ni}),i.removeAttribute(f)}else f.startsWith(Ot)&&(u.push({type:6,index:s}),i.removeAttribute(f));if(gl.test(i.tagName)){const f=i.textContent.split(Ot),m=f.length-1;if(m>0){i.textContent=bi?bi.emptyScript:"";for(let g=0;g<m;g++)i.append(f[g],$n()),tr.nextNode(),u.push({type:2,index:++s});i.append(f[m],$n())}}}else if(i.nodeType===8)if(i.data===yl)u.push({type:2,index:s});else{let f=-1;for(;(f=i.data.indexOf(Ot,f+1))!==-1;)u.push({type:7,index:s}),f+=Ot.length-1}s++}}static createElement(t,r){const n=nr.createElement("template");return n.innerHTML=t,n}}function Gr(e,t,r=e,n){if(t===jr)return t;let i=n!==void 0?r._$Co?.[n]:r._$Cl;const s=bn(t)?void 0:t._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(e),i._$AT(e,r,n)),n!==void 0?(r._$Co??=[])[n]=i:r._$Cl=i),i!==void 0&&(t=Gr(e,i._$AS(e,t.values),i,n)),t}class vv{constructor(t,r){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:r},parts:n}=this._$AD,i=(t?.creationScope??nr).importNode(r,!0);tr.currentNode=i;let s=tr.nextNode(),a=0,o=0,u=n[0];for(;u!==void 0;){if(a===u.index){let h;u.type===2?h=new Fn(s,s.nextSibling,this,t):u.type===1?h=new u.ctor(s,u.name,u.strings,this,t):u.type===6&&(h=new Tv(s,this,t)),this._$AV.push(h),u=n[++o]}a!==u?.index&&(s=tr.nextNode(),a++)}return tr.currentNode=nr,i}p(t){let r=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(t,n,r),r+=n.strings.length-2):n._$AI(t[r])),r++}}class Fn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,r,n,i){this.type=2,this._$AH=de,this._$AN=void 0,this._$AA=t,this._$AB=r,this._$AM=n,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&t?.nodeType===11&&(t=r.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,r=this){t=Gr(this,t,r),bn(t)?t===de||t==null||t===""?(this._$AH!==de&&this._$AR(),this._$AH=de):t!==this._$AH&&t!==jr&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):gv(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==de&&bn(this._$AH)?this._$AA.nextSibling.data=t:this.T(nr.createTextNode(t)),this._$AH=t}$(t){const{values:r,_$litType$:n}=t,i=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=_n.createElement(wl(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===i)this._$AH.p(r);else{const s=new vv(i,this),a=s.u(this.options);s.p(r),this.T(a),this._$AH=s}}_$AC(t){let r=ko.get(t.strings);return r===void 0&&ko.set(t.strings,r=new _n(t)),r}k(t){Ia(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let n,i=0;for(const s of t)i===r.length?r.push(n=new Fn(this.O($n()),this.O($n()),this,this.options)):n=r[i],n._$AI(s),i++;i<r.length&&(this._$AR(n&&n._$AB.nextSibling,i),r.length=i)}_$AR(t=this._$AA.nextSibling,r){for(this._$AP?.(!1,!0,r);t!==this._$AB;){const n=_o(t).nextSibling;_o(t).remove(),t=n}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class Ni{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,r,n,i,s){this.type=1,this._$AH=de,this._$AN=void 0,this.element=t,this.name=r,this._$AM=i,this.options=s,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=de}_$AI(t,r=this,n,i){const s=this.strings;let a=!1;if(s===void 0)t=Gr(this,t,r,0),a=!bn(t)||t!==this._$AH&&t!==jr,a&&(this._$AH=t);else{const o=t;let u,h;for(t=s[0],u=0;u<s.length-1;u++)h=Gr(this,o[n+u],r,u),h===jr&&(h=this._$AH[u]),a||=!bn(h)||h!==this._$AH[u],h===de?t=de:t!==de&&(t+=(h??"")+s[u+1]),this._$AH[u]=h}a&&!i&&this.j(t)}j(t){t===de?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class $v extends Ni{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===de?void 0:t}}class bv extends Ni{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==de)}}class _v extends Ni{constructor(t,r,n,i,s){super(t,r,n,i,s),this.type=5}_$AI(t,r=this){if((t=Gr(this,t,r,0)??de)===jr)return;const n=this._$AH,i=t===de&&n!==de||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,s=t!==de&&(n===de||i);i&&this.element.removeEventListener(this.name,this,n),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Tv{constructor(t,r,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=r,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){Gr(this,t)}}const zv=za.litHtmlPolyfillSupport;zv?.(_n,Fn),(za.litHtmlVersions??=[]).push("3.3.2");const Iv=(e,t,r)=>{const n=r?.renderBefore??t;let i=n._$litPart$;if(i===void 0){const s=r?.renderBefore??null;n._$litPart$=i=new Fn(t.insertBefore($n(),s),s,void 0,r??{})}return i._$AI(e),i};const Sa=globalThis;class rr extends kr{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Iv(r,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return jr}}rr._$litElement$=!0,rr.finalized=!0,Sa.litElementHydrateSupport?.({LitElement:rr});const Sv=Sa.litElementPolyfillSupport;Sv?.({LitElement:rr});(Sa.litElementVersions??=[]).push("4.2.2");const Ea=e=>(t,r)=>{r!==void 0?r.addInitializer(()=>{customElements.define(e,t)}):customElements.define(e,t)};const Ev={attribute:!0,type:String,converter:$i,reflect:!1,hasChanged:Ta},kv=(e=Ev,t,r)=>{const{kind:n,metadata:i}=r;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),n==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(r.name,e),n==="accessor"){const{name:a}=r;return{set(o){const u=t.get.call(this);t.set.call(this,o),this.requestUpdate(a,u,e,!0,o)},init(o){return o!==void 0&&this.C(a,void 0,e,o),o}}}if(n==="setter"){const{name:a}=r;return function(o){const u=this[a];t.call(this,o),this.requestUpdate(a,u,e,!0,o)}}throw Error("Unsupported decorator location: "+n)};function Wi(e){return(t,r)=>typeof r=="object"?kv(e,t,r):((n,i,s)=>{const a=i.hasOwnProperty(s);return i.constructor.createProperty(s,n),a?Object.getOwnPropertyDescriptor(i,s):void 0})(e,t,r)}function Ce(e){return Wi({...e,state:!0,attribute:!1})}const Mv=(e,t,r)=>(r.configurable=!0,r.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(e,t,r),r);function xl(e,t){return(r,n,i)=>{const s=a=>a.renderRoot?.querySelector(e)??null;return Mv(r,n,{get(){return s(this)}})}}const Uv=_a`
  :host {
    display: block;
    font-family: system-ui, -apple-system, sans-serif;
    color: #e0e0e0;
    background: #1a1a2e;
    min-height: 100vh;
  }

  .container {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  .main {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  .sidebar-container {
    display: flex;
    flex-shrink: 0;
    background: #16213e;
    border-right: 1px solid #0f3460;
  }

  .sidebar-form {
    width: 320px;
    padding: 1.5rem;
    overflow-y: auto;
    overflow-x: hidden;
    transition: width 0.25s ease, padding 0.25s ease, opacity 0.2s ease;
  }

  .sidebar-form.closed {
    width: 0;
    padding: 0;
    min-width: 0;
    opacity: 0;
    overflow: hidden;
    pointer-events: none;
  }

  .sidebar-form .control-group {
    margin-bottom: 1.5rem;
  }

  .sidebar-form .control-group h3 {
    margin: 0 0 0.75rem;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #00d9ff;
  }

  .sidebar-form .control-hint {
    margin: 0 0 0.5rem;
    font-size: 0.7rem;
    color: #666;
    line-height: 1.3;
  }

  .sidebar-form .control-item {
    margin-bottom: 1rem;
  }

  .sidebar-form .control-item label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
    color: #a0a0a0;
  }

  .sidebar-form .control-item label span {
    font-family: monospace;
    color: #00ff88;
  }

  .sidebar-form input[type="range"] {
    width: 100%;
    height: 6px;
    background: #0f3460;
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
  }

  .sidebar-form input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    background: #00d9ff;
    border-radius: 50%;
    cursor: pointer;
  }

  .sidebar-form .sample-thumbnails {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .sidebar-form .sample-thumb {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 0.35rem;
    background: #0f3460;
    border: 2px solid #1a3a5c;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .sidebar-form .sample-thumb:hover {
    border-color: #00d9ff;
    background: #1a3a5c;
  }

  .sidebar-form .sample-thumb.active {
    border-color: #00d9ff;
    background: rgba(0, 217, 255, 0.15);
  }

  .sidebar-form .sample-thumb img {
    width: 100%;
    aspect-ratio: 4/3;
    object-fit: cover;
    border-radius: 4px;
  }

  .sidebar-form .sample-thumb span {
    font-size: 0.65rem;
    color: #8892b0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .sidebar-form .sample-thumb.active span {
    color: #00d9ff;
  }

  .sidebar-form .file-input-wrapper {
    position: relative;
  }

  .sidebar-form .file-input-wrapper input[type="file"] {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
  }

  .sidebar-form .file-input-label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #0f3460, #16213e);
    border: 2px dashed #0f3460;
    border-radius: 8px;
    color: #8892b0;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .sidebar-form .file-input-wrapper:hover .file-input-label {
    border-color: #00d9ff;
    color: #00d9ff;
  }

  .sidebar-form .preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .sidebar-form .preset-btn {
    padding: 0.5rem 0.75rem;
    background: #0f3460;
    border: 1px solid #1a3a5c;
    border-radius: 6px;
    color: #a0a0a0;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .sidebar-form .preset-btn:hover {
    border-color: #00d9ff;
    color: #00d9ff;
  }

  .sidebar-form .preset-btn.active {
    background: #00d9ff;
    border-color: #00d9ff;
    color: #1a1a2e;
  }

  .sidebar-form .btn {
    width: 100%;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #00d9ff, #00ff88);
    border: none;
    border-radius: 8px;
    color: #1a1a2e;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .sidebar-form .btn-secondary {
    background: #0f3460;
    color: #e0e0e0;
  }

  .canvas-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    gap: 1rem;
    overflow: auto;
  }

  .canvas-container {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  .canvas-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .canvas-wrapper h4 {
    margin: 0;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #8892b0;
  }

  canvas {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  #input-canvas {
    max-width: 400px;
    background: #0a0a14;
  }

  #output-canvas {
    max-width: 600px;
    background: #0a0a14;
  }

  .error {
    padding: 1rem;
    background: rgba(255, 82, 82, 0.1);
    border: 1px solid #ff5252;
    border-radius: 8px;
    color: #ff5252;
    font-size: 0.875rem;
  }

  .processing {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #00d9ff;
    font-size: 0.875rem;
  }

  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid #0f3460;
    border-top-color: #00d9ff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Tablet and mobile: stack layout */
  @media (max-width: 900px) {
    .main {
      flex-direction: column;
    }

    .sidebar-container {
      flex-direction: column;
      border-right: none;
      border-bottom: 1px solid #0f3460;
      max-height: 50vh;
      overflow: hidden;
    }

    .sidebar-form.closed {
      max-height: 0;
    }

    .canvas-container {
      flex-direction: column;
      align-items: center;
    }
  }

  /* Small mobile screens */
  @media (max-width: 600px) {
    .canvas-area {
      padding: 1rem;
      gap: 0.75rem;
    }

    .canvas-container {
      gap: 1rem;
      width: 100%;
    }

    .canvas-wrapper {
      width: 100%;
    }

    .canvas-wrapper h4 {
      font-size: 0.7rem;
    }

    #input-canvas,
    #output-canvas {
      max-width: 100%;
      width: 100%;
    }

    #input-canvas {
      max-width: 100%;
    }

    #output-canvas {
      max-width: 100%;
    }
  }

  @media (max-width: 400px) {
    .sidebar-form .control-item label {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }

    .sidebar-form .control-item label span {
      font-size: 0.75rem;
    }
  }

  /* Landscape mobile optimization */
  @media (max-height: 500px) and (orientation: landscape) {
    .container {
      height: auto;
      min-height: 100vh;
    }

    .main {
      flex-direction: row;
    }

    .canvas-area {
      padding: 0.5rem;
    }

    .canvas-container {
      flex-direction: row;
      gap: 0.5rem;
    }
  }
`,Or=class Or{constructor(t){this.ctx=null,this.format=null,this.device=null,this.pipeline=null,this.sampler=null,this.currentWidth=0,this.currentHeight=0,this.canvas=t,this.started=this.start()}async start(){const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("WebGPU adapter not found");this.device=await t.requestDevice(),this.format=navigator.gpu.getPreferredCanvasFormat(),this.ctx=this.canvas.getContext("webgpu"),this.ctx.configure({device:this.device,format:this.format,alphaMode:"opaque",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),this.pipeline=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.device.createShaderModule({code:Or.vertexShaderSource}),entryPoint:"vert_main"},fragment:{module:this.device.createShaderModule({code:Or.fragmentShaderSource}),entryPoint:"frag_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"}}),this.sampler=this.device.createSampler({})}async draw(t){if(await this.started,!this.device||!this.pipeline||!this.sampler||!this.ctx)throw new Error("WebGPU not initialized");if(this.currentWidth!==t.displayWidth||this.currentHeight!==t.displayHeight){this.canvas.width=t.displayWidth,this.canvas.height=t.displayHeight,this.currentWidth=t.displayWidth,this.currentHeight=t.displayHeight;const a=this.format;if(!a)throw new Error("WebGPU not initialized");this.ctx.configure({device:this.device,format:a,alphaMode:"opaque",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT})}const r=this.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:1,resource:this.sampler},{binding:2,resource:this.device.importExternalTexture({source:t})}]}),n=this.device.createCommandEncoder(),s={colorAttachments:[{view:this.ctx.getCurrentTexture().createView(),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}]};try{const a=n.beginRenderPass(s);a.setPipeline(this.pipeline),a.setBindGroup(0,r),a.draw(6,1,0,0),a.end(),this.device.queue.submit([n.finish()]),await this.device.queue.onSubmittedWorkDone()}finally{t.close()}}destroy(){this.device?.destroy(),this.device=null,this.ctx=null,this.pipeline=null,this.sampler=null}};Or.vertexShaderSource=`
    struct VertexOutput {
      @builtin(position) Position: vec4<f32>,
      @location(0) uv: vec2<f32>,
    }

    @vertex
    fn vert_main(@builtin(vertex_index) VertexIndex: u32) -> VertexOutput {
      var pos = array<vec2<f32>, 6>(
        vec2<f32>( 1.0,  1.0),
        vec2<f32>( 1.0, -1.0),
        vec2<f32>(-1.0, -1.0),
        vec2<f32>( 1.0,  1.0),
        vec2<f32>(-1.0, -1.0),
        vec2<f32>(-1.0,  1.0)
      );

      var uv = array<vec2<f32>, 6>(
        vec2<f32>(1.0, 0.0),
        vec2<f32>(1.0, 1.0),
        vec2<f32>(0.0, 1.0),
        vec2<f32>(1.0, 0.0),
        vec2<f32>(0.0, 1.0),
        vec2<f32>(0.0, 0.0)
      );

      var output : VertexOutput;
      output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);
      output.uv = uv[VertexIndex];
      return output;
    }
  `,Or.fragmentShaderSource=`
    @group(0) @binding(1) var mySampler: sampler;
    @group(0) @binding(2) var myTexture: texture_external;
    
    @fragment
    fn frag_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {
      return textureSampleBaseClampToEdge(myTexture, mySampler, uv);
    }
  `;let Us=Or;var Pv=Object.defineProperty,Vv=Object.getOwnPropertyDescriptor,vl=(e,t,r,n)=>{for(var i=n>1?void 0:n?Vv(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&Pv(t,r,i),i};const Mo=52;let _i=class extends rr{constructor(){super(...arguments),this.open=!0}toggle(){this.dispatchEvent(new CustomEvent("toggle",{bubbles:!0,composed:!0}))}get toggleLabel(){return this.open?"Close settings":"Open settings"}render(){return st`
      <button
        type="button"
        class="sidebar-toggle"
        @click=${this.toggle}
        aria-expanded=${this.open}
        aria-label=${this.toggleLabel}
        title=${this.toggleLabel}
      >
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M9 18l6-6-6-6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="label">Settings</span>
      </button>
    `}};_i.styles=_a`
    :host {
      display: block;
      flex-shrink: 0;
      width: ${Mo}px;
    }

    .sidebar-toggle {
      width: 100%;
      min-height: 3rem;
      padding: 0 0.25rem;
      background: #0f3460;
      border: none;
      border-right: 1px solid #1a3a5c;
      color: #00d9ff;
      font-size: 0.8125rem;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      transition: background 0.15s, color 0.15s;
    }

    .sidebar-toggle:hover {
      background: #1a3a5c;
      color: #fff;
    }

    .sidebar-toggle .icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      transition: transform 0.25s ease;
    }

    .sidebar-toggle .label {
      line-height: 1.1;
      font-weight: 500;
      letter-spacing: 0.02em;
    }

    .sidebar-toggle[aria-expanded="true"] .icon {
      transform: rotate(180deg);
    }

    @media (max-width: 900px) {
      :host {
        width: 100%;
      }

      .sidebar-toggle {
        flex-direction: row;
        width: 100%;
        height: ${Mo}px;
        padding: 0 0.75rem;
        border-right: none;
        border-bottom: 1px solid #1a3a5c;
      }

      .sidebar-toggle .label {
        flex: 1;
        text-align: left;
      }

      .sidebar-toggle[aria-expanded="true"] .icon {
        transform: rotate(0deg);
      }

      .sidebar-toggle[aria-expanded="false"] .icon {
        transform: rotate(180deg);
      }
    }
  `;vl([Wi({type:Boolean})],_i.prototype,"open",2);_i=vl([Ea("demo-sidebar")],_i);var Av=Object.defineProperty,Cv=Object.getOwnPropertyDescriptor,ka=(e,t,r,n)=>{for(var i=n>1?void 0:n?Cv(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&Av(t,r,i),i};let Tn=class extends rr{constructor(){super(...arguments),this.title="fisheye.js",this.subtitle="GPU-accelerated fisheye dewarping using WebGPU"}render(){return st`
      <header>
        <h1>${this.title}</h1>
        <p>${this.subtitle}</p>
      </header>
    `}};Tn.styles=_a`
    :host {
      display: block;
    }

    header {
      padding: 1rem 2rem;
      background: #16213e;
      border-bottom: 1px solid #0f3460;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      background: linear-gradient(90deg, #00d9ff, #00ff88);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    header p {
      margin: 0.25rem 0 0;
      font-size: 0.875rem;
      color: #8892b0;
    }

    @media (max-width: 600px) {
      header {
        padding: 0.75rem 1rem;
      }

      header h1 {
        font-size: 1.25rem;
      }

      header p {
        font-size: 0.75rem;
      }
    }

    @media (max-height: 500px) and (orientation: landscape) {
      header {
        padding: 0.5rem 1rem;
      }

      header h1 {
        font-size: 1rem;
      }

      header p {
        display: none;
      }
    }
  `;ka([Wi()],Tn.prototype,"title",2);ka([Wi()],Tn.prototype,"subtitle",2);Tn=ka([Ea("page-header")],Tn);var Ov=Object.defineProperty,Bv=Object.getOwnPropertyDescriptor,be=(e,t,r,n)=>{for(var i=n>1?void 0:n?Bv(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&Ov(t,r,i),i};const Uo=3264,oi={fx:991,fy:991,cx:1612,cy:1617,k1:.03562009,k2:-.02587979,k3:.00564249,k4:-.00107043,balance:0,fovScale:1},rs={fx:991,fy:991,cx:1612,cy:1617,k1:.02494321,k2:.0049985,k3:-.01754164,k4:.00455207,balance:0,fovScale:1},Se={...oi,projection:{kind:"rectilinear"}},Po=[{id:"cam1_01",label:"Cam 1-01",src:"samples/cam1_01.jpg"},{id:"cam1_02",label:"Cam 1-02",src:"samples/cam1_02.jpg"},{id:"cam1_03",label:"Cam 1-03",src:"samples/cam1_03.jpg"},{id:"cam2_01",label:"Cam 2-01",src:"samples/cam2_01.jpg"},{id:"cam2_02",label:"Cam 2-02",src:"samples/cam2_02.jpg"},{id:"cam2_03",label:"Cam 2-03",src:"samples/cam2_03.jpg"}],Vo=[{id:"rectilinear",label:"Rectilinear (90)",projection:{kind:"rectilinear"}},{id:"equirectangular",label:"Equirectangular",projection:{kind:"equirectangular"}},{id:"original",label:"Original",projection:{kind:"original"}},{id:"cylindrical",label:"Cylindrical",projection:{kind:"cylindrical"}}];let ue=class extends rr{constructor(){super(...arguments),this.k1=Se.k1,this.k2=Se.k2,this.k3=Se.k3,this.k4=Se.k4,this.balance=Se.balance,this.fovScale=Se.fovScale,this.presetId=null,this.projection=Se.projection,this.isProcessing=!1,this.errorMessage="",this.hasWebGPU=!0,this.sidebarOpen=!0,this.selectedSampleId="cam1_01",this.fisheye=null,this.renderer=null,this.currentImageBitmap=null,this.processImagePromise=Promise.resolve(),this.processImageDebounceTimer=null,this.loadRequestId=0}connectedCallback(){super.connectedCallback(),this.checkWebGPU(),this.loadDefaultImage()}disconnectedCallback(){super.disconnectedCallback(),this.processImageDebounceTimer!==null&&(clearTimeout(this.processImageDebounceTimer),this.processImageDebounceTimer=null),this.fisheye?.destroy(),this.renderer?.destroy(),this.currentImageBitmap?.close()}async checkWebGPU(){navigator.gpu||(this.hasWebGPU=!1,this.errorMessage="WebGPU is not supported in this browser. Please use Chrome 113+ or Edge 113+.")}async loadDefaultImage(){try{const e=Po[0];this.applyCalibrationFromSample(e.id);const r=await(await fetch(`/fisheye.js/${e.src}?t=${Date.now()}`)).blob();await this.loadImage(r),this.selectedSampleId=e.id}catch(e){console.warn("Failed to load default image:",e)}}async loadImage(e,t){try{const r=++this.loadRequestId;this.currentImageBitmap?.close(),this.currentImageBitmap=await createImageBitmap(e),await this.updateComplete;const n=this.inputCanvas.getContext("2d");n&&(this.inputCanvas.width=this.currentImageBitmap.width,this.inputCanvas.height=this.currentImageBitmap.height,n.drawImage(this.currentImageBitmap,0,0));const i=this.currentImageBitmap;if(await this.processImagePromise,r!==this.loadRequestId)return;this.processImagePromise=this.processImage(i,t,r).catch(()=>{}),await this.processImagePromise,await new Promise(s=>requestAnimationFrame(()=>s()))}catch(r){this.errorMessage=`Failed to load image: ${r}`}}async handleFileUpload(e){const r=e.target.files?.[0];r&&(this.selectedSampleId=null,await this.loadImage(r))}getCalibrationForCurrentSample(){return(this.selectedSampleId??"cam1_01").startsWith("cam2_")?rs:oi}buildFisheyeOptions(e,t,r){const n=r!==void 0?r.startsWith("cam2_")?rs:oi:this.getCalibrationForCurrentSample(),i=e/Uo,s=t/Uo,a=this.projection.kind==="rectilinear"?{kind:"rectilinear",mode:"manual",newFx:n.fx*i,newFy:n.fy*s,newCx:e/2,newCy:t/2}:this.projection;return{fx:n.fx*i,fy:n.fy*s,cx:n.cx*i,cy:n.cy*s,k1:this.k1,k2:this.k2,k3:this.k3,k4:this.k4,width:e,height:t,balance:this.balance,fovScale:this.fovScale,projection:a}}applyCalibrationFromSample(e){const t=e.startsWith("cam2_")?rs:oi;this.k1=t.k1,this.k2=t.k2,this.k3=t.k3,this.k4=t.k4,this.balance=t.balance,this.fovScale=t.fovScale}async handleSampleSelect(e){try{this.selectedSampleId=e.id,this.applyCalibrationFromSample(e.id),await this.updateComplete;const r=await(await fetch(`/fisheye.js/${e.src}?t=${Date.now()}`)).blob();await this.loadImage(r,e.id)}catch{this.errorMessage=`Failed to load sample: ${e.label}`}}async processImage(e,t,r){const n=e??this.currentImageBitmap;if(!(!n||!this.hasWebGPU)){this.isProcessing=!0,this.errorMessage="";try{if(await this.updateComplete,r!==void 0&&r!==this.loadRequestId){this.isProcessing=!1;return}const i=n.width,s=n.height,a=this.buildFisheyeOptions(i,s,t);this.fisheye?this.fisheye.updateConfig(a):this.fisheye=new sv(a),this.renderer||(this.renderer=new Us(this.outputCanvas));const o=new VideoFrame(n,{timestamp:0});let u=null,h=!1;try{u=await this.fisheye.undistort(o),o.close(),h=!0,(r===void 0||r===this.loadRequestId)&&(await this.renderer.draw(u),u=null)}finally{h||o.close(),u?.close(),this.isProcessing=!1}}catch(i){this.errorMessage=`Processing error: ${i}`,console.error(i)}}}enqueueProcessImage(){const e=this.processImagePromise;return this.processImagePromise=e.then(()=>this.processImage()).catch(()=>{}),this.processImagePromise}scheduleProcessImageDebounced(){this.processImageDebounceTimer!==null&&clearTimeout(this.processImageDebounceTimer),this.processImageDebounceTimer=setTimeout(()=>{this.processImageDebounceTimer=null,this.enqueueProcessImage()},ue.PROCESS_IMAGE_DEBOUNCE_MS)}cancelProcessImageDebounce(){this.processImageDebounceTimer!==null&&(clearTimeout(this.processImageDebounceTimer),this.processImageDebounceTimer=null)}handleParamChange(e,t){this[e]=t,this.scheduleProcessImageDebounced()}async handlePresetChange(e){const t=Vo.find(r=>r.id===e);t&&(this.cancelProcessImageDebounce(),this.presetId=t.id,this.projection=t.projection,this.fisheye=null,await this.enqueueProcessImage())}handleSidebarToggle(){this.sidebarOpen=!this.sidebarOpen}resetToDefaults(){this.presetId=null,this.projection=Se.projection,this.balance=Se.balance,this.fovScale=Se.fovScale,this.k1=Se.k1,this.k2=Se.k2,this.k3=Se.k3,this.k4=Se.k4,this.fisheye=null,this.loadDefaultImage()}render(){return st`
      <div class="container">
        <page-header></page-header>

        <div class="main">
          <div class="sidebar-container">
            <demo-sidebar
              .open=${this.sidebarOpen}
              @toggle=${this.handleSidebarToggle}
            ></demo-sidebar>
            <div class="sidebar-form ${this.sidebarOpen?"open":"closed"}">
              ${this.errorMessage&&!this.hasWebGPU?st`<div class="error">${this.errorMessage}</div>`:st`
                    <div class="control-group">
                      <h3>Image</h3>
                      <p class="control-hint">Pick a sample or upload your own file.</p>
                      <div class="sample-thumbnails">
                        ${Po.map(e=>st`
                            <button
                              type="button"
                              class="sample-thumb ${this.selectedSampleId===e.id?"active":""}"
                              title=${e.label}
                              @click=${()=>this.handleSampleSelect(e)}
                            >
                              <img src="${"/fisheye.js/"}${e.src}" alt=${e.label} loading="lazy" />
                              <span>${e.label}</span>
                            </button>
                          `)}
                      </div>
                      <div class="file-input-wrapper">
                        <input
                          type="file"
                          accept="image/*"
                          @change=${this.handleFileUpload}
                        />
                        <div class="file-input-label">
                          <span></span>
                          Upload Image
                        </div>
                      </div>
                    </div>

                    <div class="control-group">
                      <h3>View preset</h3>
                      <p class="control-hint">Projection mode (rectilinear, equirectangular, etc.)</p>
                      <div class="preset-buttons">
                        ${Vo.map(e=>st`
                            <button
                              class="preset-btn ${this.presetId!==null&&this.presetId===e.id?"active":""}"
                              @click=${()=>this.handlePresetChange(e.id)}
                            >
                              ${e.label}
                            </button>
                          `)}
                      </div>
                    </div>

                    <div class="control-group">
                      <h3>Distortion Coefficients</h3>
                      <p class="control-hint">OpenCV fisheye: _d = (1 + k1 + k2 + k3 + k4). Typical |k| &lt; 0.1.</p>
                      ${this.renderSlider("k1",this.k1,-.1,.1,1e-4)}
                      ${this.renderSlider("k2",this.k2,-.1,.1,1e-4)}
                      ${this.renderSlider("k3",this.k3,-.1,.1,1e-4)}
                      ${this.renderSlider("k4",this.k4,-.1,.1,1e-4)}
                    </div>

                    <div class="control-group">
                      <h3>Camera Parameters</h3>
                      <p class="control-hint">balance: 0 = no black edges, 1 = keep original FOV. fovScale: &gt;1 = widen FOV, &lt;1 = narrow FOV.</p>
                      ${this.renderSlider("balance",this.balance,0,1,.01)}
                      ${this.renderSlider("fovScale",this.fovScale,.1,3,.01)}
                    </div>

                    <div class="control-group">
                      <button class="btn btn-secondary" @click=${this.resetToDefaults}>
                        Reset to Defaults
                      </button>
                    </div>
                  `}
            </div>
          </div>

          <div class="canvas-area">
            ${this.errorMessage&&this.hasWebGPU?st`<div class="error">${this.errorMessage}</div>`:""}
            ${this.isProcessing?st`
                  <div class="processing">
                    <div class="spinner"></div>
                    Processing...
                  </div>
                `:""}

            <div class="canvas-container">
              <div class="canvas-wrapper">
                <h4>Input (Fisheye)</h4>
                <canvas id="input-canvas" width="640" height="480"></canvas>
              </div>
              <div class="canvas-wrapper">
                <h4>Output (Dewarped)</h4>
                <canvas id="output-canvas" width="640" height="480"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    `}renderSlider(e,t,r,n,i){return st`
      <div class="control-item">
        <label>
          ${e}
          <span>${t.toFixed(i<=1e-4?4:i<1?3:0)}</span>
        </label>
        <input
          type="range"
          min=${r}
          max=${n}
          step=${i}
          .value=${String(t)}
          @input=${s=>this.handleParamChange(e,Number(s.target.value))}
        />
      </div>
    `}};ue.PROCESS_IMAGE_DEBOUNCE_MS=200;ue.styles=Uv;be([Ce()],ue.prototype,"k1",2);be([Ce()],ue.prototype,"k2",2);be([Ce()],ue.prototype,"k3",2);be([Ce()],ue.prototype,"k4",2);be([Ce()],ue.prototype,"balance",2);be([Ce()],ue.prototype,"fovScale",2);be([Ce()],ue.prototype,"presetId",2);be([Ce()],ue.prototype,"projection",2);be([Ce()],ue.prototype,"isProcessing",2);be([Ce()],ue.prototype,"errorMessage",2);be([Ce()],ue.prototype,"hasWebGPU",2);be([Ce()],ue.prototype,"sidebarOpen",2);be([Ce()],ue.prototype,"selectedSampleId",2);be([xl("#output-canvas")],ue.prototype,"outputCanvas",2);be([xl("#input-canvas")],ue.prototype,"inputCanvas",2);ue=be([Ea("fisheye-demo")],ue);
