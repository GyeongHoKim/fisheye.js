(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var Xt="0.9.0",l=Symbol(`typegpu:${Xt}:$internal`),O=Symbol(`typegpu:${Xt}:$gpuValueOf`),ne=Symbol(`typegpu:${Xt}:$getNameForward`),qt=Symbol(`typegpu:${Xt}:$providing`),Te=Symbol(`typegpu:${Xt}:$ownSnippet`),T=Symbol(`typegpu:${Xt}:$resolve`),Ar=Symbol(`typegpu:${Xt}:$repr`);function A(e){return!!e?.[l]}var ee={[l]:!0,type:"void",toString(){return"void"}},Rh=["bool","f32","f16","i32","u32","u16","vec2f","vec2h","vec2i","vec2u","vec2<bool>","vec3f","vec3h","vec3i","vec3u","vec3<bool>","vec4f","vec4h","vec4i","vec4u","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","struct","array","ptr","atomic","decorated","abstractInt","abstractFloat","void","texture_1d","texture_storage_1d","texture_2d","texture_storage_2d","texture_multisampled_2d","texture_depth_2d","texture_depth_multisampled_2d","texture_2d_array","texture_storage_2d_array","texture_depth_2d_array","texture_cube","texture_depth_cube","texture_cube_array","texture_depth_cube_array","texture_3d","texture_storage_3d","texture_external","sampler","sampler_comparison"];function Z(e){let t=e;return A(t)&&typeof t.kind=="string"&&t.kind.startsWith("vec")}function Mi(e){let t=e;return A(t)&&typeof t.type=="string"&&t.type.startsWith("vec2")}function Ui(e){let t=e;return A(t)&&typeof t.type=="string"&&t.type.startsWith("vec3")}function Za(e){let t=e;return A(t)&&typeof t.type=="string"&&t.type.startsWith("vec4")}function it(e){return Mi(e)||Ui(e)||Za(e)}function rt(e){let t=e;return A(t)&&typeof t.kind?.startsWith=="function"&&t.kind.startsWith("mat")}function Ja(e){return A(e)&&e?.type==="mat2x2f"}function Ka(e){return A(e)&&e?.type==="mat3x3f"}function jh(e){return A(e)&&e?.type==="mat4x4f"}function Dn(e){return Ja(e)||Ka(e)||jh(e)}function ta(e){return Z(e)&&["vec2f","vec3f","vec4f"].includes(e.kind)}function Ot(e){return A(e)&&Rh.includes(e?.type)}function ve(e){return A(e)&&e?.type==="array"}function pe(e){return A(e)&&e?.type==="struct"}function De(e){return A(e)&&e?.type==="ptr"}function Wn(e){return A(e)&&e?.type==="atomic"}function is(e){return A(e)&&e?.type==="@align"}function ss(e){return A(e)&&e?.type==="@size"}function eo(e){return A(e)&&e?.type==="@location"}function Lh(e){return A(e)&&e?.type==="@interpolate"}function as(e){return A(e)&&e?.type==="@builtin"}function We(e){return A(e)&&e?.type==="decorated"}function to(e){return A(e)&&e.type==="void"}function Ut(e){let t=e?.type;return A(e)&&(t==="abstractInt"||t==="abstractFloat"||t==="f32"||t==="f16"||t==="i32"||t==="u32")}function os(e){let t=e?.type;return A(e)&&(t==="f16"||t==="vec2h"||t==="vec3h"||t==="vec4h")}var Nh=["abstractInt","abstractFloat","f32","f16","i32","u32","bool"];function we(e){return!A(e)||Nh.includes(e?.type)}function Dh(e){return e.schema}Object.assign(globalThis,{__TYPEGPU_AUTONAME__:(e,t)=>(si(e)&&A(e)&&!x(e)&&e.$name(t),e)});var Vi=globalThis;function ro(e){return!!e?.[ne]}function x(e){return ro(e)?x(e[ne]):ai(e)?.name}function G(e,t){ro(e)&&G(e[ne],t),Wh(e,{name:t})}function si(e){return!!e?.$name}function Zr(e){return!!ai(e)?.ast}function ai(e){return Vi.__TYPEGPU_META__.get(e)}function Wh(e,t){Vi.__TYPEGPU_META__??=new WeakMap;let r=Vi.__TYPEGPU_META__;r.set(e,{...r.get(e),...t})}var no=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],qh={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"};function mt(e){return e.type==="decorated"||e.type==="loose-decorated"?e.inner:e}function En(e){return e.type==="ptr"?e.inner:e}var Hh=["unstruct","disarray","loose-decorated",...no];function Br(e){return A(e)&&Hh.includes(e?.type)}function yt(e){return A(e)&&e?.type==="disarray"}function qe(e){return A(e)&&e?.type==="unstruct"}function He(e){return A(e)&&e?.type==="loose-decorated"}function Jr(e){return e.attribs?.find(is)?.params[0]}function Yh(e){return e.attribs?.find(ss)?.params[0]}function Vt(e){return e.attribs?.find(eo)?.params[0]}function Or(e){return Ot(e)||Br(e)}var Ne={type:"unknown",toString(){return"unknown"}},io=class{constructor(t,r,n){this.name=t,this.lhs=r,this.operator=n}},so=class{constructor(t){this.matrix=t}},ra=class{constructor(t){this.op=t,G(this,"consoleLog")}[l]=!0},Xh="Invariant failed";function nt(e,t){if(!e)throw new Error(Xh)}var _r=class Pi extends Error{constructor(t,r){let n=r.map(i=>`- ${Zr(i)?`fn*:${x(i)}`:i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Resolution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,Pi.prototype)}appendToTrace(t){let r=[t,...this.trace];return new Pi(this.cause,r)}},na=class Ai extends Error{constructor(t,r){let n=r.map(i=>`- ${i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Execution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,Ai.prototype)}appendToTrace(t){let r=[t,...this.trace];return new Ai(this.cause,r)}},Qh=class ao extends Error{constructor(t){super(`Missing value for '${t}'`),this.slot=t,Object.setPrototypeOf(this,ao.prototype)}},Zh=class oo extends Error{constructor(t){super(`Buffer '${x(t)??"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,oo.prototype)}},Jh=class uo extends Error{constructor(t,r){super(`The function '${t??"<unnamed>"}' is missing links to the following external values: ${r}.`),Object.setPrototypeOf(this,uo.prototype)}},us=class ho extends Error{constructor(t){super(`Missing bind groups for layouts: '${[...t].map(r=>x(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(bindGroup).(...)`),Object.setPrototypeOf(this,ho.prototype)}},lo=class co extends Error{constructor(t){super(`Missing vertex buffers for layouts: '${[...t].map(r=>x(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(layout, buffer).(...)`),Object.setPrototypeOf(this,co.prototype)}},ia=class po extends Error{constructor(t){super(t),Object.setPrototypeOf(this,po.prototype)}},sa=class fo extends Error{constructor(t){super(t),Object.setPrototypeOf(this,fo.prototype)}},C=class mo extends Error{constructor(t){super(t),Object.setPrototypeOf(this,mo.prototype)}};function Bi(e){return e?.resourceType==="slot"}function Oi(e){return e?.resourceType==="derived"}function Ci(e){return e?.[qt]!==void 0}function oi(e){return e?.resourceType==="accessor"}function yo(e){return e==="runtime"||e==="constant"||e==="argument"}function Tr(e){return yo(e.origin)}var Kh={uniform:{space:"uniform",access:"read"},readonly:{space:"storage",access:"read"},mutable:{space:"storage",access:"read-write"},workgroup:{space:"workgroup",access:"read-write"},private:{space:"private",access:"read-write"},function:{space:"function",access:"read-write"},"this-function":{space:"function",access:"read-write"}},go=class{constructor(t,r,n){this.value=t,this.dataType=r,this.origin=n}};function hs(e){return e instanceof go}function kn(e){return Ut(e.dataType)}function y(e,t,r){return new go(e,mt(t),r)}function ls(e){return xt("function",e,"read-write")}function el(e){return xt("private",e,"read-write")}function tl(e){return xt("workgroup",e,"read-write")}function rl(e,t="read"){return xt("storage",e,t)}function nl(e){return xt("uniform",e,"read")}function il(e){return xt("handle",e,"read")}function xt(e,t,r,n=!1){return{[l]:!0,type:"ptr",addressSpace:e,inner:t,access:r,implicit:n,toString:()=>`ptr<${e}, ${t}, ${r}>`}}function wo(e,t){let r=Kh[e];if(r)return xt(r.space,t,r.access)}function sl(e){return xt(e.addressSpace,e.inner,e.access,!0)}function al(e){return xt(e.addressSpace,e.inner,e.access,!1)}var dn=class{type="normal"},ol=class{type="codegen"},ul=class{constructor(t,r){this.buffers=t,this.vars=r}type="simulate"};function xo(e){return!!e?.[T]}function ui(e){return e?.[Te]}function Ie(e){return(typeof e.value!="string"||e.dataType.type==="unknown")&&ui(e.value)===void 0}function hl(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||xo(e)||Ot(e)||Bi(e)||Oi(e)||Ci(e)}function Fi(e){return!!e&&typeof e=="object"&&"getMappedRange"in e&&"mapAsync"in e}var Cn=!1;function ll(e){if(Cn)return e();try{return Cn=!0,e()}finally{Cn=!1}}function qn(){return Cn}var It;function vo(e,t){if(nt(It===void 0||It===e),It===e)return t();It=e;try{return t()}finally{It=void 0}}function Ee(){return It}var $o=new dn;function Hn(){return It?.mode??$o}function Xe(){return It?.mode.type==="codegen"}function c(e,...t){let r=Ee();function n(s){return hs(s)?r.resolve(s.value,s.dataType).value:s}let i="";for(let s=0;s<e.length;++s){i+=e[s];let a=t[s];Array.isArray(a)?i+=a.filter(o=>o!==void 0).map(n).join(", "):a&&(i+=n(a))}return i}var cl=(()=>{let e=n=>{if(n.origin==="argument")throw new C(c`d.ref(${n}) is illegal, cannot take a reference of an argument. Copy the value locally first, and take a reference of the copy.`);if(n.dataType.type==="ptr")return y(n.value,al(n.dataType),n.origin);let i=wo(n.origin,n.dataType);return y(new dt(n,i),i??Ne,"runtime")},t=n=>new _o(n),r=n=>Xe()?e(n):t(n);return G(r,"ref"),r.toString=()=>"ref",Object.defineProperty(r,l,{value:{jsImpl:t,gpuImpl:e,strictSignature:void 0,argConversionHint:"keep"}}),r})();function bo(e){return e instanceof _o}var _o=class{[l];type;#e;constructor(t){this[l]=!0,this.type="ref",this.#e=t}get $(){return this.#e}set $(t){if(t&&typeof t=="object")for(let r of Object.keys(t))this.#e[r]=t[r];else this.#e=t}},dt=class{[l];snippet;#e;constructor(t,r){this[l]=!0,this.snippet=t,this.#e=r}get[Te](){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return y(this,this.#e,this.snippet.origin)}[T](t){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return y(c`(&${this.snippet})`,this.#e,this.snippet.origin)}};function cs(e){if(!De(e.dataType))return e;let t=e.dataType.inner,r=we(t)?"runtime":e.origin;return e.value instanceof dt?y(c`${e.value.snippet}`,t,r):y(c`(*${e})`,t,r)}function Ur(e,t){throw new Error(`Failed to handle ${e} at ${t}`)}var ps={rank:Number.POSITIVE_INFINITY,action:"none"};function Yn(e,t){let r=mt(e),n=mt(t);if(r.type===n.type)return{rank:0,action:"none"};if(r.type==="abstractFloat"){if(n.type==="f32")return{rank:1,action:"none"};if(n.type==="f16")return{rank:2,action:"none"}}if(r.type==="abstractInt"){if(n.type==="i32")return{rank:3,action:"none"};if(n.type==="u32")return{rank:4,action:"none"};if(n.type==="abstractFloat")return{rank:5,action:"none"};if(n.type==="f32")return{rank:6,action:"none"};if(n.type==="f16")return{rank:7,action:"none"}}return it(r)&&it(n)?Yn(r.primitive,n.primitive):Dn(r)&&Dn(n)?{rank:0,action:"none"}:ps}function pl(e,t){let r=mt(e),n=mt(t);if(r.type==="ptr"&&r.implicit&&Yn(r.inner,n).rank<Number.POSITIVE_INFINITY)return{rank:0,action:"deref"};if(n.type==="ptr"&&Yn(r,n.inner).rank<Number.POSITIVE_INFINITY)return{rank:1,action:"ref"};let i={f32:0,f16:1,i32:2,u32:3,bool:4};if(r.type in i&&n.type in i){let s=r.type,a=n.type;if(s!==a){let o=i[s];return{rank:i[a]<o?10:20,action:"cast",targetType:n}}}if(r.type==="abstractFloat"){if(n.type==="u32")return{rank:2,action:"cast",targetType:n};if(n.type==="i32")return{rank:1,action:"cast",targetType:n}}return ps}function dl(e,t,r){let n=Yn(e,t);return n.rank<Number.POSITIVE_INFINITY?n:r?pl(e,t):ps}function aa(e,t,r){let n;for(let s of t){let a=[],o=0;for(let u of e){let h=dl(u,s,r);if(o+=h.rank,h.rank===Number.POSITIVE_INFINITY)break;a.push(h)}o<(n?.sum??Number.POSITIVE_INFINITY)&&(n={type:s,details:a,sum:o})}if(!n)return;let i=n.details.map((s,a)=>({sourceIndex:a,action:s.action,...s.action==="cast"&&{targetType:s.targetType}}));return{targetType:n.type,actions:i,hasImplicitConversions:i.some(s=>s.action==="cast")}}function ds(e,t){if(e.length===0)return;let r=[...new Set((t||e).map(mt))],n=aa(e,r,!1);if(n)return n;let i=aa(e,r,!0);if(i)return i}function fl(e,t,r){if(t.action==="none")return y(e.value,r,e.origin);switch(t.action){case"ref":return y(new dt(e,r),r,e.origin);case"deref":return cs(e);case"cast":return r(e);default:Ur(t.action,"applyActionToSnippet")}}function de(e,t){if(e.some(n=>n.type==="unknown"))return;let r=ds(e,t);if(r)return e.map(()=>r.targetType)}function zr(e,t,r=!0){let n=e.map(s=>s.dataType);if(n.some(s=>s.type==="unknown"))return;let i=ds(n,t);if(i)return e.map((s,a)=>{let o=i.actions[a];return nt(o),fl(s,o,i.targetType)})}function Nt(e,t,r=!0){if(t===e.dataType)return y(e.value,t,e.origin);if(e.dataType.type==="unknown")return y(c`${y(e.value,t,e.origin)}`,t,e.origin);let n=zr([e],[t],r);if(!n)throw new C(`Cannot convert value of type '${String(e.dataType)}' to type '${t.type}'`);return n[0]}function ml(e,t){return Object.keys(e.propTypes).map(r=>{let n=t[r];if(!n)throw new Error(`Missing property ${r}`);let i=e.propTypes[r];return zr([n],[i])?.[0]??n})}var Ye=class extends Error{constructor(t){super(t),this.name=this.constructor.name}};function d(e){let t=(...n)=>{let i=Ee(),{argTypes:s,returnType:a}=typeof e.signature=="function"?e.signature(...n.map(u=>u.dataType.type==="ptr"&&u.dataType.implicit?u.dataType.inner:u.dataType)):e.signature,o=n.map((u,h)=>{let p=s[h];if(!p)throw new Error("Function called with invalid arguments");return Nt(u,p,!e.ignoreImplicitCastWarning)});if(!e.noComptime&&o.every(u=>Ie(u))&&typeof e.normalImpl=="function"){i.pushMode(new dn);try{return y(e.normalImpl(...o.map(u=>u.value)),a,"constant")}catch(u){if(!(u instanceof Ye))throw u}finally{i.popMode("normal")}}return y(e.codegenImpl(...o),a,"runtime")},r=((...n)=>{if(Xe())return t(...n);if(typeof e.normalImpl=="string")throw new Ye(e.normalImpl);return e.normalImpl(...n)});return G(r,e.name),r.toString=()=>e.name,Object.defineProperty(r,l,{value:{jsImpl:e.normalImpl,gpuImpl:t,get strictSignature(){return typeof e.signature!="function"?e.signature:void 0},argConversionHint:"keep"}}),r}var fn={[l]:!0,type:"abstractInt",toString(){return"abstractInt"}},st={[l]:!0,type:"abstractFloat",toString(){return"abstractFloat"}},yl=d({name:"bool",signature:e=>({argTypes:e?[e]:[],returnType:F}),normalImpl(e){return e===void 0?!1:typeof e=="boolean"?e:!!e},codegenImpl:e=>e.dataType.type==="bool"?c`${e}`:c`bool(${e})`}),F=Object.assign(yl,{type:"bool"}),gl=d({name:"u32",signature:e=>({argTypes:e?[e]:[],returnType:$}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:(e&4294967295)>>>0},codegenImpl:e=>e.dataType.type==="u32"?c`${e}`:c`u32(${e})`}),$=Object.assign(gl,{type:"u32"}),wl=d({name:"i32",signature:e=>({argTypes:e?[e]:[],returnType:R}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:e|0},codegenImpl:e=>e.dataType.type==="i32"?c`${e}`:c`i32(${e})`}),xl={[l]:!0,type:"u16"},R=Object.assign(wl,{type:"i32"}),vl=d({name:"f32",signature:e=>({argTypes:e?[e]:[],returnType:w}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Math.fround(e)},codegenImpl:e=>e.dataType.type==="f32"?c`${e}`:c`f32(${e})`}),w=Object.assign(vl,{type:"f32"}),To=new ArrayBuffer(4),$l=new Float32Array(To),bl=new Uint32Array(To);function _l(e){$l[0]=e;let t=bl[0],r=t>>>31&1,n=t>>>23&255,i=t&8388607;return n===255?r<<15|31744|(i?512:0):(n=n-127+15,n<=0?n<-10?r<<15:(i=(i|8388608)>>1-n,i=i+4096>>13,r<<15|i):n>=31||(i=i+4096,i&8388608&&(i=0,++n,n>=31))?r<<15|31744:r<<15|n<<10|i>>13)}function Tl(e){let t=e&32768?-1:1,r=e>>10&31,n=e&1023;return r===0?n?t*n*2**-24:t*0:r===31?n?Number.NaN:t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t*(1+n/1024)*2**(r-15)}function zl(e){return Tl(_l(e))}var Il=d({name:"f16",signature:e=>({argTypes:e?[e]:[],returnType:ie}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:zl(e)},codegenImpl:e=>e.dataType.type==="f16"?c`${e}`:c`f16(${e})`}),ie=Object.assign(Il,{type:"f16"}),Qt=class extends Array{castElement(){return this[l].elementSchema[l].jsImpl}[T](){let t=this[l].elementSchema;return this.every(r=>!r)?y(`${this.kind}()`,t,"constant"):this.every(r=>this[0]===r)?y(`${this.kind}(${this[0]})`,t,"runtime"):y(`${this.kind}(${this.join(", ")})`,t,"runtime")}toString(){return this[T]().value}get xx(){return new this._Vec2(this[0],this[0])}get xy(){return new this._Vec2(this[0],this[1])}get xz(){return new this._Vec2(this[0],this[2])}get xw(){return new this._Vec2(this[0],this[3])}get yx(){return new this._Vec2(this[1],this[0])}get yy(){return new this._Vec2(this[1],this[1])}get yz(){return new this._Vec2(this[1],this[2])}get yw(){return new this._Vec2(this[1],this[3])}get zx(){return new this._Vec2(this[2],this[0])}get zy(){return new this._Vec2(this[2],this[1])}get zz(){return new this._Vec2(this[2],this[2])}get zw(){return new this._Vec2(this[2],this[3])}get wx(){return new this._Vec2(this[3],this[0])}get wy(){return new this._Vec2(this[3],this[1])}get wz(){return new this._Vec2(this[3],this[2])}get ww(){return new this._Vec2(this[3],this[3])}get xxx(){return new this._Vec3(this[0],this[0],this[0])}get xxy(){return new this._Vec3(this[0],this[0],this[1])}get xxz(){return new this._Vec3(this[0],this[0],this[2])}get xxw(){return new this._Vec3(this[0],this[0],this[3])}get xyx(){return new this._Vec3(this[0],this[1],this[0])}get xyy(){return new this._Vec3(this[0],this[1],this[1])}get xyz(){return new this._Vec3(this[0],this[1],this[2])}get xyw(){return new this._Vec3(this[0],this[1],this[3])}get xzx(){return new this._Vec3(this[0],this[2],this[0])}get xzy(){return new this._Vec3(this[0],this[2],this[1])}get xzz(){return new this._Vec3(this[0],this[2],this[2])}get xzw(){return new this._Vec3(this[0],this[2],this[3])}get xwx(){return new this._Vec3(this[0],this[3],this[0])}get xwy(){return new this._Vec3(this[0],this[3],this[1])}get xwz(){return new this._Vec3(this[0],this[3],this[2])}get xww(){return new this._Vec3(this[0],this[3],this[3])}get yxx(){return new this._Vec3(this[1],this[0],this[0])}get yxy(){return new this._Vec3(this[1],this[0],this[1])}get yxz(){return new this._Vec3(this[1],this[0],this[2])}get yxw(){return new this._Vec3(this[1],this[0],this[3])}get yyx(){return new this._Vec3(this[1],this[1],this[0])}get yyy(){return new this._Vec3(this[1],this[1],this[1])}get yyz(){return new this._Vec3(this[1],this[1],this[2])}get yyw(){return new this._Vec3(this[1],this[1],this[3])}get yzx(){return new this._Vec3(this[1],this[2],this[0])}get yzy(){return new this._Vec3(this[1],this[2],this[1])}get yzz(){return new this._Vec3(this[1],this[2],this[2])}get yzw(){return new this._Vec3(this[1],this[2],this[3])}get ywx(){return new this._Vec3(this[1],this[3],this[0])}get ywy(){return new this._Vec3(this[1],this[3],this[1])}get ywz(){return new this._Vec3(this[1],this[3],this[2])}get yww(){return new this._Vec3(this[1],this[3],this[3])}get zxx(){return new this._Vec3(this[2],this[0],this[0])}get zxy(){return new this._Vec3(this[2],this[0],this[1])}get zxz(){return new this._Vec3(this[2],this[0],this[2])}get zxw(){return new this._Vec3(this[2],this[0],this[3])}get zyx(){return new this._Vec3(this[2],this[1],this[0])}get zyy(){return new this._Vec3(this[2],this[1],this[1])}get zyz(){return new this._Vec3(this[2],this[1],this[2])}get zyw(){return new this._Vec3(this[2],this[1],this[3])}get zzx(){return new this._Vec3(this[2],this[2],this[0])}get zzy(){return new this._Vec3(this[2],this[2],this[1])}get zzz(){return new this._Vec3(this[2],this[2],this[2])}get zzw(){return new this._Vec3(this[2],this[2],this[3])}get zwx(){return new this._Vec3(this[2],this[3],this[0])}get zwy(){return new this._Vec3(this[2],this[3],this[1])}get zwz(){return new this._Vec3(this[2],this[3],this[2])}get zww(){return new this._Vec3(this[2],this[3],this[3])}get wxx(){return new this._Vec3(this[3],this[0],this[0])}get wxy(){return new this._Vec3(this[3],this[0],this[1])}get wxz(){return new this._Vec3(this[3],this[0],this[2])}get wxw(){return new this._Vec3(this[3],this[0],this[3])}get wyx(){return new this._Vec3(this[3],this[1],this[0])}get wyy(){return new this._Vec3(this[3],this[1],this[1])}get wyz(){return new this._Vec3(this[3],this[1],this[2])}get wyw(){return new this._Vec3(this[3],this[1],this[3])}get wzx(){return new this._Vec3(this[3],this[2],this[0])}get wzy(){return new this._Vec3(this[3],this[2],this[1])}get wzz(){return new this._Vec3(this[3],this[2],this[2])}get wzw(){return new this._Vec3(this[3],this[2],this[3])}get wwx(){return new this._Vec3(this[3],this[3],this[0])}get wwy(){return new this._Vec3(this[3],this[3],this[1])}get wwz(){return new this._Vec3(this[3],this[3],this[2])}get www(){return new this._Vec3(this[3],this[3],this[3])}get xxxx(){return new this._Vec4(this[0],this[0],this[0],this[0])}get xxxy(){return new this._Vec4(this[0],this[0],this[0],this[1])}get xxxz(){return new this._Vec4(this[0],this[0],this[0],this[2])}get xxxw(){return new this._Vec4(this[0],this[0],this[0],this[3])}get xxyx(){return new this._Vec4(this[0],this[0],this[1],this[0])}get xxyy(){return new this._Vec4(this[0],this[0],this[1],this[1])}get xxyz(){return new this._Vec4(this[0],this[0],this[1],this[2])}get xxyw(){return new this._Vec4(this[0],this[0],this[1],this[3])}get xxzx(){return new this._Vec4(this[0],this[0],this[2],this[0])}get xxzy(){return new this._Vec4(this[0],this[0],this[2],this[1])}get xxzz(){return new this._Vec4(this[0],this[0],this[2],this[2])}get xxzw(){return new this._Vec4(this[0],this[0],this[2],this[3])}get xxwx(){return new this._Vec4(this[0],this[0],this[3],this[0])}get xxwy(){return new this._Vec4(this[0],this[0],this[3],this[1])}get xxwz(){return new this._Vec4(this[0],this[0],this[3],this[2])}get xxww(){return new this._Vec4(this[0],this[0],this[3],this[3])}get xyxx(){return new this._Vec4(this[0],this[1],this[0],this[0])}get xyxy(){return new this._Vec4(this[0],this[1],this[0],this[1])}get xyxz(){return new this._Vec4(this[0],this[1],this[0],this[2])}get xyxw(){return new this._Vec4(this[0],this[1],this[0],this[3])}get xyyx(){return new this._Vec4(this[0],this[1],this[1],this[0])}get xyyy(){return new this._Vec4(this[0],this[1],this[1],this[1])}get xyyz(){return new this._Vec4(this[0],this[1],this[1],this[2])}get xyyw(){return new this._Vec4(this[0],this[1],this[1],this[3])}get xyzx(){return new this._Vec4(this[0],this[1],this[2],this[0])}get xyzy(){return new this._Vec4(this[0],this[1],this[2],this[1])}get xyzz(){return new this._Vec4(this[0],this[1],this[2],this[2])}get xyzw(){return new this._Vec4(this[0],this[1],this[2],this[3])}get xywx(){return new this._Vec4(this[0],this[1],this[3],this[0])}get xywy(){return new this._Vec4(this[0],this[1],this[3],this[1])}get xywz(){return new this._Vec4(this[0],this[1],this[3],this[2])}get xyww(){return new this._Vec4(this[0],this[1],this[3],this[3])}get xzxx(){return new this._Vec4(this[0],this[2],this[0],this[0])}get xzxy(){return new this._Vec4(this[0],this[2],this[0],this[1])}get xzxz(){return new this._Vec4(this[0],this[2],this[0],this[2])}get xzxw(){return new this._Vec4(this[0],this[2],this[0],this[3])}get xzyx(){return new this._Vec4(this[0],this[2],this[1],this[0])}get xzyy(){return new this._Vec4(this[0],this[2],this[1],this[1])}get xzyz(){return new this._Vec4(this[0],this[2],this[1],this[2])}get xzyw(){return new this._Vec4(this[0],this[2],this[1],this[3])}get xzzx(){return new this._Vec4(this[0],this[2],this[2],this[0])}get xzzy(){return new this._Vec4(this[0],this[2],this[2],this[1])}get xzzz(){return new this._Vec4(this[0],this[2],this[2],this[2])}get xzzw(){return new this._Vec4(this[0],this[2],this[2],this[3])}get xzwx(){return new this._Vec4(this[0],this[2],this[3],this[0])}get xzwy(){return new this._Vec4(this[0],this[2],this[3],this[1])}get xzwz(){return new this._Vec4(this[0],this[2],this[3],this[2])}get xzww(){return new this._Vec4(this[0],this[2],this[3],this[3])}get xwxx(){return new this._Vec4(this[0],this[3],this[0],this[0])}get xwxy(){return new this._Vec4(this[0],this[3],this[0],this[1])}get xwxz(){return new this._Vec4(this[0],this[3],this[0],this[2])}get xwxw(){return new this._Vec4(this[0],this[3],this[0],this[3])}get xwyx(){return new this._Vec4(this[0],this[3],this[1],this[0])}get xwyy(){return new this._Vec4(this[0],this[3],this[1],this[1])}get xwyz(){return new this._Vec4(this[0],this[3],this[1],this[2])}get xwyw(){return new this._Vec4(this[0],this[3],this[1],this[3])}get xwzx(){return new this._Vec4(this[0],this[3],this[2],this[0])}get xwzy(){return new this._Vec4(this[0],this[3],this[2],this[1])}get xwzz(){return new this._Vec4(this[0],this[3],this[2],this[2])}get xwzw(){return new this._Vec4(this[0],this[3],this[2],this[3])}get xwwx(){return new this._Vec4(this[0],this[3],this[3],this[0])}get xwwy(){return new this._Vec4(this[0],this[3],this[3],this[1])}get xwwz(){return new this._Vec4(this[0],this[3],this[3],this[2])}get xwww(){return new this._Vec4(this[0],this[3],this[3],this[3])}get yxxx(){return new this._Vec4(this[1],this[0],this[0],this[0])}get yxxy(){return new this._Vec4(this[1],this[0],this[0],this[1])}get yxxz(){return new this._Vec4(this[1],this[0],this[0],this[2])}get yxxw(){return new this._Vec4(this[1],this[0],this[0],this[3])}get yxyx(){return new this._Vec4(this[1],this[0],this[1],this[0])}get yxyy(){return new this._Vec4(this[1],this[0],this[1],this[1])}get yxyz(){return new this._Vec4(this[1],this[0],this[1],this[2])}get yxyw(){return new this._Vec4(this[1],this[0],this[1],this[3])}get yxzx(){return new this._Vec4(this[1],this[0],this[2],this[0])}get yxzy(){return new this._Vec4(this[1],this[0],this[2],this[1])}get yxzz(){return new this._Vec4(this[1],this[0],this[2],this[2])}get yxzw(){return new this._Vec4(this[1],this[0],this[2],this[3])}get yxwx(){return new this._Vec4(this[1],this[0],this[3],this[0])}get yxwy(){return new this._Vec4(this[1],this[0],this[3],this[1])}get yxwz(){return new this._Vec4(this[1],this[0],this[3],this[2])}get yxww(){return new this._Vec4(this[1],this[0],this[3],this[3])}get yyxx(){return new this._Vec4(this[1],this[1],this[0],this[0])}get yyxy(){return new this._Vec4(this[1],this[1],this[0],this[1])}get yyxz(){return new this._Vec4(this[1],this[1],this[0],this[2])}get yyxw(){return new this._Vec4(this[1],this[1],this[0],this[3])}get yyyx(){return new this._Vec4(this[1],this[1],this[1],this[0])}get yyyy(){return new this._Vec4(this[1],this[1],this[1],this[1])}get yyyz(){return new this._Vec4(this[1],this[1],this[1],this[2])}get yyyw(){return new this._Vec4(this[1],this[1],this[1],this[3])}get yyzx(){return new this._Vec4(this[1],this[1],this[2],this[0])}get yyzy(){return new this._Vec4(this[1],this[1],this[2],this[1])}get yyzz(){return new this._Vec4(this[1],this[1],this[2],this[2])}get yyzw(){return new this._Vec4(this[1],this[1],this[2],this[3])}get yywx(){return new this._Vec4(this[1],this[1],this[3],this[0])}get yywy(){return new this._Vec4(this[1],this[1],this[3],this[1])}get yywz(){return new this._Vec4(this[1],this[1],this[3],this[2])}get yyww(){return new this._Vec4(this[1],this[1],this[3],this[3])}get yzxx(){return new this._Vec4(this[1],this[2],this[0],this[0])}get yzxy(){return new this._Vec4(this[1],this[2],this[0],this[1])}get yzxz(){return new this._Vec4(this[1],this[2],this[0],this[2])}get yzxw(){return new this._Vec4(this[1],this[2],this[0],this[3])}get yzyx(){return new this._Vec4(this[1],this[2],this[1],this[0])}get yzyy(){return new this._Vec4(this[1],this[2],this[1],this[1])}get yzyz(){return new this._Vec4(this[1],this[2],this[1],this[2])}get yzyw(){return new this._Vec4(this[1],this[2],this[1],this[3])}get yzzx(){return new this._Vec4(this[1],this[2],this[2],this[0])}get yzzy(){return new this._Vec4(this[1],this[2],this[2],this[1])}get yzzz(){return new this._Vec4(this[1],this[2],this[2],this[2])}get yzzw(){return new this._Vec4(this[1],this[2],this[2],this[3])}get yzwx(){return new this._Vec4(this[1],this[2],this[3],this[0])}get yzwy(){return new this._Vec4(this[1],this[2],this[3],this[1])}get yzwz(){return new this._Vec4(this[1],this[2],this[3],this[2])}get yzww(){return new this._Vec4(this[1],this[2],this[3],this[3])}get ywxx(){return new this._Vec4(this[1],this[3],this[0],this[0])}get ywxy(){return new this._Vec4(this[1],this[3],this[0],this[1])}get ywxz(){return new this._Vec4(this[1],this[3],this[0],this[2])}get ywxw(){return new this._Vec4(this[1],this[3],this[0],this[3])}get ywyx(){return new this._Vec4(this[1],this[3],this[1],this[0])}get ywyy(){return new this._Vec4(this[1],this[3],this[1],this[1])}get ywyz(){return new this._Vec4(this[1],this[3],this[1],this[2])}get ywyw(){return new this._Vec4(this[1],this[3],this[1],this[3])}get ywzx(){return new this._Vec4(this[1],this[3],this[2],this[0])}get ywzy(){return new this._Vec4(this[1],this[3],this[2],this[1])}get ywzz(){return new this._Vec4(this[1],this[3],this[2],this[2])}get ywzw(){return new this._Vec4(this[1],this[3],this[2],this[3])}get ywwx(){return new this._Vec4(this[1],this[3],this[3],this[0])}get ywwy(){return new this._Vec4(this[1],this[3],this[3],this[1])}get ywwz(){return new this._Vec4(this[1],this[3],this[3],this[2])}get ywww(){return new this._Vec4(this[1],this[3],this[3],this[3])}get zxxx(){return new this._Vec4(this[2],this[0],this[0],this[0])}get zxxy(){return new this._Vec4(this[2],this[0],this[0],this[1])}get zxxz(){return new this._Vec4(this[2],this[0],this[0],this[2])}get zxxw(){return new this._Vec4(this[2],this[0],this[0],this[3])}get zxyx(){return new this._Vec4(this[2],this[0],this[1],this[0])}get zxyy(){return new this._Vec4(this[2],this[0],this[1],this[1])}get zxyz(){return new this._Vec4(this[2],this[0],this[1],this[2])}get zxyw(){return new this._Vec4(this[2],this[0],this[1],this[3])}get zxzx(){return new this._Vec4(this[2],this[0],this[2],this[0])}get zxzy(){return new this._Vec4(this[2],this[0],this[2],this[1])}get zxzz(){return new this._Vec4(this[2],this[0],this[2],this[2])}get zxzw(){return new this._Vec4(this[2],this[0],this[2],this[3])}get zxwx(){return new this._Vec4(this[2],this[0],this[3],this[0])}get zxwy(){return new this._Vec4(this[2],this[0],this[3],this[1])}get zxwz(){return new this._Vec4(this[2],this[0],this[3],this[2])}get zxww(){return new this._Vec4(this[2],this[0],this[3],this[3])}get zyxx(){return new this._Vec4(this[2],this[1],this[0],this[0])}get zyxy(){return new this._Vec4(this[2],this[1],this[0],this[1])}get zyxz(){return new this._Vec4(this[2],this[1],this[0],this[2])}get zyxw(){return new this._Vec4(this[2],this[1],this[0],this[3])}get zyyx(){return new this._Vec4(this[2],this[1],this[1],this[0])}get zyyy(){return new this._Vec4(this[2],this[1],this[1],this[1])}get zyyz(){return new this._Vec4(this[2],this[1],this[1],this[2])}get zyyw(){return new this._Vec4(this[2],this[1],this[1],this[3])}get zyzx(){return new this._Vec4(this[2],this[1],this[2],this[0])}get zyzy(){return new this._Vec4(this[2],this[1],this[2],this[1])}get zyzz(){return new this._Vec4(this[2],this[1],this[2],this[2])}get zyzw(){return new this._Vec4(this[2],this[1],this[2],this[3])}get zywx(){return new this._Vec4(this[2],this[1],this[3],this[0])}get zywy(){return new this._Vec4(this[2],this[1],this[3],this[1])}get zywz(){return new this._Vec4(this[2],this[1],this[3],this[2])}get zyww(){return new this._Vec4(this[2],this[1],this[3],this[3])}get zzxx(){return new this._Vec4(this[2],this[2],this[0],this[0])}get zzxy(){return new this._Vec4(this[2],this[2],this[0],this[1])}get zzxz(){return new this._Vec4(this[2],this[2],this[0],this[2])}get zzxw(){return new this._Vec4(this[2],this[2],this[0],this[3])}get zzyx(){return new this._Vec4(this[2],this[2],this[1],this[0])}get zzyy(){return new this._Vec4(this[2],this[2],this[1],this[1])}get zzyz(){return new this._Vec4(this[2],this[2],this[1],this[2])}get zzyw(){return new this._Vec4(this[2],this[2],this[1],this[3])}get zzzx(){return new this._Vec4(this[2],this[2],this[2],this[0])}get zzzy(){return new this._Vec4(this[2],this[2],this[2],this[1])}get zzzz(){return new this._Vec4(this[2],this[2],this[2],this[2])}get zzzw(){return new this._Vec4(this[2],this[2],this[2],this[3])}get zzwx(){return new this._Vec4(this[2],this[2],this[3],this[0])}get zzwy(){return new this._Vec4(this[2],this[2],this[3],this[1])}get zzwz(){return new this._Vec4(this[2],this[2],this[3],this[2])}get zzww(){return new this._Vec4(this[2],this[2],this[3],this[3])}get zwxx(){return new this._Vec4(this[2],this[3],this[0],this[0])}get zwxy(){return new this._Vec4(this[2],this[3],this[0],this[1])}get zwxz(){return new this._Vec4(this[2],this[3],this[0],this[2])}get zwxw(){return new this._Vec4(this[2],this[3],this[0],this[3])}get zwyx(){return new this._Vec4(this[2],this[3],this[1],this[0])}get zwyy(){return new this._Vec4(this[2],this[3],this[1],this[1])}get zwyz(){return new this._Vec4(this[2],this[3],this[1],this[2])}get zwyw(){return new this._Vec4(this[2],this[3],this[1],this[3])}get zwzx(){return new this._Vec4(this[2],this[3],this[2],this[0])}get zwzy(){return new this._Vec4(this[2],this[3],this[2],this[1])}get zwzz(){return new this._Vec4(this[2],this[3],this[2],this[2])}get zwzw(){return new this._Vec4(this[2],this[3],this[2],this[3])}get zwwx(){return new this._Vec4(this[2],this[3],this[3],this[0])}get zwwy(){return new this._Vec4(this[2],this[3],this[3],this[1])}get zwwz(){return new this._Vec4(this[2],this[3],this[3],this[2])}get zwww(){return new this._Vec4(this[2],this[3],this[3],this[3])}get wxxx(){return new this._Vec4(this[3],this[0],this[0],this[0])}get wxxy(){return new this._Vec4(this[3],this[0],this[0],this[1])}get wxxz(){return new this._Vec4(this[3],this[0],this[0],this[2])}get wxxw(){return new this._Vec4(this[3],this[0],this[0],this[3])}get wxyx(){return new this._Vec4(this[3],this[0],this[1],this[0])}get wxyy(){return new this._Vec4(this[3],this[0],this[1],this[1])}get wxyz(){return new this._Vec4(this[3],this[0],this[1],this[2])}get wxyw(){return new this._Vec4(this[3],this[0],this[1],this[3])}get wxzx(){return new this._Vec4(this[3],this[0],this[2],this[0])}get wxzy(){return new this._Vec4(this[3],this[0],this[2],this[1])}get wxzz(){return new this._Vec4(this[3],this[0],this[2],this[2])}get wxzw(){return new this._Vec4(this[3],this[0],this[2],this[3])}get wxwx(){return new this._Vec4(this[3],this[0],this[3],this[0])}get wxwy(){return new this._Vec4(this[3],this[0],this[3],this[1])}get wxwz(){return new this._Vec4(this[3],this[0],this[3],this[2])}get wxww(){return new this._Vec4(this[3],this[0],this[3],this[3])}get wyxx(){return new this._Vec4(this[3],this[1],this[0],this[0])}get wyxy(){return new this._Vec4(this[3],this[1],this[0],this[1])}get wyxz(){return new this._Vec4(this[3],this[1],this[0],this[2])}get wyxw(){return new this._Vec4(this[3],this[1],this[0],this[3])}get wyyx(){return new this._Vec4(this[3],this[1],this[1],this[0])}get wyyy(){return new this._Vec4(this[3],this[1],this[1],this[1])}get wyyz(){return new this._Vec4(this[3],this[1],this[1],this[2])}get wyyw(){return new this._Vec4(this[3],this[1],this[1],this[3])}get wyzx(){return new this._Vec4(this[3],this[1],this[2],this[0])}get wyzy(){return new this._Vec4(this[3],this[1],this[2],this[1])}get wyzz(){return new this._Vec4(this[3],this[1],this[2],this[2])}get wyzw(){return new this._Vec4(this[3],this[1],this[2],this[3])}get wywx(){return new this._Vec4(this[3],this[1],this[3],this[0])}get wywy(){return new this._Vec4(this[3],this[1],this[3],this[1])}get wywz(){return new this._Vec4(this[3],this[1],this[3],this[2])}get wyww(){return new this._Vec4(this[3],this[1],this[3],this[3])}get wzxx(){return new this._Vec4(this[3],this[2],this[0],this[0])}get wzxy(){return new this._Vec4(this[3],this[2],this[0],this[1])}get wzxz(){return new this._Vec4(this[3],this[2],this[0],this[2])}get wzxw(){return new this._Vec4(this[3],this[2],this[0],this[3])}get wzyx(){return new this._Vec4(this[3],this[2],this[1],this[0])}get wzyy(){return new this._Vec4(this[3],this[2],this[1],this[1])}get wzyz(){return new this._Vec4(this[3],this[2],this[1],this[2])}get wzyw(){return new this._Vec4(this[3],this[2],this[1],this[3])}get wzzx(){return new this._Vec4(this[3],this[2],this[2],this[0])}get wzzy(){return new this._Vec4(this[3],this[2],this[2],this[1])}get wzzz(){return new this._Vec4(this[3],this[2],this[2],this[2])}get wzzw(){return new this._Vec4(this[3],this[2],this[2],this[3])}get wzwx(){return new this._Vec4(this[3],this[2],this[3],this[0])}get wzwy(){return new this._Vec4(this[3],this[2],this[3],this[1])}get wzwz(){return new this._Vec4(this[3],this[2],this[3],this[2])}get wzww(){return new this._Vec4(this[3],this[2],this[3],this[3])}get wwxx(){return new this._Vec4(this[3],this[3],this[0],this[0])}get wwxy(){return new this._Vec4(this[3],this[3],this[0],this[1])}get wwxz(){return new this._Vec4(this[3],this[3],this[0],this[2])}get wwxw(){return new this._Vec4(this[3],this[3],this[0],this[3])}get wwyx(){return new this._Vec4(this[3],this[3],this[1],this[0])}get wwyy(){return new this._Vec4(this[3],this[3],this[1],this[1])}get wwyz(){return new this._Vec4(this[3],this[3],this[1],this[2])}get wwyw(){return new this._Vec4(this[3],this[3],this[1],this[3])}get wwzx(){return new this._Vec4(this[3],this[3],this[2],this[0])}get wwzy(){return new this._Vec4(this[3],this[3],this[2],this[1])}get wwzz(){return new this._Vec4(this[3],this[3],this[2],this[2])}get wwzw(){return new this._Vec4(this[3],this[3],this[2],this[3])}get wwwx(){return new this._Vec4(this[3],this[3],this[3],this[0])}get wwwy(){return new this._Vec4(this[3],this[3],this[3],this[1])}get wwwz(){return new this._Vec4(this[3],this[3],this[3],this[2])}get wwww(){return new this._Vec4(this[3],this[3],this[3],this[3])}},mn=class extends Qt{e0;e1;constructor(t,r){super(2),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t)}get 0(){return this.e0}get 1(){return this.e1}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}},yn=class extends Qt{e0;e1;e2;constructor(t,r,n){super(3),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}set z(t){this[2]=this.castElement()(t)}},gn=class extends Qt{e0;e1;e2;e3;constructor(t,r,n,i){super(4),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t),this.e3=this.castElement()(i??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}get 3(){return this.e3}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}set 3(t){this.e3=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set w(t){this[3]=t}},fs=class zo extends mn{get[l](){return{elementSchema:w}}get kind(){return"vec2f"}get _Vec2(){return zo}get _Vec3(){return xs}get _Vec4(){return Ts}},ms=class Io extends mn{get[l](){return{elementSchema:ie}}get kind(){return"vec2h"}get _Vec2(){return Io}get _Vec3(){return vs}get _Vec4(){return zs}},ys=class So extends mn{get[l](){return{elementSchema:R}}get kind(){return"vec2i"}get _Vec2(){return So}get _Vec3(){return $s}get _Vec4(){return Is}},gs=class Eo extends mn{get[l](){return{elementSchema:$}}get kind(){return"vec2u"}get _Vec2(){return Eo}get _Vec3(){return bs}get _Vec4(){return Ss}},ws=class ko extends mn{get[l](){return{elementSchema:F}}get kind(){return"vec2<bool>"}get _Vec2(){return ko}get _Vec3(){return _s}get _Vec4(){return Es}},xs=class Mo extends yn{get[l](){return{elementSchema:w}}get kind(){return"vec3f"}get _Vec2(){return fs}get _Vec3(){return Mo}get _Vec4(){return Ts}},vs=class Uo extends yn{get[l](){return{elementSchema:ie}}get kind(){return"vec3h"}get _Vec2(){return ms}get _Vec3(){return Uo}get _Vec4(){return zs}},$s=class Vo extends yn{get[l](){return{elementSchema:R}}get kind(){return"vec3i"}get _Vec2(){return ys}get _Vec3(){return Vo}get _Vec4(){return Is}},bs=class Po extends yn{get[l](){return{elementSchema:$}}get kind(){return"vec3u"}get _Vec2(){return gs}get _Vec3(){return Po}get _Vec4(){return Ss}},_s=class Ao extends yn{get[l](){return{elementSchema:F}}get kind(){return"vec3<bool>"}get _Vec2(){return ws}get _Vec3(){return Ao}get _Vec4(){return Es}},Ts=class Bo extends gn{get[l](){return{elementSchema:w}}get kind(){return"vec4f"}get _Vec2(){return fs}get _Vec3(){return xs}get _Vec4(){return Bo}},zs=class Oo extends gn{get[l](){return{elementSchema:ie}}get kind(){return"vec4h"}get _Vec2(){return ms}get _Vec3(){return vs}get _Vec4(){return Oo}},Is=class Co extends gn{get[l](){return{elementSchema:R}}get kind(){return"vec4i"}get _Vec2(){return ys}get _Vec3(){return $s}get _Vec4(){return Co}},Ss=class Fo extends gn{get[l](){return{elementSchema:$}}get kind(){return"vec4u"}get _Vec2(){return gs}get _Vec3(){return bs}get _Vec4(){return Fo}},Es=class Go extends gn{get[l](){return{elementSchema:F}}get kind(){return"vec4<bool>"}get _Vec2(){return ws}get _Vec3(){return _s}get _Vec4(){return Go}},P=$e(fs,w),at=$e(ms,ie),ue=$e(ys,R),_e=$e(gs,$),Zt=$e(ws,F),se=$e(xs,w),ot=$e(vs,ie),ke=$e($s,R),te=$e(bs,$),Jt=$e(_s,F),z=$e(Ts,w),ut=$e(zs,ie),he=$e(Is,R),me=$e(Ss,$),Kt=$e(Es,F),Xn={vec2f:P,vec2h:at,vec2i:ue,vec2u:_e,"vec2<bool>":Zt,vec3f:se,vec3h:ot,vec3i:ke,vec3u:te,"vec3<bool>":Jt,vec4f:z,vec4h:ut,vec4i:he,vec4u:me,"vec4<bool>":Kt};function $e(e,t){let{kind:r,length:n}=new e,i=d({name:r,signature:(...a)=>({argTypes:a.map(o=>it(o)?o:t),returnType:s}),normalImpl:(...a)=>{let o=new Array(a.length),u=0;for(let h of a)if(typeof h=="number"||typeof h=="boolean")o[u++]=h;else for(let p=0;p<h.length;++p)o[u++]=h[p];if(o.length<=1||o.length===n)return new e(...o);throw new Error(`'${r}' constructor called with invalid number of arguments.`)},ignoreImplicitCastWarning:!0,codegenImpl:(...a)=>a.length===1&&a[0]?.dataType===s?c`${a[0]}`:c`${r}(${a})`}),s=Object.assign(i,{type:r,primitive:t,[Ar]:void 0});return e.prototype.schema=s,s}function Qn(e){return e>=2**63||e<-9223372036854776e3?y(e,st,"constant"):Number.isInteger(e)?(Number.isSafeInteger(e)||console.warn(`The integer ${e} exceeds the safe integer range and may have lost precision.`),y(e,fn,"constant")):y(e,st,"constant")}function St(e){return e.type==="abstractFloat"?w:e.type==="abstractInt"?R:e}function Sl(e){return e.map(t=>y(t.value,St(t.dataType),t.origin))}function hi(e){if(hs(e))return e;if(bo(e))throw new Error("Cannot use refs (d.ref(...)) from the outer scope.");return ui(e)||(Z(e)||rt(e)?y(e,Dh(e),"constant"):typeof e=="string"||typeof e=="function"||typeof e=="object"||typeof e=="symbol"||typeof e>"u"||e===null?y(e,Ne,"constant"):typeof e=="number"?Qn(e):typeof e=="boolean"?y(e,F,"constant"):y(e,Ne,"constant"))}function Pt(e){let t=(...n)=>{let i=n;if(!i.every(s=>Ie(s)))throw new C(`Called comptime function with runtime-known values: ${i.filter(s=>!Ie(s)).map(s=>`'${s.value}'`).join(", ")}`);return hi(e(...i.map(s=>s.value)))},r=((...n)=>{let i=Ee();if(i?.mode.type==="codegen"){i.pushMode(new dn);try{return t(...n)}finally{i.popMode("normal")}}return e(...n)});return r.toString=()=>"comptime",r[ne]=e,r.$name=n=>(G(e,n),r),Object.defineProperty(r,l,{value:{jsImpl:e,gpuImpl:t,argConversionHint:"keep"}}),r}var I=class{constructor(t){this.type=t}[l]=!0},gt={uint8:$,uint8x2:_e,uint8x4:me,sint8:R,sint8x2:ue,sint8x4:he,unorm8:w,unorm8x2:P,unorm8x4:z,snorm8:w,snorm8x2:P,snorm8x4:z,uint16:$,uint16x2:_e,uint16x4:me,sint16:R,sint16x2:ue,sint16x4:he,unorm16:w,unorm16x2:P,unorm16x4:z,snorm16:w,snorm16x2:P,snorm16x4:z,float16:w,float16x2:P,float16x4:z,float32:w,float32x2:P,float32x3:se,float32x4:z,uint32:$,uint32x2:_e,uint32x3:te,uint32x4:me,sint32:R,sint32x2:ue,sint32x3:ke,sint32x4:he,"unorm10-10-10-2":z,"unorm8x4-bgra":z},ks=new Set(Object.keys(gt)),El=new I("uint8"),kl=new I("uint8x2"),Ml=new I("uint8x4"),Ul=new I("sint8"),Vl=new I("sint8x2"),Pl=new I("sint8x4"),Al=new I("unorm8"),Bl=new I("unorm8x2"),Ol=new I("unorm8x4"),Cl=new I("snorm8"),Fl=new I("snorm8x2"),Gl=new I("snorm8x4"),Rl=new I("uint16"),jl=new I("uint16x2"),Ll=new I("uint16x4"),Nl=new I("sint16"),Dl=new I("sint16x2"),Wl=new I("sint16x4"),ql=new I("unorm16"),Hl=new I("unorm16x2"),Yl=new I("unorm16x4"),Xl=new I("snorm16"),Ql=new I("snorm16x2"),Zl=new I("snorm16x4"),Jl=new I("float16"),Kl=new I("float16x2"),ec=new I("float16x4"),tc=new I("float32"),rc=new I("float32x2"),nc=new I("float32x3"),ic=new I("float32x4"),sc=new I("uint32"),ac=new I("uint32x2"),oc=new I("uint32x3"),uc=new I("uint32x4"),hc=new I("sint32"),lc=new I("sint32x2"),cc=new I("sint32x3"),pc=new I("sint32x4"),dc=new I("unorm10-10-10-2"),fc=new I("unorm8x4-bgra");function Ro(e){return A(e)&&ks.has(e?.type)}function At(e,t){let r=e?.type,n=r in gt?gt[r]:e;return typeof n!="function"?t:t===void 0?n():n(t)}function li(e){return jo(e,!1)}function le(e){return jo(e,!0)}function jo(e,t){let r=n=>Object.fromEntries(Object.entries(e).map(([i,s])=>[i,At(s,n?.[i])]));return Object.setPrototypeOf(r,mc),r.propTypes=e,Object.defineProperty(r,l,{value:{isAbstruct:t}}),r}var mc={type:"struct",$name(e){return G(this,e),this},toString(){return`struct:${x(this)??"<unnamed>"}`}};function Bt(e){let t=String(e);if(t!=="[object Object]")return t;try{return JSON.stringify(e)}catch(r){return console.error("Error parsing JSON:",r),"<invalid json>"}}function Gi(e){return Z(e)||rt(e)?e.toString():Array.isArray(e)?`[${e.map(Gi).join(", ")}]`:e&&typeof e=="object"?`{ ${Object.entries(e).map(([t,r])=>`${t}: ${Gi(r)}`).join(", ")} }`:String(e)}var yc={f32:4,f16:2,i32:4,u32:4,bool:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec2b:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec3b:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,vec4b:16,mat2x2f:8,mat3x3f:16,mat4x4f:16,atomic:4};function gc(e){let t=e?.type,r=yc[t];if(r!==void 0)return r;if(pe(e))return Object.values(e.propTypes).map(J).reduce((n,i)=>n>i?n:i);if(ve(e))return J(e.elementType);if(qe(e)){let n=Object.values(e.propTypes)[0];return n?Jr(n)??1:1}if(yt(e))return Jr(e.elementType)??1;if(We(e)||He(e))return Jr(e)??J(e.inner);if(ks.has(t))return 1;throw new Error(`Cannot determine alignment of data: ${Bt(e)}`)}function wc(e){if(qe(e)){let t=Object.values(e.propTypes)[0];return t?Oe(t):1}return yt(e)?Oe(e.elementType):He(e)?Jr(e)??Oe(e.inner):Jr(e)??1}var oa=new WeakMap,ua=new WeakMap;function J(e){let t=oa.get(e);return t===void 0&&(t=gc(e),oa.set(e,t)),t}function Oe(e){let t=ua.get(e);return t===void 0&&(t=wc(e),ua.set(e,t)),t}function xc(e){return J(e)}var Se=(e,t)=>{let r=t-1,n=~r;return(e&r)===0?e:(e&n)+t},vc={bool:4,f32:4,f16:2,i32:4,u32:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,"vec2<bool>":8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,"vec3<bool>":12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,"vec4<bool>":16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4,atomic:4};function $c(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){if(Number.isNaN(t))throw new Error("Only the last property of a struct can be unbounded");if(t=Se(t,J(n)),t+=U(n),Number.isNaN(t)&&n.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return Se(t,J(e))}function bc(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){let i=Oe(n);t=Se(t,i),t+=U(n)}return t}function _c(e){let t=vc[e?.type];if(t!==void 0)return t;if(pe(e))return $c(e);if(qe(e))return bc(e);if(ve(e)){if(e.elementCount===0)return Number.NaN;let r=J(e.elementType);return Se(U(e.elementType),r)*e.elementCount}if(yt(e)){let r=Oe(e.elementType);return Se(U(e.elementType),r)*e.elementCount}if(We(e)||He(e))return Yh(e)??U(e.inner);throw new Error(`Cannot determine size of data: ${e}`)}var ha=new WeakMap;function U(e){let t=ha.get(e);return t===void 0&&(t=_c(e),ha.set(e,t)),t}function Tc(e){return U(e)}function Cr(e,t){return We(e)?new la(e.inner,[t,...e.attribs]):He(e)?new ca(e.inner,[t,...e.attribs]):Br(e)?new ca(e,[t]):new la(e,[t])}function zc(e,t){return Cr(t,{[l]:!0,type:"@align",params:[e]})}function Ic(e,t){return Cr(t,{[l]:!0,type:"@size",params:[e]})}function Zn(e,t){return Cr(t,{[l]:!0,type:"@location",params:[e]})}function Sc(e,t){return Cr(t,{[l]:!0,type:"@interpolate",params:[e]})}function Ec(e){if(!wt(e))throw new Error("The @invariant attribute must only be applied to the position built-in value.");let t=We(e)||He(e)?e.attribs.find(as):void 0;if(!t||t.params[0]!=="position")throw new Error("The @invariant attribute must only be applied to the position built-in value.");return Cr(e,{[l]:!0,type:"@invariant",params:[]})}function wt(e){return(We(e)||He(e))&&e.attribs.find(as)!==void 0}function Ms(e){return!We(e)&&!He(e)?"":e.attribs.map(t=>t.params.length===0?`${t.type} `:`${t.type}(${t.params.join(", ")}) `).join("")}var Lo=class{constructor(t,r){this.inner=t,this.attribs=r;let n=r.find(is)?.params[0],i=r.find(ss)?.params[0];if(n!==void 0){if(n<=0)throw new Error(`Custom data alignment must be a positive number, got: ${n}.`);if(Math.log2(n)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${n}.`);if(Ot(this.inner)&&n%J(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${n}, expected multiple of: ${J(this.inner)}.`)}if(i!==void 0){if(i<U(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${i}, expected at least: ${U(this.inner)}.`);if(i<=0)throw new Error(`Custom data size must be a positive number. Got: ${i}.`)}}[l]=!0},la=class extends Lo{[l]=!0;type="decorated"},ca=class extends Lo{[l]=!0;type="loose-decorated"},on=Pt(((e,t)=>t===void 0?Pt(r=>pa(e,r)):pa(e,t))).$name("arrayOf");function pa(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Array schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>At(e,n?.[s]))};if(Object.setPrototypeOf(r,kc),Number.isNaN(U(e)))throw new Error("Cannot nest runtime sized arrays.");if(r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create array schema with invalid element count: ${t}.`);return r.elementCount=t,r}var kc={[l]:!0,type:"array",toString(){return`arrayOf(${this.elementType}, ${this.elementCount})`}};function xe(e,t){return Cr(e,{[l]:!0,type:"@builtin",params:[t]})}var No={vertexIndex:xe($,"vertex_index"),instanceIndex:xe($,"instance_index"),position:xe(z,"position"),clipDistances:xe(on($,8),"clip_distances"),frontFacing:xe(F,"front_facing"),fragDepth:xe(w,"frag_depth"),sampleIndex:xe($,"sample_index"),sampleMask:xe($,"sample_mask"),localInvocationId:xe(te,"local_invocation_id"),localInvocationIndex:xe($,"local_invocation_index"),globalInvocationId:xe(te,"global_invocation_id"),workgroupId:xe(te,"workgroup_id"),numWorkgroups:xe(te,"num_workgroups"),subgroupInvocationId:xe($,"subgroup_invocation_id"),subgroupSize:xe($,"subgroup_size")};function Mr(e,t){for(let[r,n]of Object.entries(t))e[r]=n,n&&(typeof n=="object"||typeof n=="function")&&x(n)===void 0&&G(n,r)}function Mc(e,t,r){let n=[...e.matchAll(/:\s*(?<arg>.*?)\s*[,)]/g)].map(i=>i?i[1]:void 0);r(Object.fromEntries(t.flatMap((i,s)=>{let a=n?n[s]:void 0;return pe(i)&&a!==void 0?[[a,i]]:[]})))}function Do(e,t,r){let n=e.match(/->\s(?<output>[\w\d_]+)\s{/),i=n?n[1]?.trim():void 0;pe(t)&&i&&!/\s/g.test(i)&&r({[i]:t})}function Uc(e){return new RegExp(`(?<![\\w\\$_.])${e.replaceAll(".","\\.").replaceAll("$","\\$")}(?![\\w\\$_])`,"g")}function wn(e,t,r){return Object.entries(t).reduce((n,[i,s])=>{let a=Uc(i);if(r&&i!=="Out"&&i!=="In"&&!a.test(r)&&console.warn(`The external '${i}' wasn't used in the resolved template.`),hl(s)||Br(s)||Zr(s))return n.replaceAll(a,e.resolve(s).value);if(s!==null&&typeof s=="object"){let o=[...r.matchAll(new RegExp(`${i.replaceAll(".","\\.").replaceAll("$","\\$")}\\.(?<prop>.*?)(?![\\w\\$_])`,"g"))].map(u=>u[1]);return[...new Set(o)].reduce((u,h)=>h&&h in s?wn(e,{[`${i}.${h}`]:s[h]},u):u,n)}return console.warn(`During resolution, the external '${i}' has been omitted. Only TGPU resources, 'use gpu' functions, primitives, and plain JS objects can be used as externals.`),n},r)}function Vc(e){let{strippedCode:t,argRange:r}=Pc(e),n=new Wo(t);n.consume("(");let i=[];for(;!n.isAt(")");){let a=[];for(;n.isAt("@");)n.parseUntil(da,fa),n.consume(")"),a.push(n.lastParsed);n.parseUntil(Bc);let o=n.lastParsed,u;n.isAt(":")&&(n.consume(":"),n.parseUntil(Oc,Fc),u=n.lastParsed),i.push({identifier:o,attributes:a,type:u}),n.isAt(",")&&n.consume(",")}n.consume(")");let s;if(n.isAt("->")){n.consume("->");let a=[];for(;n.isAt("@");)n.parseUntil(da,fa),n.consume(")"),a.push(n.lastParsed);s={type:n.str.slice(n.pos),attributes:a}}return{args:i,ret:s,range:{begin:r[0],end:r[1]}}}function Pc(e){let t=new Wo(e),r="",n;for(;!t.isFinished();){if(t.isAt(Ac)){t.advanceBy(1);continue}if(t.isAt("//")){t.consume("//"),t.parseUntil(qo),t.advanceBy(1);continue}if(t.isAt("/*")){t.parseUntil(Cc,Gc),t.consume("*/");continue}if(t.isAt("{"))return{strippedCode:r,argRange:[n,t.pos]};t.isAt("(")&&n===void 0&&(n=t.pos),n!==void 0&&(r+=t.str[t.pos]),t.advanceBy(1)}throw new Error("Invalid wgsl code!")}var Wo=class{constructor(t){this.str=t,this.#t=0}#e;#t;get pos(){return this.#t}get lastParsed(){if(this.#e===void 0)throw new Error("Parse was not called yet!");return this.str.slice(this.#e,this.pos)}isFinished(){return this.#t>=this.str.length}isAt(t){if(typeof t=="string"){for(let r=0;r<t.length;r++)if(this.str[this.#t+r]!==t[r])return!1;return!0}for(let r of t)if(this.isAt(r))return!0;return!1}parseUntil(t,r){this.#e=this.#t;let n=0;for(;this.#t<this.str.length;){if(r&&this.isAt(r[0])&&(n+=1),r&&this.isAt(r[1])&&(n-=1),n===0&&this.isAt(t))return this.#t;this.#t+=1}throw new Error("Reached the end of the string without finding a match!")}advanceBy(t){this.#t+=t}consume(t){if(!this.isAt(t))throw new Error(`Expected '${t}' at position ${this.#t}, but found '${this.str.slice(this.#t,this.#t+t.length)}'`);this.advanceBy(t.length)}},qo=new Set([`
`,"\v","\f","\r","","\u2028","\u2029"]),Ac=new Set([...qo," ","	","",""]),da=new Set([")"]),Bc=new Set([":",",",")"]),Oc=new Set([",",")"]),Cc=new Set(["*/"]),fa=["(",")"],Fc=["<",">"],Gc=["/*","*/"];function xn(e,t=""){let r=[],n={applyExternals(s){r.push(s)},resolve(s,a,o){let u={};for(let Re of r)Mr(u,Re);let h=s.getUniqueName(this);if(typeof e=="string"){if(!o)throw new Error("Explicit return type is required for string implementation");let Re=wn(s,u,e),Ct="",Ft="";if(t!==""){let Me=pe(a[0])?`(in: ${s.resolve(a[0]).value})`:"()",ht=Ot(o)?Ms(o):"",Lr=o!==ee?pe(o)?`-> ${s.resolve(o).value}`:`-> ${ht!==""?ht:"@location(0)"} ${s.resolve(o).value}`:"";Ct=`${Me} ${Lr} `,Ft=Re}else{let Me=Vc(Re);if(Me.args.length!==a.length)throw new Error(`WGSL implementation has ${Me.args.length} arguments, while the shell has ${a.length} arguments.`);let ht=Me.args.map((Nr,Sn)=>`${Nr.identifier}: ${ma(s,`parameter ${Nr.identifier}`,Nr.type,a[Sn])}`).join(", "),Lr=o===ee?"":`-> ${ma(s,"return type",Me.ret?.type,o)}`;Ct=`(${ht}) ${Lr}`,Ft=Re.slice(Me.range.end)}return s.addDeclaration(`${t}fn ${h}${Ct}${Ft}`),y(h,o,"runtime")}let p=ai(e),f=typeof p?.externals=="function"?p.externals():p?.externals;if(f){let Re=Object.fromEntries(Object.entries(f).filter(([Ct])=>!(Ct in u)));Mr(u,Re)}let m=p?.ast;if(!m)throw new Error("Missing metadata for tgpu.fn function body (either missing 'use gpu' directive, or misconfigured `unplugin-typegpu`)");let v=m.externalNames.filter(Re=>!(Re in u));if(v.length>0)throw new Jh(x(this),v);let b=m.params[1];b&&b.type==="i"&&t!==""&&Mr(u,{[b.name]:mt(o)});let{head:V,body:D,returnType:H}=s.fnToWgsl({functionType:t.includes("@compute")?"compute":t.includes("@vertex")?"vertex":t.includes("@fragment")?"fragment":"normal",argTypes:a,params:m.params,returnType:o,body:m.body,externalMap:u});return s.addDeclaration(`${t}fn ${h}${s.resolve(V).value}${s.resolve(D).value}`),y(h,H,"runtime")}},i=x(e);return i!==void 0&&G(n,i),n}function ma(e,t,r,n){let i=e.resolve(n).value.replace(/\s/g,"");if(!r)return i;let s=r.replace(/\s/g,"");if(s!==i)throw new Error(`Type mismatch between TGPU shell and WGSL code string: ${t}, JS type "${i}", WGSL type "${s}".`);return r}function Rc(e,t={}){let r=0,n=new Set;return Object.fromEntries(Object.entries(e??{}).map(([i,s])=>{let a=Vt(s);if(a!==void 0){if(n.has(a))throw new Error("Duplicate custom location attributes found");n.add(a)}return[i,s]}).map(([i,s])=>{if(wt(s))return[i,s];if(Vt(s)!==void 0)return[i,s];if(t[i])return[i,Zn(t[i],s)];for(;n.has(r);)r++;return[i,Zn(r++,s)]}))}function vn(e,t={}){return Or(e)?to(e)||wt(e)||Vt(e)!==void 0?e:Zn(0,e):li(Rc(e,t))}function ci(e,...t){return jc(e)?Lc(e,...t):e}function jc(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)&&e.raw.every(t=>typeof t=="string")}function Lc(e,...t){return e.slice(1).reduce((r,n,i)=>`${r}${t[i]}${n}`,e[0])}function Nc(e){if(Object.keys(e.out).length===0)throw new Error("A vertexFn output cannot be empty since it must include the 'position' builtin.");let t={in:e.in,out:e.out,argTypes:e.in&&Object.keys(e.in).length!==0?[vn(e.in)]:[],isEntry:!0};return Object.assign((r,...n)=>Dc(t,ci(r,...n)),t)}function Dc(e,t){let r=xn(t,"@vertex "),n=e.argTypes[0];return{shell:e,$uses(i){return r.applyExternals(i),this},[l]:!0,[ne]:r,$name(i){return G(r,i),si(n)&&n.$name(`${i}_Input`),this},[T](i){let s=vn(e.out,i.varyingLocations).$name(`${x(this)??""}_Output`);return typeof t=="string"&&(n&&r.applyExternals({In:n}),r.applyExternals({Out:s})),r.resolve(i,e.argTypes,s)},toString(){return`vertexFn:${x(r)??"<unnamed>"}`}}}var Fr=class{};function Us(e){let t=d({name:e.type,normalImpl:(...n)=>{let i=[];for(let s of n)if(typeof s=="number")i.push(s);else for(let a=0;a<s.length;++a)i.push(s[a]);if(i.length!==0&&i.length!==e.columns*e.rows)throw new Error(`'${e.type}' constructor called with invalid number of arguments.`);for(let s=i.length;s<e.columns*e.rows;++s)i.push(0);return new e.MatImpl(...i)},ignoreImplicitCastWarning:!0,signature:(...n)=>({argTypes:n.map(i=>it(i)?i:w),returnType:r}),codegenImpl:(...n)=>c`${e.type}(${n})`}),r=Object.assign(t,{type:e.type,identity:Zc[e.columns],translation:e.columns===4?pi:void 0,scaling:e.columns===4?di:void 0,rotationX:e.columns===4?fi:void 0,rotationY:e.columns===4?mi:void 0,rotationZ:e.columns===4?yi:void 0});return e.MatImpl.prototype.schema=r,r}var Wc=class extends Fr{[l]=!0;columns;length=4;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1]),this.makeColumn(t[2],t[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[1].x=t}set 3(t){this.columns[1].y=t}*[Symbol.iterator](){yield this[0],yield this[1],yield this[2],yield this[3]}[T](){return y(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,vt,"runtime")}toString(){return this[T]().value}},qc=class extends Wc{kind="mat2x2f";makeColumn(t,r){return P(t,r)}},Hc=class extends Fr{[l]=!0;columns;length=12;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2]),this.makeColumn(t[3],t[4],t[5]),this.makeColumn(t[6],t[7],t[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){}*[Symbol.iterator](){for(let t=0;t<12;t++)yield this[t]}[T](){return y(`${this.kind}(${this[0]}, ${this[1]}, ${this[2]}, ${this[4]}, ${this[5]}, ${this[6]}, ${this[8]}, ${this[9]}, ${this[10]})`,$t,"runtime")}toString(){return this[T]().value}},Yc=class extends Hc{kind="mat3x3f";makeColumn(t,r,n){return se(t,r,n)}},Xc=class extends Fr{[l]=!0;columns;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2],t[3]),this.makeColumn(t[4],t[5],t[6],t[7]),this.makeColumn(t[8],t[9],t[10],t[11]),this.makeColumn(t[12],t[13],t[14],t[15])]}length=16;get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){this.columns[0].w=t}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){this.columns[1].w=t}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){this.columns[2].w=t}set 12(t){this.columns[3].x=t}set 13(t){this.columns[3].y=t}set 14(t){this.columns[3].z=t}set 15(t){this.columns[3].w=t}*[Symbol.iterator](){for(let t=0;t<16;t++)yield this[t]}[T](){return y(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,q,"runtime")}toString(){return this[T]().value}},Qc=class extends Xc{kind="mat4x4f";makeColumn(t,r,n,i){return z(t,r,n,i)}},Ho=Pt(()=>vt(1,0,0,1)).$name("identity2"),Yo=Pt(()=>$t(1,0,0,0,1,0,0,0,1)).$name("identity3"),Xo=Pt(()=>q(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)).$name("identity4"),Zc={2:Ho,3:Yo,4:Xo},pi=d({name:"translation4",normalImpl:e=>q(1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1),get signature(){return{argTypes:[se],returnType:q}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, ${e}.x, ${e}.y, ${e}.z, 1)`}),di=d({name:"scaling4",normalImpl:e=>q(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),get signature(){return{argTypes:[se],returnType:q}},codegenImpl:e=>c`mat4x4f(${e}.x, 0, 0, 0, 0, ${e}.y, 0, 0, 0, 0, ${e}.z, 0, 0, 0, 0, 1)`}),fi=d({name:"rotationX4",normalImpl:e=>q(1,0,0,0,0,Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[w],returnType:q}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1)`}),mi=d({name:"rotationY4",normalImpl:e=>q(Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[w],returnType:q}},codegenImpl:e=>c`mat4x4f(cos(${e}), 0, -sin(${e}), 0, 0, 1, 0, 0, sin(${e}), 0, cos(${e}), 0, 0, 0, 0, 1)`}),yi=d({name:"rotationZ4",normalImpl:e=>q(Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1),get signature(){return{argTypes:[w],returnType:q}},codegenImpl:e=>c`mat4x4f(cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)`}),vt=Us({type:"mat2x2f",rows:2,columns:2,MatImpl:qc}),$t=Us({type:"mat3x3f",rows:3,columns:3,MatImpl:Yc}),q=Us({type:"mat4x4f",rows:4,columns:4,MatImpl:Qc});function Jc(e){return e.kind==="mat3x3f"?[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]:Array.from({length:e.length}).map((t,r)=>e[r])}var Dt=(e,t,r)=>{if(e===t)return 0;let n=E((r-e)/(t-e),0,1);return n*n*(3-2*n)},E=(e,t,r)=>Math.min(Math.max(t,e),r),ir=(e,t)=>t===0?e:Math.trunc(e/t);function Ze(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getFloat32(0,!0)}function Je(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getInt32(0,!0)}var Ue=Zt[l].jsImpl,Ae=P[l].jsImpl,ct=at[l].jsImpl,Ir=ue[l].jsImpl,Kr=_e[l].jsImpl,Ve=Jt[l].jsImpl,ze=se[l].jsImpl,Ke=ot[l].jsImpl,Sr=ke[l].jsImpl,en=te[l].jsImpl,Pe=Kt[l].jsImpl,Be=z[l].jsImpl,pt=ut[l].jsImpl,Er=he[l].jsImpl,tn=me[l].jsImpl,sr=e=>Math.sqrt(e.x**2+e.y**2),ar=e=>Math.sqrt(e.x**2+e.y**2+e.z**2),or=e=>Math.sqrt(e.x**2+e.y**2+e.z**2+e.w**2),Mn=(e,t)=>e.x*t.x+e.y*t.y,Un=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z,Vn=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,W=e=>t=>Ae(e(t.x),e(t.y)),Y=e=>t=>ct(e(t.x),e(t.y)),ur=e=>t=>Ir(e(t.x),e(t.y)),Dr=e=>t=>Kr(e(t.x),e(t.y)),N=e=>t=>ze(e(t.x),e(t.y),e(t.z)),X=e=>t=>Ke(e(t.x),e(t.y),e(t.z)),hr=e=>t=>Sr(e(t.x),e(t.y),e(t.z)),Wr=e=>t=>en(e(t.x),e(t.y),e(t.z)),L=e=>t=>Be(e(t.x),e(t.y),e(t.z),e(t.w)),Q=e=>t=>pt(e(t.x),e(t.y),e(t.z),e(t.w)),lr=e=>t=>Er(e(t.x),e(t.y),e(t.z),e(t.w)),qr=e=>t=>tn(e(t.x),e(t.y),e(t.z),e(t.w)),ya=e=>t=>{let r=t.columns;return vt(W(e)(r[0]),W(e)(r[1]))},ga=e=>t=>{let r=t.columns;return $t(N(e)(r[0]),N(e)(r[1]),N(e)(r[2]))},wa=e=>t=>{let r=t.columns;return q(L(e)(r[0]),L(e)(r[1]),L(e)(r[2]),L(e)(r[3]))},lt=e=>(t,r)=>Ae(e(t.x,r.x),e(t.y,r.y)),Gt=e=>(t,r)=>ct(e(t.x,r.x),e(t.y,r.y)),cr=e=>(t,r)=>Ir(e(t.x,r.x),e(t.y,r.y)),pr=e=>(t,r)=>Kr(e(t.x,r.x),e(t.y,r.y)),et=e=>(t,r)=>ze(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Rt=e=>(t,r)=>Ke(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),dr=e=>(t,r)=>Sr(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),fr=e=>(t,r)=>en(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Le=e=>(t,r)=>Be(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),jt=e=>(t,r)=>pt(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),mr=e=>(t,r)=>Er(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),yr=e=>(t,r)=>tn(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),Kc=e=>(t,r)=>{let n=t.columns,i=r.columns;return vt(lt(e)(n[0],i[0]),lt(e)(n[1],i[1]))},ep=e=>(t,r)=>{let n=t.columns,i=r.columns;return $t(et(e)(n[0],i[0]),et(e)(n[1],i[1]),et(e)(n[2],i[2]))},tp=e=>(t,r)=>{let n=t.columns,i=r.columns;return q(Le(e)(n[0],i[0]),Le(e)(n[1],i[1]),Le(e)(n[2],i[2]),Le(e)(n[3],i[3]))},rp=e=>(t,r,n)=>Ae(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),np=e=>(t,r,n)=>ct(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),ip=e=>(t,r,n)=>ze(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),sp=e=>(t,r,n)=>Ke(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),ap=e=>(t,r,n)=>Be(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),op=e=>(t,r,n)=>pt(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),_={eq:{vec2f:(e,t)=>Ue(e.x===t.x,e.y===t.y),vec2h:(e,t)=>Ue(e.x===t.x,e.y===t.y),vec2i:(e,t)=>Ue(e.x===t.x,e.y===t.y),vec2u:(e,t)=>Ue(e.x===t.x,e.y===t.y),"vec2<bool>":(e,t)=>Ue(e.x===t.x,e.y===t.y),vec3f:(e,t)=>Ve(e.x===t.x,e.y===t.y,e.z===t.z),vec3h:(e,t)=>Ve(e.x===t.x,e.y===t.y,e.z===t.z),vec3i:(e,t)=>Ve(e.x===t.x,e.y===t.y,e.z===t.z),vec3u:(e,t)=>Ve(e.x===t.x,e.y===t.y,e.z===t.z),"vec3<bool>":(e,t)=>Ve(e.x===t.x,e.y===t.y,e.z===t.z),vec4f:(e,t)=>Pe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4h:(e,t)=>Pe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4i:(e,t)=>Pe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4u:(e,t)=>Pe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),"vec4<bool>":(e,t)=>Pe(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w)},lt:{vec2f:(e,t)=>Ue(e.x<t.x,e.y<t.y),vec2h:(e,t)=>Ue(e.x<t.x,e.y<t.y),vec2i:(e,t)=>Ue(e.x<t.x,e.y<t.y),vec2u:(e,t)=>Ue(e.x<t.x,e.y<t.y),vec3f:(e,t)=>Ve(e.x<t.x,e.y<t.y,e.z<t.z),vec3h:(e,t)=>Ve(e.x<t.x,e.y<t.y,e.z<t.z),vec3i:(e,t)=>Ve(e.x<t.x,e.y<t.y,e.z<t.z),vec3u:(e,t)=>Ve(e.x<t.x,e.y<t.y,e.z<t.z),vec4f:(e,t)=>Pe(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4h:(e,t)=>Pe(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4i:(e,t)=>Pe(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4u:(e,t)=>Pe(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w)},or:{"vec2<bool>":(e,t)=>Ue(e.x||t.x,e.y||t.y),"vec3<bool>":(e,t)=>Ve(e.x||t.x,e.y||t.y,e.z||t.z),"vec4<bool>":(e,t)=>Pe(e.x||t.x,e.y||t.y,e.z||t.z,e.w||t.w)},all:{"vec2<bool>":e=>e.x&&e.y,"vec3<bool>":e=>e.x&&e.y&&e.z,"vec4<bool>":e=>e.x&&e.y&&e.z&&e.w},abs:{vec2f:W(Math.abs),vec2h:Y(Math.abs),vec2i:ur(Math.abs),vec2u:Dr(Math.abs),vec3f:N(Math.abs),vec3h:X(Math.abs),vec3i:hr(Math.abs),vec3u:Wr(Math.abs),vec4f:L(Math.abs),vec4h:Q(Math.abs),vec4i:lr(Math.abs),vec4u:qr(Math.abs)},atan2:{vec2f:lt(Math.atan2),vec2h:Gt(Math.atan2),vec3f:et(Math.atan2),vec3h:Rt(Math.atan2),vec4f:Le(Math.atan2),vec4h:jt(Math.atan2)},acos:{vec2f:W(Math.acos),vec2h:Y(Math.acos),vec2i:ur(Math.acos),vec2u:Dr(Math.acos),vec3f:N(Math.acos),vec3h:X(Math.acos),vec3i:hr(Math.acos),vec3u:Wr(Math.acos),vec4f:L(Math.acos),vec4h:Q(Math.acos),vec4i:lr(Math.acos),vec4u:qr(Math.acos)},acosh:{vec2f:W(Math.acosh),vec2h:Y(Math.acosh),vec3f:N(Math.acosh),vec3h:X(Math.acosh),vec4f:L(Math.acosh),vec4h:Q(Math.acosh)},asin:{vec2f:W(Math.asin),vec2h:Y(Math.asin),vec3f:N(Math.asin),vec3h:X(Math.asin),vec4f:L(Math.asin),vec4h:Q(Math.asin)},asinh:{vec2f:W(Math.asinh),vec2h:Y(Math.asinh),vec3f:N(Math.asinh),vec3h:X(Math.asinh),vec4f:L(Math.asinh),vec4h:Q(Math.asinh)},atan:{vec2f:W(Math.atan),vec2h:Y(Math.atan),vec3f:N(Math.atan),vec3h:X(Math.atan),vec4f:L(Math.atan),vec4h:Q(Math.atan)},atanh:{vec2f:W(Math.atanh),vec2h:Y(Math.atanh),vec3f:N(Math.atanh),vec3h:X(Math.atanh),vec4f:L(Math.atanh),vec4h:Q(Math.atanh)},ceil:{vec2f:W(Math.ceil),vec2h:Y(Math.ceil),vec3f:N(Math.ceil),vec3h:X(Math.ceil),vec4f:L(Math.ceil),vec4h:Q(Math.ceil)},clamp:{vec2f:(e,t,r)=>Ae(E(e.x,t.x,r.x),E(e.y,t.y,r.y)),vec2h:(e,t,r)=>ct(E(e.x,t.x,r.x),E(e.y,t.y,r.y)),vec2i:(e,t,r)=>Ir(E(e.x,t.x,r.x),E(e.y,t.y,r.y)),vec2u:(e,t,r)=>Kr(E(e.x,t.x,r.x),E(e.y,t.y,r.y)),vec3f:(e,t,r)=>ze(E(e.x,t.x,r.x),E(e.y,t.y,r.y),E(e.z,t.z,r.z)),vec3h:(e,t,r)=>Ke(E(e.x,t.x,r.x),E(e.y,t.y,r.y),E(e.z,t.z,r.z)),vec3i:(e,t,r)=>Sr(E(e.x,t.x,r.x),E(e.y,t.y,r.y),E(e.z,t.z,r.z)),vec3u:(e,t,r)=>en(E(e.x,t.x,r.x),E(e.y,t.y,r.y),E(e.z,t.z,r.z)),vec4f:(e,t,r)=>Be(E(e.x,t.x,r.x),E(e.y,t.y,r.y),E(e.z,t.z,r.z),E(e.w,t.w,r.w)),vec4h:(e,t,r)=>pt(E(e.x,t.x,r.x),E(e.y,t.y,r.y),E(e.z,t.z,r.z),E(e.w,t.w,r.w)),vec4i:(e,t,r)=>Er(E(e.x,t.x,r.x),E(e.y,t.y,r.y),E(e.z,t.z,r.z),E(e.w,t.w,r.w)),vec4u:(e,t,r)=>tn(E(e.x,t.x,r.x),E(e.y,t.y,r.y),E(e.z,t.z,r.z),E(e.w,t.w,r.w))},length:{vec2f:sr,vec2h:sr,vec3f:ar,vec3h:ar,vec4f:or,vec4h:or},add:{vec2f:lt((e,t)=>e+t),vec2h:Gt((e,t)=>e+t),vec2i:cr((e,t)=>e+t),vec2u:pr((e,t)=>e+t),vec3f:et((e,t)=>e+t),vec3h:Rt((e,t)=>e+t),vec3i:dr((e,t)=>e+t),vec3u:fr((e,t)=>e+t),vec4f:Le((e,t)=>e+t),vec4h:jt((e,t)=>e+t),vec4i:mr((e,t)=>e+t),vec4u:yr((e,t)=>e+t),mat2x2f:Kc((e,t)=>e+t),mat3x3f:ep((e,t)=>e+t),mat4x4f:tp((e,t)=>e+t)},smoothstep:{vec2f:rp(Dt),vec2h:np(Dt),vec3f:ip(Dt),vec3h:sp(Dt),vec4f:ap(Dt),vec4h:op(Dt)},addMixed:{vec2f:(e,t)=>W(r=>r+t)(e),vec2h:(e,t)=>Y(r=>r+t)(e),vec2i:(e,t)=>ur(r=>r+t)(e),vec2u:(e,t)=>Dr(r=>r+t)(e),vec3f:(e,t)=>N(r=>r+t)(e),vec3h:(e,t)=>X(r=>r+t)(e),vec3i:(e,t)=>hr(r=>r+t)(e),vec3u:(e,t)=>Wr(r=>r+t)(e),vec4f:(e,t)=>L(r=>r+t)(e),vec4h:(e,t)=>Q(r=>r+t)(e),vec4i:(e,t)=>lr(r=>r+t)(e),vec4u:(e,t)=>qr(r=>r+t)(e),mat2x2f:(e,t)=>ya(r=>r+t)(e),mat3x3f:(e,t)=>ga(r=>r+t)(e),mat4x4f:(e,t)=>wa(r=>r+t)(e)},mulSxV:{vec2f:(e,t)=>W(r=>e*r)(t),vec2h:(e,t)=>Y(r=>e*r)(t),vec2i:(e,t)=>ur(r=>e*r)(t),vec2u:(e,t)=>Dr(r=>e*r)(t),vec3f:(e,t)=>N(r=>e*r)(t),vec3h:(e,t)=>X(r=>e*r)(t),vec3i:(e,t)=>hr(r=>e*r)(t),vec3u:(e,t)=>Wr(r=>e*r)(t),vec4f:(e,t)=>L(r=>e*r)(t),vec4h:(e,t)=>Q(r=>e*r)(t),vec4i:(e,t)=>lr(r=>e*r)(t),vec4u:(e,t)=>qr(r=>e*r)(t),mat2x2f:(e,t)=>ya(r=>e*r)(t),mat3x3f:(e,t)=>ga(r=>e*r)(t),mat4x4f:(e,t)=>wa(r=>e*r)(t)},mulVxV:{vec2f:lt((e,t)=>e*t),vec2h:Gt((e,t)=>e*t),vec2i:cr((e,t)=>e*t),vec2u:pr((e,t)=>e*t),vec3f:et((e,t)=>e*t),vec3h:Rt((e,t)=>e*t),vec3i:dr((e,t)=>e*t),vec3u:fr((e,t)=>e*t),vec4f:Le((e,t)=>e*t),vec4h:jt((e,t)=>e*t),vec4i:mr((e,t)=>e*t),vec4u:yr((e,t)=>e*t),mat2x2f:(e,t)=>{let r=e.columns,n=t.columns;return vt(r[0].x*n[0].x+r[1].x*n[0].y,r[0].y*n[0].x+r[1].y*n[0].y,r[0].x*n[1].x+r[1].x*n[1].y,r[0].y*n[1].x+r[1].y*n[1].y)},mat3x3f:(e,t)=>{let r=e.columns,n=t.columns;return $t(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z)},mat4x4f:(e,t)=>{let r=e.columns,n=t.columns;return q(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z+r[3].x*n[0].w,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z+r[3].y*n[0].w,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z+r[3].z*n[0].w,r[0].w*n[0].x+r[1].w*n[0].y+r[2].w*n[0].z+r[3].w*n[0].w,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z+r[3].x*n[1].w,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z+r[3].y*n[1].w,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z+r[3].z*n[1].w,r[0].w*n[1].x+r[1].w*n[1].y+r[2].w*n[1].z+r[3].w*n[1].w,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z+r[3].x*n[2].w,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z+r[3].y*n[2].w,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z+r[3].z*n[2].w,r[0].w*n[2].x+r[1].w*n[2].y+r[2].w*n[2].z+r[3].w*n[2].w,r[0].x*n[3].x+r[1].x*n[3].y+r[2].x*n[3].z+r[3].x*n[3].w,r[0].y*n[3].x+r[1].y*n[3].y+r[2].y*n[3].z+r[3].y*n[3].w,r[0].z*n[3].x+r[1].z*n[3].y+r[2].z*n[3].z+r[3].z*n[3].w,r[0].w*n[3].x+r[1].w*n[3].y+r[2].w*n[3].z+r[3].w*n[3].w)}},mulMxV:{mat2x2f:(e,t)=>{let r=e.columns;return Ae(r[0].x*t.x+r[1].x*t.y,r[0].y*t.x+r[1].y*t.y)},mat3x3f:(e,t)=>{let r=e.columns;return ze(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z)},mat4x4f:(e,t)=>{let r=e.columns;return Be(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z+r[3].x*t.w,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z+r[3].y*t.w,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z+r[3].z*t.w,r[0].w*t.x+r[1].w*t.y+r[2].w*t.z+r[3].w*t.w)}},mulVxM:{mat2x2f:(e,t)=>{let r=t.columns;return Ae(e.x*r[0].x+e.y*r[0].y,e.x*r[1].x+e.y*r[1].y)},mat3x3f:(e,t)=>{let r=t.columns;return ze(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z)},mat4x4f:(e,t)=>{let r=t.columns;return Be(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z+e.w*r[0].w,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z+e.w*r[1].w,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z+e.w*r[2].w,e.x*r[3].x+e.y*r[3].y+e.z*r[3].z+e.w*r[3].w)}},div:{vec2f:lt((e,t)=>e/t),vec2h:Gt((e,t)=>e/t),vec2i:cr(ir),vec2u:pr(ir),vec3f:et((e,t)=>e/t),vec3h:Rt((e,t)=>e/t),vec3i:dr(ir),vec3u:fr(ir),vec4f:Le((e,t)=>e/t),vec4h:jt((e,t)=>e/t),vec4i:mr(ir),vec4u:yr(ir)},dot:{vec2f:Mn,vec2h:Mn,vec2i:Mn,vec2u:Mn,vec3f:Un,vec3h:Un,vec3i:Un,vec3u:Un,vec4f:Vn,vec4h:Vn,vec4i:Vn,vec4u:Vn},normalize:{vec2f:e=>{let t=sr(e);return Ae(e.x/t,e.y/t)},vec2h:e=>{let t=sr(e);return ct(e.x/t,e.y/t)},vec2i:e=>{let t=sr(e);return Ir(e.x/t,e.y/t)},vec2u:e=>{let t=sr(e);return Kr(e.x/t,e.y/t)},vec3f:e=>{let t=ar(e);return ze(e.x/t,e.y/t,e.z/t)},vec3h:e=>{let t=ar(e);return Ke(e.x/t,e.y/t,e.z/t)},vec3i:e=>{let t=ar(e);return Sr(e.x/t,e.y/t,e.z/t)},vec3u:e=>{let t=ar(e);return en(e.x/t,e.y/t,e.z/t)},vec4f:e=>{let t=or(e);return Be(e.x/t,e.y/t,e.z/t,e.w/t)},vec4h:e=>{let t=or(e);return pt(e.x/t,e.y/t,e.z/t,e.w/t)},vec4i:e=>{let t=or(e);return Er(e.x/t,e.y/t,e.z/t,e.w/t)},vec4u:e=>{let t=or(e);return tn(e.x/t,e.y/t,e.z/t,e.w/t)}},cross:{vec3f:(e,t)=>ze(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x),vec3h:(e,t)=>Ke(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},mod:{vec2f:lt((e,t)=>e%t),vec2h:Gt((e,t)=>e%t),vec2i:cr((e,t)=>e%t),vec2u:pr((e,t)=>e%t),vec3f:et((e,t)=>e%t),vec3h:Rt((e,t)=>e%t),vec3i:dr((e,t)=>e%t),vec3u:fr((e,t)=>e%t),vec4f:Le((e,t)=>e%t),vec4h:jt((e,t)=>e%t),vec4i:mr((e,t)=>e%t),vec4u:yr((e,t)=>e%t)},floor:{vec2f:W(Math.floor),vec2h:Y(Math.floor),vec3f:N(Math.floor),vec3h:X(Math.floor),vec4f:L(Math.floor),vec4h:Q(Math.floor)},max:{vec2f:lt(Math.max),vec2h:Gt(Math.max),vec2i:cr(Math.max),vec2u:pr(Math.max),vec3f:et(Math.max),vec3h:Rt(Math.max),vec3i:dr(Math.max),vec3u:fr(Math.max),vec4f:Le(Math.max),vec4h:jt(Math.max),vec4i:mr(Math.max),vec4u:yr(Math.max)},min:{vec2f:lt(Math.min),vec2h:Gt(Math.min),vec2i:cr(Math.min),vec2u:pr(Math.min),vec3f:et(Math.min),vec3h:Rt(Math.min),vec3i:dr(Math.min),vec3u:fr(Math.min),vec4f:Le(Math.min),vec4h:jt(Math.min),vec4i:mr(Math.min),vec4u:yr(Math.min)},pow:{vec2f:(e,t)=>Ae(e.x**t.x,e.y**t.y),vec2h:(e,t)=>ct(e.x**t.x,e.y**t.y),vec3f:(e,t)=>ze(e.x**t.x,e.y**t.y,e.z**t.z),vec3h:(e,t)=>Ke(e.x**t.x,e.y**t.y,e.z**t.z),vec4f:(e,t)=>Be(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w),vec4h:(e,t)=>pt(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w)},sign:{vec2f:W(Math.sign),vec2h:Y(Math.sign),vec2i:ur(Math.sign),vec3f:N(Math.sign),vec3h:X(Math.sign),vec3i:hr(Math.sign),vec4f:L(Math.sign),vec4h:Q(Math.sign),vec4i:lr(Math.sign)},sqrt:{vec2f:W(Math.sqrt),vec2h:Y(Math.sqrt),vec3f:N(Math.sqrt),vec3h:X(Math.sqrt),vec4f:L(Math.sqrt),vec4h:Q(Math.sqrt)},mix:{vec2f:(e,t,r)=>typeof r=="number"?Ae(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):Ae(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec2h:(e,t,r)=>typeof r=="number"?ct(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):ct(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec3f:(e,t,r)=>typeof r=="number"?ze(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):ze(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec3h:(e,t,r)=>typeof r=="number"?Ke(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):Ke(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec4f:(e,t,r)=>typeof r=="number"?Be(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):Be(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w),vec4h:(e,t,r)=>typeof r=="number"?pt(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):pt(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w)},sin:{vec2f:W(Math.sin),vec2h:Y(Math.sin),vec3f:N(Math.sin),vec3h:X(Math.sin),vec4f:L(Math.sin),vec4h:Q(Math.sin)},cos:{vec2f:W(Math.cos),vec2h:Y(Math.cos),vec3f:N(Math.cos),vec3h:X(Math.cos),vec4f:L(Math.cos),vec4h:Q(Math.cos)},cosh:{vec2f:W(Math.cosh),vec2h:Y(Math.cosh),vec3f:N(Math.cosh),vec3h:X(Math.cosh),vec4f:L(Math.cosh),vec4h:Q(Math.cosh)},exp:{vec2f:W(Math.exp),vec2h:Y(Math.exp),vec3f:N(Math.exp),vec3h:X(Math.exp),vec4f:L(Math.exp),vec4h:Q(Math.exp)},exp2:{vec2f:W(e=>2**e),vec2h:Y(e=>2**e),vec3f:N(e=>2**e),vec3h:X(e=>2**e),vec4f:L(e=>2**e),vec4h:Q(e=>2**e)},log:{vec2f:W(Math.log),vec2h:Y(Math.log),vec3f:N(Math.log),vec3h:X(Math.log),vec4f:L(Math.log),vec4h:Q(Math.log)},log2:{vec2f:W(Math.log2),vec2h:Y(Math.log2),vec3f:N(Math.log2),vec3h:X(Math.log2),vec4f:L(Math.log2),vec4h:Q(Math.log2)},fract:{vec2f:W(e=>e-Math.floor(e)),vec2h:Y(e=>e-Math.floor(e)),vec3f:N(e=>e-Math.floor(e)),vec3h:X(e=>e-Math.floor(e)),vec4f:L(e=>e-Math.floor(e)),vec4h:Q(e=>e-Math.floor(e))},isCloseToZero:{vec2f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec2h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec3f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec3h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec4f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t,vec4h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t},neg:{vec2f:W(e=>-e),vec2h:Y(e=>-e),vec2i:ur(e=>-e),vec2u:Dr(e=>-e),"vec2<bool>":e=>Ue(!e.x,!e.y),vec3f:N(e=>-e),vec3h:X(e=>-e),vec3i:hr(e=>-e),vec3u:Wr(e=>-e),"vec3<bool>":e=>Ve(!e.x,!e.y,!e.z),vec4f:L(e=>-e),vec4h:Q(e=>-e),vec4i:lr(e=>-e),vec4u:qr(e=>-e),"vec4<bool>":e=>Pe(!e.x,!e.y,!e.z,!e.w)},select:{vec2f:(e,t,r)=>Ae(r.x?t.x:e.x,r.y?t.y:e.y),vec2h:(e,t,r)=>ct(r.x?t.x:e.x,r.y?t.y:e.y),vec2i:(e,t,r)=>Ir(r.x?t.x:e.x,r.y?t.y:e.y),vec2u:(e,t,r)=>Kr(r.x?t.x:e.x,r.y?t.y:e.y),"vec2<bool>":(e,t,r)=>Ue(r.x?t.x:e.x,r.y?t.y:e.y),vec3f:(e,t,r)=>ze(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3h:(e,t,r)=>Ke(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3i:(e,t,r)=>Sr(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3u:(e,t,r)=>en(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),"vec3<bool>":(e,t,r)=>Ve(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec4f:(e,t,r)=>Be(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4h:(e,t,r)=>pt(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4i:(e,t,r)=>Er(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4u:(e,t,r)=>tn(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),"vec4<bool>":(e,t,r)=>Pe(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w)},tanh:{vec2f:W(Math.tanh),vec2h:Y(Math.tanh),vec3f:N(Math.tanh),vec3h:X(Math.tanh),vec4f:L(Math.tanh),vec4h:Q(Math.tanh)},bitcastU32toF32:{vec2u:e=>Ae(Ze(e.x),Ze(e.y)),vec3u:e=>ze(Ze(e.x),Ze(e.y),Ze(e.z)),vec4u:e=>Be(Ze(e.x),Ze(e.y),Ze(e.z),Ze(e.w))},bitcastU32toI32:{vec2u:e=>Ir(Je(e.x),Je(e.y)),vec3u:e=>Sr(Je(e.x),Je(e.y),Je(e.z)),vec4u:e=>Er(Je(e.x),Je(e.y),Je(e.z),Je(e.w))}};function Qo(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="number"&&Z(t))return _.addMixed[t.kind](t,e);if(Z(e)&&typeof t=="number")return _.addMixed[e.kind](e,t);if(Z(e)&&Z(t)||rt(e)&&rt(t))return _.add[e.kind](e,t);throw new Error("Add/Sub called with invalid arguments.")}var Vs=d({name:"add",signature:(...e)=>{let t=de(e)??e;return{argTypes:t,returnType:Ut(t[0])?t[1]:t[0]}},normalImpl:Qo,codegenImpl:(e,t)=>c`(${e} + ${t})`});function up(e,t){return Qo(e,Zo(-1,t))}var Gr=d({name:"sub",signature:(...e)=>{let t=de(e)??e;return{argTypes:t,returnType:Ut(t[0])?t[1]:t[0]}},normalImpl:up,codegenImpl:(e,t)=>c`(${e} - ${t})`});function Zo(e,t){if(typeof e=="number"&&typeof t=="number")return e*t;if(typeof e=="number"&&(Z(t)||rt(t)))return _.mulSxV[t.kind](e,t);if((Z(e)||rt(e))&&typeof t=="number")return _.mulSxV[e.kind](t,e);if(Z(e)&&Z(t))return _.mulVxV[e.kind](e,t);if(ta(e)&&rt(t))return _.mulVxM[t.kind](e,t);if(rt(e)&&ta(t))return _.mulMxV[e.kind](e,t);if(rt(e)&&rt(t))return _.mulVxV[e.kind](e,t);throw new Error("Mul called with invalid arguments.")}var $n=d({name:"mul",signature:(...e)=>{let t=de(e)??e,r=Ut(t[0])?t[1]:Ut(t[1])||t[0].type.startsWith("vec")?t[0]:t[1].type.startsWith("vec")?t[1]:t[0];return{argTypes:t,returnType:r}},normalImpl:Zo,codegenImpl:(e,t)=>c`(${e} * ${t})`});function hp(e,t){if(typeof e=="number"&&typeof t=="number")return e/t;if(typeof e=="number"&&Z(t)){let r=Xn[t.kind][l].jsImpl;return _.div[t.kind](r(e),t)}if(Z(e)&&typeof t=="number"){let r=Xn[e.kind][l].jsImpl;return _.div[e.kind](e,r(t))}if(Z(e)&&Z(t))return _.div[e.kind](e,t);throw new Error("Div called with invalid arguments.")}var Ps=d({name:"div",signature:(...e)=>{let t=de(e,[w,ie,st])??e;return{argTypes:t,returnType:Ut(t[0])?t[1]:t[0]}},normalImpl:hp,codegenImpl:(e,t)=>c`(${e} / ${t})`,ignoreImplicitCastWarning:!0}),lp=d({name:"mod",signature:(...e)=>{let t=de(e)??e;return{argTypes:t,returnType:Ut(t[0])?t[1]:t[0]}},normalImpl(e,t){if(typeof e=="number"&&typeof t=="number")return e%t;if(typeof e=="number"&&Z(t)){let r=Xn[t.kind];return _.mod[t.kind](r(e),t)}if(Z(e)&&typeof t=="number"){let r=Xn[e.kind];return _.mod[e.kind](e,r(t))}if(Z(e)&&Z(t))return _.mod[e.kind](e,t);throw new Error("Mod called with invalid arguments, expected types: number or vector.")},codegenImpl:(e,t)=>c`(${e} % ${t})`});function cp(e){return typeof e=="number"?-e:_.neg[e.kind](e)}var Jo=d({name:"neg",signature:e=>({argTypes:[e],returnType:e}),normalImpl:cp,codegenImpl:e=>c`-(${e})`});function Ri(e){if("multisampled"in e){if(e.multisampled){if(e.dimension==="2d")return eu(e.sampleType);throw new Error(`Multisampled textures only support '2d' dimension, got '${e.dimension}'`)}switch(e.dimension){case"1d":return Ko(e.sampleType);case"2d":return As(e.sampleType);case"2d-array":return tu(e.sampleType);case"3d":return iu(e.sampleType);case"cube":return ru(e.sampleType);case"cube-array":return nu(e.sampleType);default:throw new Error(`Unsupported texture dimension: '${e.dimension}'`)}}if(!("access"in e))throw new Error("Descriptor is neither a sampled nor a storage texture");switch(e.dimension){case"1d":return su(e.format,e.access);case"2d":return Bs(e.format,e.access);case"2d-array":return au(e.format,e.access);case"3d":return ou(e.format,e.access);default:throw new Error(`Unsupported storage texture dimension: '${e.dimension}'`)}}function Ce(e,t){let r=e.startsWith("texture_depth")?["depth","float","unfilterable-float"]:t.sampleType.type==="i32"?["sint"]:t.sampleType.type==="u32"?["uint"]:["float","unfilterable-float"];return{[l]:!0,[Ar]:void 0,type:e,bindingSampleType:r,...t}}function gi(e,t){return{[l]:!0,[Ar]:void 0,type:e,...t}}var xa=new Map,bn={"write-only":"write","read-only":"read","read-write":"read_write"};function ge(e,t){let r=xa.get(e);return r||(r=t(),xa.set(e,r)),r}function Ko(e){let t=e||w,r=`texture_1d<${t.type}>`;return ge(r,()=>Ce("texture_1d",{dimension:"1d",sampleType:t,multisampled:!1}))}function As(e){let t=e||w,r=`texture_2d<${t.type}>`;return ge(r,()=>Ce("texture_2d",{dimension:"2d",sampleType:t,multisampled:!1}))}function eu(e){let t=e||w,r=`texture_multisampled_2d<${t.type}>`;return ge(r,()=>Ce("texture_multisampled_2d",{dimension:"2d",sampleType:t,multisampled:!0}))}function tu(e){let t=e||w,r=`texture_2d_array<${t.type}>`;return ge(r,()=>Ce("texture_2d_array",{dimension:"2d-array",sampleType:t,multisampled:!1}))}function ru(e){let t=e||w,r=`texture_cube<${t.type}>`;return ge(r,()=>Ce("texture_cube",{dimension:"cube",sampleType:t,multisampled:!1}))}function nu(e){let t=e||w,r=`texture_cube_array<${t.type}>`;return ge(r,()=>Ce("texture_cube_array",{dimension:"cube-array",sampleType:t,multisampled:!1}))}function iu(e){let t=e||w,r=`texture_3d<${t.type}>`;return ge(r,()=>Ce("texture_3d",{dimension:"3d",sampleType:t,multisampled:!1}))}function su(e,t){let r=t||"write-only",n=`texture_storage_1d<${e}, ${bn[r]}>`;return ge(n,()=>gi("texture_storage_1d",{dimension:"1d",format:e,access:r}))}function Bs(e,t){let r=t||"write-only",n=`texture_storage_2d<${e}, ${bn[r]}>`;return ge(n,()=>gi("texture_storage_2d",{dimension:"2d",format:e,access:r}))}function au(e,t){let r=t||"write-only",n=`texture_storage_2d_array<${e}, ${bn[r]}>`;return ge(n,()=>gi("texture_storage_2d_array",{dimension:"2d-array",format:e,access:r}))}function ou(e,t){let r=t||"write-only",n=`texture_storage_3d<${e}, ${bn[r]}>`;return ge(n,()=>gi("texture_storage_3d",{dimension:"3d",format:e,access:r}))}function pp(){return ge("texture_depth_2d",()=>Ce("texture_depth_2d",{dimension:"2d",sampleType:w,multisampled:!1}))}function dp(){return ge("texture_depth_multisampled_2d",()=>Ce("texture_depth_multisampled_2d",{dimension:"2d",sampleType:w,multisampled:!0}))}function fp(){return ge("texture_depth_2d_array",()=>Ce("texture_depth_2d_array",{dimension:"2d-array",sampleType:w,multisampled:!1}))}function mp(){return ge("texture_depth_cube",()=>Ce("texture_depth_cube",{dimension:"cube",sampleType:w,multisampled:!1}))}function yp(){return ge("texture_depth_cube_array",()=>Ce("texture_depth_cube_array",{dimension:"cube-array",sampleType:w,multisampled:!1}))}function uu(){return ge("texture_external",()=>({[l]:!0,[Ar]:void 0,type:"texture_external",dimension:"2d"}))}function hu(e){return!!e[l]&&typeof e.multisampled=="boolean"}function ji(e){return!!e[l]&&typeof e.format=="string"&&typeof e.access=="string"}var gp=["vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"],Li={add:Vs,sub:Gr,mul:$n,div:Ps},wp={f:{1:w,2:P,3:se,4:z},h:{1:ie,2:at,3:ot,4:ut},i:{1:R,2:ue,3:ke,4:he},u:{1:$,2:_e,3:te,4:me},b:{1:F,2:Zt,3:Jt,4:Kt}};function Os(e,t){if(gp.includes(e.dataType.type)&&t in Li)return y(new io(t,e,Li[t][l].gpuImpl),Ne,e.origin);if(ve(e.dataType)&&t==="length")return e.dataType.elementCount===0?y(c`arrayLength(&${e})`,$,"runtime"):y(e.dataType.elementCount,fn,"constant");if(Dn(e.dataType)&&t==="columns")return y(new so(e),Ne,e.origin);if(pe(e.dataType)||qe(e.dataType)){let n=e.dataType.propTypes[t];return n?(n=mt(n),y(c`${e}.${t}`,n,e.origin==="argument"?"argument":!Tr(e)&&!we(n)?e.origin:e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime")):void 0}if(De(e.dataType)){let n=cs(e);return t==="$"?n:Os(n,t)}if(it(e.dataType)&&t==="kind")return y(e.dataType.type,Ne,"constant");let r=t.length;if(it(e.dataType)&&r>=1&&r<=4){let n=e.dataType.type.includes("bool")?"b":e.dataType.type[4],i=wp[n][r];return i?y(Ie(e)?e.value[t]:c`${e}.${t}`,i,e.origin==="argument"&&r===1?"argument":e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime"):void 0}if(Ie(e)||e.dataType.type==="unknown")return hi(e.value[t])}function Cs(){return{[l]:!0,type:"sampler",[Ar]:void 0}}function Fs(){return{[l]:!0,type:"sampler_comparison",[Ar]:void 0}}function xp(e){return!!e[l]&&e.type==="sampler"}function vp(e){return!!e[l]&&e.type==="sampler_comparison"}function lu(e){return new $p(e)}var $p=class{constructor(t){this.inner=t}[l]=!0;type="atomic"},cu=Object.defineProperty,bp=(e,t,r)=>t in e?cu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_p=(e,t)=>{for(var r in t)cu(e,r,{get:t[r],enumerable:!0})},k=(e,t,r)=>bp(e,typeof t!="symbol"?t+"":t,r),Tp={};_p(Tp,{BufferReader:()=>Mt,BufferWriter:()=>er,MaxValue:()=>re,Measurer:()=>K,UnresolvedReferenceError:()=>Wt,ValidationError:()=>wi,arrayOf:()=>kp,bool:()=>Up,byte:()=>Cp,chars:()=>Zp,concat:()=>td,dynamicArrayOf:()=>nd,f16:()=>Hp,f32:()=>Xp,f32Array:()=>xd,f64Array:()=>vd,generic:()=>Kp,genericEnum:()=>ed,i16:()=>Gp,i16Array:()=>gd,i32:()=>Np,i32Array:()=>wd,i8:()=>Bp,i8Array:()=>yd,keyed:()=>ad,object:()=>Jp,optional:()=>ud,string:()=>Pp,tupleOf:()=>cd,u16:()=>jp,u16Array:()=>fd,u32:()=>Wp,u32Array:()=>md,u8:()=>yu,u8Array:()=>pd,u8ClampedArray:()=>dd});var Wt=class pu extends Error{constructor(t){super(t),Object.setPrototypeOf(this,pu.prototype)}},wi=class du extends Error{constructor(t){super(t),Object.setPrototypeOf(this,du.prototype)}},zp=class{constructor(){k(this,"size",Number.NaN),k(this,"unbounded",this),k(this,"isUnbounded",!0)}add(){return this}fork(){return this}},Ip=new zp,K=class fu{constructor(){k(this,"size",0),k(this,"unbounded",Ip),k(this,"isUnbounded",!1)}add(t){return this.size+=t,this}fork(){const t=new fu;return t.size=this.size,t}},re=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),fe=class{constructor(){k(this,"__unwrapped")}resolveReferences(e){}seekProperty(e,t){return null}},Sp=class{constructor(e){this.key=e}},rn={STRING:"string",ENUM:"enum"},Ep=class extends fe{constructor(e,t){super(),this._unstableElementSchema=e,this.length=t,k(this,"elementSchema"),this.elementSchema=e}resolveReferences(e){this.elementSchema=e.resolve(this._unstableElementSchema)}write(e,t){if(t.length!==this.length)throw new wi(`Expected array of length ${this.length}, got ${t.length}`);for(const r of t)this.elementSchema.write(e,r)}read(e){const t=[];for(let r=0;r<this.length;++r)t.push(this.elementSchema.read(e));return t}get maxSize(){return this.elementSchema.measure(re).size*this.length}measure(e,t=new K){for(let r=0;r<this.length;++r)this.elementSchema.measure(e===re?re:e[r],t);return t}};function kp(e,t){return new Ep(e,t)}var Mp=class extends fe{constructor(){super(...arguments),k(this,"maxSize",1)}read(e){return e.readBool()}write(e,t){e.writeBool(t)}measure(e,t=new K){return t.add(1)}},Up=new Mp,mu=class Xr extends fe{static get _encoder(){return Xr._cachedEncoder||(Xr._cachedEncoder=new TextEncoder),Xr._cachedEncoder}read(t){return t.readString()}write(t,r){t.writeString(r)}measure(t,r=new K){if(t===re)return r.unbounded;const n=Xr._encoder.encode(t);return r.add(n.byteLength+1)}};k(mu,"_cachedEncoder");var Vp=mu,Pp=new Vp,Ap=class extends fe{constructor(){super(...arguments),k(this,"maxSize",1)}read(e){return e.readInt8()}write(e,t){e.writeInt8(t)}measure(e,t=new K){return t.add(1)}},Bp=new Ap,Op=class extends fe{constructor(){super(...arguments),k(this,"maxSize",1)}read(e){return e.readUint8()}write(e,t){e.writeUint8(t)}measure(e,t=new K){return t.add(1)}},yu=new Op,Cp=yu,Fp=class extends fe{constructor(){super(...arguments),k(this,"maxSize",2)}read(e){return e.readInt16()}write(e,t){e.writeInt16(t)}measure(e,t=new K){return t.add(2)}},Gp=new Fp,Rp=class extends fe{constructor(){super(...arguments),k(this,"maxSize",2)}read(e){return e.readUint16()}write(e,t){e.writeUint16(t)}measure(e,t=new K){return t.add(2)}},jp=new Rp,Lp=class extends fe{constructor(){super(...arguments),k(this,"maxSize",4)}read(e){return e.readInt32()}write(e,t){e.writeInt32(t)}measure(e,t=new K){return t.add(4)}},Np=new Lp,Dp=class extends fe{constructor(){super(...arguments),k(this,"maxSize",4)}read(e){return e.readUint32()}write(e,t){e.writeUint32(t)}measure(e,t=new K){return t.add(4)}},Wp=new Dp,qp=class extends fe{constructor(){super(...arguments),k(this,"maxSize",2)}read(e){return e.readFloat16()}write(e,t){e.writeFloat16(t)}measure(e,t=new K){return t.add(2)}},Hp=new qp,Yp=class extends fe{constructor(){super(...arguments),k(this,"maxSize",4)}read(e){return e.readFloat32()}write(e,t){e.writeFloat32(t)}measure(e,t=new K){return t.add(4)}},Xp=new Yp,Qp=class extends fe{constructor(e){super(),this.length=e}write(e,t){if(t.length!==this.length)throw new wi(`Expected char-string of length ${this.length}, got ${t.length}`);for(let r=0;r<t.length;++r)e.writeUint8(t.charCodeAt(r))}read(e){let t="";for(let r=0;r<this.length;++r)t+=String.fromCharCode(e.readByte());return t}measure(e,t=new K){return t.add(this.length)}};function Zp(e){return new Qp(e)}function kt(e){return Object.entries(e)}function gu(e,t){const r={};for(const[n,i]of kt(t))r[n]=e.resolve(i);return r}var Gs=class extends fe{constructor(e){super(),this._properties=e,k(this,"properties"),this.properties=e}resolveReferences(e){this.properties=gu(e,this._properties)}write(e,t){for(const[r,n]of kt(this.properties))n.write(e,t[r])}read(e){const t={};for(const[r,n]of kt(this.properties))t[r]=n.read(e);return t}get maxSize(){const e=new K;for(const t of Object.values(this.properties))t.measure(re,e);return e.size}measure(e,t=new K){for(const[r,n]of kt(this.properties))n.measure(e===re?re:e[r],t);return t}seekProperty(e,t){let r=0;for(const[n,i]of kt(this.properties)){if(n===t)return{bufferOffset:r,schema:i};r+=i.measure(e).size}return null}};function Jp(e){return new Gs(e)}var wu=class extends fe{constructor(e,t,r){super(),this.keyedBy=e,this._subTypeMap=r,k(this,"_baseObject"),k(this,"subTypeMap"),this._baseObject=new Gs(t),this.subTypeMap=r}resolveReferences(e){this._baseObject.resolveReferences(e),this.subTypeMap=gu(e,this._subTypeMap)}write(e,t){const r=t.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===rn.ENUM?e.writeUint8(t.type):e.writeString(t.type),this._baseObject.write(e,t);for(const[i,s]of kt(n.properties))s.write(e,t[i])}read(e){const t=this.keyedBy===rn.ENUM?e.readByte():e.readString(),r=this.subTypeMap[t]||null;if(r===null)throw new Error(`Unknown sub-type '${t}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const n=this._baseObject.read(e);if(n.type=t,r!==null)for(const[i,s]of kt(r.properties))n[i]=s.read(e);return n}measure(e,t=new K){if(this._baseObject.measure(e,t),this.keyedBy===rn.ENUM)t.add(1);else if(e!==re)t.add(e.type.length+1);else return t.unbounded;if(e===re){const r=Object.values(this.subTypeMap).map(n=>{const i=t.fork();for(const s of Object.values(n.properties))s.measure(re,i);return[n,i.size]}).reduce((n,i)=>n[1]>i[1]?n:i)[0];for(const n of Object.values(r.properties))n.measure(re,t)}else{const r=e.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[i,s]of kt(n.properties))s.measure(e[i],t)}return t}};function Kp(e,t){return new wu(rn.STRING,e,t)}function ed(e,t){return new wu(rn.ENUM,e,t)}function td(e){return new Gs(Object.fromEntries(e.flatMap(({properties:t})=>Object.entries(t))))}var rd=class extends fe{constructor(e){super(),this._unstableElementType=e,k(this,"elementType"),this.elementType=e}resolveReferences(e){this.elementType=e.resolve(this._unstableElementType)}write(e,t){e.writeUint32(t.length);for(const r of t)this.elementType.write(e,r)}read(e){const t=[],r=e.readUint32();for(let n=0;n<r;++n)t.push(this.elementType.read(e));return t}get maxSize(){return this.measure(re).size}measure(e,t=new K){if(e===re)return t.unbounded;t.add(4);for(const r of e)this.elementType.measure(r,t);return t}seekProperty(e,t){if(typeof t=="symbol")return null;const r=Number.parseInt(String(t),10);if(Number.isNaN(r))return null;if(e===re)return{bufferOffset:this.elementType.measure(re).size*r,schema:this.elementType};if(r>=e.length)return null;const n=new K;for(let i=0;i<r;++i)this.elementType.measure(e[i],n);return{bufferOffset:n.size,schema:this.elementType}}};function nd(e){return new rd(e)}var xu=class{constructor(e){k(this,"__unwrapped"),k(this,"ref"),this.ref=new Sp(e)}resolveReferences(){throw new Wt("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new Wt("Tried to read a reference directly. Resolve it instead.")}write(){throw new Wt("Tried to write a reference directly. Resolve it instead.")}measure(){throw new Wt("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new Wt("Tried to seek property of a reference directly. Resolve it instead.")}},id=class{constructor(){k(this,"registry",{})}hasKey(e){return this.registry[e]!==void 0}register(e,t){this.registry[e]=t}resolve(e){if(e instanceof xu){const r=e.ref.key;if(this.registry[r]!==void 0)return this.registry[r];throw new Wt(`Couldn't resolve reference to ${r}. Unknown key.`)}return e.resolveReferences(this),e}},sd=class{constructor(e,t){this.key=e,k(this,"__unwrapped"),k(this,"__keyDefinition"),k(this,"innerType"),this.innerType=t(new xu(e)),this.resolveReferences(new id)}resolveReferences(e){e.hasKey(this.key)||(e.register(this.key,this.innerType),this.innerType.resolveReferences(e))}read(e){return this.innerType.read(e)}write(e,t){this.innerType.write(e,t)}get maxSize(){return this.measure(re).size}measure(e,t=new K){return this.innerType.measure(e,t)}seekProperty(e,t){return this.innerType.seekProperty(e,t)}};function ad(e,t){return new sd(e,t)}var od=class extends fe{constructor(e){super(),this._innerUnstableSchema=e,k(this,"innerSchema"),this.innerSchema=e}resolveReferences(e){this.innerSchema=e.resolve(this._innerUnstableSchema)}write(e,t){t!=null?(e.writeBool(!0),this.innerSchema.write(e,t)):e.writeBool(!1)}read(e){if(e.readBool())return this.innerSchema.read(e)}get maxSize(){return this.measure(re).size}measure(e,t=new K){return e!==void 0&&this.innerSchema.measure(e,t),t.add(1)}};function ud(e){return new od(e)}function hd(e,t){return t.map(r=>e.resolve(r))}var ld=class extends fe{constructor(e){super(),this._unstableSchemas=e,k(this,"schemas"),this.schemas=e}resolveReferences(e){this.schemas=hd(e,this._unstableSchemas)}write(e,t){if(t.length!==this.schemas.length)throw new wi(`Expected tuple of length ${this.schemas.length}, got ${t.length}`);for(let r=0;r<this.schemas.length;++r)this.schemas[r].write(e,t[r])}read(e){const t=[];for(let r=0;r<this.schemas.length;++r)t.push(this.schemas[r].read(e));return t}get maxSize(){return this.measure(re).size}measure(e,t=new K){for(let r=0;r<this.schemas.length;++r)this.schemas[r].measure(e===re?re:e[r],t);return t}};function cd(e){return new ld(e)}var bt=class extends fe{constructor(e,t){super(),this.length=e,this._arrayConstructor=t,k(this,"byteLength"),this.byteLength=e*t.BYTES_PER_ELEMENT}write(e,t){e.writeSlice(t)}read(e){const t=new ArrayBuffer(this.byteLength),r=new this._arrayConstructor(t,0,this.length);return e.readSlice(r,0,this.byteLength),r}measure(e,t=new K){return t.add(this.byteLength)}},pd=e=>new bt(e,Uint8Array),dd=e=>new bt(e,Uint8ClampedArray),fd=e=>new bt(e,Uint16Array),md=e=>new bt(e,Uint32Array),yd=e=>new bt(e,Int8Array),gd=e=>new bt(e,Int16Array),wd=e=>new bt(e,Int32Array),xd=e=>new bt(e,Float32Array),vd=e=>new bt(e,Float64Array);function $d(){const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return t[0]=1,e[0]===0}function vu(){return $d()?"big":"little"}function Rs(e){let t=0,r=e;return r&&"buffer"in r&&"byteOffset"in r&&(t+=r.byteOffset,r=r.buffer),{buffer:r,byteOffset:t,byteLength:e.byteLength}}var $u=class{constructor(e,t){k(this,"dataView"),k(this,"littleEndian"),k(this,"byteOffset",0),k(this,"endianness");const{byteOffset:r=0,endianness:n="system"}=t??{};this.byteOffset=r;const i=vu();this.endianness=n==="system"?i:n,this.littleEndian=this.endianness==="little";const s=Rs(e);this.byteOffset+=s.byteOffset,this.dataView=new DataView(s.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(e){this.byteOffset=e}skipBytes(e){this.byteOffset+=e}};function bd(e){if(e===0)return 0;if(Number.isNaN(e))return 32256;if(!Number.isFinite(e))return e>0?31744:64512;const t=e<0?1:0,r=Math.abs(e),n=Math.floor(Math.log2(r)),i=r/2**n-1,s=n+15,a=Math.floor(i*1024);return t<<15|s<<10|a}function _d(e){const t=(e&32768)>>15,r=(e&31744)>>10,n=e&1023;return r===0?t===0?n/1024:-n/1024:r===31?n===0?t===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(t===0?1:-1)*(1+n/1024)*2**(r-15)}var Mt=class extends $u{constructor(){super(...arguments),k(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const e=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readUint16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readInt32(){const e=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readUint32(){const e=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readFloat16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,_d(e)}readFloat32(){const e=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readString(){let e=0;for(;this.byteOffset+e<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+e++)!==0;);const t=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,e-1));return this.byteOffset+=e,t}readSlice(e,t,r){const n=Rs(e),i=new Uint8Array(n.buffer,n.byteOffset+t);for(let s=0;s<r;++s)i[s]=this.dataView.getUint8(this.byteOffset++)}},er=class extends $u{constructor(){super(...arguments),k(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(e){this.dataView.setUint8(this.byteOffset++,e?1:0)}writeByte(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt8(e){this.dataView.setInt8(this.byteOffset++,e)}writeUint8(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt16(e){this.dataView.setInt16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeUint16(e){this.dataView.setUint16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeInt32(e){this.dataView.setInt32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeUint32(e){this.dataView.setUint32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeFloat16(e){this.dataView.setUint16(this.byteOffset,bd(e),this.littleEndian),this.byteOffset+=2}writeFloat32(e){this.dataView.setFloat32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeString(e){const t=this._textEncoder.encodeInto(e,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=t.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(e){const t=Rs(e),r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(const n of r)this.dataView.setUint8(this.byteOffset++,n)}},M=e=>({argTypes:[e],returnType:e}),xi=(...e)=>{let t=de(e)??e;return{argTypes:t,returnType:t[0]}};function bu(e){return(t,...r)=>{let n=t;for(let i of r)n=e(n,i);return n}}function _u(e){return(t,...r)=>{let n=c`${t}`;for(let i of r)n=c`${e}(${n}, ${i})`;return n}}function Td(e){return typeof e=="number"?Math.abs(e):_.abs[e.kind](e)}var zd=d({name:"abs",signature:M,normalImpl:Td,codegenImpl:e=>c`abs(${e})`});function Id(e){return typeof e=="number"?Math.acos(e):_.acos[e.kind](e)}var Sd=d({name:"acos",signature:M,normalImpl:Id,codegenImpl:e=>c`acos(${e})`});function Ed(e){return typeof e=="number"?Math.acosh(e):_.acosh[e.kind](e)}var kd=d({name:"acosh",signature:M,normalImpl:Ed,codegenImpl:e=>c`acosh(${e})`});function Md(e){return typeof e=="number"?Math.asin(e):_.asin[e.kind](e)}var Ud=d({name:"asin",signature:M,normalImpl:Md,codegenImpl:e=>c`asin(${e})`});function Vd(e){return typeof e=="number"?Math.asinh(e):_.asinh[e.kind](e)}var Pd=d({name:"asinh",signature:M,normalImpl:Vd,codegenImpl:e=>c`asinh(${e})`});function Ad(e){return typeof e=="number"?Math.atan(e):_.atan[e.kind](e)}var Tu=d({name:"atan",signature:M,normalImpl:Ad,codegenImpl:e=>c`atan(${e})`});function Bd(e){return typeof e=="number"?Math.atanh(e):_.atanh[e.kind](e)}var Od=d({name:"atanh",signature:M,normalImpl:Bd,codegenImpl:e=>c`atanh(${e})`});function Cd(e,t){return typeof e=="number"&&typeof t=="number"?Math.atan2(e,t):_.atan2[e.kind](e,t)}var Fd=d({name:"atan2",signature:(...e)=>{let t=de(e,[w,ie,st])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Cd,codegenImpl:(e,t)=>c`atan2(${e}, ${t})`});function Gd(e){return typeof e=="number"?Math.ceil(e):_.ceil[e.kind](e)}var zu=d({name:"ceil",signature:M,normalImpl:Gd,codegenImpl:e=>c`ceil(${e})`});function Rd(e,t,r){return typeof e=="number"?Math.min(Math.max(t,e),r):_.clamp[e.kind](e,t,r)}var jd=d({name:"clamp",signature:xi,normalImpl:Rd,codegenImpl:(e,t,r)=>c`clamp(${e}, ${t}, ${r})`});function Ld(e){return typeof e=="number"?Math.cos(e):_.cos[e.kind](e)}var Nd=d({name:"cos",signature:M,normalImpl:Ld,codegenImpl:e=>c`cos(${e})`});function Dd(e){return typeof e=="number"?Math.cosh(e):_.cosh[e.kind](e)}var Wd=d({name:"cosh",signature:M,normalImpl:Dd,codegenImpl:e=>c`cosh(${e})`}),qd=d({name:"countLeadingZeros",signature:M,normalImpl:"CPU implementation for countLeadingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countLeadingZeros(${e})`}),Hd=d({name:"countOneBits",signature:M,normalImpl:"CPU implementation for countOneBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countOneBits(${e})`}),Yd=d({name:"countTrailingZeros",signature:M,normalImpl:"CPU implementation for countTrailingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countTrailingZeros(${e})`}),Xd=d({name:"cross",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>_.cross[e.kind](e,t),codegenImpl:(e,t)=>c`cross(${e}, ${t})`});function Qd(e){if(typeof e=="number")return e*180/Math.PI;throw new Ye("CPU implementation for degrees on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Zd=d({name:"degrees",signature:M,normalImpl:Qd,codegenImpl:e=>c`degrees(${e})`}),Jd=d({name:"determinant",signature:M,normalImpl:"CPU implementation for determinant not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`determinant(${e})`});function Kd(e,t){return typeof e=="number"&&typeof t=="number"?Math.abs(e-t):js(Gr(e,t))}var ef=d({name:"distance",signature:(...e)=>({argTypes:e,returnType:os(e[0])?ie:w}),normalImpl:Kd,codegenImpl:(e,t)=>c`distance(${e}, ${t})`}),Iu=d({name:"dot",signature:(...e)=>({argTypes:e,returnType:e[0].primitive}),normalImpl:(e,t)=>_.dot[e.kind](e,t),codegenImpl:(e,t)=>c`dot(${e}, ${t})`}),tf=d({name:"dot4U8Packed",signature:{argTypes:[$,$],returnType:$},normalImpl:"CPU implementation for dot4U8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4U8Packed(${e}, ${t})`}),rf=d({name:"dot4I8Packed",signature:{argTypes:[$,$],returnType:R},normalImpl:"CPU implementation for dot4I8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4I8Packed(${e}, ${t})`});function nf(e){return typeof e=="number"?Math.exp(e):_.exp[e.kind](e)}var sf=d({name:"exp",signature:M,normalImpl:nf,codegenImpl:e=>c`exp(${e})`});function af(e){return typeof e=="number"?2**e:_.exp2[e.kind](e)}var of=d({name:"exp2",signature:M,normalImpl:af,codegenImpl:e=>c`exp2(${e})`}),uf=d({name:"extractBits",signature:(e,t,r)=>({argTypes:[e,$,$],returnType:e}),normalImpl:"CPU implementation for extractBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`extractBits(${e}, ${t}, ${r})`}),hf=d({name:"faceForward",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:"CPU implementation for faceForward not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`faceForward(${e}, ${t}, ${r})`}),lf=d({name:"firstLeadingBit",signature:M,normalImpl:"CPU implementation for firstLeadingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstLeadingBit(${e})`}),cf=d({name:"firstTrailingBit",signature:M,normalImpl:"CPU implementation for firstTrailingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstTrailingBit(${e})`});function pf(e){return typeof e=="number"?Math.floor(e):_.floor[e.kind](e)}var df=d({name:"floor",signature:M,normalImpl:pf,codegenImpl:e=>c`floor(${e})`});function ff(e,t,r){if(typeof e=="number")return e*t+r;throw new Ye("CPU implementation for fma on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var mf=d({name:"fma",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:ff,codegenImpl:(e,t,r)=>c`fma(${e}, ${t}, ${r})`});function yf(e){return typeof e=="number"?e-Math.floor(e):_.fract[e.kind](e)}var gf=d({name:"fract",signature:M,normalImpl:yf,codegenImpl:e=>c`fract(${e})`}),wf={f32:le({fract:w,exp:R}),f16:le({fract:ie,exp:R}),abstractFloat:le({fract:st,exp:fn}),vec2f:le({fract:P,exp:ue}),vec3f:le({fract:se,exp:ke}),vec4f:le({fract:z,exp:he}),vec2h:le({fract:at,exp:ue}),vec3h:le({fract:ot,exp:ke}),vec4h:le({fract:ut,exp:he})},xf=d({name:"frexp",normalImpl:"CPU implementation for frexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",signature:e=>{let t=wf[e.type];if(!t)throw new Error(`Unsupported data type for frexp: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},codegenImpl:e=>c`frexp(${e})`}),vf=d({name:"insertBits",signature:(e,t,r,n)=>({argTypes:[e,t,$,$],returnType:e}),normalImpl:"CPU implementation for insertBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r,n)=>c`insertBits(${e}, ${t}, ${r}, ${n})`});function $f(e){if(typeof e=="number")return 1/Math.sqrt(e);throw new Ye("CPU implementation for inverseSqrt on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var bf=d({name:"inverseSqrt",signature:M,normalImpl:$f,codegenImpl:e=>c`inverseSqrt(${e})`}),_f=d({name:"ldexp",signature:(e,t)=>{switch(e.type){case"abstractFloat":return{argTypes:[e,fn],returnType:e};case"f32":case"f16":return{argTypes:[e,R],returnType:e};case"vec2f":case"vec2h":return{argTypes:[e,ue],returnType:e};case"vec3f":case"vec3h":return{argTypes:[e,ke],returnType:e};case"vec4f":case"vec4h":return{argTypes:[e,he],returnType:e};default:throw new Error(`Unsupported data type for ldexp: ${e.type}. Supported types are abstractFloat, f32, f16, vec2f, vec2h, vec3f, vec3h, vec4f, vec4h.`)}},normalImpl:"CPU implementation for ldexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`ldexp(${e}, ${t})`});function Tf(e){return typeof e=="number"?Math.abs(e):_.length[e.kind](e)}var js=d({name:"length",signature:e=>({argTypes:[e],returnType:os(e)?ie:w}),normalImpl:Tf,codegenImpl:e=>c`length(${e})`});function zf(e){return typeof e=="number"?Math.log(e):_.log[e.kind](e)}var If=d({name:"log",signature:M,normalImpl:zf,codegenImpl:e=>c`log(${e})`});function Sf(e){return typeof e=="number"?Math.log2(e):_.log2[e.kind](e)}var Ef=d({name:"log2",signature:M,normalImpl:Sf,codegenImpl:e=>c`log2(${e})`});function kf(e,t){return typeof e=="number"?Math.max(e,t):_.max[e.kind](e,t)}var Mf=d({name:"max",signature:xi,normalImpl:bu(kf),codegenImpl:_u("max")});function Uf(e,t){return typeof e=="number"?Math.min(e,t):_.min[e.kind](e,t)}var Ni=d({name:"min",signature:xi,normalImpl:bu(Uf),codegenImpl:_u("min")});function Vf(e,t,r){if(typeof e=="number"){if(typeof r!="number"||typeof t!="number")throw new Error("When e1 and e2 are numbers, the blend factor must be a number.");return e*(1-r)+t*r}if(typeof e=="number"||typeof t=="number")throw new Error("e1 and e2 need to both be vectors of the same kind.");return _.mix[e.kind](e,t,r)}var Pf=d({name:"mix",signature:xi,normalImpl:Vf,codegenImpl:(e,t,r)=>c`mix(${e}, ${t}, ${r})`}),Af={f32:le({fract:w,whole:w}),f16:le({fract:ie,whole:ie}),abstractFloat:le({fract:st,whole:st}),vec2f:le({fract:P,whole:P}),vec3f:le({fract:se,whole:se}),vec4f:le({fract:z,whole:z}),vec2h:le({fract:at,whole:at}),vec3h:le({fract:ot,whole:ot}),vec4h:le({fract:ut,whole:ut})},Bf=d({name:"modf",signature:e=>{let t=Af[e.type];if(!t)throw new Error(`Unsupported data type for modf: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},normalImpl:"CPU implementation for modf not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`modf(${e})`}),Of=d({name:"normalize",signature:M,normalImpl:e=>_.normalize[e.kind](e),codegenImpl:e=>c`normalize(${e})`});function Cf(e,t){if(typeof e=="number"&&typeof t=="number")return e**t;if(Z(e)&&Z(t))return _.pow[e.kind](e,t);throw new Error("Invalid arguments to pow()")}var Su=d({name:"pow",signature:(...e)=>{let t=de(e,[w,ie,st])??e;return{argTypes:t,returnType:Ut(t[0])?t[1]:t[0]}},normalImpl:Cf,codegenImpl:(e,t)=>c`pow(${e}, ${t})`}),Ff=d({name:"quantizeToF16",signature:M,normalImpl:"CPU implementation for quantizeToF16 not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`quantizeToF16(${e})`});function Gf(e){if(typeof e=="number")return e*Math.PI/180;throw new Ye("CPU implementation for radians on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Rf=d({name:"radians",signature:(...e)=>{let t=de(e,[w,ie,st])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Gf,codegenImpl:e=>c`radians(${e})`}),jf=d({name:"reflect",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>Gr(e,$n(2*Iu(t,e),t)),codegenImpl:(e,t)=>c`reflect(${e}, ${t})`}),Lf=d({name:"refract",normalImpl:"CPU implementation for refract not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`refract(${e}, ${t}, ${r})`,signature:(e,t,r)=>({argTypes:[e,t,os(e)?ie:w],returnType:e})}),Nf=d({name:"reverseBits",signature:M,normalImpl:"CPU implementation for reverseBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`reverseBits(${e})`});function Df(e){if(typeof e=="number")return Math.round(e);throw new Ye("CPU implementation for round on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Wf=d({name:"round",signature:M,normalImpl:Df,codegenImpl:e=>c`round(${e})`});function qf(e){if(typeof e=="number")return Math.max(0,Math.min(1,e));throw new Ye("CPU implementation for saturate on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Hf=d({name:"saturate",signature:M,normalImpl:qf,codegenImpl:e=>c`saturate(${e})`});function Yf(e){return typeof e=="number"?Math.sign(e):_.sign[e.kind](e)}var Xf=d({name:"sign",signature:M,normalImpl:Yf,codegenImpl:e=>c`sign(${e})`});function Qf(e){return typeof e=="number"?Math.sin(e):_.sin[e.kind](e)}var Zf=d({name:"sin",signature:M,normalImpl:Qf,codegenImpl:e=>c`sin(${e})`});function Jf(e){if(typeof e=="number")return Math.sinh(e);throw new Ye("CPU implementation for sinh on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Kf=d({name:"sinh",signature:M,normalImpl:Jf,codegenImpl:e=>c`sinh(${e})`});function em(e,t,r){return typeof r=="number"?Dt(e,t,r):_.smoothstep[r.kind](e,t,r)}var tm=d({name:"smoothstep",signature:(...e)=>({argTypes:e,returnType:e[2]}),normalImpl:em,codegenImpl:(e,t,r)=>c`smoothstep(${e}, ${t}, ${r})`});function rm(e){return typeof e=="number"?Math.sqrt(e):_.sqrt[e.kind](e)}var nm=d({name:"sqrt",signature:M,normalImpl:rm,codegenImpl:e=>c`sqrt(${e})`});function im(e,t){if(typeof e=="number")return e<=t?1:0;throw new Ye("CPU implementation for step on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var sm=d({name:"step",signature:(...e)=>{let t=de(e,[w,ie,st])??e;return{argTypes:t,returnType:t[0]}},normalImpl:im,codegenImpl:(e,t)=>c`step(${e}, ${t})`});function am(e){if(typeof e=="number")return Math.tan(e);throw new Ye("CPU implementation for tan on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Eu=d({name:"tan",signature:M,normalImpl:am,codegenImpl:e=>c`tan(${e})`});function om(e){return typeof e=="number"?Math.tanh(e):_.tanh[e.kind](e)}var um=d({name:"tanh",signature:M,normalImpl:om,codegenImpl:e=>c`tanh(${e})`}),hm=d({name:"transpose",signature:M,normalImpl:"CPU implementation for transpose not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`transpose(${e})`}),lm=d({name:"trunc",signature:M,normalImpl:"CPU implementation for trunc not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`trunc(${e})`}),ku=d({name:"bitcastU32toF32",normalImpl:(e=>typeof e=="number"?Ze(e):_.bitcastU32toF32[e.kind](e)),codegenImpl:e=>c`bitcast<f32>(${e})`,signature:(...e)=>{let t=de(e,[$])??e;return{argTypes:t,returnType:it(t[0])?t[0].type==="vec2u"?P:t[0].type==="vec3u"?se:z:w}}}),Mu=d({name:"bitcastU32toI32",normalImpl:(e=>typeof e=="number"?Je(e):_.bitcastU32toI32[e.kind](e)),codegenImpl:e=>c`bitcast<i32>(${e})`,signature:(...e)=>{let t=de(e,[$])??e;return{argTypes:t,returnType:it(t[0])?t[0].type==="vec2u"?ue:t[0].type==="vec3u"?ke:he:R}}}),Uu=d({name:"unpack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4);new er(t).writeUint32(e);let r=new Mt(t);return P(r.readFloat16(),r.readFloat16())},signature:{argTypes:[$],returnType:P},codegenImpl:e=>c`unpack2x16float(${e})`}),cm=d({name:"pack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4),r=new er(t);r.writeFloat16(e.x),r.writeFloat16(e.y);let n=new Mt(t);return $(n.readUint32())},signature:{argTypes:[P],returnType:$},codegenImpl:e=>c`pack2x16float(${e})`}),pm=d({name:"unpack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4);new er(t).writeUint32(e);let r=new Mt(t);return z(r.readUint8()/255,r.readUint8()/255,r.readUint8()/255,r.readUint8()/255)},signature:{argTypes:[$],returnType:z},codegenImpl:e=>c`unpack4x8unorm(${e})`}),dm=d({name:"pack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4),r=new er(t);r.writeUint8(e.x*255),r.writeUint8(e.y*255),r.writeUint8(e.z*255),r.writeUint8(e.w*255);let n=new Mt(t);return $(n.readUint32())},signature:{argTypes:[z],returnType:$},codegenImpl:e=>c`pack4x8unorm(${e})`});function Rr(e){return e.type.includes("2")?Zt:e.type.includes("3")?Jt:Kt}var Vu=d({name:"allEq",signature:(...e)=>({argTypes:e,returnType:F}),normalImpl:(e,t)=>Ns(_n(e,t)),codegenImpl:(e,t)=>c`all(${e} == ${t})`}),_n=(e,t)=>_.eq[e.kind](e,t),fm=d({name:"eq",signature:(...e)=>({argTypes:e,returnType:Rr(e[0])}),normalImpl:_n,codegenImpl:(e,t)=>c`(${e} == ${t})`}),mm=d({name:"ne",signature:(...e)=>({argTypes:e,returnType:Rr(e[0])}),normalImpl:(e,t)=>ft(_n(e,t)),codegenImpl:(e,t)=>c`(${e} != ${t})`}),vi=(e,t)=>_.lt[e.kind](e,t),ym=d({name:"lt",signature:(...e)=>({argTypes:e,returnType:Rr(e[0])}),normalImpl:vi,codegenImpl:(e,t)=>c`(${e} < ${t})`}),gm=d({name:"le",signature:(...e)=>({argTypes:e,returnType:Rr(e[0])}),normalImpl:(e,t)=>Ls(vi(e,t),_n(e,t)),codegenImpl:(e,t)=>c`(${e} <= ${t})`}),wm=d({name:"gt",signature:(...e)=>({argTypes:e,returnType:Rr(e[0])}),normalImpl:(e,t)=>Pu(ft(vi(e,t)),ft(_n(e,t))),codegenImpl:(e,t)=>c`(${e} > ${t})`}),xm=d({name:"ge",signature:(...e)=>({argTypes:e,returnType:Rr(e[0])}),normalImpl:(e,t)=>ft(vi(e,t)),codegenImpl:(e,t)=>c`(${e} >= ${t})`}),ft=e=>_.neg[e.kind](e),vm=d({name:"not",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:ft,codegenImpl:e=>c`!(${e})`}),Ls=(e,t)=>_.or[e.kind](e,t),$m=d({name:"or",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Ls,codegenImpl:(e,t)=>c`(${e} | ${t})`}),Pu=(e,t)=>ft(Ls(ft(e),ft(t))),bm=d({name:"and",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Pu,codegenImpl:(e,t)=>c`(${e} & ${t})`}),Ns=e=>_.all[e.kind](e),_m=d({name:"all",signature:(...e)=>({argTypes:e,returnType:F}),normalImpl:Ns,codegenImpl:e=>c`all(${e})`}),Tm=d({name:"any",signature:(...e)=>({argTypes:e,returnType:F}),normalImpl:e=>!Ns(ft(e)),codegenImpl:e=>c`any(${e})`}),zm=d({name:"isCloseTo",signature:(...e)=>({argTypes:e,returnType:F}),normalImpl:(e,t,r=.01)=>typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<r:Z(e)&&Z(t)?_.isCloseToZero[e.kind](Gr[l].jsImpl(e,t),r):!1,codegenImpl:(e,t,r=y(.01,w,"constant"))=>kn(e)&&kn(t)?c`(abs(f32(${e}) - f32(${t})) <= ${r})`:!kn(e)&&!kn(t)?c`all(abs(${e} - ${t}) <= (${e} - ${e}) + ${r})`:"false"});function Im(e,t,r){return typeof r=="boolean"?r?t:e:_.select[e.kind](e,t,r)}var Sm=d({name:"select",signature:(e,t,r)=>{let[n,i]=de([e,t])??[e,t];return{argTypes:[n,i,r],returnType:n}},normalImpl:Im,codegenImpl:(e,t,r)=>c`select(${e}, ${t}, ${r})`}),Em={channelType:w,vectorType:z,sampleTypes:["depth","unfilterable-float"],texelSize:"non-copyable"},km={channelType:w,vectorType:z,sampleTypes:["depth","unfilterable-float"],texelSize:2},Mm={channelType:w,vectorType:z,sampleTypes:["depth","unfilterable-float"],texelSize:4},Um={channelType:$,vectorType:me,sampleTypes:["uint"],texelSize:1},va=new Map;function Tn(e){let t=va.get(e);return t===void 0&&(t=Vm(e),va.set(e,t)),t}function Vm(e){let t=Bm(e),r=Pm(e),n=e.includes("stencil");return{channelType:t,vectorType:t===$?me:t===R?he:z,texelSize:Om(e),sampleTypes:Cm(e),canRenderAttachment:Am(e),...r&&{depthAspect:r},...n&&{stencilAspect:Um}}}function Pm(e){if(e==="depth16unorm")return km;if(e==="depth32float"||e==="depth32float-stencil8")return Mm;if(e==="depth24plus"||e==="depth24plus-stencil8")return Em}function Am(e){return!(e.startsWith("bc")||e.startsWith("etc2")||e.startsWith("eac")||e.startsWith("astc")||e==="rgb9e5ufloat")}function Bm(e){return e==="stencil8"||e.includes("uint")?$:e.includes("sint")?R:w}function Om(e){let[,t,r]=e.match(/^(rgba|bgra|rg|r)(8|16|32)/)??[];return t&&r?t.length*Number(r)/8:e==="stencil8"?1:e==="depth16unorm"?2:e==="depth32float"?4:e==="depth32float-stencil8"?5:e==="depth24plus"||e==="depth24plus-stencil8"?"non-copyable":/^(bc[14]-|etc2-rgb8|eac-r11)/.test(e)?8:/^(bc|astc-|etc2-rgba|eac-rg)/.test(e)?16:4}function Cm(e){return e==="stencil8"?["uint"]:e.includes("uint")?["uint"]:e.includes("sint")?["sint"]:e.includes("depth")?["depth","unfilterable-float"]:/^(r|rg|rgba)16(u|s)norm$/.test(e)?["unfilterable-float"]:["float","unfilterable-float"]}var Fm=new Set(["r32float","rg32float","rgba32float"]);function Gm(e,t){return Fm.has(t)&&!e.features.has("float32-filterable")?["unfilterable-float"]:Tn(t).sampleTypes}var Ds=["f16","clip_distances","dual_source_blending","subgroups","primitive_index"],Au={f16:"shader-f16",clip_distances:"clip-distances",dual_source_blending:"dual-source-blending",subgroups:"subgroups",primitive_index:"primitive-index"},Rm={block:0,binaryExpr:1,assignmentExpr:2,logicalExpr:3,unaryExpr:4,numericLiteral:5,call:6,memberAccess:7,indexAccess:8,return:10,if:11,let:12,const:13,for:14,while:15,continue:16,break:17,arrayExpr:100,preUpdate:101,postUpdate:102,stringLiteral:103,objectExpr:104},Di={identifier:"i",destructuredObject:"d"};const jm=Object.freeze(Object.defineProperty({__proto__:null,FuncParameterType:Di,NodeTypeCatalog:Rm},Symbol.toStringTag,{value:"Module"}));function Lm(e){return e?.[O]}var Fe={get(e,t){if(t in e)return Reflect.get(e,t);if(t==="toString"||t===Symbol.toStringTag||t===Symbol.toPrimitive)return()=>e.toString();if(typeof t=="symbol")return;let r=ui(e),n=Os(r,String(t));if(n)return new Proxy({[l]:!0,[T]:i=>i.resolve(n.value,n.dataType),[Te]:n,toString:()=>`${String(e)}.${t}`},Fe)}};function $i(e){let t=e;for(;;){let r=Lm(t);if(!r)break;t=r}return t}function Wi(e,t){return new Nm(e,t)}function Bu(e){let t=Reflect.ownKeys(e);for(let r of t){let n=e[r];(n&&typeof n=="object"||typeof n=="function")&&Bu(n)}return Object.freeze(e)}var Nm=class{constructor(t,r){this.dataType=t,this.#e=r&&typeof r=="object"?Bu(r):r}[l]={};#e;$name(t){return G(this,t),this}[T](t){let r=t.getUniqueName(this),n=t.resolve(this.dataType).value,i=t.resolve(this.#e,this.dataType).value;return t.addDeclaration(`const ${r}: ${n} = ${i};`),y(r,this.dataType,we(this.dataType)?"constant":"constant-tgpu-const-ref")}toString(){return`const:${x(this)??"<unnamed>"}`}get[O](){let t=this.dataType;return new Proxy({[l]:!0,get[Te](){return y(this,t,we(t)?"constant":"constant-tgpu-const-ref")},[T]:r=>r.resolve(this),toString:()=>`const:${x(this)??"<unnamed>"}.$`},Fe)}get $(){return Xe()?this[O]:this.#e}get value(){return this.$}};function Dm(e){return new Wm(e)}var Wm=class{constructor(t){this.declaration=t}[l]=!0;externalsToApply=[];$uses(t){return this.externalsToApply.push(t),this}[T](t){let r={};for(let i of this.externalsToApply)Mr(r,i);let n=wn(t,r,this.declaration);return t.addDeclaration(n),y("",ee,"constant")}toString(){return`declare: ${this.declaration}`}};function Ou(e){let t={argTypes:e.in&&Object.keys(e.in).length!==0?[vn(e.in)]:[],returnType:ee,workgroupSize:[e.workgroupSize[0]??1,e.workgroupSize[1]??1,e.workgroupSize[2]??1],isEntry:!0};return Object.assign((r,...n)=>qm(t,e.workgroupSize,ci(r,...n)),t)}function qm(e,t,r){let n=xn(r,`@compute @workgroup_size(${t.join(", ")}) `),i=e.argTypes[0];return{shell:e,$uses(s){return n.applyExternals(s),this},[l]:!0,[ne]:n,$name(s){return G(n,s),si(i)&&i.$name(`${s}_Input`),this},[T](s){return n.resolve(s,e.argTypes,e.returnType)},toString(){return`computeFn:${x(n)??"<unnamed>"}`}}}function B(e,t){let r={[l]:!0,argTypes:e,returnType:t??ee,isEntry:!1};return Object.assign((n,...i)=>Ym(r,ci(n,...i)),r)}function Cu(e){return A(e)&&e?.resourceType==="function"}function Hm([e,t]){return`${x(e)??"<unnamed>"}=${t}`}function Ym(e,t){let r=xn(t,""),n={shell:e,resourceType:"function",$uses(a){return r.applyExternals(a),this},[ne]:r,$name(a){return G(r,a),this},with(a,o){return Fu(s,[[oi(a)?a.slot:a,o]])},[T](a){return typeof t=="string"&&(Mc(t,e.argTypes,r.applyExternals),Do(t,e.returnType,r.applyExternals)),r.resolve(a,e.argTypes,e.returnType)}},i=d({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.argTypes,returnType:e.returnType},normalImpl:(...a)=>ll(()=>{try{if(typeof t=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");let o=a.map((h,p)=>At(e.argTypes[p],h)),u=t(...o);return At(e.returnType,u)}catch(o){throw o instanceof na?o.appendToTrace(s):new na(o,[s])}}),codegenImpl:(...a)=>{let o=Ee();return o.withResetIndentLevel(()=>c`${o.resolve(s).value}(${a})`)}}),s=Object.assign(i,n);return s[l].implementation=t,Object.defineProperty(s,"toString",{value(){return`fn:${x(r)??"<unnamed>"}`}}),s}function Fu(e,t){let r={resourceType:"function",shell:e.shell,[qt]:{inner:e,pairs:t},$uses(s){return e.$uses(s),this},[ne]:e,$name(s){return e.$name(s),this},with(s,a){return Fu(i,[...t,[oi(s)?s.slot:s,a]])}},n=d({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.shell.argTypes,returnType:e.shell.returnType},normalImpl:e,codegenImpl:(...s)=>{let a=Ee();return a.withResetIndentLevel(()=>c`${a.resolve(i).value}(${s})`)}}),i=Object.assign(n,r);return i[l].implementation=e[l].implementation,Object.defineProperty(i,"toString",{value(){return`fn:${x(e)??"<unnamed>"}[${t.map(Hm).join(", ")}]`}}),i}function Xm(e,t,r="runtime"){return new Qm(e,t,r)}var Qm=class{[l];dataType;origin;#e;#t;constructor(t,r,n){this[l]=!0,this.dataType=r,this.origin=n,this.#e=t,this.#t=[]}$uses(t){return this.#t.push(t),this}[T](t){let r={};for(let i of this.#t)Mr(r,i);let n=wn(t,r,this.#e);return y(n,this.dataType,this.origin)}toString(){return`raw(${String(this.dataType)}): "${this.#e}"`}get[O](){let t=this.dataType,r=this.origin;return new Proxy({[l]:!0,get[Te](){return y(this,t,r)},[T]:n=>n.resolve(this),toString:()=>`raw(${String(this.dataType)}): "${this.#e}".$`},Fe)}get $(){if(!Xe())throw new Error("Raw code snippets can only be used on the GPU.");return this[O]}get value(){return this.$}};function Zm(e){let t={in:e.in,out:e.out,returnType:vn(e.out),isEntry:!0};return Object.assign((r,...n)=>Jm(t,ci(r,...n)),t)}function Jm(e,t){let r=xn(t,"@fragment "),n=e.returnType;return typeof t=="string"&&Do(t,n,i=>r.applyExternals(i)),{shell:e,outputType:n,$uses(i){return r.applyExternals(i),this},[l]:!0,[ne]:r,$name(i){return G(r,i),si(n)&&n.$name(`${i}_Output`),this},[T](i){let s=e.in?vn(e.in,i.varyingLocations).$name(`${x(this)??""}_Input`):void 0;return s&&r.applyExternals({In:s}),r.applyExternals({Out:n}),r.resolve(i,s?[s]:[],e.returnType)},toString(){return`fragmentFn:${x(r)??"<unnamed>"}`}}}var Gu=new Set(["alias","break","case","const","const_assert","continue","continuing","default","diagnostic","discard","else","enable","false","fn","for","if","let","loop","override","requires","return","struct","switch","true","var","while","NULL","Self","abstract","active","alignas","alignof","as","asm","asm_fragment","async","attribute","auto","await","become","cast","catch","class","co_await","co_return","co_yield","coherent","column_major","common","compile","compile_fragment","concept","const_cast","consteval","constexpr","constinit","crate","debugger","decltype","delete","demote","demote_to_helper","do","dynamic_cast","enum","explicit","export","extends","extern","external","fallthrough","filter","final","finally","friend","from","fxgroup","get","goto","groupshared","highp","impl","implements","import","inline","instanceof","interface","layout","lowp","macro","macro_rules","match","mediump","meta","mod","module","move","mut","mutable","namespace","new","nil","noexcept","noinline","nointerpolation","non_coherent","noncoherent","noperspective","null","nullptr","of","operator","package","packoffset","partition","pass","patch","pixelfragment","precise","precision","premerge","priv","protected","pub","public","readonly","ref","regardless","register","reinterpret_cast","require","resource","restrict","self","set","shared","sizeof","smooth","snorm","static","static_assert","static_cast","std","subroutine","super","target","template","this","thread_local","throw","trait","try","type","typedef","typeid","typename","typeof","union","unless","unorm","unsafe","unsized","use","using","varying","virtual","volatile","wgsl","where","with","writeonly","yield","sampler"]);function Km(e){return e?e.replaceAll(/\s/g,"_").replaceAll(/[^\w\d]/g,""):"item"}function Ru(e){if(e==="_"||e.startsWith("__")||/\s/.test(e))throw new Error(`Invalid identifier '${e}'. Choose an identifier without whitespaces or leading underscores.`);let t=e.split("_")[0];return!Gu.has(t)}var ju=class{#e;#t;constructor(){this.#e=new Set(Gu),this.#t=[]}get usedFunctionScopeNames(){return this.#t[this.#t.length-1]}makeUnique(t,r){let n=Km(t),i=this.getUniqueVariant(n);return r?this.#e.add(i):this.usedFunctionScopeNames?.add(i),i}makeValid(t){return Ru(t)&&!this.#e.has(t)?(this.usedFunctionScopeNames?.add(t),t):this.makeUnique(t,!1)}isUsed(t){return this.#e.has(t)||!!this.usedFunctionScopeNames?.has(t)}pushFunctionScope(){this.#t.push(new Set)}popFunctionScope(){this.#t.pop()}},ey=class extends ju{#e=0;getUniqueVariant(t){let r=`${t}_${this.#e++}`;for(;this.isUsed(r);)r=`${t}_${this.#e++}`;return r}},ty=class extends ju{getUniqueVariant(t){let r=0,n=t;for(;this.isUsed(n);)r++,n=`${t}_${r}`;return n}};function ry(e,t){let r=xn(t,"");return{[l]:!0,[ne]:r,resourceType:"shellless-impl",argTypes:e,[T](n){return r.resolve(n,e,void 0)},toString(){return`fn*:${x(r)??"<unnamed>"}(${e.map(n=>n.toString()).join(", ")})`}}}function qi(e,t){return e.type!==t.type?!1:e.type==="ptr"&&t.type==="ptr"?e.access===t.access&&e.addressSpace===t.addressSpace&&e.implicit===t.implicit&&qi(e.inner,t.inner):e.type==="array"&&t.type==="array"?e.elementCount===t.elementCount&&qi(e.elementType,t.elementType):e.type==="struct"&&t.type==="struct"?e===t:!0}var ny=class{cache=new Map;get(t,r){let n=ai(t);if(!n?.ast)return;if(!r&&n.ast.params.length>0)throw new Error(`Cannot resolve '${x(t)}' directly, because it expects arguments. Either call it from another function, or wrap it in a shell`);let i=(r??[]).map((o,u)=>{if(o.value instanceof dt){if(o.dataType.type==="unknown")throw new C("d.ref() created with primitive types must be stored in a variable before use");return o.dataType}if(o.dataType.type==="unknown")throw new Error(`Passed illegal value ${o.value} as the #${u} argument to ${n.name}(...)`);let h=St(o.dataType);if(o.origin==="constant-tgpu-const-ref"||o.origin==="runtime-tgpu-const-ref"){let p=Ee();throw new Error(`Cannot pass constant references as function arguments. Explicitly copy them by wrapping them in a schema: '${p.resolve(h).value}(...)'`)}return De(h)&&h.implicit&&(h=h.inner),h}),s=this.cache.get(t);if(s){let o=s.find(u=>u.argTypes.length===i.length&&u.argTypes.every((h,p)=>qi(h,i[p])));if(o)return o}else s=[],this.cache.set(t,s);let a=ry(i,t);return s.push(a),a}},iy=class{[l];constructor(t){this[l]={nameRegistry:t,shelllessRepo:new ny,memoizedResolves:new WeakMap,memoizedDerived:new WeakMap,listeners:{name:new Set}}}on(t,r){if(t==="name"){let n=this[l].listeners.name;return n.add(r),()=>n.delete(r)}throw new Error(`Unsupported event: ${t}`)}};function sy(e,t){let r=e.nameRegistry.makeUnique(x(t),!0);for(let n of e.listeners.name)n({target:t,name:r});return r}function jr(e){let{names:t="strict"}=e??{};return new iy(t==="strict"?new ty:new ey)}function bi(e){return typeof e?.format=="string"}function ay(e,t){let r=[];if(Or(e)){if(!bi(t))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return r.push(t._layout),{usedVertexLayouts:r,bufferDefinitions:[{arrayStride:t._layout.stride,stepMode:t._layout.stepMode,attributes:[{format:t.format,offset:t.offset,shaderLocation:Vt(e)??0}]}]}}let n=[],i=new WeakMap,s=0;for(let[a,o]of Object.entries(e)){if(wt(o))continue;let u=t[a];if(!u)throw new Error(`An attribute by the name of '${a}' was not provided to the shader.`);let h=u._layout,p=i.get(h);p||(r.push(h),p=[],n.push({arrayStride:h.stride,stepMode:h.stepMode,attributes:p}),i.set(h,p)),s=Vt(o)??s,p.push({format:u.format,offset:u.offset,shaderLocation:s++})}return{usedVertexLayouts:r,bufferDefinitions:n}}var oy=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","vec2<bool>","vec3<bool>","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","texture_external"];function uy(e){return oy.includes(e.type)}function Hi(e,[t,r]){if(!Ru(t))throw new Error(`Property key '${t}' is a reserved WGSL word. Choose a different name.`);return`  ${Ms(r)}${t}: ${e.resolve(r).value},
`}function hy(e,t){if(t[l].isAbstruct)throw new Error("Cannot resolve abstract struct types to WGSL.");let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>Hi(e,n)).join("")}}`),r}function ly(e,t){let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>bi(n[1])?Hi(e,[n[0],gt[n[1].format]]):Hi(e,n)).join("")}
}`),r}function cy(e,t){let r=e.resolve(t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function py(e,t){let r=e.resolve(bi(t.elementType)?gt[t.elementType.format]:t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function Lu(e,t){if(Br(t))return t.type==="unstruct"?ly(e,t):t.type==="disarray"?py(e,t):t.type==="loose-decorated"?e.resolve(bi(t.inner)?gt[t.inner.format]:t.inner).value:e.resolve(gt[t.type]).value;if(uy(t))return t.type;if(t.type==="struct")return hy(e,t);if(t.type==="array")return cy(e,t);if(t.type==="atomic")return`atomic<${Lu(e,t.inner)}>`;if(t.type==="decorated")return e.resolve(t.inner).value;if(t.type==="ptr")return t.addressSpace==="storage"?`ptr<storage, ${e.resolve(t.inner).value}, ${t.access==="read-write"?"read_write":t.access}>`:`ptr<${t.addressSpace}, ${e.resolve(t.inner).value}>`;if(t.type==="abstractInt"||t.type==="abstractFloat"||t.type==="void"||t.type==="u16")throw new Error(`${t.type} has no representation in WGSL`);if(ji(t))return`${t.type}<${t.format}, ${bn[t.access]}>`;if(hu(t))return t.type.startsWith("texture_depth")?t.type:`${t.type}<${t.sampleType.type}>`;if(vp(t)||xp(t))return t.type;Ur(t,"resolveData")}var Nu=class Yi{constructor(t){this.bindings=t}with(t,r){return new Yi([...this.bindings,[oi(t)?t.slot:t,r]])}pipe(t){let r=t(this);return new Yi([...this.bindings,...r.bindings])}};function*dy(e){let t=0;for(;;)e.has(t)||(yield t),t++}function fy(e,t){let r="size"in e?e.size:e.currentByteOffset,n=t-1,i=r&n;"skipBytes"in e?e.skipBytes(t-i&n):e.add(t-i&n)}var oe=fy,$a=new WeakMap;function Du(e){let t=$a.get(e);if(t)return t;let r=new K,n={},i;for(let s in e.propTypes){let a=e.propTypes[s];if(a===void 0)throw new Error(`Property ${s} is undefined in struct`);let o=r.size;oe(r,qe(e)?Oe(a):J(a)),i&&(i.padding=r.size-o);let u=U(a);n[s]={offset:r.size,size:u},i=n[s],r.add(u)}return i&&(i.padding=Se(U(e),J(e))-r.size),$a.set(e,n),n}var my=(()=>{try{return new Function("return true"),!0}catch{return!1}})(),Ii=new WeakMap,Pn={u32:"u32",vec2u:"u32",vec3u:"u32",vec4u:"u32",u16:"u16",i32:"i32",vec2i:"i32",vec3i:"i32",vec4i:"i32",f32:"f32",vec2f:"f32",vec3f:"f32",vec4f:"f32",f16:"f16",vec2h:"f16",vec3h:"f16",vec4h:"f16",mat2x2f:"f32",mat3x3f:"f32",mat4x4f:"f32"},yy={uint8:"u8",uint8x2:"u8",uint8x4:"u8",sint8:"i8",sint8x2:"i8",sint8x4:"i8",unorm8:"u8",unorm8x2:"u8",unorm8x4:"u8",snorm8:"i8",snorm8x2:"i8",snorm8x4:"i8",uint16:"u16",uint16x2:"u16",uint16x4:"u16",sint16:"i16",sint16x2:"i16",sint16x4:"i16",unorm16:"u16",unorm16x2:"u16",unorm16x4:"u16",snorm16:"i16",snorm16x2:"i16",snorm16x4:"i16",float16:"f16",float16x2:"f16",float16x4:"f16",float32:"f32",float32x2:"f32",float32x3:"f32",float32x4:"f32",uint32:"u32",uint32x2:"u32",uint32x3:"u32",uint32x4:"u32",sint32:"i32",sint32x2:"i32",sint32x3:"i32",sint32x4:"i32"},An={u32:"setUint32",i32:"setInt32",f32:"setFloat32",u16:"setUint16",i16:"setInt16",f16:"setFloat16",u8:"setUint8",i8:"setInt8"},gy={unorm8:e=>`Math.round(${e} * 255)`,unorm8x2:e=>`Math.round(${e} * 255)`,unorm8x4:e=>`Math.round(${e} * 255)`,snorm8:e=>`Math.round(${e} * 127)`,snorm8x2:e=>`Math.round(${e} * 127)`,snorm8x4:e=>`Math.round(${e} * 127)`,unorm16:e=>`Math.round(${e} * 65535)`,unorm16x2:e=>`Math.round(${e} * 65535)`,unorm16x4:e=>`Math.round(${e} * 65535)`,snorm16:e=>`Math.round(${e} * 32767)`,snorm16x2:e=>`Math.round(${e} * 32767)`,snorm16x4:e=>`Math.round(${e} * 32767)`},ba={"unorm10-10-10-2":{writeFunction:"setUint32",generator:(e,t)=>`output.setUint32(${e}, ((${t}.x*1023&0x3FF)<<22)|((${t}.y*1023&0x3FF)<<12)|((${t}.z*1023&0x3FF)<<2)|(${t}.w*3&3), littleEndian);
`},"unorm8x4-bgra":{writeFunction:"setUint8",generator:(e,t)=>{let r=["z","y","x","w"],n="";for(let i=0;i<4;i++)n+=`output.setUint8((${e} + ${i}), Math.round(${t}.${r[i]} * 255), littleEndian);
`;return n}}};function Fn(e,t,r,n=0){let i=["i","j","k"][n]||`i${n}`;if(Wn(e)||We(e))return Fn(e.inner,t,r,n);if(pe(e)||qe(e)){let a=Du(e),o="";for(let[u,h]of Object.entries(a)){let p=e.propTypes[u];p&&(o+=Fn(p,`(${t} + ${h.offset})`,`${r}.${u}`,n))}return o}if(ve(e)||yt(e)){let a=Se(U(e.elementType),J(e)),o="";return o+=`for (let ${i} = 0; ${i} < ${e.elementCount}; ${i}++) {
`,o+=Fn(e.elementType,`(${t} + ${i} * ${a})`,`${r}[${i}]`,n+1),o+=`}
`,o}if(it(e)){let a=Pn[e.type],o="",u=An[a],h=["x","y","z","w"],p=Mi(e)?2:Ui(e)?3:4;for(let f=0;f<p;f++)o+=`output.${u}((${t} + ${f*4}), ${r}.${h[f]}, littleEndian);
`;return o}if(Dn(e)){let a=Pn[e.type],o=An[a],u=Ja(e)?2:Ka(e)?3:4,h=u*u,p=Se(u*4,8),f="";for(let m=0;m<h;m++){let v=Math.floor(m/u),b=m%u,V=v*p+b*4;f+=`output.${o}((${t} + ${V}), ${r}.columns[${v}].${["x","y","z","w"][b]}, littleEndian);
`}return f}if(Ro(e)){let a=e.type;if(a in ba)return ba[a].generator(t,r);let o=yy[a],u=An[o],h=gt[a],p=Za(h)?4:Ui(h)?3:Mi(h)?2:1,f=o==="u8"||o==="i8"?1:o==="u16"||o==="i16"||o==="f16"?2:4,m=["x","y","z","w"],v=gy[a],b="";for(let V=0;V<p;V++){let D=p===1?r:`${r}.${m[V]}`,H=v?v(D):D;b+=`output.${u}((${t} + ${V*f}), ${H}, littleEndian);
`}return b}if(!Object.hasOwn(Pn,e.type))throw new Error(`Primitive ${e.type} is unsupported by compiled writer`);let s=Pn[e.type];return`output.${An[s]}(${t}, ${r}, littleEndian);
`}function _a(e){if(!my){console.warn("This environment does not allow eval - using default writer as fallback");return}if(Ii.has(e))return Ii.get(e);try{let t=Fn(e,"offset","value",0),r=new Function("output","offset","value","littleEndian=true",t);return Ii.set(e,r),r}catch(t){console.warn(`Failed to compile writer for schema: ${e}
Reason: ${t instanceof Error?t.message:String(t)}
Falling back to default writer`)}}var vr={bool(){throw new Error("Booleans are not host-shareable")},f32(e,t,r){e.writeFloat32(r)},f16(e,t,r){e.writeFloat16(r)},i32(e,t,r){e.writeInt32(r)},u32(e,t,r){e.writeUint32(r)},u16(e,t,r){e.writeUint16(r)},vec2f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},vec2h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},vec2i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},vec2u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},vec3f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},vec3h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z)},vec3i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},vec3u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},vec4f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},vec4h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},vec4i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},vec4u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat3x3f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat4x4f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},struct(e,t,r){let n=J(t);oe(e,n);for(let[i,s]of Object.entries(t.propTypes))oe(e,J(s)),Jn(e,s,r[i]);oe(e,n)},array(e,t,r){if(t.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let n=J(t);oe(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)oe(e,n),Jn(e,t.elementType,r[s]);e.seekTo(i+U(t))},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t,r){vr[t.inner.type]?.(e,t,r)},decorated(e,t,r){let n=Oe(t);oe(e,n);let i=e.currentByteOffset;vr[t.inner?.type]?.(e,t.inner,r),e.seekTo(i+U(t))},uint8(e,t,r){e.writeUint8(r)},uint8x2(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y)},uint8x4(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y),e.writeUint8(r.z),e.writeUint8(r.w)},sint8(e,t,r){e.writeInt8(r)},sint8x2(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y)},sint8x4(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y),e.writeInt8(r.z),e.writeInt8(r.w)},unorm8(e,t,r){e.writeUint8(Math.round(r*255))},unorm8x2(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255))},unorm8x4(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255)),e.writeUint8(Math.round(r.z*255)),e.writeUint8(Math.round(r.w*255))},snorm8(e,t,r){e.writeInt8(Math.round(r*127))},snorm8x2(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127))},snorm8x4(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127)),e.writeInt8(Math.round(r.z*127)),e.writeInt8(Math.round(r.w*127))},uint16(e,t,r){e.writeUint16(r)},uint16x2(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y)},uint16x4(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y),e.writeUint16(r.z),e.writeUint16(r.w)},sint16(e,t,r){e.writeInt16(r)},sint16x2(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y)},sint16x4(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y),e.writeInt16(r.z),e.writeInt16(r.w)},unorm16(e,t,r){e.writeUint16(r*65535)},unorm16x2(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535)},unorm16x4(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535),e.writeUint16(r.z*65535),e.writeUint16(r.w*65535)},snorm16(e,t,r){e.writeInt16(Math.round(r*32767))},snorm16x2(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767))},snorm16x4(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767)),e.writeInt16(Math.round(r.z*32767)),e.writeInt16(Math.round(r.w*32767))},float16(e,t,r){e.writeFloat16(r)},float16x2(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},float16x4(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},float32(e,t,r){e.writeFloat32(r)},float32x2(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},float32x3(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},float32x4(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},uint32(e,t,r){e.writeUint32(r)},uint32x2(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},uint32x3(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},uint32x4(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},sint32(e,t,r){e.writeInt32(r)},sint32x2(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},sint32x3(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},sint32x4(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},"unorm10-10-10-2"(e,t,r){let n=0;n|=(r.x*1023&1023)<<22,n|=(r.y*1023&1023)<<12,n|=(r.z*1023&1023)<<2,n|=r.w*3&3,e.writeUint32(n)},"unorm8x4-bgra"(e,t,r){e.writeUint8(r.z*255),e.writeUint8(r.y*255),e.writeUint8(r.x*255),e.writeUint8(r.w*255)},disarray(e,t,r){let n=J(t);oe(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)oe(e,n),vr[t.elementType?.type]?.(e,t.elementType,r[s]);e.seekTo(i+U(t))},unstruct(e,t,r){let n=t.propTypes;for(let[i,s]of Object.entries(n))vr[s.type]?.(e,s,r[i])},"loose-decorated"(e,t,r){let n=Oe(t);oe(e,n);let i=e.currentByteOffset,s=vr[t.inner?.type];return s?.(e,t.inner,r),e.seekTo(i+U(t)),r}};function Jn(e,t,r){let n=vr[t.type];if(!n)throw new Error(`Cannot write data of type '${t.type}'.`);n(e,t,r)}var wy={bool(){throw new Error("Booleans are not host-shareable")},f32(e){return e.readFloat32()},f16(e){return e.readFloat16()},i32(e){return e.readInt32()},u32(e){return e.readUint32()},u16(e){return e.readUint16()},vec2f(e){return P(e.readFloat32(),e.readFloat32())},vec3f(e){return se(e.readFloat32(),e.readFloat32(),e.readFloat32())},vec4f(e){return z(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},vec2h(e){return at(e.readFloat16(),e.readFloat16())},vec3h(e){return ot(e.readFloat16(),e.readFloat16(),e.readFloat16())},vec4h(e){return ut(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16())},vec2i(e){return ue(e.readInt32(),e.readInt32())},vec3i(e){return ke(e.readInt32(),e.readInt32(),e.readInt32())},vec4i(e){return he(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32())},vec2u(e){return _e(e.readUint32(),e.readUint32())},vec3u(e){return te(e.readUint32(),e.readUint32(),e.readUint32())},vec4u(e){return me(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32())},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e){return vt(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},mat3x3f(e){let t=()=>{let r=e.readFloat32();return e.readFloat32(),r};return $t(e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t())},mat4x4f(e){return q(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},struct(e,t){let r=J(t);oe(e,r);let n={},i=t.propTypes;for(let[s,a]of Object.entries(i))oe(e,J(a)),n[s]=tt(e,a);return oe(e,r),n},array(e,t){if(t.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let r=J(t),n=[];for(let i=0;i<t.elementCount;i++){oe(e,r);let s=t.elementType,a=tt(e,s);n.push(a)}return oe(e,r),n},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t){return tt(e,t.inner)},decorated(e,t){let r=Oe(t);oe(e,r);let n=e.currentByteOffset,i=tt(e,t.inner);return e.seekTo(n+U(t)),i},uint8:e=>e.readUint8(),uint8x2:e=>_e(e.readUint8(),e.readUint8()),uint8x4:e=>me(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),sint8:e=>e.readInt8(),sint8x2:e=>ue(e.readInt8(),e.readInt8()),sint8x4:e=>he(e.readInt8(),e.readInt8(),e.readInt8(),e.readInt8()),unorm8:e=>e.readUint8()/255,unorm8x2:e=>P(e.readUint8()/255,e.readUint8()/255),unorm8x4:e=>z(e.readUint8()/255,e.readUint8()/255,e.readUint8()/255,e.readUint8()/255),snorm8:e=>e.readInt8()/127,snorm8x2:e=>P(e.readInt8()/127,e.readInt8()/127),snorm8x4:e=>z(e.readInt8()/127,e.readInt8()/127,e.readInt8()/127,e.readInt8()/127),uint16:e=>e.readUint16(),uint16x2:e=>_e(e.readUint16(),e.readUint16()),uint16x4:e=>me(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16()),sint16:e=>e.readInt16(),sint16x2:e=>ue(e.readInt16(),e.readInt16()),sint16x4:e=>he(e.readInt16(),e.readInt16(),e.readInt16(),e.readInt16()),unorm16:e=>e.readUint16()/65535,unorm16x2:e=>P(e.readUint16()/65535,e.readUint16()/65535),unorm16x4:e=>z(e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535),snorm16:e=>e.readInt16()/32767,snorm16x2:e=>P(e.readInt16()/32767,e.readInt16()/32767),snorm16x4:e=>z(e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767),float16(e){return e.readFloat16()},float16x2:e=>P(e.readFloat16(),e.readFloat16()),float16x4:e=>z(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16()),float32:e=>e.readFloat32(),float32x2:e=>P(e.readFloat32(),e.readFloat32()),float32x3:e=>se(e.readFloat32(),e.readFloat32(),e.readFloat32()),float32x4:e=>z(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()),uint32:e=>e.readUint32(),uint32x2:e=>_e(e.readUint32(),e.readUint32()),uint32x3:e=>te(e.readUint32(),e.readUint32(),e.readUint32()),uint32x4:e=>me(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32()),sint32:e=>e.readInt32(),sint32x2:e=>ue(e.readInt32(),e.readInt32()),sint32x3:e=>ke(e.readInt32(),e.readInt32(),e.readInt32()),sint32x4:e=>he(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32()),"unorm10-10-10-2"(e){let t=e.readUint32(),r=(t>>22)/1023,n=(t>>12&1023)/1023,i=(t>>2&1023)/1023,s=(t&3)/3;return z(r,n,i,s)},"unorm8x4-bgra"(e){let t=e.readByte()/255,r=e.readByte()/255,n=e.readByte()/255,i=e.readByte()/255;return z(n,r,t,i)},unstruct(e,t){let r={},n=t.propTypes;for(let[i,s]of Object.entries(n))r[i]=tt(e,s);return r},disarray(e,t){let r=J(t),n=[];for(let i=0;i<t.elementCount;i++)oe(e,r),n.push(tt(e,t.elementType));return oe(e,r),n},"loose-decorated"(e,t){oe(e,Oe(t));let r=e.currentByteOffset,n=tt(e,t.inner);return e.seekTo(r+U(t)),n}};function tt(e,t){let r=wy[t.type];if(!r)throw new Error(`Cannot read data of type '${t.type}'.`);return r(e,t)}function xy(e,t){let r=U(e);if(r===0||t===void 0||t===null)return[];let n=new ArrayBuffer(r),i=new er(n),s=[];function a(h,p,f,m){if(p!=null){if(pe(h)||qe(h)){let v=Du(h);for(let[b,V]of Object.entries(v)){let D=h.propTypes[b];if(!D)continue;let H=p[b];H!==void 0&&a(D,H,f+V.offset,V.padding??m)}return}if(ve(h)||yt(h)){let v=h,b=Se(U(v.elementType),J(v.elementType));if(!Array.isArray(p))throw new Error("Partial value for array must be an array");let V=p??[];V.sort((D,H)=>D.idx-H.idx);for(let{idx:D,value:H}of V)a(v.elementType,H,f+D*b,b-U(v.elementType))}else{let v=U(h);i.seekTo(f),Jn(i,h,p),s.push({start:f,end:f+v,padding:m})}}}if(a(e,t,0),s.length===0)return[];let o=[],u=s[0];for(let h=1;h<s.length;h++){let p=s[h];if(!p||!u)throw new Error("Internal error: missing segment");p.start===u.end+(u.padding??0)?(u.end=p.end,u.padding=p.padding):(o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),u=p)}if(!u)throw new Error("Internal error: missing segment");return o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),o}function Kn(e){return!!e?.usableAsStorage}var Ta=class Wu extends Error{constructor(t){super(`Resource '${x(t)??"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,Wu.prototype)}};function qu(e){return!!e.usableAsUniform}var Hu={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},Ws=class{constructor(e,t){this.usage=e,this.buffer=t,this[l]={dataType:t.dataType},this[ne]=t}resourceType="buffer-usage";[l];[ne];$name(e){return this.buffer.$name(e),this}[T](e){let t=this.buffer.dataType,r=e.getUniqueName(this),{group:n,binding:i}=e.allocateFixedEntry(this.usage==="uniform"?{uniform:t}:{storage:t,access:this.usage},this.buffer),s=Hu[this.usage];return e.addDeclaration(`@group(${n}) @binding(${i}) var<${s}> ${r}: ${e.resolve(t).value};`),y(r,t,we(t)?"runtime":this.usage)}toString(){return`${this.usage}:${x(this)??"<unnamed>"}`}get[O](){let e=this.buffer.dataType,t=this.usage;return new Proxy({[l]:!0,get[Te](){return y(this,e,we(e)?"runtime":t)},[T]:r=>r.resolve(this),toString:()=>`${this.usage}:${x(this)??"<unnamed>"}.$`},Fe)}get $(){let e=Hn(),t=qn();if(e.type==="normal")throw new sa(t?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.read()`");return e.type==="codegen"?this[O]:e.type==="simulate"?(e.buffers.has(this.buffer)||e.buffers.set(this.buffer,At(this.buffer.dataType,this.buffer.initial)),e.buffers.get(this.buffer)):Ur(e,"bufferUsage.ts#TgpuFixedBufferImpl/$")}get value(){return this.$}set $(e){let t=Hn(),r=qn();if(t.type==="normal")throw new sa(r?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.write()`");if(t.type==="codegen")throw new Error("Unreachable bufferUsage.ts#TgpuFixedBufferImpl/$");if(t.type==="simulate"){t.buffers.set(this.buffer,e);return}Ur(t,"bufferUsage.ts#TgpuFixedBufferImpl/$")}set value(e){this.$=e}},za=class{constructor(e,t,r){this.usage=e,this.dataType=t,this[l]={dataType:t},this.#e=r,G(this,r.key)}[l];resourceType="buffer-usage";#e;[T](e){let t=this.dataType,r=e.getUniqueName(this),n=e.allocateLayoutEntry(this.#e.layout),i=Hu[this.usage];return e.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var<${i}> ${r}: ${e.resolve(t).value};`),y(r,t,we(t)?"runtime":this.usage)}toString(){return`${this.usage}:${x(this)??"<unnamed>"}`}get[O](){let e=this.dataType,t=this.usage;return new Proxy({[l]:!0,get[Te](){return y(this,e,we(e)?"runtime":t)},[T]:r=>r.resolve(this),toString:()=>`${this.usage}:${x(this)??"<unnamed>"}.$`},Fe)}get $(){if(Xe())return this[O];throw new Error("Direct access to buffer values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},Ia=new WeakMap;function vy(e){if(!Kn(e))throw new Error(`Cannot pass ${e} to asMutable, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=Ia.get(e);return t||(t=new Ws("mutable",e),Ia.set(e,t)),t}var Sa=new WeakMap;function $y(e){if(!Kn(e))throw new Error(`Cannot pass ${e} to asReadonly, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=Sa.get(e);return t||(t=new Ws("readonly",e),Sa.set(e,t)),t}var Ea=new WeakMap;function by(e){if(!qu(e))throw new Error(`Cannot pass ${e} to asUniform, as it is not allowed to be used as a uniform. To allow it, call .$usage('uniform') when creating the buffer.`);let t=Ea.get(e);return t||(t=new Ws("uniform",e),Ea.set(e,t)),t}var _y={uniform:by,mutable:vy,readonly:$y};function Bn(e,t,r){return Ot(t)?new ka(e,t,r):new ka(e,t,r,["storage","uniform"])}function nn(e){return e.resourceType==="buffer"}var Ty=vu(),ka=class{constructor(t,r,n,i){this.dataType=r,this.initialOrBuffer=n,this._disallowedUsages=i,this.#e=t.device,Fi(n)?(this._ownBuffer=!1,this._buffer=n):(this._ownBuffer=!0,this.initial=n)}[l]=!0;resourceType="buffer";flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;#e;_buffer=null;_ownBuffer;_destroyed=!1;_hostBuffer;initial;usableAsUniform=!1;usableAsStorage=!1;usableAsVertex=!1;usableAsIndex=!1;get buffer(){if(this._destroyed)throw new Error("This buffer has been destroyed");return this._buffer||(this._buffer=this.#e.createBuffer({size:U(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:x(this)??"<unnamed>"}),this.initial&&(this._writeToTarget(this._buffer.getMappedRange(),this.initial),this._buffer.unmap())),this._buffer}get destroyed(){return this._destroyed}$name(t){return G(this,t),this._buffer&&(this._buffer.label=t),this}$usage(...t){for(let r of t){if(this._disallowedUsages?.includes(r))throw new Error(`Buffer of type ${this.dataType.type} cannot be used as ${r}`);this.flags|=r==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=r==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=r==="vertex"?GPUBufferUsage.VERTEX:0,this.flags|=r==="index"?GPUBufferUsage.INDEX:0,this.usableAsUniform=this.usableAsUniform||r==="uniform",this.usableAsStorage=this.usableAsStorage||r==="storage",this.usableAsVertex=this.usableAsVertex||r==="vertex",this.usableAsIndex=this.usableAsIndex||r==="index"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}compileWriter(){_a(this.dataType)}_writeToTarget(t,r){let n=_a(this.dataType);if(n)try{n(new DataView(t),0,r,Ty==="little");return}catch(i){console.error(`Error when using compiled writer for buffer ${x(this)??"<unnamed>"} - this is likely a bug, please submit an issue at https://github.com/software-mansion/TypeGPU/issues
Using fallback writer instead.`,i)}Jn(new er(t),this.dataType,r)}write(t){let r=this.buffer;if(r.mapState==="mapped"){let i=r.getMappedRange();this._writeToTarget(i,t);return}let n=U(this.dataType);this._hostBuffer||(this._hostBuffer=new ArrayBuffer(n)),this._writeToTarget(this._hostBuffer,t),this.#e.queue.writeBuffer(r,0,this._hostBuffer,0,n)}writePartial(t){let r=this.buffer,n=xy(this.dataType,t);if(r.mapState==="mapped"){let i=r.getMappedRange(),s=new Uint8Array(i);for(let a of n)s.set(a.data,a.data.byteOffset)}else for(let i of n)this.#e.queue.writeBuffer(r,i.data.byteOffset,i.data,0,i.data.byteLength)}clear(){let t=this.buffer;if(t.mapState==="mapped"){new Uint8Array(t.getMappedRange()).fill(0);return}let r=this.#e.createCommandEncoder();r.clearBuffer(t),this.#e.queue.submit([r.finish()])}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let r=U(this.dataType),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t.buffer,0,this.buffer,0,r),this.#e.queue.submit([n.finish()])}async read(){let t=this.buffer;if(t.mapState==="mapped"){let s=t.getMappedRange();return tt(new Mt(s),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let s=t.getMappedRange(),a=tt(new Mt(s),this.dataType);return t.unmap(),a}let r=this.#e.createBuffer({size:U(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t,0,r,0,U(this.dataType)),this.#e.queue.submit([n.finish()]),await r.mapAsync(GPUMapMode.READ,0,U(this.dataType));let i=tt(new Mt(r.getMappedRange()),this.dataType);return r.unmap(),r.destroy(),i}as(t){return _y[t]?.(this)}destroy(){this._destroyed||(this._destroyed=!0,this._ownBuffer&&this._buffer?.destroy())}toString(){return`buffer:${x(this)??"<unnamed>"}`}};function zy(e,t){return new Qu(Cs(),e,t)}function Iy(e,t){return new Qu(Fs(),e,t)}function Yu(e){let t=e;return t?.resourceType==="sampler"&&!!t[l]}function Xu(e){let t=e;return t?.resourceType==="sampler-comparison"&&!!t[l]}var Sy=class{constructor(t,r){this.schema=t,this.#e=r,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",G(this,r.key)}[l]={unwrap:void 0};resourceType;#e;[T](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}get[O](){let t=this.schema;return new Proxy({[l]:!0,get[Te](){return y(this,t,"handle")},[T]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},Fe)}get $(){if(Xe())return this[O];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}toString(){return`${this.resourceType}:${x(this)??"<unnamed>"}`}},Qu=class{constructor(t,r,n){this.schema=t,this.#r=r,this.#n=n,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",this[l]={unwrap:()=>(this.#t||(this.#t=this.#n.device.createSampler({...this.#r,label:x(this)??"<unnamed>"})),this.#t)},this.#e=r.minFilter==="linear"||r.magFilter==="linear"||r.mipmapFilter==="linear"}[l];resourceType;#e;#t=null;#r;#n;[T](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(this.schema.type==="sampler_comparison"?{sampler:"comparison"}:{sampler:this.#e?"filtering":"non-filtering"},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}get[O](){let t=this.schema;return new Proxy({[l]:!0,get[Te](){return y(this,t,"handle")},[T]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},Fe)}get $(){if(Xe())return this[O];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}$name(t){return G(this,t),this}toString(){return`${this.resourceType}:${x(this)??"<unnamed>"}`}},Ey=class{constructor(t,r){this.schema=t,this.#e=r,G(this,r.key)}resourceType="external-texture";[l]=!0;#e;[T](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),y(r,uu(),"handle")}get[O](){let t=this.schema;return new Proxy({[l]:!0,get[Te](){return y(this,t,"handle")},[T]:r=>r.resolve(this),toString:()=>`textureExternal:${x(this)??"<unnamed>"}.$`},Fe)}get $(){if(Xe())return this[O];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureExternal:${x(this)??"<unnamed>"}`}};function Zu(e){let{videoWidth:t,videoHeight:r}=e;if(t&&r)return{width:t,height:r};let{naturalWidth:n,naturalHeight:i}=e;if(n&&i)return{width:n,height:i};let{codedWidth:s,codedHeight:a}=e;if(s&&a)return{width:s,height:a};let{width:o,height:u}=e;if(o&&u)return{width:o,height:u};throw new Error("Cannot determine dimensions of the provided image source.")}var ky=`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) i: u32) -> VertexOutput {
  const pos = array(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  const uv = array(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));
  return VertexOutput(vec4f(pos[i], 0, 1), uv[i]);
}`,My=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  return textureSample(src, samp, uv);
}`,Uy=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  let r = textureGather(0, src, samp, uv);
  let g = textureGather(1, src, samp, uv);
  let b = textureGather(2, src, samp, uv);
  let a = textureGather(3, src, samp, uv);
  return vec4f(dot(r, vec4f(0.25)), dot(g, vec4f(0.25)), dot(b, vec4f(0.25)), dot(a, vec4f(0.25)));
}`,Xi=new WeakMap;function Vy(e){let t=Xi.get(e);return t||(t={vertexModule:e.createShaderModule({code:ky}),filterableResources:new Map,layoutResources:new Map},Xi.set(e,t)),t}function Py(e,t,r){let n=Vy(e),i=n.filterableResources.get(t);i||(i={fragmentModule:e.createShaderModule({code:t?My:Uy}),sampler:e.createSampler(t?{magFilter:"linear",minFilter:"linear"}:{})},n.filterableResources.set(t,i));let s=`${t}:${r}`,a=n.layoutResources.get(s);if(!a){let o=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:r}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:t?"filtering":"non-filtering"}}]});a={bindGroupLayout:o,pipelineLayout:e.createPipelineLayout({bindGroupLayouts:[o]})},n.layoutResources.set(s,a)}return{vertexModule:n.vertexModule,...i,...a}}function Ju(e){let{device:t,source:r,destination:n,format:i,filterable:s,sampleType:a}=e,o=Py(t,s,a),u=t.createRenderPipeline({layout:o.pipelineLayout,vertex:{module:o.vertexModule},fragment:{module:o.fragmentModule,targets:[{format:i}]},primitive:{topology:"triangle-list"}}),h=t.createBindGroup({layout:o.bindGroupLayout,entries:[{binding:0,resource:r},{binding:1,resource:o.sampler}]}),p=!e.encoder,f=e.encoder??t.createCommandEncoder(),m=f.beginRenderPass({colorAttachments:[{view:n,loadOp:"clear",storeOp:"store"}]});m.setPipeline(u),m.setBindGroup(0,h),m.draw(3),m.end(),p&&t.queue.submit([f.finish()])}function Ay(e){Xi.delete(e)}function Ku(e,t,r){let n=Tn(t),i=Gm(e,t),s=i.includes("float"),a=i.includes("unfilterable-float");if(!s&&!a)throw new Error(`Cannot ${r} for format '${t}': only float formats are supported.`);if(!n.canRenderAttachment)throw new Error(`Cannot ${r} for format '${t}': format does not support render attachments.`);return{filterable:s,sampleType:s?"float":"unfilterable-float"}}function By(e,t,r=0,n){if(t.dimension!=="2d")throw new Error("Mipmap generation only supports 2D textures.");let{filterable:i,sampleType:s}=Ku(e,t.format,"generate mipmaps"),a=n??t.mipLevelCount-r;for(let o=0;o<t.depthOrArrayLayers;o++)for(let u=r;u<r+a-1;u++){let h=p=>({dimension:"2d",baseMipLevel:p,mipLevelCount:1,baseArrayLayer:o,arrayLayerCount:1});Ju({device:e,source:t.createView(h(u)),destination:t.createView(h(u+1)),format:t.format,filterable:i,sampleType:s})}}function Oy(e,t,r,n=0){if(t.dimension!=="2d")throw new Error("Resampling only supports 2D textures.");let{filterable:i}=Ku(e,t.format,"resample"),{width:s,height:a}=Zu(r),o=e.createTexture({size:[s,a],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.copyExternalImageToTexture({source:r},{texture:o},[s,a]);let u=e.createTexture({size:[t.width,t.height],format:t.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),h=e.createCommandEncoder();Ju({device:e,source:o.createView(),destination:u.createView(),format:t.format,filterable:i,sampleType:"float",encoder:h}),h.copyTextureToTexture({texture:u},{texture:t,origin:{x:0,y:0,z:n}},{width:t.width,height:t.height,depthOrArrayLayers:1}),e.queue.submit([h.finish()]),o.destroy(),u.destroy()}function Cy(e){return{dimension:e.dimension??"2d",sampleType:Tn(e.format).channelType,multisampled:(e.sampleCount??1)!==1}}function Fy(e,t){return new Gy(e,t)}function un(e){return e?.resourceType==="texture"&&!!e[l]}function hn(e){return e?.resourceType==="texture-view"&&!!e[l]}var Gy=class{constructor(t,r){this.props=t;let n=t.format;this.#s=r,this.#e=Tn(n);let i=this.#e.texelSize;this.#t=i==="non-copyable"?"non-copyable":t.size[0]*(t.size[1]??1)*(t.size[2]??1)*i,this[l]={unwrap:()=>{if(this.#r)throw new Error("This texture has been destroyed");return this.#i||(this.#i=r.device.createTexture({label:x(this)??"<unnamed>",format:t.format,size:t.size,usage:this.#n,dimension:t.dimension??"2d",viewFormats:t.viewFormats??[],mipLevelCount:t.mipLevelCount??1,sampleCount:t.sampleCount??1})),this.#i}}}[l];resourceType="texture";usableAsSampled=!1;usableAsStorage=!1;usableAsRender=!1;#e;#t;#r=!1;#n=GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;#i=null;#s;$name(t){return G(this,t),this}$usage(...t){let r=t.includes("storage"),n=t.includes("sampled"),i=t.includes("render");return this.#n|=n?GPUTextureUsage.TEXTURE_BINDING:0,this.#n|=r?GPUTextureUsage.STORAGE_BINDING:0,this.#n|=i?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||=r,this.usableAsSampled||=n,this.usableAsRender||=i,this}createView(t,r){return t==="render"?new jy(this,r):new Ry(t??Ri(Cy(this.props)),this,r)}#a(t=0){let r=2**t,[n,i,s]=[Math.max(1,Math.floor((this.props.size[0]??1)/r)),Math.max(1,Math.floor((this.props.size[1]??1)/r)),Math.max(1,Math.floor((this.props.size[2]??1)/r))],a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot clear texture with format '${this.props.format}': this format does not support copy operations.`);this.#s.device.queue.writeTexture({texture:this[l].unwrap(),mipLevel:t},new Uint8Array(n*i*s*a),{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}clear(t="all"){if(t==="all"){let r=this.props.mipLevelCount??1;for(let n=0;n<r;n++)this.#a(n)}else this.#a(t)}generateMipmaps(t=0,r){if(this.usableAsRender===!1)throw new Error("generateMipmaps called without specifying 'render' usage. Add it via the $usage('render') method.");let n=r??(this.props.mipLevelCount??1)-t;if(n<=1){console.warn(`generateMipmaps is a no-op: would generate ${n} mip levels (base: ${t}, total: ${this.props.mipLevelCount??1})`);return}if(t>=(this.props.mipLevelCount??1))throw new Error(`Base mip level ${t} is out of range. Texture has ${this.props.mipLevelCount??1} mip levels.`);By(this.#s.device,this[l].unwrap(),t,n)}write(t,r=0){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){this.#u(t,r);return}let n=this.props.dimension??"2d";if(!Array.isArray(t)){this.#o(t,n==="3d"?0:void 0);return}let i=this.props.size[2]??1;t.length>i&&console.warn(`Too many image sources provided. Expected ${i} layers, got ${t.length}. Extra sources will be ignored.`);for(let s=0;s<Math.min(t.length,i);s++){let a=t[s];a&&this.#o(a,s)}}#u(t,r){let n=Math.max(1,this.props.size[0]>>r),i=Math.max(1,(this.props.size[1]??1)>>r),s=Math.max(1,(this.props.size[2]??1)>>r),a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot write to texture with format '${this.props.format}': this format does not support copy operations.`);let o=n*i*s*a,u=t.byteLength??t.byteLength;if(u!==o)throw new Error(`Buffer size mismatch. Expected ${o} bytes for mip level ${r}, got ${u} bytes.`);this.#s.device.queue.writeTexture({texture:this[l].unwrap(),mipLevel:r},"buffer"in t?t.buffer:t,{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}#o(t,r){let n=this.props.size[0],i=this.props.size[1]??1,{width:s,height:a}=Zu(t);if(s!==n||a!==i){Oy(this.#s.device,this[l].unwrap(),t,r);return}this.#s.device.queue.copyExternalImageToTexture({source:t},{texture:this[l].unwrap(),...r!==void 0&&{origin:{x:0,y:0,z:r}}},r!==void 0?[n,i,1]:this.props.size)}copyFrom(t){if(t.props.format!==this.props.format)throw new Error(`Texture format mismatch. Source texture has format ${t.props.format}, target texture has format ${this.props.format}`);if(t.props.size[0]!==this.props.size[0]||(t.props.size[1]??1)!==(this.props.size[1]??1)||(t.props.size[2]??1)!==(this.props.size[2]??1))throw new Error(`Texture size mismatch. Source texture has size ${t.props.size.join("x")}, target texture has size ${this.props.size.join("x")}`);let r=this.#s.device.createCommandEncoder();r.copyTextureToTexture({texture:t[l].unwrap()},{texture:this[l].unwrap()},t.props.size),this.#s.device.queue.submit([r.finish()])}get destroyed(){return this.#r}destroy(){this.#r||(this.#r=!0,this.#i?.destroy())}},Ry=class{constructor(t,r,n){this.schema=t,this.#e=r,this.#r=n,this[l]={unwrap:()=>{if(!this.#t){let i=this.schema,s=ji(i)?i.format:this.#e.props.format;this.#t=this.#e[l].unwrap().createView({...this.#r,label:x(this)??"<unnamed>",format:this.#r?.format??s,dimension:i.dimension})}return this.#t}}}[l];resourceType="texture-view";#e;#t;#r;$name(t){return G(this,t),this.#t&&(this.#t.label=t),this}get[O](){let t=this.schema;return new Proxy({[l]:!0,get[Te](){return y(this,t,"handle")},[T]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},Fe)}get $(){if(Xe())return this[O];throw new Error("Direct access to texture view values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureView:${x(this)??"<unnamed>"}`}[T](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(ji(this.schema)?{storageTexture:this.schema}:{texture:this.schema,sampleType:this.#r?.sampleType??this.schema.bindingSampleType[0]},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),y(r,this.schema,"handle")}},Ma=class{constructor(e,t){this.schema=e,this.#e=t,G(this,t.key)}[l]={unwrap:void 0};resourceType="texture-view";#e;toString(){return`textureView:${x(this)??"<unnamed>"}`}[T](e){let t=e.getUniqueName(this),r=e.allocateLayoutEntry(this.#e.layout);return e.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var ${t}: ${e.resolve(this.schema).value};`),y(t,this.schema,"handle")}get[O](){let e=this.schema;return new Proxy({[l]:!0,get[Te](){return y(this,e,"handle")},[T]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},Fe)}get $(){if(Xe())return this[O];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},jy=class{constructor(e,t={}){this.descriptor=t,this[l]={unwrap:()=>e[l].unwrap().createView({label:x(this)??"<unnamed>",...this.descriptor})}}[l];resourceType="texture-view"};function Ly(e){return!!e?.usableAsSampled}var Ny=class eh extends Error{constructor(t){super(`Resource '${x(t)??"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,eh.prototype)}};function Dy(e){let t={};for(let[r,n]of Object.entries(e)){if(n===null){t[r]=null;continue}if("texture"in n&&typeof n.texture=="string"){let i=n.texture;t[r]={...n,texture:Ri({dimension:n.viewDimension??"2d",sampleType:i==="sint"?R:i==="uint"?$:w,multisampled:n.multisampled??!1})}}else if("storageTexture"in n&&typeof n.storageTexture=="string"){let i={readonly:"read-only",writeonly:"write-only",mutable:"read-write"};t[r]={...n,storageTexture:Ri({access:i[n.access??"writeonly"],format:n.storageTexture,dimension:n.viewDimension??"2d"})}}else"externalTexture"in n&&Object.keys(n.externalTexture).length===0?t[r]={...n,externalTexture:{type:"texture_external",dimension:"2d"}}:t[r]=n}return t}function th(e){let t=Dy(e);return new qy(t)}function rh(e){return!!e&&e.resourceType==="bind-group-layout"}function ei(e){return!!e&&e.resourceType==="bind-group"}var Wy=class nh extends Error{constructor(t,r){super(`Bind group '${t??"<unnamed>"}' is missing a required binding '${r}'`),Object.setPrototypeOf(this,nh.prototype)}},Ua=["compute","fragment"],Hr=["compute","vertex","fragment"],qy=class{constructor(e){this.entries=e;let t=0;for(let[r,n]of Object.entries(e)){if(n===null){t++;continue}let i={layout:this,key:r,idx:t};if("uniform"in n&&(this.bound[r]=new za("uniform",n.uniform,i)),"storage"in n){let s="type"in n.storage?n.storage:n.storage(0);this.bound[r]=new za(n.access??"readonly",s,i)}"texture"in n&&(this.bound[r]=new Ma(n.texture,i)),"storageTexture"in n&&(this.bound[r]=new Ma(n.storageTexture,i)),"externalTexture"in n&&(this.bound[r]=new Ey(n.externalTexture,i)),"sampler"in n&&(this.bound[r]=new Sy(n.sampler==="comparison"?Fs():Cs(),i)),Object.defineProperty(this.value,r,{get:()=>this.bound[r].value}),t++}}[l]=!0;_index;resourceType="bind-group-layout";bound={};value={};$=this.value;get[O](){return this.$}toString(){return`bindGroupLayout:${x(this)??"<unnamed>"}`}get index(){return this._index}$name(e){return G(this,e),this}$idx(e){return this._index=e,this}unwrap(e){return e.device.createBindGroupLayout({label:x(this)??"<unnamed>",entries:Object.values(this.entries).map((t,r)=>{if(t===null)return null;let n=t.visibility,i={binding:r,visibility:0};if("uniform"in t)n=n??Hr,i.buffer={type:"uniform"};else if("storage"in t)n=n??(t.access==="mutable"?Ua:Hr),i.buffer={type:t.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in t)n=n??Hr,i.sampler={type:t.sampler};else if("texture"in t){n=n??Hr;let{multisampled:s,dimension:a,bindingSampleType:o}=t.texture;i.texture={sampleType:t.sampleType??o[0],viewDimension:a,multisampled:s}}else if("storageTexture"in t){n=n??Ua;let{dimension:s,access:a,format:o}=t.storageTexture;i.storageTexture={access:a,format:o,viewDimension:s}}else"externalTexture"in t&&(n=n??Hr,i.externalTexture={});return n?.includes("compute")&&(i.visibility|=GPUShaderStage.COMPUTE),n?.includes("vertex")&&(i.visibility|=GPUShaderStage.VERTEX),n?.includes("fragment")&&(i.visibility|=GPUShaderStage.FRAGMENT),i}).filter(t=>t!==null)})}},ih=class{constructor(e,t){this.layout=e,this.entries=t;for(let r of Object.keys(e.entries))if(e.entries[r]!==null&&!(r in t))throw new Wy(x(e),r)}resourceType="bind-group";unwrap(e){return e.device.createBindGroup({label:x(this.layout)??"<unnamed>",layout:e.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([t,r],n)=>{if(r===null)return null;let i=this.entries[t];if(i===void 0)throw new Error(`'${t}' is a resource required to populate bind group layout '${x(this.layout)??"<unnamed>"}'.`);if("uniform"in r){let s;if(nn(i)){if(!qu(i))throw new Zh(i);s={buffer:e.unwrap(i)}}else s={buffer:i};return{binding:n,resource:s}}if("storage"in r){let s;if(nn(i)){if(!Kn(i))throw new Ta(i);s={buffer:e.unwrap(i)}}else s={buffer:i};return{binding:n,resource:s}}if("texture"in r){let s;if(un(i)){if(!Ly(i))throw new Ny(i);s=e.unwrap(i.createView(r.texture))}else hn(i)?s=e.unwrap(i):s=i;return{binding:n,resource:s}}if("storageTexture"in r){let s;if(un(i)){if(!Kn(i))throw new Ta(i);s=e.unwrap(i.createView(r.storageTexture))}else hn(i)?s=e.unwrap(i):s=i;return{binding:n,resource:s}}if("sampler"in r)return Xu(i)||Yu(i)?{binding:n,resource:e.unwrap(i)}:{binding:n,resource:i};if("externalTexture"in r)return{binding:n,resource:i};throw new Error(`Malformed bind group entry: ${Bt(i)}`)}).filter(t=>t!==null)})}};function ti(e){return new Hy(e)}var Hy=class{constructor(e=void 0){this.defaultValue=e}[l]=!0;resourceType="slot";$name(e){return G(this,e),this}areEqual(e,t){return Object.is(e,t)}toString(){return`slot:${x(this)??"<unnamed>"}`}get[O](){let e=Ee();if(!e)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return $i(e.unwrap(this))}get value(){return this[O]}get $(){return this.value}};function ri(e,t){return new sh("private",e,t)}function Va(e){return new sh("workgroup",e)}var sh=class{[l]={};#e;#t;#r;constructor(t,r,n){this.#e=t,this.#t=r,this.#r=n}[T](t){let r=t.getUniqueName(this),n=`var<${this.#e}> ${r}: ${t.resolve(this.#t).value}`;return this.#r?t.addDeclaration(`${n} = ${t.resolve(this.#r,this.#t).value};`):t.addDeclaration(`${n};`),y(r,this.#t,we(this.#t)?"runtime":this.#e)}$name(t){return G(this,t),this}toString(){return`var:${x(this)??"<unnamed>"}`}get[O](){let t=this.#t,r=we(t)?"runtime":this.#e;return new Proxy({[l]:!0,get[Te](){return y(this,t,r)},[T]:n=>n.resolve(this),toString:()=>`var:${x(this)??"<unnamed>"}.$`},Fe)}get $(){let t=Hn(),r=qn();if(t.type==="normal")throw new ia(r?`Cannot access variable '${x(this)??"<unnamed>"}'. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");return t.type==="codegen"?this[O]:t.type==="simulate"?(t.vars[this.#e].has(this)||t.vars[this.#e].set(this,this.#r),t.vars[this.#e].get(this)):Ur(t,"tgpuVariable.ts#TgpuVarImpl/$")}set $(t){let r=Hn(),n=qn();if(r.type==="normal")throw new ia(n?`Cannot access ${String(this)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");if(r.type==="codegen")throw new Error("Unreachable tgpuVariable.ts#TgpuVarImpl/$");if(r.type==="simulate"){r.vars[this.#e].set(this,t);return}Ur(r,"tgpuVariable.ts#TgpuVarImpl/$")}get value(){return this.$}set value(t){this.$=t}},ah=ri($,0).$name("dataBlockIndex"),oh=ri($,0).$name("dataByteIndex"),uh=ti().$name("dataBuffer"),Yy=B([],$)`() {
  let i = dataByteIndex;
  dataByteIndex = dataByteIndex + 1u;
  return i;
}`.$uses({dataByteIndex:oh}).$name("nextByteIndex"),g="dataBuffer[dataBlockIndex].serializedData[nextByteIndex()]",hh={f32:B([w])`(n) => {
  ${g} = bitcast<u32>(n);
}`,f16:B([ie])`(n) => {
  ${g} = pack2x16float(vec2f(f32(n), 0.0));
}`,i32:B([R])`(n) => {
  ${g} = bitcast<u32>(n);
}`,u32:B([$])`(n) => {
  ${g} = n;
}`,bool:B([F])`(b) => {
  ${g} = u32(b);
}`,vec2f:B([P])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
}`,vec3f:B([se])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
  ${g} = bitcast<u32>(v.z);
}`,vec4f:B([z])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
  ${g} = bitcast<u32>(v.z);
  ${g} = bitcast<u32>(v.w);
}`,vec2h:B([at])`(v) => {
  ${g} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
}`,vec3h:B([ot])`(v) => {
  ${g} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${g} = pack2x16float(vec2f(f32(v.z), 0.0));
}`,vec4h:B([ut])`(v) => {
  ${g} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${g} = pack2x16float(vec2f(f32(v.z), f32(v.w)));
}`,vec2i:B([ue])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
}`,vec3i:B([ke])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
  ${g} = bitcast<u32>(v.z);
}`,vec4i:B([he])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
  ${g} = bitcast<u32>(v.z);
  ${g} = bitcast<u32>(v.w);
}`,vec2u:B([_e])`(v) => {
  ${g} = v.x;
  ${g} = v.y;
}`,vec3u:B([te])`(v) => {
  ${g} = v.x;
  ${g} = v.y;
  ${g} = v.z;
}`,vec4u:B([me])`(v) => {
  ${g} = v.x;
  ${g} = v.y;
  ${g} = v.z;
  ${g} = v.w;
}`,"vec2<bool>":B([Zt])`(v) => {
  ${g} = u32(v.x);
  ${g} = u32(v.y);
}`,"vec3<bool>":B([Jt])`(v) => {
  ${g} = u32(v.x);
  ${g} = u32(v.y);
  ${g} = u32(v.z);
}`,"vec4<bool>":B([Kt])`(v) => {
  ${g} = u32(v.x);
  ${g} = u32(v.y);
  ${g} = u32(v.z);
  ${g} = u32(v.w);
}`,mat2x2f:B([vt])`(m) => {
  ${g} = bitcast<u32>(m[0][0]);
  ${g} = bitcast<u32>(m[0][1]);
  ${g} = bitcast<u32>(m[1][0]);
  ${g} = bitcast<u32>(m[1][1]);
}`,mat3x3f:B([$t])`(m) => {
  ${g} = bitcast<u32>(m[0][0]);
  ${g} = bitcast<u32>(m[0][1]);
  ${g} = bitcast<u32>(m[0][2]);
  ${g} = 0u;
  ${g} = bitcast<u32>(m[1][0]);
  ${g} = bitcast<u32>(m[1][1]);
  ${g} = bitcast<u32>(m[1][2]);
  ${g} = 0u;
  ${g} = bitcast<u32>(m[2][0]);
  ${g} = bitcast<u32>(m[2][1]);
  ${g} = bitcast<u32>(m[2][2]);
  ${g} = 0u;
}`,mat4x4f:B([q])`(m) => {
  ${g} = bitcast<u32>(m[0][0]);
  ${g} = bitcast<u32>(m[0][1]);
  ${g} = bitcast<u32>(m[0][2]);
  ${g} = bitcast<u32>(m[0][3]);
  ${g} = bitcast<u32>(m[1][0]);
  ${g} = bitcast<u32>(m[1][1]);
  ${g} = bitcast<u32>(m[1][2]);
  ${g} = bitcast<u32>(m[1][3]);
  ${g} = bitcast<u32>(m[2][0]);
  ${g} = bitcast<u32>(m[2][1]);
  ${g} = bitcast<u32>(m[2][2]);
  ${g} = bitcast<u32>(m[2][3]);
  ${g} = bitcast<u32>(m[3][0]);
  ${g} = bitcast<u32>(m[3][1]);
  ${g} = bitcast<u32>(m[3][2]);
  ${g} = bitcast<u32>(m[3][3]);
}`};for(let[e,t]of Object.entries(hh))t.$name(`serialize${e[0].toLocaleUpperCase()}${e.slice(1)}`).$uses({dataBlockIndex:ah,nextByteIndex:Yy,dataBuffer:uh});function lh(e){return`(${e.map((t,r)=>`_arg_${r}`).join(", ")})`}function ch(e,t){let r=hh[e.type];if(r)return r.with(uh,t);if(pe(e)){let n=Object.keys(e.propTypes),i=Object.values(e.propTypes),s=ph(i,t);return B([e])`(arg) {\n  propsSerializer(${n.map(a=>`arg.${a}`).join(", ")});\n}`.$uses({propsSerializer:s}).$name(`${x(e)??"struct"}Serializer`)}if(ve(e)){let n=e.elementType,i=e.elementCount,s=ch(n,t);return B([e])`(arg) {\n${Array.from({length:i},(a,o)=>`  elementSerializer(arg[${o}]);`).join(`
`)}\n}`.$uses({elementSerializer:s}).$name("arraySerializer")}throw new Error(`Cannot serialize data of type ${e.type}`)}function ph(e,t){let r={},n=B(e),i=lh(e),s=e.map((a,o)=>(r[`serializer${o}`]=ch(a,t),`  serializer${o}(_arg_${o});`)).join(`
`);return n`${i} {\n${s}\n}`.$uses(r).$name("compoundSerializer")}function Xy(e,t,r,n,i){let s=t.map(U).reduce((u,h)=>u+h,0);if(s>i.logSizeLimit)throw new Error(`Logged data needs to fit in ${i.logSizeLimit} bytes (one of the logs requires ${s} bytes). Consider increasing the limit by passing appropriate options to tgpu.init().`);let a=ph(t,r).$name(`log${e}serializer`),o=lh(t);return B(t)`${o} {
  dataBlockIndex = atomicAdd(&indexBuffer, 1);
  if (dataBlockIndex >= ${i.logCountLimit}) {
    return;
  }
  dataBuffer[dataBlockIndex].id = ${e};
  dataByteIndex = 0;

  compoundSerializer${o};
}`.$uses({indexBuffer:n,dataBuffer:r,dataBlockIndex:ah,dataByteIndex:oh,compoundSerializer:a}).$name(`log${e}`)}var Qy=["log","debug","info","warn","error","clear"],Zy={logCountLimit:64,logSizeLimit:252,messagePrefix:" GPU "},dh=y("/* console.log() */",ee,"runtime"),Jy=class{get logResources(){}generateLog(){return console.warn("'console.log' is only supported when resolving pipelines."),dh}},Ky=class{#e;#t;#r=1;#n;#i;constructor(t){this.#e={...Zy,...t[l].logOptions},this.#t=new Map;let r=li({id:$,serializedData:on($,Math.ceil(this.#e.logSizeLimit/4))}).$name("SerializedLogData");this.#i=t.createMutable(on(r,this.#e.logCountLimit)).$name("dataBuffer"),this.#n=t.createMutable(lu($)).$name("indexBuffer")}generateLog(t,r,n){if(!Qy.includes(r))return console.warn(`Unsupported log method '${r}' was used in TGSL.`),dh;let i=Sl(n),s=this.#r++,a=i.filter(h=>h.dataType!==Ne),o=Xy(s,a.map(h=>h.dataType),this.#i,this.#n,this.#e),u=i.map(h=>h.dataType===Ne?h.value:h.dataType);return this.#t.set(s,{op:r,argTypes:u}),y(c`${t.resolve(o).value}(${a})`,ee,"runtime")}get logResources(){return this.#r===1?void 0:{dataBuffer:this.#i,indexBuffer:this.#n,options:this.#e,logIdToMeta:this.#t}}},Pa={mat2x2f:P,mat3x3f:se,mat4x4f:z};function fh(e,t){if(ve(e.dataType)||yt(e.dataType)){let r=e.dataType.elementType,n=we(r),i=Tr(e),s=t.origin==="constant",a;return e.origin==="constant-tgpu-const-ref"?s?a=n?"constant":"constant-tgpu-const-ref":a=n?"runtime":"runtime-tgpu-const-ref":e.origin==="runtime-tgpu-const-ref"?a=n?"runtime":"runtime-tgpu-const-ref":!i&&!n?a=e.origin:s&&e.origin==="constant"?a="constant":a="runtime",y(Ie(e)&&Ie(t)?e.value[t.value]:c`${e}[${t}]`,r,a)}if(it(e.dataType))return y(Ie(e)&&Ie(t)?e.value[t.value]:c`${e}[${t}]`,e.dataType.primitive,e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime");if(De(e.dataType))return fh(cs(e),t);if(e.value instanceof so){let r=Pa[e.value.matrix.dataType.type];return y(c`${e.value.matrix}[${t}]`,r,e.origin)}if(e.dataType.type in Pa)throw new Error("The only way of accessing matrix elements in TGSL is through the 'columns' property.");if(Ie(e)&&Ie(t)||e.dataType.type==="unknown")return hi(e.value[t.value])}var{NodeTypeCatalog:j}=jm,eg=["==","!=","===","!==","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"],tg=["&&","||","==","!=","===","!==","<","<=",">",">="],Aa={"===":"==","!==":"!=",get">>>"(){throw new Error("The `>>>` operator is unsupported in TypeGPU functions.")},get in(){throw new Error("The `in` operator is unsupported in TypeGPU functions.")},get instanceof(){throw new Error("The `instanceof` operator is unsupported in TypeGPU functions.")},get"|>"(){throw new Error("The `|>` operator is unsupported in TypeGPU functions.")},get"??"(){throw new Error("The `??` operator is unsupported in TypeGPU functions.")},get">>>="(){throw new Error("The `>>>=` operator is unsupported in TypeGPU functions.")},get"**="(){throw new Error("The `**=` operator is unsupported in TypeGPU functions.")},get"??="(){throw new Error("The `??=` operator is unsupported in TypeGPU functions.")},get"&&="(){throw new Error("The `&&=` operator is unsupported in TypeGPU functions.")},get"||="(){throw new Error("The `||=` operator is unsupported in TypeGPU functions.")}};function Ba(e,t,r){return r?tg.includes(t)?F:t==="="?r:e:t==="!"||t==="~"?F:e}var rg={"-":Jo[l].gpuImpl},ng={"+":Vs[l].gpuImpl,"-":Gr[l].gpuImpl,"*":$n[l].gpuImpl,"/":Ps[l].gpuImpl,"**":Su[l].gpuImpl},ig=class{#e=void 0;initGenerator(e){this.#e=e}get ctx(){if(!this.#e)throw new Error("WGSL Generator has not yet been initialized. Please call initialize(ctx) before using the generator.");return this.#e}block([e,t]){this.ctx.pushBlockScope();try{this.ctx.indent();let r=t.map(n=>this.statement(n)).join(`
`);return this.ctx.dedent(),`{
${r}
${this.ctx.pre}}`}finally{this.ctx.popBlockScope()}}refVariable(e,t){let r=this.ctx.makeNameValid(e),n=ls(t),i=y(new dt(y(r,t,"function"),n),n,"function");return this.ctx.defineVariable(e,i),r}blockVariable(e,t,r,n){let i=we(r),s;n==="constant-tgpu-const-ref"||n==="runtime-tgpu-const-ref"?s=n:n==="argument"?i?s="runtime":s="argument":i?n==="constant"&&e==="const"?s="constant":s="runtime":s=yo(n)?"this-function":n;let a=y(this.ctx.makeNameValid(t),r,s);return this.ctx.defineVariable(t,a),a}identifier(e){if(!e)throw new Error("Cannot resolve an empty identifier");let t=this.ctx.getById(e);if(!t)throw new Error(`Identifier ${e} not found`);return t}typedExpression(e,t){let r=this.ctx.expectedType;this.ctx.expectedType=t;try{let n=this.expression(e);return Nt(n,t)}finally{this.ctx.expectedType=r}}expression(e){if(typeof e=="string")return this.identifier(e);if(typeof e=="boolean")return y(e,F,"constant");if(e[0]===j.logicalExpr||e[0]===j.binaryExpr||e[0]===j.assignmentExpr){let[t,r,n,i]=e,s=this.expression(r),a=this.expression(i);if(a.value instanceof dt)throw new C(c`Cannot assign a ref to an existing variable '${s}', define a new variable instead.`);if(n==="==")throw new Error("Please use the === operator instead of ==");if(n==="==="&&Ie(s)&&Ie(a))return y(s.value===a.value,F,"constant");if(s.dataType.type==="unknown")throw new C(`Left-hand side of '${n}' is of unknown type`);if(a.dataType.type==="unknown")throw new C(`Right-hand side of '${n}' is of unknown type`);let o=ng[n];if(o)return o(s,a);let u=t===j.assignmentExpr?[s.dataType]:void 0,[h,p]=zr([s,a],u)??[s,a],f=this.ctx.resolve(h.value,h.dataType).value,m=this.ctx.resolve(p.value,p.dataType).value,v=Ba(h.dataType,n,p.dataType);if(t===j.assignmentExpr){if(h.origin==="constant"||h.origin==="constant-tgpu-const-ref"||h.origin==="runtime-tgpu-const-ref")throw new C(`'${f} = ${m}' is invalid, because ${f} is a constant.`);if(s.origin==="argument")throw new C(`'${f} ${n} ${m}' is invalid, because non-pointer arguments cannot be mutated.`);if(a.origin==="argument"&&!we(a.dataType))throw new C(`'${f} = ${m}' is invalid, because argument references cannot be assigned.
-----
Try '${f} = ${this.ctx.resolve(a.dataType).value}(${m})' to copy the value instead.
-----`);if(!Tr(a))throw new C(`'${f} = ${m}' is invalid, because references cannot be assigned.
-----
Try '${f} = ${this.ctx.resolve(a.dataType).value}(${m})' to copy the value instead.
-----`)}return y(eg.includes(n)?`(${f} ${Aa[n]??n} ${m})`:`${f} ${Aa[n]??n} ${m}`,v,"runtime")}if(e[0]===j.postUpdate){let[t,r,n]=e,i=this.expression(n),s=this.ctx.resolve(i.value,i.dataType).value;return y(`${s}${r}`,i.dataType,"runtime")}if(e[0]===j.unaryExpr){let[t,r,n]=e,i=this.expression(n),s=rg[r];if(s)return s(i);let a=this.ctx.resolve(i.value,i.dataType).value,o=Ba(i.dataType,r);return y(`${r}${a}`,o,"runtime")}if(e[0]===j.memberAccess){let[t,r,n]=e,i=this.expression(r);if(i.value===console)return y(new ra(n),Ne,"runtime");let s=Os(i,n);if(!s)throw new Error(c`Property '${n}' not found on value '${i}' of type ${this.ctx.resolve(i.dataType)}`);return s}if(e[0]===j.indexAccess){let[t,r,n]=e,i=this.expression(r),s=this.expression(n),a=zr([s],[$,R],!1)?.[0]??s,o=fh(i,a);if(!o){let u=this.ctx.resolve(i.value,i.dataType).value,h=this.ctx.resolve(a.value,a.dataType).value;throw new Error(`Unable to index value ${u} of unknown type with index ${h}. If the value is an array, to address this, consider one of the following approaches: (1) declare the array using 'tgpu.const', (2) store the array in a buffer, or (3) define the array within the GPU function scope.`)}return o}if(e[0]===j.numericLiteral){let t=typeof e[1]=="string"?Qn(ag(e[1])):Qn(e[1]);if(!t)throw new Error(`Invalid numeric literal ${e[1]}`);return t}if(e[0]===j.call){let[t,r,n]=e,i=this.expression(r);if(pe(i.value)||ve(i.value)){if(n.length>1)throw new C("Array and struct schemas should always be called with at most 1 argument");if(!n[0])return y(`${this.ctx.resolve(i.value).value}()`,i.value,"runtime");let o=this.typedExpression(n[0],i.value);return y(this.ctx.resolve(o.value,i.value).value,i.value,"runtime")}if(i.value===Wi)throw new Error("Constants cannot be defined within TypeGPU function scope. To address this, move the constant definition outside the function scope.");if(i.value instanceof io){if(!n[0])throw new C(`An infix operator '${i.value.name}' was called without any arguments`);let o=this.expression(n[0]);return i.value.operator(i.value.lhs,o)}if(!A(i.value)){let o=n.map(h=>this.expression(h)),u=this.ctx.shelllessRepo.get(i.value,o);if(u){let h=o.map((p,f)=>{let m=u.argTypes[f];return Nt(p,m,!1)});return this.ctx.withResetIndentLevel(()=>{let p=this.ctx.resolve(u);return y(c`${p.value}(${h})`,p.dataType,"runtime")})}throw new Error(`Function '${x(i.value)??String(i.value)}' is not marked with the 'use gpu' directive and cannot be used in a shader`)}let s=i.value[l]?.argConversionHint??"keep",a=i.value[l]?.strictSignature;try{let o;if(a)o=n.map((h,p)=>{let f=a.argTypes[p];if(!f)throw new C(`Function '${x(i.value)}' was called with too many arguments`);return this.typedExpression(h,f)});else if(Array.isArray(s))o=n.map((h,p)=>{let f=s[p];if(!f)throw new C(`Function '${x(i.value)}' was called with too many arguments`);return this.typedExpression(h,f)});else{let h=n.map(p=>this.expression(p));s==="keep"?o=h:s==="unify"?o=zr(h)??h:o=s(...h).map((p,f)=>[p,h[f]]).map(([p,f])=>Nt(f,p))}if(i.value instanceof ra)return this.ctx.generateLog(i.value.op,o);let u=i.value(...o);if(!hs(u))throw new Error("Functions running in codegen mode must return snippets");return u}catch(o){throw o instanceof _r?o:new _r(o,[{toString:()=>`fn:${x(i.value)}`}])}}if(e[0]===j.objectExpr){let t=e[1],r=this.ctx.expectedType;if(!r||!pe(r))throw new C(`No target type could be inferred for object with keys [${Object.keys(t).join(", ")}], please wrap the object in the corresponding schema.`);let n=Object.fromEntries(Object.entries(r.propTypes).map(([s,a])=>{let o=t[s];if(o===void 0)throw new C(`Missing property ${s} in object literal for struct ${r}`);let u=this.typedExpression(o,a);return[s,u]})),i=ml(r,n);return y(c`${this.ctx.resolve(r).value}(${i})`,r,"runtime")}if(e[0]===j.arrayExpr){let[t,r]=e,n=this.ctx.expectedType,i,s;if(ve(n)){if(i=n.elementType,s=r.map(o=>this.typedExpression(o,i)),s.length!==n.elementCount)throw new C(`Cannot create value of type '${n}' from an array of length: ${s.length}`)}else{let o=r.map(h=>{let p=this.expression(h);if(p.origin==="argument"&&!we(p.dataType)||!Tr(p)){let f=this.ctx.resolve(p.value,p.dataType).value,m=this.ctx.resolve(St(p.dataType)).value;throw new C(`'${f}' reference cannot be used in an array constructor.
-----
Try '${m}(${f})' or 'arrayOf(${m}, count)([...])' to copy the value instead.
-----`)}return p});if(o.length===0)throw new C("Cannot infer the type of an empty array literal.");let u=zr(o);if(!u)throw new C("The given values cannot be automatically converted to a common type. Consider wrapping the array in an appropriate schema");s=u,i=St(s[0]?.dataType)}let a=`array<${this.ctx.resolve(i).value}, ${s.length}>`;return y(c`${a}(${s})`,on[l].jsImpl(i,s.length),"runtime")}if(e[0]===j.stringLiteral)return y(e[1],Ne,"constant");if(e[0]===j.preUpdate)throw new Error("Cannot use pre-updates in TGSL.");sg(e)}functionDefinition(e){return this.block(e)}statement(e){if(typeof e=="string")return`${this.ctx.pre}${this.ctx.resolve(this.identifier(e).value).value};`;if(typeof e=="boolean")return`${this.ctx.pre}${e?"true":"false"};`;if(e[0]===j.return){let t=e[1];if(t!==void 0){let r=this.ctx.topFunctionReturnType,n=r?this.typedExpression(t,r):this.expression(t);if(n.value instanceof dt)throw new C(c`Cannot return references, returning '${n.value.snippet}'`);if(n.origin==="argument"&&!we(n.dataType)&&this.ctx.topFunctionScope?.functionType==="normal")throw new C(c`Cannot return references to arguments, returning '${n}'. Copy the argument before returning it.`);if(!r&&!Tr(n)&&n.origin!=="this-function"){let i=this.ctx.resolve(n.value,n.dataType).value,s=this.ctx.resolve(En(n.dataType)).value;throw new C(`'return ${i};' is invalid, cannot return references.
-----
Try 'return ${s}(${i});' instead.
-----`)}return n=Nt(n,En(n.dataType),!1),nt(n.dataType.type!=="unknown"),this.ctx.reportReturnType(n.dataType),c`${this.ctx.pre}return ${n};`}return`${this.ctx.pre}return;`}if(e[0]===j.if){let[t,r,n,i]=e,s=this.typedExpression(r,F),a=s.value===!1?void 0:this.block(On(n)),o=s.value===!0||!i?void 0:this.block(On(i));return s.value===!0?`${this.ctx.pre}${a}`:s.value===!1?o?`${this.ctx.pre}${o}`:"":o?c`\
${this.ctx.pre}if (${s}) ${a}
${this.ctx.pre}else ${o}`:c`${this.ctx.pre}if (${s}) ${a}`}if(e[0]===j.let||e[0]===j.const){let t="var",[r,n,i]=e,s=i!==void 0?this.expression(i):void 0;if(!s)throw new Error(`Cannot create variable '${n}' without an initial value.`);let a=Tr(s),o=s.dataType,u=we(o);if(Br(s.dataType))throw new Error(`Cannot create variable '${n}' with loose data type.`);if(s.value instanceof dt){if(s.dataType.type!=="unknown")throw new C("Cannot store d.ref() in a variable if it references another value. Copy the value passed into d.ref() instead.");let p=s.value.snippet,f=this.refVariable(n,St(p.dataType));return c`${this.ctx.pre}var ${f} = ${Nt(p,p.dataType,!1)};`}if(a){if(r===j.const)s.origin==="argument"?t="let":u&&(t=s.origin==="constant"?"const":"let");else if(s.origin==="argument"&&!u){let p=this.ctx.resolve(s.value).value,f=this.ctx.resolve(En(s.dataType)).value;throw new C(`'let ${n} = ${p}' is invalid, because references to arguments cannot be assigned to 'let' variable declarations.
  -----
  - Try 'let ${n} = ${f}(${p})' if you need to reassign '${n}' later
  - Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
  -----`)}}else{if(r===j.let){let p=this.ctx.resolve(s.value).value,f=this.ctx.resolve(En(s.dataType)).value;throw new C(`'let ${n} = ${p}' is invalid, because references cannot be assigned to 'let' variable declarations.
-----
- Try 'let ${n} = ${f}(${p})' if you need to reassign '${n}' later
- Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
-----`)}if(s.origin==="constant-tgpu-const-ref")t="const";else if(s.origin==="runtime-tgpu-const-ref")t="let";else{if(t="let",!De(o)){let p=wo(s.origin,St(o));nt(p!==void 0,`Creating pointer type from origin ${s.origin}`),o=p}s.value instanceof dt||(o=sl(o))}}let h=this.blockVariable(t,n,St(o),s.origin);return c`${this.ctx.pre}${t} ${h.value} = ${Nt(s,o,!1)};`}if(e[0]===j.block)return this.block(e);if(e[0]===j.for){let[t,r,n,i,s]=e,[a,o,u]=this.ctx.withResetIndentLevel(()=>[r?this.statement(r):void 0,n?this.typedExpression(n,F):void 0,i?this.statement(i):void 0]),h=a?a.slice(0,-1):"",p=u?u.slice(0,-1):"",f=this.block(On(s));return c`${this.ctx.pre}for (${h}; ${o}; ${p}) ${f}`}if(e[0]===j.while){let[t,r,n]=e,i=this.typedExpression(r,F),s=this.ctx.resolve(i.value).value,a=this.block(On(n));return`${this.ctx.pre}while (${s}) ${a}`}return e[0]===j.continue?`${this.ctx.pre}continue;`:e[0]===j.break?`${this.ctx.pre}break;`:`${this.ctx.pre}${this.ctx.resolve(this.expression(e).value).value};`}};function sg(e){throw new Error(`'${Bt(e)}' was not handled by the WGSL generator.`)}function ag(e){return/^0x[0-9a-f]+$/i.test(e)?Number.parseInt(e):/^0b[01]+$/i.test(e)?Number.parseInt(e.slice(2),2):Number.parseFloat(e)}function On(e){return typeof e!="object"||e[0]!==j.block?[j.block,[e]]:e}var og=new ig,mh=og,yh="#CATCHALL#",ug=class{_stack=[];_itemDepth=0;get itemDepth(){return this._itemDepth}get topItem(){let e=this._stack[this._stack.length-1];if(!e||e.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return e}get topFunctionScope(){return this._stack.findLast(e=>e.type==="functionScope")}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}popItem(){this.pop("item")}pushSlotBindings(e){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(e)})}popSlotBindings(){this.pop("slotBinding")}pushFunctionScope(e,t,r,n,i){let s={type:"functionScope",functionType:e,args:t,argAliases:r,returnType:n,externalMap:i,reportedReturnTypes:new Set};return this._stack.push(s),s}popFunctionScope(){this.pop("functionScope")}pushBlockScope(){this._stack.push({type:"blockScope",declarations:new Map})}popBlockScope(){this.pop("blockScope")}pop(e){let t=this._stack[this._stack.length-1];if(!t||e&&t.type!==e)throw new Error(`Internal error, expected a ${e} layer to be on top.`);this._stack.pop(),e==="item"&&this._itemDepth--}readSlot(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="item")r.usedSlots.add(e);else if(r?.type==="slotBinding"){let n=r.bindingMap.get(e);if(n!==void 0)return n}else if(!(r?.type==="functionScope"||r?.type==="blockScope"))throw new Error("Unknown layer type.")}return e.defaultValue}getSnippetById(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="functionScope"){let n=r.args.find(s=>s.value===e);if(n!==void 0)return n;if(r.argAliases[e])return r.argAliases[e];let i=r.externalMap[e];return i!=null?hi(i):void 0}if(r?.type==="blockScope"){let n=r.declarations.get(e);if(n!==void 0)return n}}}defineBlockVariable(e,t){if(t.dataType.type==="unknown")throw Error(`Tried to define variable '${e}' of unknown type`);for(let r=this._stack.length-1;r>=0;--r){let n=this._stack[r];if(n?.type==="blockScope"){n.declarations.set(e,t);return}}throw new Error("No block scope found to define a variable in.")}},Gn=["","  ","    ","      ","        ","          ","            ","              ","                "],Si=Gn.length-1,hg=class{identLevel=0;get pre(){return Gn[this.identLevel]??Gn[Si].repeat(this.identLevel/Si)+Gn[this.identLevel%Si]}indent(){let e=this.pre;return this.identLevel++,e}dedent(){return this.identLevel--,this.pre}withResetLevel(e){let t=this.identLevel;this.identLevel=0;try{return e()}finally{this.identLevel=t}}},gh=class{#e;#t;_indentController=new hg;_itemStateStack=new ug;#r=[];_declarations=[];_varyingLocations;#n=new WeakSet;#i;get varyingLocations(){return this._varyingLocations}[l]={itemStateStack:this._itemStateStack};bindGroupLayoutsToPlaceholderMap=new Map;_nextFreeLayoutPlaceholderIdx=0;fixedBindings=[];enableExtensions;expectedType;constructor(e){this.enableExtensions=e.enableExtensions,this.#t=e.shaderGenerator??mh,this.#i=e.root?new Ky(e.root):new Jy,this.#e=e.namespace[l]}getUniqueName(e){return sy(this.#e,e)}makeNameValid(e){return this.#e.nameRegistry.makeValid(e)}get pre(){return this._indentController.pre}get topFunctionScope(){return this._itemStateStack.topFunctionScope}get topFunctionReturnType(){let e=this._itemStateStack.topFunctionScope;return nt(e),e.returnType}get shelllessRepo(){return this.#e.shelllessRepo}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}withResetIndentLevel(e){return this._indentController.withResetLevel(e)}getById(e){let t=this._itemStateStack.getSnippetById(e);return t===void 0?null:t}defineVariable(e,t){this._itemStateStack.defineBlockVariable(e,t)}reportReturnType(e){let t=this._itemStateStack.topFunctionScope;nt(t),t.reportedReturnTypes.add(e)}pushBlockScope(){this._itemStateStack.pushBlockScope()}popBlockScope(){this._itemStateStack.popBlockScope()}generateLog(e,t){return this.#i.generateLog(this,e,t)}get logResources(){return this.#i.logResources}fnToWgsl(e){let t=!1;try{this.#e.nameRegistry.pushFunctionScope();let r=[],n=[];for(let[o,u]of e.argTypes.entries()){let h=e.params[o],p=De(u)?u.addressSpace==="storage"?u.access==="read"?"readonly":"mutable":u.addressSpace:"argument";switch(h?.type){case Di.identifier:{let f=h.name,m=y(this.makeNameValid(f),u,p);r.push(m),m.value!==f&&n.push([f,m]);break}case Di.destructuredObject:{r.push(y(`_arg_${o}`,u,p)),n.push(...h.props.map(({name:f,alias:m})=>{let v=mt(e.argTypes[o].propTypes[f]);return[m,y(`_arg_${o}.${f}`,v,"argument")]}));break}case void 0:r.push(y(`_arg_${o}`,u,p))}}let i=this._itemStateStack.pushFunctionScope(e.functionType,r,Object.fromEntries(n),e.returnType,e.externalMap);t=!0,this.#t.initGenerator(this);let s=this.#t.functionDefinition(e.body),a=e.returnType;if(!a){let o=[...i.reportedReturnTypes];if(o.length===0)a=ee;else{let u=ds(o);u&&!u.hasImplicitConversions&&(a=u.targetType)}if(!a)throw new Error(`Expected function to have a single return type, got [${o.join(", ")}]. Cast explicitly to the desired type.`);a=St(a)}return{head:lg(this,r,a),body:s,returnType:a}}finally{t&&this._itemStateStack.popFunctionScope(),this.#e.nameRegistry.popFunctionScope()}}addDeclaration(e){this._declarations.push(e)}allocateLayoutEntry(e){let t=this.bindGroupLayoutsToPlaceholderMap,r=t.get(e);return r||(r=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,t.set(e,r)),r}allocateFixedEntry(e,t){let r=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:e,resource:t}),{group:yh,binding:r}}readSlot(e){let t=this._itemStateStack.readSlot(e);if(t===void 0)throw new Qh(e);return t}withSlots(e,t){this._itemStateStack.pushSlotBindings(e);try{return t()}finally{this._itemStateStack.popSlotBindings()}}withVaryingLocations(e,t){this._varyingLocations=e;try{return t()}finally{this._varyingLocations=void 0}}unwrap(e){if(Ci(e))return this.withSlots(e[qt].pairs,()=>this.unwrap(e[qt].inner));let t=e;for(;;)if(Bi(t))t=this.readSlot(t);else if(Oi(t))t=this._getOrCompute(t);else break;return t}_getOrCompute(e){let t=this.#e.memoizedDerived.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;this.pushMode(new dn);let r;try{r=e["~compute"]()}finally{this.popMode("normal")}let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedDerived.set(e,t),r}catch(r){throw r instanceof _r?r.appendToTrace(e):new _r(r,[e])}finally{this._itemStateStack.popItem()}}_getOrInstantiate(e){let t=this.#e.memoizedResolves.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;let r;if(Or(e))r=y(Lu(this,e),ee,"runtime");else if(Oi(e)||Bi(e))r=this.resolve(this.unwrap(e));else if(xo(e))r=e[T](this);else if(Zr(e)){let i=this.#e.shelllessRepo.get(e,void 0);if(!i)throw new Error(`Couldn't resolve ${e.name}. Make sure it's a function that accepts no arguments, or call it from another TypeGPU function.`);return this.withResetIndentLevel(()=>this.resolve(i))}else throw new TypeError(`Unresolvable internal value: ${Bt(e)}`);let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedResolves.set(e,t),r}catch(r){throw r instanceof _r?r.appendToTrace(e):new _r(r,[e])}finally{this._itemStateStack.popItem()}}resolve(e,t){if(Cu(e)||Zr(e)){if(this.#n.has(e)&&!this.#e.memoizedResolves.has(e))throw new Error(`Recursive function ${e} detected. Recursion is not allowed on the GPU.`);this.#n.add(e)}if(Ci(e))return this.withSlots(e[qt].pairs,()=>this.resolve(e[qt].inner,t));if(A(e)||Zr(e)){if(this._itemStateStack.itemDepth===0)try{this.pushMode(new ol);let r=vo(this,()=>this._getOrInstantiate(e));return y(`${[...this._declarations].join(`

`)}${r.value}`,ee,"runtime")}finally{this.popMode("codegen")}return this._getOrInstantiate(e)}if(typeof e=="number"){let r=t??Qn(e).dataType;if(nt(r.type!=="unknown"),r.type==="abstractInt")return y(`${e}`,r,"constant");if(r.type==="u32")return y(`${e}u`,r,"constant");if(r.type==="i32")return y(`${e}i`,r,"constant");let n=e.toExponential(),i=r.type==="abstractFloat"&&Number.isInteger(e)?`${e}.`:`${e}`,s=n.length<i.length?n:i;return r.type==="f32"?y(`${s}f`,r,"constant"):r.type==="f16"?y(`${s}h`,r,"constant"):y(s,r,"constant")}if(typeof e=="boolean")return y(e?"true":"false",F,"constant");if(typeof e=="string")return y(e,ee,"runtime");if(t&&ve(t)){if(!Array.isArray(e))throw new C(`Cannot coerce ${e} into value of type '${t}'`);if(t.elementCount!==e.length)throw new C(`Cannot create value of type '${t}' from an array of length: ${e.length}`);let r=this.resolve(t.elementType);return y(c`array<${r}, ${t.elementCount}>(${e.map(n=>y(n,t.elementType,"runtime"))})`,t,"runtime")}if(Array.isArray(e))return y(c`array(${e.map(r=>this.resolve(r))})`,Ne,"runtime");if(t&&pe(t))return y(c`${this.resolve(t)}(${Object.entries(t.propTypes).map(([r,n])=>y(e[r],n,"runtime"))})`,t,"runtime");throw new C(`Value ${e} (as json: ${Bt(e)}) is not resolvable${t?` to type ${t.type}`:""}`)}pushMode(e){this.#r.push(e)}popMode(e){let t=this.#r.pop();e!==void 0&&nt(t?.type===e)}get mode(){return this.#r[this.#r.length-1]??$o}};function _i(e,t){let r=new gh(t),n=(t.config?r.withSlots(t.config(new Nu([])).bindings,()=>r.resolve(e)):r.resolve(e)).value,i=r.bindGroupLayoutsToPlaceholderMap,s=[],a=new Set([...i.keys()].map(f=>f.index).filter(f=>f!==void 0)),o=dy(a),u=r.fixedBindings.map((f,m)=>[String(m),f.layoutEntry]),h=()=>{let f=o.next().value,m=th(Object.fromEntries(u));return s[f]=m,n=n.replaceAll(yh,String(f)),[f,new ih(m,Object.fromEntries(r.fixedBindings.map((v,b)=>[String(b),v.resource])))]},p=u.length>0?h():void 0;for(let[f,m]of i.entries()){let v=f.index??o.next().value;s[v]=f,n=n.replaceAll(m,String(v))}return t.enableExtensions&&t.enableExtensions.length>0&&(n=`${t.enableExtensions.map(f=>`enable ${f};`).join(`
`)}

${n}`),{code:n,usedBindGroupLayouts:s,catchall:p,logResources:r.logResources}}function lg(e,t,r){let n=t.map(i=>`${i.value}: ${e.resolve(i.dataType).value}`).join(", ");return r.type!=="void"?`(${n}) -> ${Ms(r)}${e.resolve(r).value} `:`(${n}) `}function wh(e){let t=e;return t?.resourceType==="compute-pipeline"&&!!t[l]}function xh(e){let t=e;return t?.resourceType==="render-pipeline"&&!!t[l]}function cg(e){return xh(e)||wh(e)}function Qi(e,t){return Array.isArray(e)?fg(e,t):dg(e)}function pg(e,t){return Array.isArray(e)?Qi(e,t).code:Qi(e).code}function dg(e){let{template:t,externals:r,shaderGenerator:n,names:i="strict",config:s,enableExtensions:a}=e;t||console.warn("Calling resolve with an empty template is deprecated and will soon return an empty string. Consider using the 'tgpu.resolve(resolvableArray, options)' API instead.");let o={};Mr(o,r??{});let u={[l]:!0,[T](h){return y(wn(h,o,t??""),ee,"runtime")},toString:()=>"<root>"};return _i(u,{namespace:typeof i=="string"?jr({names:i}):i,enableExtensions:a,shaderGenerator:n,config:s,root:vh(Object.values(r))})}function fg(e,t){let{shaderGenerator:r,names:n="strict",config:i,enableExtensions:s}=t??{},a={[l]:!0,[T](o){return e.forEach(u=>o.resolve(u)),y("",ee,"runtime")},toString:()=>"<root>"};return _i(a,{namespace:typeof n=="string"?jr({names:n}):n,enableExtensions:s,shaderGenerator:r,config:i,root:vh(e)})}function vh(e){let t=e.filter(cg);if(t.length>1)throw new Error(`Found ${t.length} pipelines but can only resolve one at a time.`);return t[0]?.[l].branch}function mg(e){let t=Ee()??new gh({namespace:jr(),shaderGenerator:mh}),r=[1,1,1],n=[1,1,1],i=[r[0]*n[0],r[1]*n[1],r[2]*n[2]],s=new Map,a=Array.from({length:r[0]},()=>Array.from({length:r[1]},()=>Array.from({length:r[2]},()=>new Map))),o=Array.from({length:i[0]},()=>Array.from({length:i[1]},()=>Array.from({length:i[2]},()=>new Map))),u=Array.from({length:i[0]},(h,p)=>Array.from({length:i[1]},(f,m)=>Array.from({length:i[2]},(v,b)=>{let V=Math.floor(p/n[0]),D=Math.floor(m/n[1]),H=Math.floor(b/n[2]);return new ul(s,{private:o[p][m][b],workgroup:a[V][D][H]})})));t.pushMode(u[0][0][0]);try{return{value:vo(t,e),buffers:s,privateVars:o,workgroupVars:a}}finally{t.popMode("simulate")}}function yg(e,t,r,n){return new gg(e,t,r,n)}function qs(e){let t=e;return t?.resourceType==="query-set"&&!!t[l]}var gg=class{constructor(e,t,r,n){this.type=t,this.count=r,this.rawQuerySet=n,this.#e=e.device,this._ownQuerySet=!n,this._querySet=n||null}resourceType="query-set";#e;_querySet=null;_ownQuerySet;_destroyed=!1;_available=!0;_readBuffer=null;_resolveBuffer=null;get querySet(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");return this.rawQuerySet?this.rawQuerySet:this._querySet?this._querySet:(this._querySet=this.#e.createQuerySet({type:this.type,count:this.count}),this._querySet)}get destroyed(){return this._destroyed}get available(){return this._available}get[l](){let e=this;return{get readBuffer(){return e._readBuffer||(e._readBuffer=e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})),e._readBuffer},get resolveBuffer(){return e._resolveBuffer||(e._resolveBuffer=e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC})),e._resolveBuffer}}}$name(e){return G(this,e),this._querySet&&(this._querySet.label=e),this}resolve(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");if(!this._available)throw new Error("This QuerySet is busy resolving or reading.");let e=this.#e.createCommandEncoder();e.resolveQuerySet(this.querySet,0,this.count,this[l].resolveBuffer,0),this.#e.queue.submit([e.finish()])}async read(){if(!this._resolveBuffer)throw new Error("QuerySet must be resolved before reading.");this._available=!1;try{let e=this.#e.createCommandEncoder();e.copyBufferToBuffer(this[l].resolveBuffer,0,this[l].readBuffer,0,this.count*BigUint64Array.BYTES_PER_ELEMENT),this.#e.queue.submit([e.finish()]);let t=this[l].readBuffer;await t.mapAsync(GPUMapMode.READ);let r=new BigUint64Array(t.getMappedRange().slice());return t.unmap(),Array.from(r)}finally{this._available=!0}}destroy(){this._destroyed||(this._destroyed=!0,this._querySet&&this._ownQuerySet&&this._querySet.destroy(),this._readBuffer?.destroy(),this._resolveBuffer?.destroy(),this._readBuffer=this._resolveBuffer=null)}},Oa=class{constructor(e){this._make=e}_map=new WeakMap;getOrMake(e,...t){if(this._map.has(e))return this._map.get(e);let r=this._make(e,...t);return this._map.set(e,r),r}},Ei=class{constructor(e,t){this.resourceType=e,this.buffer=t,this[ne]=t,this.#e=this.buffer.as(this.resourceType)}[l]=!0;[ne];#e;$name(e){return G(this[ne],e),this}write(e){this.buffer.write(e)}writePartial(e){this.buffer.writePartial(e)}read(){return this.buffer.read()}get[O](){return this.#e.$}get $(){return this.#e.$}get value(){return this.$}[T](e){return e.resolve(this.#e)}},S=e=>ku(e??0),Qe=e=>Mu(e??0),gr=e=>Uu(e??0),wg={f32:e=>S(e[0]),f16:e=>gr(e[0]).x,i32:e=>Qe(e[0]),u32:e=>e[0]??0,bool:e=>!!e[0],vec2f:e=>P(S(e[0]),S(e[1])),vec3f:e=>se(S(e[0]),S(e[1]),S(e[2])),vec4f:e=>z(S(e[0]),S(e[1]),S(e[2]),S(e[3])),vec2h(e){let t=gr(e[0]);return at(t.x,t.y)},vec3h(e){let t=gr(e[0]),r=gr(e[1]);return ot(t.x,t.y,r.x)},vec4h(e){let t=gr(e[0]),r=gr(e[1]);return ut(t.x,t.y,r.x,r.y)},vec2i:e=>ue(Qe(e[0]),Qe(e[1])),vec3i:e=>ke(Qe(e[0]),Qe(e[1]),Qe(e[2])),vec4i:e=>he(Qe(e[0]),Qe(e[1]),Qe(e[2]),Qe(e[3])),vec2u:e=>_e(e[0]??0,e[1]??0),vec3u:e=>te(e[0]??0,e[1]??0,e[2]??0),vec4u:e=>me(e[0]??0,e[1]??0,e[2]??0,e[3]??0),"vec2<bool>":e=>Zt(!!e[0],!!e[1]),"vec3<bool>":e=>Jt(!!e[0],!!e[1],!!e[2]),"vec4<bool>":e=>Kt(!!e[0],!!e[1],!!e[2],!!e[3]),mat2x2f:e=>vt(S(e[0]),S(e[1]),S(e[2]),S(e[3])),mat3x3f:e=>$t(S(e[0]),S(e[1]),S(e[2]),S(e[4]),S(e[5]),S(e[6]),S(e[8]),S(e[9]),S(e[10])),mat4x4f:e=>q(S(e[0]),S(e[1]),S(e[2]),S(e[3]),S(e[4]),S(e[5]),S(e[6]),S(e[7]),S(e[8]),S(e[9]),S(e[10]),S(e[11]),S(e[12]),S(e[13]),S(e[14]),S(e[15]))};function xg(e,t){let r=wg[t.type];if(r)return r(e);if(pe(t)){let n=Object.keys(t.propTypes),i=Object.values(t.propTypes),s=Zi(e,i);return Object.fromEntries(n.map((a,o)=>[a,s[o]]))}if(ve(t)){let n=t.elementType,i=t.elementCount;return Zi(e,Array.from({length:i},()=>n))}throw new Error(`Cannot deserialize data of type ${t.type}`)}function Zi(e,t){let r=0;return t.map(n=>{if(!Ot(n))return n;let i=Math.ceil(U(n)/4),s=xg(e.subarray(r,r+i),n);return r+=i,s})}function vg(e,t){return Zi(e,t).map(Gi)}function Ji(e){let{indexBuffer:t,dataBuffer:r,logIdToMeta:n,options:i}=e;r.read().then(s=>{s.filter(a=>a.id).forEach(({id:a,serializedData:o})=>{let{argTypes:u,op:h}=n.get(a),p=vg(new Uint32Array(o),u);p.length===0&&p.push(""),console[h](`%c${i.messagePrefix}%c ${p[0]}`,"background: #936ff5; color: white;","color: inherit; background: none",...p.slice(1))})}),t.read().then(s=>{s>i.logCountLimit&&console.warn(`Log count limit per dispatch (${i.logCountLimit}) exceeded by ${s-i.logCountLimit} calls. Consider increasing the limit by passing appropriate options to tgpu.init().`)}),r.buffer.clear(),t.buffer.clear()}function $h(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Performance callback requires the "timestamp-query" feature to be enabled on GPU device.');return e.timestampWrites?{...e,performanceCallback:t}:{...e,performanceCallback:t,hasAutoQuerySet:!0,timestampWrites:{querySet:r.createQuerySet("timestamp",2),beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}}function bh(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Timestamp writes require the "timestamp-query" feature to be enabled on GPU device.');e.hasAutoQuerySet&&e.timestampWrites&&e.timestampWrites.querySet.destroy();let n={querySet:t.querySet};return t.beginningOfPassWriteIndex!==void 0&&(n.beginningOfPassWriteIndex=t.beginningOfPassWriteIndex),t.endOfPassWriteIndex!==void 0&&(n.endOfPassWriteIndex=t.endOfPassWriteIndex),{...e,hasAutoQuerySet:!1,timestampWrites:n}}function _h(e,t){if(!e.timestampWrites)return{};let{querySet:r,beginningOfPassWriteIndex:n,endOfPassWriteIndex:i}=e.timestampWrites,s={querySet:qs(r)?t.unwrap(r):r};return n!==void 0&&(s.beginningOfPassWriteIndex=n),i!==void 0&&(s.endOfPassWriteIndex=i),{timestampWrites:s}}function Ki({root:e,priors:t}){let r=t.timestampWrites?.querySet,n=t.performanceCallback;if(!r)throw new Error("Cannot dispatch workgroups with performance callback without a query set.");if(!qs(r))throw new Error("Performance callback with raw GPUQuerySet is not supported. Use TgpuQuerySet instead.");let i=e.device.createCommandEncoder();i.resolveQuerySet(e.unwrap(r),0,r.count,r[l].resolveBuffer,0),e.device.queue.submit([i.finish()]),e.device.queue.onSubmittedWorkDone().then(async()=>{if(!r.available)return;let s=await r.read(),a=s[t.timestampWrites?.beginningOfPassWriteIndex??0],o=s[t.timestampWrites?.endOfPassWriteIndex??1];if(a===void 0||o===void 0)throw new Error("QuerySet did not return valid timestamps.");await n(a,o)})}function $g(e,t,r){return new bg(new _g(e,t,r),{})}var bg=class Qr{constructor(t,r){this._core=t,this._priors=r,this[l]={get rawPipeline(){return t.unwrap().pipeline},get priors(){return r},get branch(){return t.branch}},this[ne]=t}[l];resourceType="compute-pipeline";[ne];[T](t){return t.resolve(this._core)}toString(){return`computePipeline:${x(this)??"<unnamed>"}`}get rawPipeline(){return this._core.unwrap().pipeline}with(t,r){return ei(t)?new Qr(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t.layout,t]])}):new Qr(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t,r]])})}withPerformanceCallback(t){let r=$h(this._priors,t,this._core.branch);return new Qr(this._core,r)}withTimestampWrites(t){let r=bh(this._priors,t,this._core.branch);return new Qr(this._core,r)}dispatchWorkgroups(t,r,n){let i=this._core.unwrap(),{branch:s}=this._core,a={label:x(this._core)??"<unnamed>",..._h(this._priors,s)},o=s.device.createCommandEncoder(),u=o.beginComputePass(a);u.setPipeline(i.pipeline);let h=new Set(i.usedBindGroupLayouts);if(i.usedBindGroupLayouts.forEach((p,f)=>{if(i.catchall&&f===i.catchall[0])u.setBindGroup(f,s.unwrap(i.catchall[1])),h.delete(p);else{let m=this._priors.bindGroupLayoutMap?.get(p);m!==void 0&&(h.delete(p),u.setBindGroup(f,s.unwrap(m)))}}),h.size>0)throw new us(h);u.dispatchWorkgroups(t,r,n),u.end(),s.device.queue.submit([o.finish()]),i.logResources&&Ji(i.logResources),this._priors.performanceCallback&&Ki({root:s,priors:this._priors})}$name(t){return G(this._core,t),this}},_g=class{constructor(e,t,r){this.branch=e,this._slotBindings=t,this._entryFn=r}[l]=!0;_memo;[T](e){return e.withSlots(this._slotBindings,()=>(e.resolve(this._entryFn),y("",ee,"runtime")))}toString(){return"computePipelineCore"}unwrap(){if(this._memo===void 0){let e=this.branch.device,t=Ds.filter(h=>this.branch.enabledFeatures.has(Au[h])),r,n=jr({names:this.branch.nameRegistrySetting});r=_i(this,{namespace:n,enableExtensions:t,shaderGenerator:this.branch.shaderGenerator,root:this.branch});let{code:i,usedBindGroupLayouts:s,catchall:a,logResources:o}=r;a!==void 0&&s[a[0]]?.$name(`${x(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let u=e.createShaderModule({label:`${x(this)??"<unnamed>"} - Shader`,code:i});this._memo={pipeline:e.createComputePipeline({label:x(this)??"<unnamed>",layout:e.createPipelineLayout({label:`${x(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:s.map(h=>this.branch.unwrap(h))}),compute:{module:u}}),usedBindGroupLayouts:s,catchall:a,logResources:o}}return this._memo}};function Ca(e,t="vertex"){return new Tg(e,t)}function Th(e){return e?.resourceType==="vertex-layout"}var es=Symbol("defaultAttribEntry");function Rn(e,t,r,n,i){if(We(t)||He(t)){let s=Vt(t);return s!==void 0&&(n[i??es]=s),Rn(e,t.inner,Se(r,Oe(t)),n)}if(pe(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Se(s,J(u));let h=[o,Rn(e,u,s,n,o)];return s+=U(u),h}))}if(qe(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Se(s,Oe(u));let h=[o,Rn(e,u,s,n,o)];return s+=U(u),h}))}if("type"in t&&typeof t.type=="string"){if(no.includes(t.type))return{_layout:e,format:t.type,offset:r};let s=qh[t.type];if(s)return{_layout:e,format:s,offset:r}}throw new Error(`Unsupported data used in vertex layout: ${String(t)}`)}var Tg=class{constructor(e,t){this.schemaForCount=e,this.stepMode=t;let r=e(0);this.stride=Se(U(r.elementType),J(r)),this.attrib=Rn(this,r.elementType,0,this._customLocationMap)}[l]=!0;resourceType="vertex-layout";stride;attrib;_customLocationMap={};get vertexLayout(){if(this._customLocationMap[es]!==void 0){if(typeof this.attrib.format!="string"||typeof this.attrib.offset!="number")throw new Error("Single attribute vertex layouts must have a format and offset.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[{format:this.attrib.format,offset:this.attrib.offset,shaderLocation:this._customLocationMap[es]}]}}if(!Object.keys(this.attrib).every(e=>this._customLocationMap[e]!==void 0))throw new Error("All attributes must have custom locations in order to unwrap a vertex layout.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[...Object.entries(this.attrib).map(([e,t])=>({format:t.format,offset:t.offset,shaderLocation:this._customLocationMap[e]}))]}}$name(e){return G(this,e),this}};function zg(e){return typeof e?.loadOp=="string"}function Ig(e,t){if(Or(e)){if(wt(e))return[];if(!zg(t))throw new Error("Expected a single color attachment, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(wt(i))continue;let s=t[n];if(!s)throw new Error(`A color attachment by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function Sg(e){return typeof e?.format=="string"}function Eg(e,t){if(Or(e)){if(to(e))return[];if(e.type==="decorated")return[];if(!Sg(t))throw new Error("Expected a single color target configuration, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(wt(i))continue;let s=t[n];if(!s)throw new Error(`A color target by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function zh(e){return new kg(new Mg(e),{})}var kg=class je{[l];resourceType="render-pipeline";[ne];hasIndexBuffer=!1;constructor(t,r){this[l]={core:t,priors:r,branch:t.options.branch},this[ne]=t}[T](t){return t.resolve(this[l].core)}toString(){return`renderPipeline:${x(this)??"<unnamed>"}`}$name(t){return G(this[l].core,t),this}with(t,r){let n=this[l];if(ei(t))return new je(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t.layout,t]])});if(rh(t))return new je(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t,r]])});if(Th(t))return new je(n.core,{...n.priors,vertexLayoutMap:new Map([...n.priors.vertexLayoutMap??[],[t,r]])});throw new Error("Unsupported value passed into .with()")}withPerformanceCallback(t){let r=this[l],n=$h(r.priors,t,r.core.options.branch);return new je(r.core,n)}withTimestampWrites(t){let r=this[l],n=bh(r.priors,t,r.core.options.branch);return new je(r.core,n)}withColorAttachment(t){let r=this[l];return new je(r.core,{...r.priors,colorAttachment:t})}withDepthStencilAttachment(t){let r=this[l];return new je(r.core,{...r.priors,depthStencilAttachment:t})}withStencilReference(t){let r=this[l];return new je(r.core,{...r.priors,stencilReference:t})}withIndexBuffer(t,r,n,i){let s=this[l];if(Fi(t)){if(typeof r!="string")throw new Error("If a GPUBuffer is passed, indexFormat must be provided.");return new je(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:r,offsetBytes:n,sizeBytes:i}})}let a={u32:"uint32",u16:"uint16"},o=t.dataType.elementType;return new je(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:a[o.type],offsetBytes:r!==void 0?r*U(o):void 0,sizeBytes:i!==void 0?i*U(o):void 0}})}setupRenderPass(t){let r=this[l],n=r.core.unwrap(),{branch:i,fragmentFn:s}=r.core.options,a=s?Ig(s.shell.out,r.priors.colorAttachment??{}).map(m=>un(m.view)?{...m,view:i.unwrap(m.view).createView()}:hn(m.view)?{...m,view:i.unwrap(m.view)}:m):[null],o={label:x(r.core)??"<unnamed>",colorAttachments:a,..._h(r.priors,i)},u=r.priors.depthStencilAttachment;if(u!==void 0){let m=un(u.view)?i.unwrap(u.view).createView():hn(u.view)?i.unwrap(u.view):u.view;o.depthStencilAttachment={...u,view:m}}let h=t.beginRenderPass(o);h.setPipeline(n.pipeline),r.priors.stencilReference!==void 0&&h.setStencilReference(r.priors.stencilReference);let p=new Set(n.usedBindGroupLayouts);n.usedBindGroupLayouts.forEach((m,v)=>{if(n.catchall&&v===n.catchall[0])h.setBindGroup(v,i.unwrap(n.catchall[1])),p.delete(m);else{let b=r.priors.bindGroupLayoutMap?.get(m);b!==void 0&&(p.delete(m),h.setBindGroup(v,i.unwrap(b)))}});let f=new Set(r.core.usedVertexLayouts);if(r.core.usedVertexLayouts.forEach((m,v)=>{let b=r.priors.vertexLayoutMap?.get(m);b&&(f.delete(m),h.setVertexBuffer(v,i.unwrap(b)))}),p.size>0)throw new us(p);if(f.size>0)throw new lo(f);return h}draw(t,r,n,i){let s=this[l],{branch:a}=s.core.options,{logResources:o}=s.core.unwrap(),u=a.device.createCommandEncoder(),h=this.setupRenderPass(u);h.draw(t,r,n,i),h.end(),a.device.queue.submit([u.finish()]),o&&Ji(o),s.priors.performanceCallback&&Ki({root:a,priors:s.priors})}drawIndexed(t,r,n,i,s){let a=this[l];if(!a.priors.indexBuffer)throw new Error("No index buffer set for this render pipeline.");let{logResources:o}=a.core.unwrap(),{branch:u}=a.core.options,{buffer:h,indexFormat:p,offsetBytes:f,sizeBytes:m}=a.priors.indexBuffer,v=u.device.createCommandEncoder(),b=this.setupRenderPass(v);Fi(h)?b.setIndexBuffer(h,p,f,m):b.setIndexBuffer(u.unwrap(h),p,f,m),b.drawIndexed(t,r,n,i,s),b.end(),u.device.queue.submit([v.finish()]),o&&Ji(o),a.priors.performanceCallback&&Ki({root:u,priors:a.priors})}},Mg=class{constructor(e){this.options=e;let t=ay(e.vertexFn.shell.in??{},e.vertexAttribs);this._vertexBufferLayouts=t.bufferDefinitions,this.usedVertexLayouts=t.usedVertexLayouts,this._targets=e.fragmentFn&&e.targets?Eg(e.fragmentFn.shell.out,e.targets):[null]}[l]=!0;usedVertexLayouts;_memo;_vertexBufferLayouts;_targets;[T](e){let{vertexFn:t,fragmentFn:r,slotBindings:n}=this.options,i=Ug(t.shell.out,r?.shell.in,x(t)??"<unnamed>",x(r)??"<unnamed>");return e.withVaryingLocations(i,()=>e.withSlots(n,()=>(e.resolve(t),r&&e.resolve(r),y("",ee,"runtime"))))}toString(){return"renderPipelineCore"}unwrap(){if(this._memo===void 0){let{branch:e,primitiveState:t,depthStencilState:r,multisampleState:n}=this.options,i=e.device,s=Ds.filter(V=>e.enabledFeatures.has(Au[V])),a,o=jr({names:e.nameRegistrySetting});a=_i(this,{namespace:o,enableExtensions:s,shaderGenerator:e.shaderGenerator,root:e});let{code:u,usedBindGroupLayouts:h,catchall:p,logResources:f}=a;p!==void 0&&h[p[0]]?.$name(`${x(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let m=i.createShaderModule({label:`${x(this)??"<unnamed>"} - Shader`,code:u}),v={layout:i.createPipelineLayout({label:`${x(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:h.map(V=>e.unwrap(V))}),vertex:{module:m,buffers:this._vertexBufferLayouts}},b=x(this);b!==void 0&&(v.label=b),this.options.fragmentFn&&(v.fragment={module:m,targets:this._targets}),t&&(Ot(t.stripIndexFormat)?v.primitive={...t,stripIndexFormat:{u32:"uint32",u16:"uint16"}[t.stripIndexFormat.type]}:v.primitive=t),r&&(v.depthStencil=r),n&&(v.multisample=n),this._memo={pipeline:i.createRenderPipeline(v),usedBindGroupLayouts:h,catchall:p,logResources:f}}return this._memo}};function Ug(e,t,r,n){let i={},s=new Set;function a(u,h){i[u]=h,s.add(h)}for(let[u,h]of Object.entries(e)){let p=Vt(h);p!==void 0&&a(u,p)}for(let[u,h]of Object.entries(t??{})){let p=Vt(h);p!==void 0&&(i[u]===void 0?a(u,p):i[u]!==p&&console.warn(`Mismatched location between vertexFn (${r}) output (${i[u]}) and fragmentFn (${n}) input (${p}) for the key "${u}", using the location set on vertex output.`))}let o=0;for(let u of Object.keys(e??{}))if(!(wt(e[u])||i[u]!==void 0)){for(;s.has(o);)o++;a(u,o)}return i}function Vg(e){if(e.includes(0))throw new Error("Size and workgroupSize cannot contain zeroes.");return te(e[0]??1,e[1]??1,e[2]??1)}var Pg=[te(1,1,1),te(256,1,1),te(16,16,1),te(8,8,4)],Ag=class Ih{#e;#t;#r;#n;#i;constructor(t,r,n,i){this.#e=t,this.#t=r,this.#r=n,this.#n=i,this.#i=te()}with(t){return new Ih(this.#e,this.#t.with(t),this.#r,this.#n)}dispatchThreads(...t){let r=Vg(t),n=zu(se(r).div(se(this.#n)));Vu(r,this.#i)||(this.#i=r,this.#r.write(r)),this.#t.dispatchWorkgroups(n.x,n.y,n.z)}get pipeline(){return this.#t}get sizeUniform(){return this.#r}},Bg=class ts{constructor(t,r){this._getRoot=t,this._slotBindings=r}with(t,r){return new ts(this._getRoot,[...this._slotBindings,[oi(t)?t.slot:t,r]])}withCompute(t){return new Og(this._getRoot(),this._slotBindings,t)}createGuardedComputePipeline(t){let r=this._getRoot();if(t.length>=4)throw new Error("Guarded compute callback only supports up to three dimensions.");let n=Pg[t.length],i=B([$,$,$])(t),s=r.createUniform(te),a=Ou({workgroupSize:n,in:{id:No.globalInvocationId}})`{
  if (any(in.id >= sizeUniform)) {
    return;
  }
  wrappedCallback(in.id.x, in.id.y, in.id.z);
}`.$uses({sizeUniform:s,wrappedCallback:i}),o=this.withCompute(a).createPipeline();return new Ag(r,o,s,n)}withVertex(t,r){return new Cg({branch:this._getRoot(),primitiveState:void 0,depthStencilState:void 0,slotBindings:this._slotBindings,vertexFn:t,vertexAttribs:r??{},multisampleState:void 0})}pipe(t){let r=t(new Nu([]));return new ts(this._getRoot,[...this._slotBindings,...r.bindings])}},Og=class{constructor(e,t,r){this._root=e,this._slotBindings=t,this._entryFn=r}createPipeline(){return $g(this._root,this._slotBindings,this._entryFn)}},Cg=class jn{constructor(t){this._options=t}withFragment(t,r,n){return nt(typeof t!="string"),nt(r===void 0||typeof r!="string"),new Fg({...this._options,fragmentFn:t,targets:r??{}})}withPrimitive(t){return new jn({...this._options,primitiveState:t})}withDepthStencil(t){return new jn({...this._options,depthStencilState:t})}withMultisample(t){return new jn({...this._options,multisampleState:t})}createPipeline(){return zh({...this._options,fragmentFn:null,targets:null})}},Fg=class Ln{constructor(t){this._options=t}withPrimitive(t){return new Ln({...this._options,primitiveState:t})}withDepthStencil(t){return new Ln({...this._options,depthStencilState:t})}withMultisample(t){return new Ln({...this._options,multisampleState:t})}createPipeline(){return zh(this._options)}},Sh=class extends Bg{constructor(t,r,n,i,s){super(()=>this,[]),this.device=t,this.nameRegistrySetting=r,this._ownDevice=n,this.shaderGenerator=s,this["~unstable"]=this,this[l]={logOptions:i}}"~unstable";_unwrappedBindGroupLayouts=new Oa(t=>t.unwrap(this));_unwrappedBindGroups=new Oa(t=>t.unwrap(this));[l];get enabledFeatures(){return new Set(this.device.features)}createBuffer(t,r){return Bn(this,t,r)}createUniform(t,r){let n=Bn(this,t,r).$usage("uniform");return new Ei("uniform",n)}createMutable(t,r){let n=Bn(this,t,r).$usage("storage");return new Ei("mutable",n)}createReadonly(t,r){let n=Bn(this,t,r).$usage("storage");return new Ei("readonly",n)}createQuerySet(t,r,n){return yg(this,t,r,n)}createBindGroup(t,r){return new ih(t,r)}destroy(){Ay(this.device),this._ownDevice&&this.device.destroy()}createTexture(t){return Fy(t,this)}createSampler(t){return zy(t,this)}createComparisonSampler(t){return Iy(t,this)}unwrap(t){if(wh(t))return t[l].rawPipeline;if(xh(t))return t[l].core.unwrap().pipeline;if(rh(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(ei(t))return this._unwrappedBindGroups.getOrMake(t);if(nn(t))return t.buffer;if(un(t))return t[l].unwrap();if(hn(t)){if(!t[l].unwrap)throw new Error("Cannot unwrap laid-out texture view as it has no underlying resource.");return t[l].unwrap()}if(Th(t))return t.vertexLayout;if(Yu(t)||Xu(t)){if(t[l].unwrap)return t[l].unwrap();throw new Error("Cannot unwrap laid-out sampler.")}if(qs(t))return t.querySet;throw new Error(`Unknown resource type: ${t}`)}beginRenderPass(t,r){let n=this.device.createCommandEncoder(),i=n.beginRenderPass(t),s=new Map,a=new Map,o,u=()=>{if(!o)throw new Error("Cannot draw without a call to pass.setPipeline");let{core:h,priors:p}=o[l],f=h.unwrap();i.setPipeline(f.pipeline);let m=new Set(f.usedBindGroupLayouts);f.usedBindGroupLayouts.forEach((b,V)=>{if(f.catchall&&V===f.catchall[0])i.setBindGroup(V,this.unwrap(f.catchall[1])),m.delete(b);else{let D=p.bindGroupLayoutMap?.get(b)??s.get(b);D!==void 0&&(m.delete(b),ei(D)?i.setBindGroup(V,this.unwrap(D)):i.setBindGroup(V,D))}});let v=new Set;if(h.usedVertexLayouts.forEach((b,V)=>{let D=p.vertexLayoutMap?.get(b),H=D?{buffer:D,offset:void 0,size:void 0}:a.get(b);!H||!H.buffer?v.add(b):nn(H.buffer)?i.setVertexBuffer(V,this.unwrap(H.buffer),H.offset,H.size):i.setVertexBuffer(V,H.buffer,H.offset,H.size)}),m.size>0)throw new us(m);if(v.size>0)throw new lo(v)};r({setViewport(...h){i.setViewport(...h)},setScissorRect(...h){i.setScissorRect(...h)},setBlendConstant(...h){i.setBlendConstant(...h)},setStencilReference(...h){i.setStencilReference(...h)},beginOcclusionQuery(...h){i.beginOcclusionQuery(...h)},endOcclusionQuery(...h){i.endOcclusionQuery(...h)},executeBundles(...h){i.executeBundles(...h)},setPipeline(h){o=h},setIndexBuffer:(h,p,f,m)=>{nn(h)?i.setIndexBuffer(this.unwrap(h),p,f,m):i.setIndexBuffer(h,p,f,m)},setVertexBuffer(h,p,f,m){a.set(h,{buffer:p,offset:f,size:m})},setBindGroup(h,p){s.set(h,p)},draw(h,p,f,m){u(),i.draw(h,p,f,m)},drawIndexed(...h){u(),i.drawIndexed(...h)},drawIndirect(...h){u(),i.drawIndirect(...h)},drawIndexedIndirect(...h){u(),i.drawIndexedIndirect(...h)}}),i.end(),this.device.queue.submit([n.finish()])}flush(){console.warn("flush() has been deprecated, and has no effect.")}};async function Gg(e){let{adapter:t,device:r,unstable_names:n="strict",unstable_logOptions:i}=e??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let s=await navigator.gpu.requestAdapter(t);if(!s)throw new Error("Could not find a compatible GPU");let a=[];for(let u of r?.requiredFeatures??[]){if(!s.features.has(u))throw new Error(`Requested feature "${u}" is not supported by the adapter.`);a.push(u)}for(let u of r?.optionalFeatures??[])s.features.has(u)?a.push(u):console.warn(`Optional feature "${u}" is not supported by the adapter.`);let o=await s.requestDevice({...r,requiredFeatures:a});return new Sh(o,n,!0,i??{},e?.shaderGenerator)}function Rg(e){let{device:t,unstable_names:r="strict",unstable_logOptions:n}=e??{};return new Sh(t,r,!1,n??{},e?.shaderGenerator)}function jg(e,t){return new Lg(e,t)}var Lg=class{constructor(e,t=void 0){this.schema=e,this.defaultValue=t,this.slot=ti(t),this[ne]=this.slot}[l]=!0;[ne];resourceType="accessor";slot;get[O](){return new Proxy({[l]:!0,[Te]:this.#e(),[T]:e=>e.resolve(this),toString:()=>`accessor:${x(this)??"<unnamed>"}.$`},Fe)}#e(){let e=Ee(),t=$i(e.unwrap(this.slot));if(Cu(t))return t[l].gpuImpl();let r=ui(t);if(r)return r;e.pushMode(new dn);try{let n=At(this.schema,t);return y(n,this.schema,"constant")}finally{e.popMode("normal")}}$name(e){return this.slot.$name(e),this}toString(){return`accessor:${x(this)??"<unnamed>"}`}get value(){if(Xe())return this[O];throw new Error("`tgpu.accessor` relies on GPU resources and cannot be accessed outside of a compute dispatch or draw call")}get $(){return this.value}[T](e){let t=this.#e();return y(e.resolve(t.value,t.dataType).value,t.dataType,t.origin)}};function Ng(e){return Wg(e)}function Dg([e,t]){return`${x(e)??"<unnamed>"}=${t}`}function Wg(e){if(Ee())throw new Error("Cannot create tgpu.derived objects at the resolution stage.");return{[l]:!0,resourceType:"derived","~compute":e,get[O](){let t=Ee();if(!t)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return $i(t.unwrap(this))},get value(){return this[O]},get $(){return this.value},with(t,r){return Eh(this,[[t,r]])},toString(){return"derived"}}}function Eh(e,t){return{[l]:!0,resourceType:"derived","~compute"(){throw new Error("'~compute' should never be read on bound derived items.")},[qt]:{inner:e,pairs:t},get[O](){let r=Ee();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return $i(r.unwrap(this))},get value(){return this[O]},get $(){return this.value},with(r,n){return Eh(e,[...t,[r,n]])},toString(){return`derived[${t.map(Dg).join(", ")}]`}}}var qg={fn:B,bindGroupLayout:th,vertexLayout:Ca,slot:ti,init:Gg,initFromDevice:Rg,resolve:pg,resolveWithContext:Qi,privateVar:ri,workgroupVar:Va,const:Wi,"~unstable":{fn:B,fragmentFn:Zm,vertexFn:Nc,computeFn:Ou,comptime:Pt,vertexLayout:Ca,namespace:jr,derived:Ng,slot:ti,accessor:jg,privateVar:ri,workgroupVar:Va,const:Wi,declare:Dm,rawCodeSnippet:Xm,simulate:mg}},kh=qg,Hg=Pt(((e,t)=>t===void 0?r=>Fa(e,r):Fa(e,t))).$name("disarrayOf");function Fa(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Disarray schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>At(e,n?.[s]))};if(Object.setPrototypeOf(r,Yg),r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create disarray schema with invalid element count: ${t}.`);return r.elementCount=t,r}var Yg={[l]:!0,type:"disarray",toString(){return`disarrayOf(${this.elementType}, ${this.elementCount})`}};function Xg(e){let t=r=>Object.fromEntries(Object.entries(e).map(([n,i])=>[n,At(i,r?.[n])]));return Object.setPrototypeOf(t,Qg),t.propTypes=e,t}var Qg={[l]:!0,type:"unstruct",$name(e){return G(this,e),this},toString(){return`unstruct:${x(this)??"<unnamed>"}`}};function $r(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if(pe(e)&&pe(t)||qe(e)&&qe(t)){let r=e.propTypes,n=t.propTypes,i=Object.keys(r),s=Object.keys(n);if(i.length!==s.length)return!1;for(let a=0;a<i.length;a++){let o=i[a],u=s[a];if(o!==u||!o||!u||!$r(r[o],n[u]))return!1}return!0}if(ve(e)&&ve(t)||yt(e)&&yt(t))return e.elementCount===t.elementCount&&$r(e.elementType,t.elementType);if(De(e)&&De(t))return e.addressSpace===t.addressSpace&&e.access===t.access&&$r(e.inner,t.inner);if(Wn(e)&&Wn(t))return $r(e.inner,t.inner);if(We(e)&&We(t)||He(e)&&He(t)){if(!$r(e.inner,t.inner)||e.attribs.length!==t.attribs.length)return!1;let r=s=>{let a=s;return`${a.type}(${(a.params??[]).join(",")})`},n=e.attribs.map(r),i=t.attribs.map(r);for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1}return!0}function tr(e,t){let r=e.prototype,n=Li[t][l].jsImpl;r[t]=function(i){return n(this,i)}}tr(Qt,"add");tr(Qt,"sub");tr(Qt,"mul");tr(Qt,"div");tr(Fr,"add");tr(Fr,"sub");tr(Fr,"mul");const Zg=Object.freeze(Object.defineProperty({__proto__:null,Void:ee,align:zc,alignmentOf:xc,arrayOf:on,atomic:lu,bool:F,builtin:No,comparisonSampler:Fs,deepEqual:$r,disarrayOf:Hg,f16:ie,f32:w,float16:Jl,float16x2:Kl,float16x4:ec,float32:tc,float32x2:rc,float32x3:nc,float32x4:ic,formatToWGSLType:gt,i32:R,interpolate:Sc,invariant:Ec,isAlignAttrib:is,isAtomic:Wn,isBuiltin:wt,isBuiltinAttrib:as,isData:Or,isDecorated:We,isDisarray:yt,isInterpolateAttrib:Lh,isLocationAttrib:eo,isLooseData:Br,isLooseDecorated:He,isPackedData:Ro,isPtr:De,isSizeAttrib:ss,isUnstruct:qe,isWgslArray:ve,isWgslData:Ot,isWgslStruct:pe,location:Zn,mat2x2f:vt,mat3x3f:$t,mat4x4f:q,matToArray:Jc,packedFormats:ks,ptrFn:ls,ptrHandle:il,ptrPrivate:el,ptrStorage:rl,ptrUniform:nl,ptrWorkgroup:tl,ref:cl,sampler:Cs,sint16:Nl,sint16x2:Dl,sint16x4:Wl,sint32:hc,sint32x2:lc,sint32x3:cc,sint32x4:pc,sint8:Ul,sint8x2:Vl,sint8x4:Pl,size:Ic,sizeOf:Tc,snorm16:Xl,snorm16x2:Ql,snorm16x4:Zl,snorm8:Cl,snorm8x2:Fl,snorm8x4:Gl,struct:li,texture1d:Ko,texture2d:As,texture2dArray:tu,texture3d:iu,textureCube:ru,textureCubeArray:nu,textureDepth2d:pp,textureDepth2dArray:fp,textureDepthCube:mp,textureDepthCubeArray:yp,textureDepthMultisampled2d:dp,textureExternal:uu,textureMultisampled2d:eu,textureStorage1d:su,textureStorage2d:Bs,textureStorage2dArray:au,textureStorage3d:ou,u16:xl,u32:$,uint16:Rl,uint16x2:jl,uint16x4:Ll,uint32:sc,uint32x2:ac,uint32x3:oc,uint32x4:uc,uint8:El,uint8x2:kl,uint8x4:Ml,unorm10_10_10_2:dc,unorm16:ql,unorm16x2:Hl,unorm16x4:Yl,unorm8:Al,unorm8x2:Bl,unorm8x4:Ol,unorm8x4_bgra:fc,unstruct:Xg,vec2b:Zt,vec2f:P,vec2h:at,vec2i:ue,vec2u:_e,vec3b:Jt,vec3f:se,vec3h:ot,vec3i:ke,vec3u:te,vec4b:Kt,vec4f:z,vec4h:ut,vec4i:he,vec4u:me},Symbol.toStringTag,{value:"Module"}));var Jg=d({name:"discard",normalImpl:"`discard` relies on GPU resources and cannot be executed outside of a draw call",signature:{argTypes:[],returnType:ee},codegenImpl:()=>"discard;"}),zn=$n[l].jsImpl,Kg=pi[l].jsImpl,ew=pi[l].gpuImpl,tw=di[l].jsImpl,rw=di[l].gpuImpl,nw=fi[l].jsImpl,iw=fi[l].gpuImpl,sw=mi[l].jsImpl,aw=mi[l].gpuImpl,ow=yi[l].jsImpl,uw=yi[l].gpuImpl,hw=d({name:"translate4",normalImpl:(e,t)=>zn(Kg(t),e),signature:{argTypes:[q,se],returnType:q},codegenImpl:(e,t)=>c`(${ew(t)} * ${e})`}),lw=d({name:"scale4",normalImpl:(e,t)=>zn(tw(t),e),signature:{argTypes:[q,se],returnType:q},codegenImpl:(e,t)=>c`(${rw(t)} * ${e})`}),Hs={argTypes:[q,w],returnType:q},cw=d({name:"rotateX4",normalImpl:(e,t)=>zn(nw(t),e),signature:Hs,codegenImpl:(e,t)=>c`(${iw(t)} * ${e})`}),pw=d({name:"rotateY4",normalImpl:(e,t)=>zn(sw(t),e),signature:Hs,codegenImpl:(e,t)=>c`(${aw(t)} * ${e})`}),dw=d({name:"rotateZ4",normalImpl:(e,t)=>zn(ow(t),e),signature:Hs,codegenImpl:(e,t)=>c`(${uw(t)} * ${e})`}),fw=d({name:"workgroupBarrier",normalImpl:"workgroupBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:ee},codegenImpl:()=>"workgroupBarrier()"}),mw=d({name:"storageBarrier",normalImpl:"storageBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:ee},codegenImpl:()=>"storageBarrier()"}),yw=d({name:"textureBarrier",normalImpl:"textureBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:ee},codegenImpl:()=>"textureBarrier()"}),_t="Atomic operations are not supported outside of CODEGEN mode.",gw=d({name:"atomicLoad",normalImpl:_t,signature:e=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Bt(e)}`);return{argTypes:[e],returnType:e.inner}},codegenImpl:e=>c`atomicLoad(&${e})`}),ww=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Bt(e)}`);return{argTypes:[e,e.inner.type==="u32"?$:R],returnType:ee}},rr=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Bt(e)}`);let r=e.inner.type==="u32"?$:R;return{argTypes:[e,r],returnType:r}},xw=d({name:"atomicStore",normalImpl:_t,signature:ww,codegenImpl:(e,t)=>c`atomicStore(&${e}, ${t})`}),vw=d({name:"atomicAdd",normalImpl:_t,signature:rr,codegenImpl:(e,t)=>c`atomicAdd(&${e}, ${t})`}),$w=d({name:"atomicSub",normalImpl:_t,signature:rr,codegenImpl:(e,t)=>c`atomicSub(&${e}, ${t})`}),bw=d({name:"atomicMax",normalImpl:_t,signature:rr,codegenImpl:(e,t)=>c`atomicMax(&${e}, ${t})`}),_w=d({name:"atomicMin",normalImpl:_t,signature:rr,codegenImpl:(e,t)=>c`atomicMin(&${e}, ${t})`}),Tw=d({name:"atomicAnd",normalImpl:_t,signature:rr,codegenImpl:(e,t)=>c`atomicAnd(&${e}, ${t})`}),zw=d({name:"atomicOr",normalImpl:_t,signature:rr,codegenImpl:(e,t)=>c`atomicOr(&${e}, ${t})`}),Iw=d({name:"atomicXor",normalImpl:_t,signature:rr,codegenImpl:(e,t)=>c`atomicXor(&${e}, ${t})`}),Tt="Derivative builtins are not allowed on the CPU",Sw=d({name:"dpdx",normalImpl:Tt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdx(${e})`}),Ew=d({name:"dpdxCoarse",normalImpl:Tt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxCoarse(${e})`}),kw=d({name:"dpdxFine",normalImpl:Tt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxFine(${e})`}),Mw=d({name:"dpdy",normalImpl:Tt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdy(${e})`}),Uw=d({name:"dpdyCoarse",normalImpl:Tt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyCoarse(${e})`}),Vw=d({name:"dpdyFine",normalImpl:Tt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyFine(${e})`}),Pw=d({name:"fwidth",normalImpl:Tt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidth(${e})`}),Aw=d({name:"fwidthCoarse",normalImpl:Tt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthCoarse(${e})`}),Bw=d({name:"fwidthFine",normalImpl:Tt,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthFine(${e})`}),Ga=e=>De(e)&&ve(e.inner)?e.inner.elementCount:0,Ow=d({name:"arrayLength",signature:e=>{let t=De(e)?e:ls(e);return{argTypes:[t],returnType:Ga(t)>0?fn:$}},normalImpl:e=>bo(e)?e.$.length:e.length,codegenImpl(e){let t=Ga(e.dataType);return t>0?String(t):c`arrayLength(${e})`}});function Cw(e,t,r,n,i){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var Fw=d({name:"textureSample",normalImpl:Cw,codegenImpl:(...e)=>c`textureSample(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?w:z}}});function Gw(e,t,r,n,i,s){throw new Error("Texture sampling with bias relies on GPU resources and cannot be executed outside of a draw call")}var Rw=d({name:"textureSampleBias",normalImpl:Gw,codegenImpl:(...e)=>c`textureSampleBias(${e})`,signature:(...e)=>({argTypes:e,returnType:z})});function jw(e,t,r,n,i,s){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var Lw=d({name:"textureSampleLevel",normalImpl:jw,codegenImpl:(...e)=>c`textureSampleLevel(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?w:z}}});function Nw(e,t,r){throw new Error("`textureLoad` relies on GPU resources and cannot be executed outside of a draw call")}var Mh=d({name:"textureLoad",normalImpl:Nw,codegenImpl:(...e)=>c`textureLoad(${e})`,signature:(...e)=>{let t=e[0];if(hu(t)){let i=t.type.startsWith("texture_depth"),s=t.sampleType;return{argTypes:e,returnType:i?w:s.type==="f32"?z:s.type==="u32"?me:he}}let r=t.format,n=Tn(r).vectorType;return{argTypes:e,returnType:n}}});function Dw(e,t,r,n){throw new Error("`textureStore` relies on GPU resources and cannot be executed outside of a draw call")}var rs=d({name:"textureStore",normalImpl:Dw,codegenImpl:(...e)=>c`textureStore(${e})`,signature:(...e)=>({argTypes:e,returnType:ee})});function Ww(e,t){throw new Error("`textureDimensions` relies on GPU resources and cannot be executed outside of a draw call")}var qw=d({name:"textureDimensions",normalImpl:Ww,codegenImpl:(...e)=>c`textureDimensions(${e})`,signature:(...e)=>{let t=e[0].dimension;return t==="1d"?{argTypes:e,returnType:$}:t==="3d"?{argTypes:e,returnType:te}:{argTypes:e,returnType:_e}}});function Hw(e,t,r,n,i,s){throw new Error("Texture comparison sampling relies on GPU resources and cannot be executed outside of a draw call")}var Yw=d({name:"textureSampleCompare",normalImpl:Hw,codegenImpl:(...e)=>c`textureSampleCompare(${e})`,signature:(...e)=>({argTypes:e,returnType:w})});function Xw(e,t,r){throw new Error("Texture sampling with base clamp to edge is not supported outside of GPU mode.")}var Qw=d({name:"textureSampleBaseClampToEdge",normalImpl:Xw,codegenImpl:(...e)=>c`textureSampleBaseClampToEdge(${e})`,signature:(...e)=>({argTypes:e,returnType:z})}),ae="Subgroup operations can only be used in the GPU context.",Zw=d({name:"subgroupAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupAdd(${e})`}),Jw=d({name:"subgroupExclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupExclusiveAdd(${e})`}),Kw=d({name:"subgroupInclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupInclusiveAdd(${e})`}),ex=d({name:"subgroupAll",signature:{argTypes:[F],returnType:F},normalImpl:ae,codegenImpl:e=>c`subgroupAll(${e})`}),tx=d({name:"subgroupAnd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupAnd(${e})`}),rx=d({name:"subgroupAny",signature:{argTypes:[F],returnType:F},normalImpl:ae,codegenImpl:e=>c`subgroupAny(${e})`}),nx=d({name:"subgroupBallot",signature:{argTypes:[F],returnType:me},normalImpl:ae,codegenImpl:e=>c`subgroupBallot(${e})`}),ix=d({name:"subgroupBroadcast",signature:(...e)=>{let t=de([e[1]],[R,$]);if(!t)throw new Error(`subgroupBroadcast's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ae,codegenImpl:(e,t)=>c`subgroupBroadcast(${e}, ${t})`}),sx=d({name:"subgroupBroadcastFirst",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupBroadcastFirst(${e})`}),ax=d({name:"subgroupElect",signature:{argTypes:[],returnType:F},normalImpl:ae,codegenImpl:()=>c`subgroupElect()`}),ox=d({name:"subgroupMax",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupMax(${e})`}),ux=d({name:"subgroupMin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupMin(${e})`}),hx=d({name:"subgroupMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupMul(${e})`}),lx=d({name:"subgroupExclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupExclusiveMul(${e})`}),cx=d({name:"subgroupInclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupInclusiveMul(${e})`}),px=d({name:"subgroupOr",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupOr(${e})`}),dx=d({name:"subgroupShuffle",signature:(...e)=>{let t=de([e[1]],[R,$]);if(!t)throw new Error(`subgroupShuffle's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ae,codegenImpl:(e,t)=>c`subgroupShuffle(${e}, ${t})`}),fx=d({name:"subgroupShuffleDown",signature:(...e)=>{let t=de([e[1]],[$]);if(!t)throw new Error(`subgroupShuffleDown's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ae,codegenImpl:(e,t)=>c`subgroupShuffleDown(${e}, ${t})`}),mx=d({name:"subgroupShuffleUp",signature:(...e)=>{let t=de([e[1]],[$]);if(!t)throw new Error(`subgroupShuffleUp's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ae,codegenImpl:(e,t)=>c`subgroupShuffleUp(${e}, ${t})`}),yx=d({name:"subgroupShuffleXor",signature:(...e)=>{let t=de([e[1]],[$]);if(!t)throw new Error(`subgroupShuffleXor's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ae,codegenImpl:(e,t)=>c`subgroupShuffleXor(${e}, ${t})`}),gx=d({name:"subgroupXor",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ae,codegenImpl:e=>c`subgroupXor(${e})`}),wx=Pt(e=>{let t=Ee();if(!t)throw new Error("Functions using `extensionEnabled` cannot be called directly. Either generate WGSL from them, or use tgpu['~unstable'].simulate(...)");if(typeof e!="string"||!Ds.includes(e))throw new Error(`extensionEnabled has to be called with a string literal representing a valid WGSL extension name. Got: '${e}'`);return(t.enableExtensions??[]).includes(e)});const xx=Object.freeze(Object.defineProperty({__proto__:null,abs:zd,acos:Sd,acosh:kd,add:Vs,all:_m,allEq:Vu,and:bm,any:Tm,arrayLength:Ow,asin:Ud,asinh:Pd,atan:Tu,atan2:Fd,atanh:Od,atomicAdd:vw,atomicAnd:Tw,atomicLoad:gw,atomicMax:bw,atomicMin:_w,atomicOr:zw,atomicStore:xw,atomicSub:$w,atomicXor:Iw,bitcastU32toF32:ku,bitcastU32toI32:Mu,ceil:zu,clamp:jd,cos:Nd,cosh:Wd,countLeadingZeros:qd,countOneBits:Hd,countTrailingZeros:Yd,cross:Xd,degrees:Zd,determinant:Jd,discard:Jg,distance:ef,div:Ps,dot:Iu,dot4I8Packed:rf,dot4U8Packed:tf,dpdx:Sw,dpdxCoarse:Ew,dpdxFine:kw,dpdy:Mw,dpdyCoarse:Uw,dpdyFine:Vw,eq:fm,exp:sf,exp2:of,extensionEnabled:wx,extractBits:uf,faceForward:hf,firstLeadingBit:lf,firstTrailingBit:cf,floor:df,fma:mf,fract:gf,frexp:xf,fwidth:Pw,fwidthCoarse:Aw,fwidthFine:Bw,ge:xm,gt:wm,identity2:Ho,identity3:Yo,identity4:Xo,insertBits:vf,inverseSqrt:bf,isCloseTo:zm,ldexp:_f,le:gm,length:js,log:If,log2:Ef,lt:ym,max:Mf,min:Ni,mix:Pf,mod:lp,modf:Bf,mul:$n,ne:mm,neg:Jo,normalize:Of,not:vm,or:$m,pack2x16float:cm,pack4x8unorm:dm,pow:Su,quantizeToF16:Ff,radians:Rf,reflect:jf,refract:Lf,reverseBits:Nf,rotateX4:cw,rotateY4:pw,rotateZ4:dw,rotationX4:fi,rotationY4:mi,rotationZ4:yi,round:Wf,saturate:Hf,scale4:lw,scaling4:di,select:Sm,sign:Xf,sin:Zf,sinh:Kf,smoothstep:tm,sqrt:nm,step:sm,storageBarrier:mw,sub:Gr,subgroupAdd:Zw,subgroupAll:ex,subgroupAnd:tx,subgroupAny:rx,subgroupBallot:nx,subgroupBroadcast:ix,subgroupBroadcastFirst:sx,subgroupElect:ax,subgroupExclusiveAdd:Jw,subgroupExclusiveMul:lx,subgroupInclusiveAdd:Kw,subgroupInclusiveMul:cx,subgroupMax:ox,subgroupMin:ux,subgroupMul:hx,subgroupOr:px,subgroupShuffle:dx,subgroupShuffleDown:fx,subgroupShuffleUp:mx,subgroupShuffleXor:yx,subgroupXor:gx,tan:Eu,tanh:um,textureBarrier:yw,textureDimensions:qw,textureLoad:Mh,textureSample:Fw,textureSampleBaseClampToEdge:Qw,textureSampleBias:Rw,textureSampleCompare:Yw,textureSampleLevel:Lw,textureStore:rs,translate4:hw,translation4:pi,transpose:hm,trunc:lm,unpack2x16float:Uu,unpack4x8unorm:pm,workgroupBarrier:fw},Symbol.toStringTag,{value:"Module"})),Uh=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(li({k1:w,k2:w,k3:w,k4:w,fov:w,centerX:w,centerY:w,zoom:w,width:w,height:w,inputWidth:w,inputHeight:w,padding:w}),"FisheyeUniforms"),wr=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(kh.bindGroupLayout({inputTexture:{texture:As()},outputTexture:{storageTexture:Bs("rgba8unorm")},uniforms:{uniform:Uh}}),"fisheyeLayout");class vx{config;root=null;uniformBuffer=null;inputTexture=null;outputTexture=null;bindGroup=null;dewarpPipeline=null;readbackBuffers=null;readbackIndex=0;readbackHasData=[!1,!1];readbackBytesPerRow=0;readbackActualBytesPerRow=0;pixelBuffer=null;inputTextureSize=[0,0];outputTextureSize=[0,0];uniformInputWidth=0;uniformInputHeight=0;constructor(t={}){this.config=this.applyDefaults(t)}applyDefaults(t){return{k1:t.k1??0,k2:t.k2??0,k3:t.k3??0,k4:t.k4??0,width:t.width??300,height:t.height??150,fov:t.fov??180,centerX:t.centerX??0,centerY:t.centerY??0,zoom:t.zoom??1}}async initialize(){this.root||(this.root=await kh.init(),this.uniformBuffer=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(this.root.createBuffer(Uh,this.getUniformData()).$usage("uniform"),"uniformBuffer"),this.dewarpPipeline=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(this.root["~unstable"].createGuardedComputePipeline((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=((r,n)=>{"use gpu";const i=wr.$.uniforms,s=i.width,a=i.height,o=i.inputWidth,u=i.inputHeight,h=ue(r,n);if(w(r)>=s||w(n)>=a)return;const p=P((w(h.x)/s-.5)*2,(w(h.y)/a-.5)*2),f=i.centerX,m=i.centerY,v=p.sub(P(f,m)),b=js(v),V=Math.SQRT2,D=Ni(i.fov*.017453293,3.1),H=Eu(D*.5)/V,Re=Ni(H,1),Ct=b*Re,Ft=Tu(Ct),Me=Ft*Ft,ht=Me*Me,Lr=ht*Me,Nr=ht*ht,Sn=Ft*(1+i.k1*Me+i.k2*ht+i.k3*Lr+i.k4*Nr)/i.zoom;let ea=P(v.x,v.y);b>1e-4&&(ea=P(v.x*(Sn/b),v.y*(Sn/b)));const nr=ea.add(P(f,m)).mul(.5).add(.5);if(nr.x>=0&&nr.x<=1&&nr.y>=0&&nr.y<=1){const Fh=ue(R(nr.x*o),R(nr.y*u)),Gh=Mh(wr.$.inputTexture,Fh,0);rs(wr.$.outputTexture,h,Gh)}else rs(wr.$.outputTexture,h,z(0,0,0,1))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"x"},{type:"i",name:"y"}],body:[0,[[13,"p",[7,[7,"fisheyeLayout","$"],"uniforms"]],[13,"outputW",[7,"p","width"]],[13,"outputH",[7,"p","height"]],[13,"inputW",[7,"p","inputWidth"]],[13,"inputH",[7,"p","inputHeight"]],[13,"coord",[6,[7,"d","vec2i"],["x","y"]]],[11,[3,[1,[6,[7,"d","f32"],["x"]],">=","outputW"],"||",[1,[6,[7,"d","f32"],["y"]],">=","outputH"]],[0,[[10]]]],[13,"uv",[6,[7,"d","vec2f"],[[1,[1,[1,[6,[7,"d","f32"],[[7,"coord","x"]]],"/","outputW"],"-",[5,"0.5"]],"*",[5,"2"]],[1,[1,[1,[6,[7,"d","f32"],[[7,"coord","y"]]],"/","outputH"],"-",[5,"0.5"]],"*",[5,"2"]]]]],[13,"centerX",[7,"p","centerX"]],[13,"centerY",[7,"p","centerY"]],[13,"centered",[6,[7,"uv","sub"],[[6,[7,"d","vec2f"],["centerX","centerY"]]]]],[13,"r",[6,[7,"std","length"],["centered"]]],[13,"cornerNorm",[7,"Math","SQRT2"]],[13,"fovRad",[6,[7,"std","min"],[[1,[7,"p","fov"],"*",[5,"0.017453293"]],[5,"3.1"]]]],[13,"scaleRaw",[1,[6,[7,"std","tan"],[[1,"fovRad","*",[5,"0.5"]]]],"/","cornerNorm"]],[13,"scale",[6,[7,"std","min"],["scaleRaw",[5,"1"]]]],[13,"rScaledForFov",[1,"r","*","scale"]],[13,"theta",[6,[7,"std","atan"],["rScaledForFov"]]],[13,"theta2",[1,"theta","*","theta"]],[13,"theta4",[1,"theta2","*","theta2"]],[13,"theta6",[1,"theta4","*","theta2"]],[13,"theta8",[1,"theta4","*","theta4"]],[13,"thetaDistorted",[1,"theta","*",[1,[1,[1,[1,[5,"1"],"+",[1,[7,"p","k1"],"*","theta2"]],"+",[1,[7,"p","k2"],"*","theta4"]],"+",[1,[7,"p","k3"],"*","theta6"]],"+",[1,[7,"p","k4"],"*","theta8"]]]],[13,"rDistorted","thetaDistorted"],[13,"rScaled",[1,"rDistorted","/",[7,"p","zoom"]]],[12,"distortedUv",[6,[7,"d","vec2f"],[[7,"centered","x"],[7,"centered","y"]]]],[11,[1,"r",">",[5,"0.0001"]],[0,[[2,"distortedUv","=",[6,[7,"d","vec2f"],[[1,[7,"centered","x"],"*",[1,"rScaled","/","r"]],[1,[7,"centered","y"],"*",[1,"rScaled","/","r"]]]]]]]],[13,"finalUv",[6,[7,[6,[7,[6,[7,"distortedUv","add"],[[6,[7,"d","vec2f"],["centerX","centerY"]]]],"mul"],[[5,"0.5"]]],"add"],[[5,"0.5"]]]],[11,[3,[3,[3,[1,[7,"finalUv","x"],">=",[5,"0"]],"&&",[1,[7,"finalUv","x"],"<=",[5,"1"]]],"&&",[1,[7,"finalUv","y"],">=",[5,"0"]]],"&&",[1,[7,"finalUv","y"],"<=",[5,"1"]]],[0,[[13,"sampleCoord",[6,[7,"d","vec2i"],[[6,[7,"d","i32"],[[1,[7,"finalUv","x"],"*","inputW"]]],[6,[7,"d","i32"],[[1,[7,"finalUv","y"],"*","inputH"]]]]]],[13,"color",[6,[7,"std","textureLoad"],[[7,[7,"fisheyeLayout","$"],"inputTexture"],"sampleCoord",[5,"0"]]]],[6,[7,"std","textureStore"],[[7,[7,"fisheyeLayout","$"],"outputTexture"],"coord","color"]]]],[0,[[6,[7,"std","textureStore"],[[7,[7,"fisheyeLayout","$"],"outputTexture"],"coord",[6,[7,"d","vec4f"],[[5,"0"],[5,"0"],[5,"0"],[5,"1"]]]]]]]]]],externalNames:["fisheyeLayout","d","std","Math"]},externals:()=>({fisheyeLayout:wr,d:Zg,std:xx,Math})})&&t.f)({})),"dewarpPipeline"))}getUniformData(){return{k1:this.config.k1,k2:this.config.k2,k3:this.config.k3,k4:this.config.k4,fov:this.config.fov,centerX:this.config.centerX,centerY:this.config.centerY,zoom:this.config.zoom,width:this.config.width,height:this.config.height,inputWidth:this.uniformInputWidth,inputHeight:this.uniformInputHeight,padding:0}}updateUniforms(){this.uniformBuffer&&this.uniformBuffer.write(this.getUniformData())}async readbackToVideoFrame(t,r,n){const i=this.readbackBuffers;if(!i)throw new Error("Readback buffer not initialized");const s=this.readbackIndex,a=1-s,o=i[s],u=i[a];if(!o||!u)throw new Error("Readback buffer not initialized");const h=t.createCommandEncoder();h.copyTextureToBuffer({texture:r},{buffer:o,bytesPerRow:this.readbackBytesPerRow},[this.config.width,this.config.height]),t.queue.submit([h.finish()]),await t.queue.onSubmittedWorkDone(),this.readbackHasData[s]=!0,this.readbackIndex=a;const p=this.readbackHasData[a]?u:o;await p.mapAsync(GPUMapMode.READ);const f=p.getMappedRange(),m=this.pixelBuffer??new Uint8Array(this.config.width*this.config.height*4),v=new Uint8Array(f);for(let b=0;b<this.config.height;b++){const V=b*this.readbackBytesPerRow,D=b*this.readbackActualBytesPerRow;m.set(v.subarray(V,V+this.readbackActualBytesPerRow),D)}return p.unmap(),new VideoFrame(m,{format:"RGBA",codedWidth:this.config.width,codedHeight:this.config.height,timestamp:n})}createInputTexture(t,r,n){const i=[r,n];return t["~unstable"].createTexture({size:i,format:"rgba8unorm"}).$usage("sampled","render")}createOutputTexture(t,r,n){const i=[r,n];return t["~unstable"].createTexture({size:i,format:"rgba8unorm"}).$usage("storage")}calculateBytesPerRow(t){const r=t*4;return Math.ceil(r/256)*256}createReadbackBuffer(t,r,n){const i=this.calculateBytesPerRow(r)*n;return t.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}async dewarp(t){if(await this.initialize(),!this.root||!this.uniformBuffer)throw new Error("GPU resources not initialized");const r=this.root,n=r.device;(!this.inputTexture||this.inputTextureSize[0]!==t.displayWidth||this.inputTextureSize[1]!==t.displayHeight)&&(this.inputTexture?.destroy(),this.inputTexture=this.createInputTexture(r,t.displayWidth,t.displayHeight),this.inputTextureSize=[t.displayWidth,t.displayHeight],this.bindGroup=null),(!this.outputTexture||this.outputTextureSize[0]!==this.config.width||this.outputTextureSize[1]!==this.config.height)&&(this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.outputTexture=this.createOutputTexture(r,this.config.width,this.config.height),this.readbackBytesPerRow=this.calculateBytesPerRow(this.config.width),this.readbackActualBytesPerRow=this.config.width*4,this.pixelBuffer=new Uint8Array(this.config.width*this.config.height*4),this.readbackBuffers=[this.createReadbackBuffer(n,this.config.width,this.config.height),this.createReadbackBuffer(n,this.config.width,this.config.height)],this.readbackIndex=0,this.readbackHasData=[!1,!1],this.outputTextureSize=[this.config.width,this.config.height],this.bindGroup=null);const i=this.inputTexture,s=this.outputTexture;if(!i||!s)throw new Error("Textures not initialized");i.write(t),this.uniformInputWidth=t.displayWidth,this.uniformInputHeight=t.displayHeight,this.updateUniforms(),this.bindGroup||(this.bindGroup=r.createBindGroup(wr,{inputTexture:i,outputTexture:s,uniforms:this.uniformBuffer}));const a=this.bindGroup,o=this.dewarpPipeline;if(!o||!s)throw new Error("Compute pipeline or output texture not initialized");o.with(a).dispatchThreads(this.config.width,this.config.height);const u=r.unwrap(s);return this.readbackToVideoFrame(n,u,t.timestamp)}updateConfig(t){this.config=this.applyDefaults({...this.config,...t}),this.updateUniforms(),(t.width||t.height)&&(this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.outputTexture=null,this.readbackBuffers=null,this.readbackIndex=0,this.readbackHasData=[!1,!1],this.outputTextureSize=[0,0],this.readbackBytesPerRow=0,this.readbackActualBytesPerRow=0,this.pixelBuffer=null)}destroy(){this.inputTexture?.destroy(),this.outputTexture?.destroy(),this.readbackBuffers?.[0]?.destroy(),this.readbackBuffers?.[1]?.destroy(),this.root?.destroy(),this.inputTexture=null,this.outputTexture=null,this.readbackBuffers=null,this.readbackIndex=0,this.readbackHasData=[!1,!1],this.uniformBuffer=null,this.root=null,this.bindGroup=null,this.dewarpPipeline=null,this.readbackBytesPerRow=0,this.readbackActualBytesPerRow=0,this.pixelBuffer=null,this.inputTextureSize=[0,0],this.outputTextureSize=[0,0]}}const Nn=globalThis,Ys=Nn.ShadowRoot&&(Nn.ShadyCSS===void 0||Nn.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Xs=Symbol(),Ra=new WeakMap;let Vh=class{constructor(t,r,n){if(this._$cssResult$=!0,n!==Xs)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=r}get styleSheet(){let t=this.o;const r=this.t;if(Ys&&t===void 0){const n=r!==void 0&&r.length===1;n&&(t=Ra.get(r)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&Ra.set(r,t))}return t}toString(){return this.cssText}};const $x=e=>new Vh(typeof e=="string"?e:e+"",void 0,Xs),bx=(e,...t)=>{const r=e.length===1?e[0]:t.reduce((n,i,s)=>n+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[s+1],e[0]);return new Vh(r,e,Xs)},_x=(e,t)=>{if(Ys)e.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet);else for(const r of t){const n=document.createElement("style"),i=Nn.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=r.cssText,e.appendChild(n)}},ja=Ys?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let r="";for(const n of t.cssRules)r+=n.cssText;return $x(r)})(e):e;const{is:Tx,defineProperty:zx,getOwnPropertyDescriptor:Ix,getOwnPropertyNames:Sx,getOwnPropertySymbols:Ex,getPrototypeOf:kx}=Object,Ti=globalThis,La=Ti.trustedTypes,Mx=La?La.emptyScript:"",Ux=Ti.reactiveElementPolyfillSupport,sn=(e,t)=>e,ni={toAttribute(e,t){switch(t){case Boolean:e=e?Mx:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=e!==null;break;case Number:r=e===null?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch{r=null}}return r}},Qs=(e,t)=>!Tx(e,t),Na={attribute:!0,type:String,converter:ni,reflect:!1,useDefault:!1,hasChanged:Qs};Symbol.metadata??=Symbol("metadata"),Ti.litPropertyMetadata??=new WeakMap;let br=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,r=Na){if(r.state&&(r.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((r=Object.create(r)).wrapped=!0),this.elementProperties.set(t,r),!r.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(t,n,r);i!==void 0&&zx(this.prototype,t,i)}}static getPropertyDescriptor(t,r,n){const{get:i,set:s}=Ix(this.prototype,t)??{get(){return this[r]},set(a){this[r]=a}};return{get:i,set(a){const o=i?.call(this);s?.call(this,a),this.requestUpdate(t,o,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Na}static _$Ei(){if(this.hasOwnProperty(sn("elementProperties")))return;const t=kx(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(sn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(sn("properties"))){const r=this.properties,n=[...Sx(r),...Ex(r)];for(const i of n)this.createProperty(i,r[i])}const t=this[Symbol.metadata];if(t!==null){const r=litPropertyMetadata.get(t);if(r!==void 0)for(const[n,i]of r)this.elementProperties.set(n,i)}this._$Eh=new Map;for(const[r,n]of this.elementProperties){const i=this._$Eu(r,n);i!==void 0&&this._$Eh.set(i,r)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const r=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const i of n)r.unshift(ja(i))}else t!==void 0&&r.push(ja(t));return r}static _$Eu(t,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,r=this.constructor.elementProperties;for(const n of r.keys())this.hasOwnProperty(n)&&(t.set(n,this[n]),delete this[n]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return _x(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,r,n){this._$AK(t,n)}_$ET(t,r){const n=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,n);if(i!==void 0&&n.reflect===!0){const s=(n.converter?.toAttribute!==void 0?n.converter:ni).toAttribute(r,n.type);this._$Em=t,s==null?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(t,r){const n=this.constructor,i=n._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const s=n.getPropertyOptions(i),a=typeof s.converter=="function"?{fromAttribute:s.converter}:s.converter?.fromAttribute!==void 0?s.converter:ni;this._$Em=i;const o=a.fromAttribute(r,s.type);this[i]=o??this._$Ej?.get(i)??o,this._$Em=null}}requestUpdate(t,r,n,i=!1,s){if(t!==void 0){const a=this.constructor;if(i===!1&&(s=this[t]),n??=a.getPropertyOptions(t),!((n.hasChanged??Qs)(s,r)||n.useDefault&&n.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(a._$Eu(t,n))))return;this.C(t,r,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,r,{useDefault:n,reflect:i,wrapped:s},a){n&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,a??r??this[t]),s!==!0||a!==void 0)||(this._$AL.has(t)||(this.hasUpdated||n||(r=void 0),this._$AL.set(t,r)),i===!0&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(r){Promise.reject(r)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,s]of this._$Ep)this[i]=s;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[i,s]of n){const{wrapped:a}=s,o=this[i];a!==!0||this._$AL.has(i)||o===void 0||this.C(i,void 0,s,o)}}let t=!1;const r=this._$AL;try{t=this.shouldUpdate(r),t?(this.willUpdate(r),this._$EO?.forEach(n=>n.hostUpdate?.()),this.update(r)):this._$EM()}catch(n){throw t=!1,this._$EM(),n}t&&this._$AE(r)}willUpdate(t){}_$AE(t){this._$EO?.forEach(r=>r.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(r=>this._$ET(r,this[r])),this._$EM()}updated(t){}firstUpdated(t){}};br.elementStyles=[],br.shadowRootOptions={mode:"open"},br[sn("elementProperties")]=new Map,br[sn("finalized")]=new Map,Ux?.({ReactiveElement:br}),(Ti.reactiveElementVersions??=[]).push("2.1.2");const Zs=globalThis,Da=e=>e,ii=Zs.trustedTypes,Wa=ii?ii.createPolicy("lit-html",{createHTML:e=>e}):void 0,Ph="$lit$",Et=`lit$${Math.random().toFixed(9).slice(2)}$`,Ah="?"+Et,Vx=`<${Ah}>`,Yt=document,ln=()=>Yt.createComment(""),cn=e=>e===null||typeof e!="object"&&typeof e!="function",Js=Array.isArray,Px=e=>Js(e)||typeof e?.[Symbol.iterator]=="function",ki=`[ 	
\f\r]`,Yr=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,qa=/-->/g,Ha=/>/g,Lt=RegExp(`>|${ki}(?:([^\\s"'>=/]+)(${ki}*=${ki}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Ya=/'/g,Xa=/"/g,Bh=/^(?:script|style|textarea|title)$/i,Ax=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),xr=Ax(1),Vr=Symbol.for("lit-noChange"),ce=Symbol.for("lit-nothing"),Qa=new WeakMap,Ht=Yt.createTreeWalker(Yt,129);function Oh(e,t){if(!Js(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return Wa!==void 0?Wa.createHTML(t):t}const Bx=(e,t)=>{const r=e.length-1,n=[];let i,s=t===2?"<svg>":t===3?"<math>":"",a=Yr;for(let o=0;o<r;o++){const u=e[o];let h,p,f=-1,m=0;for(;m<u.length&&(a.lastIndex=m,p=a.exec(u),p!==null);)m=a.lastIndex,a===Yr?p[1]==="!--"?a=qa:p[1]!==void 0?a=Ha:p[2]!==void 0?(Bh.test(p[2])&&(i=RegExp("</"+p[2],"g")),a=Lt):p[3]!==void 0&&(a=Lt):a===Lt?p[0]===">"?(a=i??Yr,f=-1):p[1]===void 0?f=-2:(f=a.lastIndex-p[2].length,h=p[1],a=p[3]===void 0?Lt:p[3]==='"'?Xa:Ya):a===Xa||a===Ya?a=Lt:a===qa||a===Ha?a=Yr:(a=Lt,i=void 0);const v=a===Lt&&e[o+1].startsWith("/>")?" ":"";s+=a===Yr?u+Vx:f>=0?(n.push(h),u.slice(0,f)+Ph+u.slice(f)+Et+v):u+Et+(f===-2?o:v)}return[Oh(e,s+(e[r]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),n]};class pn{constructor({strings:t,_$litType$:r},n){let i;this.parts=[];let s=0,a=0;const o=t.length-1,u=this.parts,[h,p]=Bx(t,r);if(this.el=pn.createElement(h,n),Ht.currentNode=this.el.content,r===2||r===3){const f=this.el.content.firstChild;f.replaceWith(...f.childNodes)}for(;(i=Ht.nextNode())!==null&&u.length<o;){if(i.nodeType===1){if(i.hasAttributes())for(const f of i.getAttributeNames())if(f.endsWith(Ph)){const m=p[a++],v=i.getAttribute(f).split(Et),b=/([.?@])?(.*)/.exec(m);u.push({type:1,index:s,name:b[2],strings:v,ctor:b[1]==="."?Cx:b[1]==="?"?Fx:b[1]==="@"?Gx:zi}),i.removeAttribute(f)}else f.startsWith(Et)&&(u.push({type:6,index:s}),i.removeAttribute(f));if(Bh.test(i.tagName)){const f=i.textContent.split(Et),m=f.length-1;if(m>0){i.textContent=ii?ii.emptyScript:"";for(let v=0;v<m;v++)i.append(f[v],ln()),Ht.nextNode(),u.push({type:2,index:++s});i.append(f[m],ln())}}}else if(i.nodeType===8)if(i.data===Ah)u.push({type:2,index:s});else{let f=-1;for(;(f=i.data.indexOf(Et,f+1))!==-1;)u.push({type:7,index:s}),f+=Et.length-1}s++}}static createElement(t,r){const n=Yt.createElement("template");return n.innerHTML=t,n}}function Pr(e,t,r=e,n){if(t===Vr)return t;let i=n!==void 0?r._$Co?.[n]:r._$Cl;const s=cn(t)?void 0:t._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(e),i._$AT(e,r,n)),n!==void 0?(r._$Co??=[])[n]=i:r._$Cl=i),i!==void 0&&(t=Pr(e,i._$AS(e,t.values),i,n)),t}class Ox{constructor(t,r){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:r},parts:n}=this._$AD,i=(t?.creationScope??Yt).importNode(r,!0);Ht.currentNode=i;let s=Ht.nextNode(),a=0,o=0,u=n[0];for(;u!==void 0;){if(a===u.index){let h;u.type===2?h=new In(s,s.nextSibling,this,t):u.type===1?h=new u.ctor(s,u.name,u.strings,this,t):u.type===6&&(h=new Rx(s,this,t)),this._$AV.push(h),u=n[++o]}a!==u?.index&&(s=Ht.nextNode(),a++)}return Ht.currentNode=Yt,i}p(t){let r=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(t,n,r),r+=n.strings.length-2):n._$AI(t[r])),r++}}class In{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,r,n,i){this.type=2,this._$AH=ce,this._$AN=void 0,this._$AA=t,this._$AB=r,this._$AM=n,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&t?.nodeType===11&&(t=r.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,r=this){t=Pr(this,t,r),cn(t)?t===ce||t==null||t===""?(this._$AH!==ce&&this._$AR(),this._$AH=ce):t!==this._$AH&&t!==Vr&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Px(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==ce&&cn(this._$AH)?this._$AA.nextSibling.data=t:this.T(Yt.createTextNode(t)),this._$AH=t}$(t){const{values:r,_$litType$:n}=t,i=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=pn.createElement(Oh(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===i)this._$AH.p(r);else{const s=new Ox(i,this),a=s.u(this.options);s.p(r),this.T(a),this._$AH=s}}_$AC(t){let r=Qa.get(t.strings);return r===void 0&&Qa.set(t.strings,r=new pn(t)),r}k(t){Js(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let n,i=0;for(const s of t)i===r.length?r.push(n=new In(this.O(ln()),this.O(ln()),this,this.options)):n=r[i],n._$AI(s),i++;i<r.length&&(this._$AR(n&&n._$AB.nextSibling,i),r.length=i)}_$AR(t=this._$AA.nextSibling,r){for(this._$AP?.(!1,!0,r);t!==this._$AB;){const n=Da(t).nextSibling;Da(t).remove(),t=n}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t))}}class zi{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,r,n,i,s){this.type=1,this._$AH=ce,this._$AN=void 0,this.element=t,this.name=r,this._$AM=i,this.options=s,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=ce}_$AI(t,r=this,n,i){const s=this.strings;let a=!1;if(s===void 0)t=Pr(this,t,r,0),a=!cn(t)||t!==this._$AH&&t!==Vr,a&&(this._$AH=t);else{const o=t;let u,h;for(t=s[0],u=0;u<s.length-1;u++)h=Pr(this,o[n+u],r,u),h===Vr&&(h=this._$AH[u]),a||=!cn(h)||h!==this._$AH[u],h===ce?t=ce:t!==ce&&(t+=(h??"")+s[u+1]),this._$AH[u]=h}a&&!i&&this.j(t)}j(t){t===ce?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Cx extends zi{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===ce?void 0:t}}class Fx extends zi{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==ce)}}class Gx extends zi{constructor(t,r,n,i,s){super(t,r,n,i,s),this.type=5}_$AI(t,r=this){if((t=Pr(this,t,r,0)??ce)===Vr)return;const n=this._$AH,i=t===ce&&n!==ce||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,s=t!==ce&&(n===ce||i);i&&this.element.removeEventListener(this.name,this,n),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Rx{constructor(t,r,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=r,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){Pr(this,t)}}const jx=Zs.litHtmlPolyfillSupport;jx?.(pn,In),(Zs.litHtmlVersions??=[]).push("3.3.2");const Lx=(e,t,r)=>{const n=r?.renderBefore??t;let i=n._$litPart$;if(i===void 0){const s=r?.renderBefore??null;n._$litPart$=i=new In(t.insertBefore(ln(),s),s,void 0,r??{})}return i._$AI(e),i};const Ks=globalThis;class an extends br{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Lx(r,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Vr}}an._$litElement$=!0,an.finalized=!0,Ks.litElementHydrateSupport?.({LitElement:an});const Nx=Ks.litElementPolyfillSupport;Nx?.({LitElement:an});(Ks.litElementVersions??=[]).push("4.2.2");const Dx=e=>(t,r)=>{r!==void 0?r.addInitializer(()=>{customElements.define(e,t)}):customElements.define(e,t)};const Wx={attribute:!0,type:String,converter:ni,reflect:!1,hasChanged:Qs},qx=(e=Wx,t,r)=>{const{kind:n,metadata:i}=r;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),n==="setter"&&((e=Object.create(e)).wrapped=!0),s.set(r.name,e),n==="accessor"){const{name:a}=r;return{set(o){const u=t.get.call(this);t.set.call(this,o),this.requestUpdate(a,u,e,!0,o)},init(o){return o!==void 0&&this.C(a,void 0,e,o),o}}}if(n==="setter"){const{name:a}=r;return function(o){const u=this[a];t.call(this,o),this.requestUpdate(a,u,e,!0,o)}}throw Error("Unsupported decorator location: "+n)};function Hx(e){return(t,r)=>typeof r=="object"?qx(e,t,r):((n,i,s)=>{const a=i.hasOwnProperty(s);return i.constructor.createProperty(s,n),a?Object.getOwnPropertyDescriptor(i,s):void 0})(e,t,r)}function Ge(e){return Hx({...e,state:!0,attribute:!1})}const Yx=(e,t,r)=>(r.configurable=!0,r.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(e,t,r),r);function Ch(e,t){return(r,n,i)=>{const s=a=>a.renderRoot?.querySelector(e)??null;return Yx(r,n,{get(){return s(this)}})}}const Xx=bx`
  :host {
    display: block;
    font-family: system-ui, -apple-system, sans-serif;
    color: #e0e0e0;
    background: #1a1a2e;
    min-height: 100vh;
  }

  .container {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  header {
    padding: 1rem 2rem;
    background: #16213e;
    border-bottom: 1px solid #0f3460;
  }

  header h1 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    background: linear-gradient(90deg, #00d9ff, #00ff88);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  header p {
    margin: 0.25rem 0 0;
    font-size: 0.875rem;
    color: #8892b0;
  }

  .main {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  .controls {
    width: 320px;
    padding: 1.5rem;
    background: #16213e;
    overflow-y: auto;
    border-right: 1px solid #0f3460;
  }

  .control-group {
    margin-bottom: 1.5rem;
  }

  .control-group h3 {
    margin: 0 0 0.75rem;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #00d9ff;
  }

  .control-hint {
    margin: 0 0 0.5rem;
    font-size: 0.7rem;
    color: #666;
    line-height: 1.3;
  }

  .control-item {
    margin-bottom: 1rem;
  }

  .control-item label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
    color: #a0a0a0;
  }

  .control-item label span {
    font-family: monospace;
    color: #00ff88;
  }

  input[type="range"] {
    width: 100%;
    height: 6px;
    background: #0f3460;
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    background: #00d9ff;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.15s;
  }

  input[type="range"]::-webkit-slider-thumb:hover {
    background: #00ff88;
  }

  input[type="number"] {
    width: 100%;
    padding: 0.5rem;
    background: #0f3460;
    border: 1px solid #1a3a5c;
    border-radius: 4px;
    color: #e0e0e0;
    font-family: monospace;
    font-size: 0.875rem;
  }

  input[type="number"]:focus {
    outline: none;
    border-color: #00d9ff;
  }

  .file-input-wrapper {
    position: relative;
  }

  .file-input-wrapper input[type="file"] {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
  }

  .file-input-label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #0f3460, #16213e);
    border: 2px dashed #0f3460;
    border-radius: 8px;
    color: #8892b0;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .file-input-wrapper:hover .file-input-label {
    border-color: #00d9ff;
    color: #00d9ff;
  }

  .canvas-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    gap: 1rem;
    overflow: auto;
  }

  .canvas-container {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  .canvas-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .canvas-wrapper h4 {
    margin: 0;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #8892b0;
  }

  canvas {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  #input-canvas {
    max-width: 400px;
    background: #0a0a14;
  }

  #output-canvas {
    max-width: 600px;
    background: #0a0a14;
  }

  .error {
    padding: 1rem;
    background: rgba(255, 82, 82, 0.1);
    border: 1px solid #ff5252;
    border-radius: 8px;
    color: #ff5252;
    font-size: 0.875rem;
  }

  .processing {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #00d9ff;
    font-size: 0.875rem;
  }

  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid #0f3460;
    border-top-color: #00d9ff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  .btn {
    width: 100%;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #00d9ff, #00ff88);
    border: none;
    border-radius: 8px;
    color: #1a1a2e;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .btn:hover {
    opacity: 0.9;
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .btn-secondary {
    background: #0f3460;
    color: #e0e0e0;
  }

  /* Tablet and mobile: stack layout */
  @media (max-width: 900px) {
    .main {
      flex-direction: column;
    }

    .controls {
      width: 100%;
      max-height: none;
      border-right: none;
      border-bottom: 1px solid #0f3460;
      overflow: visible;
    }

    .controls.collapsed {
      padding: 0;
    }

    .controls.collapsed .controls-content {
      display: none;
    }

    .canvas-container {
      flex-direction: column;
      align-items: center;
    }
  }

  /* Mobile toggle button */
  .controls-toggle {
    display: none;
    width: 100%;
    padding: 1rem;
    background: #16213e;
    border: none;
    border-bottom: 1px solid #0f3460;
    color: #e0e0e0;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    align-items: center;
    justify-content: space-between;
  }

  .controls-toggle .toggle-icon {
    transition: transform 0.3s ease;
  }

  .controls-toggle .toggle-icon.expanded {
    transform: rotate(180deg);
  }

  .controls-content {
    padding: 1.5rem;
  }

  @media (max-width: 900px) {
    .controls-toggle {
      display: flex;
    }

    .controls {
      padding: 0;
    }

    .controls-content {
      padding: 1rem;
    }
  }

  /* Small mobile screens */
  @media (max-width: 600px) {
    header {
      padding: 0.75rem 1rem;
    }

    header h1 {
      font-size: 1.25rem;
    }

    header p {
      font-size: 0.75rem;
    }

    .controls-content {
      padding: 1rem;
    }

    .control-group {
      margin-bottom: 1rem;
    }

    .control-group h3 {
      font-size: 0.7rem;
      margin-bottom: 0.5rem;
    }

    .control-item {
      margin-bottom: 0.75rem;
    }

    .control-item label {
      font-size: 0.8rem;
    }

    /* Larger touch targets for sliders */
    input[type="range"] {
      height: 8px;
      padding: 8px 0;
    }

    input[type="range"]::-webkit-slider-thumb {
      width: 24px;
      height: 24px;
    }

    .file-input-label {
      padding: 1rem;
      font-size: 1rem;
    }

    .btn {
      padding: 1rem;
      font-size: 1rem;
    }

    .canvas-area {
      padding: 1rem;
      gap: 0.75rem;
    }

    .canvas-container {
      gap: 1rem;
      width: 100%;
    }

    .canvas-wrapper {
      width: 100%;
    }

    .canvas-wrapper h4 {
      font-size: 0.7rem;
    }

    #input-canvas,
    #output-canvas {
      max-width: 100%;
      width: 100%;
    }

    #input-canvas {
      max-width: 100%;
    }

    #output-canvas {
      max-width: 100%;
    }
  }

  /* Very small screens */
  @media (max-width: 400px) {
    header h1 {
      font-size: 1.1rem;
    }

    .control-item label {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }

    .control-item label span {
      font-size: 0.75rem;
    }
  }

  /* Landscape mobile optimization */
  @media (max-height: 500px) and (orientation: landscape) {
    .container {
      height: auto;
      min-height: 100vh;
    }

    header {
      padding: 0.5rem 1rem;
    }

    header h1 {
      font-size: 1rem;
    }

    header p {
      display: none;
    }

    .main {
      flex-direction: row;
    }

    .controls {
      width: 280px;
      max-height: calc(100vh - 50px);
      overflow-y: auto;
    }

    .controls-toggle {
      display: none;
    }

    .controls-content {
      display: block !important;
      padding: 0.75rem;
    }

    .control-group {
      margin-bottom: 0.75rem;
    }

    .control-item {
      margin-bottom: 0.5rem;
    }

    .canvas-area {
      padding: 0.5rem;
    }

    .canvas-container {
      flex-direction: row;
      gap: 0.5rem;
    }
  }
`,kr=class kr{constructor(t){this.ctx=null,this.format=null,this.device=null,this.pipeline=null,this.sampler=null,this.currentWidth=0,this.currentHeight=0,this.canvas=t,this.started=this.start()}async start(){const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("WebGPU adapter not found");this.device=await t.requestDevice(),this.format=navigator.gpu.getPreferredCanvasFormat(),this.ctx=this.canvas.getContext("webgpu"),this.ctx.configure({device:this.device,format:this.format,alphaMode:"opaque",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),this.pipeline=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.device.createShaderModule({code:kr.vertexShaderSource}),entryPoint:"vert_main"},fragment:{module:this.device.createShaderModule({code:kr.fragmentShaderSource}),entryPoint:"frag_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"}}),this.sampler=this.device.createSampler({})}async draw(t){if(await this.started,!this.device||!this.pipeline||!this.sampler||!this.ctx)throw new Error("WebGPU not initialized");if(this.currentWidth!==t.displayWidth||this.currentHeight!==t.displayHeight){this.canvas.width=t.displayWidth,this.canvas.height=t.displayHeight,this.currentWidth=t.displayWidth,this.currentHeight=t.displayHeight;const a=this.format;if(!a)throw new Error("WebGPU not initialized");this.ctx.configure({device:this.device,format:a,alphaMode:"opaque",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT})}const r=this.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:1,resource:this.sampler},{binding:2,resource:this.device.importExternalTexture({source:t})}]}),n=this.device.createCommandEncoder(),s={colorAttachments:[{view:this.ctx.getCurrentTexture().createView(),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}]};try{const a=n.beginRenderPass(s);a.setPipeline(this.pipeline),a.setBindGroup(0,r),a.draw(6,1,0,0),a.end(),this.device.queue.submit([n.finish()])}finally{t.close()}}destroy(){this.device?.destroy(),this.device=null,this.ctx=null,this.pipeline=null,this.sampler=null}};kr.vertexShaderSource=`
    struct VertexOutput {
      @builtin(position) Position: vec4<f32>,
      @location(0) uv: vec2<f32>,
    }

    @vertex
    fn vert_main(@builtin(vertex_index) VertexIndex: u32) -> VertexOutput {
      var pos = array<vec2<f32>, 6>(
        vec2<f32>( 1.0,  1.0),
        vec2<f32>( 1.0, -1.0),
        vec2<f32>(-1.0, -1.0),
        vec2<f32>( 1.0,  1.0),
        vec2<f32>(-1.0, -1.0),
        vec2<f32>(-1.0,  1.0)
      );

      var uv = array<vec2<f32>, 6>(
        vec2<f32>(1.0, 0.0),
        vec2<f32>(1.0, 1.0),
        vec2<f32>(0.0, 1.0),
        vec2<f32>(1.0, 0.0),
        vec2<f32>(0.0, 1.0),
        vec2<f32>(0.0, 0.0)
      );

      var output : VertexOutput;
      output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);
      output.uv = uv[VertexIndex];
      return output;
    }
  `,kr.fragmentShaderSource=`
    @group(0) @binding(1) var mySampler: sampler;
    @group(0) @binding(2) var myTexture: texture_external;
    
    @fragment
    fn frag_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {
      return textureSampleBaseClampToEdge(myTexture, mySampler, uv);
    }
  `;let ns=kr;var Qx=Object.defineProperty,Zx=Object.getOwnPropertyDescriptor,be=(e,t,r,n)=>{for(var i=n>1?void 0:n?Zx(t,r):t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&Qx(t,r,i),i};const zt={k1:-.0014613319981768,k2:-.00329861110580401,k3:.00605760088590183,k4:-.00374209380722371,centerX:-.0306,centerY:-.0452,fov:180,zoom:1};let ye=class extends an{constructor(){super(...arguments),this.k1=zt.k1,this.k2=zt.k2,this.k3=zt.k3,this.k4=zt.k4,this.fov=zt.fov,this.centerX=zt.centerX,this.centerY=zt.centerY,this.zoom=zt.zoom,this.isProcessing=!1,this.errorMessage="",this.hasWebGPU=!0,this.controlsExpanded=!1,this.fisheye=null,this.renderer=null,this.currentImageBitmap=null}connectedCallback(){super.connectedCallback(),this.checkWebGPU(),this.loadDefaultImage()}disconnectedCallback(){super.disconnectedCallback(),this.fisheye?.destroy(),this.renderer?.destroy(),this.currentImageBitmap?.close()}async checkWebGPU(){navigator.gpu||(this.hasWebGPU=!1,this.errorMessage="WebGPU is not supported in this browser. Please use Chrome 113+ or Edge 113+.")}async loadDefaultImage(){try{const t=await(await fetch(`/fisheye.js/test.jpg?t=${Date.now()}`)).blob();await this.loadImage(t)}catch(e){console.warn("Failed to load default image:",e)}}async loadImage(e){try{this.currentImageBitmap?.close(),this.currentImageBitmap=await createImageBitmap(e),await this.updateComplete;const t=this.inputCanvas.getContext("2d");t&&(this.inputCanvas.width=this.currentImageBitmap.width,this.inputCanvas.height=this.currentImageBitmap.height,t.drawImage(this.currentImageBitmap,0,0)),await this.processImage()}catch(t){this.errorMessage=`Failed to load image: ${t}`}}async handleFileUpload(e){const r=e.target.files?.[0];r&&await this.loadImage(r)}async processImage(){if(!(!this.currentImageBitmap||!this.hasWebGPU)){this.isProcessing=!0,this.errorMessage="";try{await this.updateComplete,this.fisheye?this.fisheye.updateConfig({k1:this.k1,k2:this.k2,k3:this.k3,k4:this.k4,fov:this.fov,centerX:this.centerX,centerY:this.centerY,zoom:this.zoom,width:this.currentImageBitmap.width,height:this.currentImageBitmap.height}):this.fisheye=new vx({k1:this.k1,k2:this.k2,k3:this.k3,k4:this.k4,fov:this.fov,centerX:this.centerX,centerY:this.centerY,zoom:this.zoom,width:this.currentImageBitmap.width,height:this.currentImageBitmap.height}),this.renderer||(this.renderer=new ns(this.outputCanvas));const e=new VideoFrame(this.currentImageBitmap,{timestamp:0});let t=null,r=!1;try{t=await this.fisheye.dewarp(e),e.close(),r=!0,await this.renderer.draw(t),t=null}finally{r||e.close(),t?.close(),this.isProcessing=!1}}catch(e){this.errorMessage=`Processing error: ${e}`,console.error(e)}}}handleParamChange(e,t){this[e]=t,this.processImage()}resetToDefaults(){this.loadDefaultImage()}toggleControls(){this.controlsExpanded=!this.controlsExpanded}render(){return xr`
      <div class="container">
        <header>
          <h1>fisheye.js</h1>
          <p>GPU-accelerated fisheye dewarping using WebGPU</p>
        </header>

        <div class="main">
          <aside class="controls ${this.controlsExpanded?"":"collapsed"}">
            <button class="controls-toggle" @click=${this.toggleControls}>
              <span>Controls</span>
              <span class="toggle-icon ${this.controlsExpanded?"expanded":""}"></span>
            </button>
            <div class="controls-content">
            ${this.errorMessage&&!this.hasWebGPU?xr`<div class="error">${this.errorMessage}</div>`:xr`
                  <div class="control-group">
                    <h3>Image</h3>
                    <div class="file-input-wrapper">
                      <input
                        type="file"
                        accept="image/*"
                        @change=${this.handleFileUpload}
                      />
                      <div class="file-input-label">
                        <span></span>
                        Upload Image
                      </div>
                    </div>
                  </div>

                  <div class="control-group">
                    <h3>Distortion Coefficients</h3>
                    <p class="control-hint">OpenCV fisheye: _d = (1 + k1 + k2 + k3 + k4). Typical |k| &lt; 0.1.</p>
                    ${this.renderSlider("k1",this.k1,-.1,.1,1e-4)}
                    ${this.renderSlider("k2",this.k2,-.1,.1,1e-4)}
                    ${this.renderSlider("k3",this.k3,-.1,.1,1e-4)}
                    ${this.renderSlider("k4",this.k4,-.1,.1,1e-4)}
                  </div>

                  <div class="control-group">
                    <h3>Camera Parameters</h3>
                    ${this.renderSlider("fov",this.fov,60,220,1)}
                    ${this.renderSlider("centerX",this.centerX,-.5,.5,.001)}
                    ${this.renderSlider("centerY",this.centerY,-.5,.5,.001)}
                    ${this.renderSlider("zoom",this.zoom,.1,3,.01)}
                  </div>

                  <div class="control-group">
                    <button class="btn btn-secondary" @click=${this.resetToDefaults}>
                      Reset to Defaults
                    </button>
                  </div>
                `}
            </div>
          </aside>

          <div class="canvas-area">
            ${this.errorMessage&&this.hasWebGPU?xr`<div class="error">${this.errorMessage}</div>`:""}
            ${this.isProcessing?xr`
                  <div class="processing">
                    <div class="spinner"></div>
                    Processing...
                  </div>
                `:""}

            <div class="canvas-container">
              <div class="canvas-wrapper">
                <h4>Input (Fisheye)</h4>
                <canvas id="input-canvas" width="640" height="480"></canvas>
              </div>
              <div class="canvas-wrapper">
                <h4>Output (Dewarped)</h4>
                <canvas id="output-canvas" width="640" height="480"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    `}renderSlider(e,t,r,n,i){return xr`
      <div class="control-item">
        <label>
          ${e}
          <span>${t.toFixed(i<=1e-4?4:i<1?3:0)}</span>
        </label>
        <input
          type="range"
          min=${r}
          max=${n}
          step=${i}
          .value=${String(t)}
          @input=${s=>this.handleParamChange(e,Number(s.target.value))}
        />
      </div>
    `}};ye.styles=Xx;be([Ge()],ye.prototype,"k1",2);be([Ge()],ye.prototype,"k2",2);be([Ge()],ye.prototype,"k3",2);be([Ge()],ye.prototype,"k4",2);be([Ge()],ye.prototype,"fov",2);be([Ge()],ye.prototype,"centerX",2);be([Ge()],ye.prototype,"centerY",2);be([Ge()],ye.prototype,"zoom",2);be([Ge()],ye.prototype,"isProcessing",2);be([Ge()],ye.prototype,"errorMessage",2);be([Ge()],ye.prototype,"hasWebGPU",2);be([Ge()],ye.prototype,"controlsExpanded",2);be([Ch("#output-canvas")],ye.prototype,"outputCanvas",2);be([Ch("#input-canvas")],ye.prototype,"inputCanvas",2);ye=be([Dx("fisheye-demo")],ye);
